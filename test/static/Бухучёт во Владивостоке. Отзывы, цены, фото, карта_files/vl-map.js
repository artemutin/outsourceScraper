var CatalogVlMap=function(a){this.constructor(a);return{init:this._init.bind(this),transform:this._transform.bind(this),addMarkers:this._addMarkers.bind(this),addLocations:this._addLocations.bind(this),getBounds:this._getBounds.bind(this),getMarkerByAddressId:this._getMarkerByAddressId.bind(this),focusMarker:this._focusMarker.bind(this),getZoom:this._getZoom.bind(this),setOption:this._setOption.bind(this),getCenter:this._getCenter.bind(this),removeMarkers:this._removeMarkers.bind(this),getDefaultOptions:this.getDefaultOptions.bind(this),
updateSize:this.updateSize.bind(this),setCenter:this.centerAt.bind(this),setZoom:this.setZoom.bind(this),zoomToFocusFeature:this.zoomToFocusFeature.bind(this),getMap:function(){return this.map}.bind(this)}};CatalogVlMap.prototype.constructor=function(a){this.options={};this.map={};this.event={};this.CLUSTER_DISTANCE=30;this.CLUSTER_MARGIN=60;this.CLUSTER_GRIDSIZE=256};
CatalogVlMap.prototype.getDefaultOptions=function(){return{target:document.getElementById("vlMapPlaceholder"),zoom:12,minZoom:6,maxZoom:18,center:[131.8892,43.1129],onMarkerFocus:null,onMarkerBlur:null,onZoom:null,onMapMoveEnd:null,serverCluster:!0,fitExtent:!1,focusMarkerZoom:17,controls:{Zoom:!0,FullScreen:!1,Rotate:!0,Attribution:!0,ScaleLine:!0}}};
CatalogVlMap.prototype._init=function(a){this.options=_.defaults(a,this.getDefaultOptions());this.map=new Mapvlru({target:this.options.target?this.options.target:this.getDefaultOptions().target,basemap:{zoom:this.options.zoom?this.options.zoom:this.getDefaultOptions().zoom,center:this.getValidCenter(),minZoom:this.options.minZoom?this.options.minZoom:this.getDefaultOptions().minZoom,extent:[126.45367490292469,41.64339422602288,141.7576299810497,47.875120173688174]},controls:this.options.controls||
this.getDefaultOptions().controls,interactions:{MouseWheelZoom:this.options.scrollZoom},objectInteractions:{hover:{state:!1,styled:!1},click:{state:!0,styled:!0,dblClickDelay:!0}},layers:{roadPoi:!1,traffic:!1},OSMSwitcher:!0,geoClicker:!1,popup:{position:"top"}});this.featureType=this.options.serverCluster?"marker":"cluster";return this};CatalogVlMap.prototype.getValidCenter=function(a){a=a?a:this.options.center;return isNaN(a[0])||isNaN(a[1])?this.getDefaultOptions().center:[1*a[0],1*a[1]]};
CatalogVlMap.prototype._addMarkers=function(a,b,c){a&&a.length&&(b&&this.map.clear(),this.markers=this.map.addMarkers(a,{clustered:!this.options.serverCluster,fitExtent:this.options.fitExtent,clusterDistance:this.CLUSTER_DISTANCE,layer:"companiesLayer",style:function(a){return this.getMarkerStyle.call(this,a)}.bind(this)}));this.setEvents();c instanceof Function&&c.call(this)};
CatalogVlMap.prototype._addLocations=function(a,b){a&&a.length&&(this.locations=this.map.addMarkers(a,{clustered:!1,fitExtent:!1,layer:"locationsLayer",style:this.getLocationMarkerStyle.bind(this,!1)}));this.setEvents();b instanceof Function&&b.call(this)};CatalogVlMap.prototype._setOption=function(a,b){this.options[a]=b;"serverCluster"===a&&(this.featureType=this.options.serverCluster?"marker":"cluster")};
CatalogVlMap.prototype.getMarkerStyle=function(a,b){var c=new ol.style.Fill({color:b?"#f9844b":"#6aae08"}),e=new ol.style.Fill({color:"#fff"}),f=new ol.style.Stroke({color:"#fff",width:2.5}),d=this.getDataByFeature(a),d=d.isServerCluster?d.clusterSize:d.length;return[new ol.style.Style({image:new ol.style.Circle({fill:c,stroke:f,radius:this.getMarkerRadius(d)}),fill:c,stroke:f,text:new ol.style.Text({text:1<d?d:"",font:"13px Arial",fill:e})})]};
CatalogVlMap.prototype.getLocationMarkerStyle=function(a){var b=new Image;b.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAbCAYAAACX6BTbAAAC+0lEQVRIS6VWTUhUURT+DiQ0LXpRQlTiGEm5yZEKczNlE2QEloJLNV3YxkKlNhoV/WCLCg1yk4v8WwZKEmSQVrNRqXBsUUmCihWBhdOiCQxufNf3Hs83783IdODxfu653zn3nO+c8wQpRClVBOAsAN55bQGwDGDKvHpFhM+eIl5flVKlAK4B4D2dvARwXUR4XyNJ4EqpTgBN1EqsLGN8YQCxr8NYjMeQWIkjkGUgxwghtLMcJbnVCGTxMFo6RaTFib4GXCk1BOAMFZ5+uIWx2Qca0E9oKJJ/AacKLlsqPSJSb73Y4EqpHsaX3nZGy7AYn04XDns9xyhEc3jEOoVtQIMrpSoADGYCbFlwGagUkSELfA5AsO9tAyYWBtbtsVvxcG41ag928/OciOwWy2sm7PZoiSfwLmM/qgrvYm/2Ecwsvcbj6Uv4En/vqdsaGdcJB1BJcJ1Ebhib7fLccKPsI7ZtCtprP37P4+pIgafusT2N2hEAvQRnEYTaR4s9vaHXbZFJKs+bvCefg376jH1rZIL6UwRXfGocDPjGuqsyYa0RWBfWevQJznI2Lg5vx5+/v3yOeh5VhXfstVQh3LhhM+6Vf6dunOD05mhH9AQ+L0V9vedxWY2ka6oayM8OoyX8nDiv7IT+Lw0trxx01AmtA/CIFLsfLcuY49bGpvCIpiyAeoKz87CIjCvP9uFnYiFjA1sDubh58pOON4A8q0J1Xxmf70f/u3MZg9cceIiSYM0qx0XqLPA8s/kb6RLrZ9mRSHpdJCJzzq7YDKCD1df+otiXll7gpF/b8UmriltEhDMB7n6uqzVVn/ECd/STmIhwHGpxg9vJXW/8HXFeTaIIizIZnF/MoczCMtIZcAGXuoe134Dm0bSB2Lcn6HvTsCYHjHHtoW6Edpy2aJcEnBQWZzydJ2AOWMHs4eySHAhmz2YoPIFTgjtCxBoIsafwL4BT35z4MQAVpJwfPT3D4joBk0wD+q/AlF4Azc7keRlIC25tMsch+UtQTq+08g9xE1eO9nr73gAAAABJRU5ErkJggg\x3d\x3d";
a&&(b.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAbCAYAAACX6BTbAAACrElEQVRIS6WWP0wUURCHv6mwEM8Ko4mChdBIwIiVMULoIChUKhRyiUSthERjp8HOWEgnCSZAg1pJJNAZNFpihGADNqiJRioRC6me+e27vd272727nJNclt2d/Wbe/MUoI865duAqoKt+B4FfwGruN2tm+jtRLOmpc64TuA/oWkneAONmpmuBlMCdcxPArUBrbxfWF+DzMvzc8Pd19XCoBU50QWufv/cyYWZjcXoB3Dk3D1wMFN5PwsqcB6aJwGeG4Oz1UGPGzLLhTR7unJsJ4ivY3Ahsb1QKR/S+oQUGp8JT5A0EcOdcP/CyJnBootDAgJnNh/AtoJHFe/BpoXqPizVP9kHvAz3dMrPjlvdaYZi+nAxuaIbuO3CsA76uwOtHsL2ZrJt9DjoFDAjuk6gPlMAkubEImSPRm53vMNmbrNsx6B2BWcHVBG1MX0r2Rl5nX0j5S67uVc+N6fotIO9hVXAXuPDwVHqs734M3wnsG6sKfcHVzhkmzsHen5SjDkH37ehduRDW7YfRd9LdEVzenGfuGnz7kO69krSvHv7ulu+Bo6dh8Kk4b6OE/m8Zhm5F5RgkdBiYDkrs2UjtNR5+eWXKlyxkBdcYVRNleNIDv3/UbuDAYbi5FMQbaAo71M+V9VewpElbo/SMQ+sFX+NmwyG8KTf8MxUTm2Y3SqS8bjezrfhUHAUeo+5TQ6WVZRJc5adG8108ZmbaCRTPc9+t5eZMEjyaJ2tmpnUYSDE8Sm618Y/i7JNopqYshetJbimrsTIVE1wI7ixe1mkLWkfzBrQ/1WDxHCjGmtvao77sSsAlYYmHs+AEyoEMaIZrSgrsZ3YquCw8FiL1QFuwAjeXobkr3JVrQL9KLq06E8NSdAIlWQb8fwVeZoHRePKSDFSEhx/l1qHqV1Btr4ryD0eZFY7U1LBcAAAAAElFTkSuQmCC");
return[new ol.style.Style({image:new ol.style.Icon({anchor:[12,0],anchorOrigin:"bottom-left",anchorXUnits:"pixels",anchorYUnits:"fraction",img:b,imgSize:[23,27],snapToPixel:!1})})]};CatalogVlMap.prototype.getMarkerRadius=function(a){return a=11*(1+(a&&1<a?String(a).length:0)/3)};CatalogVlMap.prototype.clickHandle=function(a){this.getDataByFeature(a.element).isLocation?this.focusLocation(a.element,!0):this.options.clickControl?this.setFocus(a.element,!0):this.setFocus(a.element,!1)};
CatalogVlMap.prototype.clickOutHandle=function(a){this.hasFocus&&this.options.clickControl&&this.setFocus.call(this,this.hasFocus,!1);this.focusLocation(!1)};
CatalogVlMap.prototype.setEvents=function(){var a=this;this.map.$off("markerClick");this.map.$on("markerClick",this.clickHandle.bind(this));this.map.$off("markerClickOut");this.map.$on("markerClickOut",this.clickOutHandle.bind(this));this.map.$off(this.featureType+"Click");this.map.$on(this.featureType+"Click",this.clickHandle.bind(this));this.map.$off(this.featureType+"ClickOut");this.map.$on(this.featureType+"ClickOut",this.clickOutHandle.bind(this));this.event.mapClick||(this.event.mapClick=!0,
this.map._map.on("click",function(b){a.fakeFocus&&(a.fakeFocus=!1,a.map.$emit("clusterClickOut"));if(a.options.onMapClick)a.options.onMapClick(a._transform(b.coordinate,!0))}));if(!this.event.propertychange){this.event.propertychange=!0;var b,c;this.map._map.getView().on("propertychange",function(e){a.event.propertychange=!0;"center"===e.key&&a.options.onMapMoveEnd&&(clearTimeout(b),b=setTimeout(function(){a.options.onMapMoveEnd.call(a,a._getCenter())},300));"resolution"===e.key&&(clearTimeout(c),
c=setTimeout(function(){a.options.onZoom&&a.options.onZoom.call(a,a._getZoom())},300))})}};CatalogVlMap.prototype.setFocus=function(a,b){if(!a)return!1;var c=this.getDataByFeature(a);this.hasFocus=b?a:null;a.setCustomStyle(this.getMarkerStyle(a,b));b?this.options.onMarkerFocus&&this.options.onMarkerFocus.call(this,c,a):this.options.onMarkerBlur&&this.options.onMarkerBlur.call(this,c,a)};
CatalogVlMap.prototype.focusLocation=function(a,b){a||(a=this.hasFocusLocation,b=!1);this.hasFocusLocation=b?a:!1;a&&(a.setCustomStyle(this.getLocationMarkerStyle(b)),b?this.showLocationBaloon(a.get("data"),a.getGeometry().getCoordinates()):this.hideLocationBaloon())};CatalogVlMap.prototype.getDataByFeature=function(a){if(!a)return!1;var b=a.get("features"),c=[];b?_.each(b,function(a,b){c.push(a.get("data"))}):c=a.get("data");return c};
CatalogVlMap.prototype._transform=function(a,b){return b?ol.proj.transform(a,"EPSG:3857","EPSG:4326"):ol.proj.transform([1*a.lon,1*a.lat],"EPSG:3857","EPSG:4326")};CatalogVlMap.prototype._getBounds=function(){return this.map.getBounds()};CatalogVlMap.prototype._getMarkerByAddressId=function(a){return _.find(this.markers,function(b){if(1*b.get("data").addrId===1*a)return b})};
CatalogVlMap.prototype._focusMarker=function(a){if(!a)return!1;var b=[a.getGeometry().getCoordinates()[0],a.getGeometry().getCoordinates()[1]];this.setZoom(this.options.focusMarkerZoom).centerAt(this._transform({lon:b[0],lat:b[1]}));setTimeout(function(){a=a.getRelatedCluster()||a;this.setFocus(a,!0);this.fakeFocus=!0}.bind(this),500)};CatalogVlMap.prototype.centerAt=function(a){this.map.centerAt(this.getValidCenter(a));return this};
CatalogVlMap.prototype.setZoom=function(a){this.map._map.getView().setZoom(a);return this};CatalogVlMap.prototype._getZoom=function(){return this.map._map.getView().getZoom()};CatalogVlMap.prototype._removeMarkers=function(a){this.map.removeMarkers(a)};CatalogVlMap.prototype._getCenter=function(a){var b={lon:this.map._map.getView().getCenter()[0],lat:this.map._map.getView().getCenter()[1]};a&&(b=this._transform(b));return b};CatalogVlMap.prototype.updateSize=function(){this.map.updateSize();this.map.$emit("clusterClickOut")};
CatalogVlMap.prototype.addControl=function(a){};CatalogVlMap.prototype.removeControl=function(a){};CatalogVlMap.prototype.showLocationBaloon=function(a,b){var c=$("#Baloon_"+a.id);c.length||(c=$('\x3cdiv class\x3d"map-baloon location" id\x3d"Baloon_'+a.id+'"\x3e'+a.title+"\x3c/div\x3e"));this.map.getPopup().draw({el:c[0],coordinates:b})};
CatalogVlMap.prototype.hideLocationBaloon=function(){setTimeout(function(){this.map._featureInteractions.clickMarker.getFeatures().getLength()||this.map.getPopup().hide()}.bind(this),100)};
CatalogVlMap.prototype.zoomToFocusFeature=function(){if(this.hasFocus){var a=this.hasFocus.getGeometry().getCoordinates(),b=this.map._map.getView();this.map._map.beforeRender(ol.animation.zoom({resolution:b.getResolution(),duration:250,easing:ol.easing.easeOut}));this.map._map.beforeRender(ol.animation.pan({duration:250,source:b.getCenter(),easing:ol.easing.easeOut}));b.setZoom(this.map._map.getView().getZoom()+1);b.setCenter(a)}};