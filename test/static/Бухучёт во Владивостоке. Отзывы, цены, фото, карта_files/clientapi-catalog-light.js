function changeLoginLinks(e){function t(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)"),i=n.exec(t?t:location.search);return null==i?"":decodeURIComponent(i[1].replace(/\+/g," "))}function n(e){var t=location.origin?location.origin:location.protocol+"//"+location.hostname,n=encodeURIComponent(t+location.pathname+(location.search||"")),i=encodeURIComponent(t+"/verify-slave-auth?return_url="+n),o=commentsvlru.control.config.baseUrlStatic,r={farpost:o+"/backend/public/slave-auth/farpost?returnUrl="+i,vkontakte:o+"/backend/public/slave-auth/vkontakte?returnUrl="+i,odnoklassniki:o+"/backend/public/slave-auth/odnoklassniki?returnUrl="+i,facebook:o+"/backend/public/slave-auth/facebook?returnUrl="+i,google:o+"/backend/public/slave-auth/google?returnUrl="+i};if("undefined"==typeof r[e])throw new Error("Wrong auth key");return r[e]}function i(t){var i=n(t)+encodeURIComponent(encodeURIComponent("#comments")),o=$('.open-auth-link[href*="login/'+t+'"]',e);o.attr("href",i?i+"&bindComments=1":"#").removeClass("login-link").removeAttr("target")}function o(e,i){var o,r=n(i),a=e.find('.open-auth-link[href*="login/'+i+'"]'),s=a.attr("href"),l=r;if(e.is("#handlebarsProfileFollowers")&&-1!=s.indexOf("%23")){var c=s.replace(/.*?%23/g,"");l+=encodeURIComponent(encodeURIComponent("#"+c))}else l+=encodeURIComponent(encodeURIComponent("#comments"));(o=t("action",s))&&(l=l+"&action="+o),l+="&bindComments=1",a.attr("href",l?l:"#").removeClass("login-link").removeAttr("target")}function r(e,t){o(t,"vkontakte"),o(t,"facebook"),o(t,"google"),o(t,"odnoklassniki"),o(t,"farpost")}try{i("vkontakte"),i("facebook"),i("google"),i("odnoklassniki"),i("farpost"),commentsvlru.on("ModalFormUIInitializer",$.proxy(r,window))}catch(a){}return e}function onThreadLoad(e){return e=$("<div>"+e+"</div"),e=updateUserNameLink(e),$(".inlineFormAuth",e).show(),e=changeLoginLinks(e),e.html()}function onProfileInit(e){return e=$("<div>"+e+"</div"),e=changeLoginLinks(e),e.html()}function subscribeLinkComments(){var e=function(){try{$.publish("linkComments.commentsvlru")}catch(e){}};$.subscribe("load.commentsvlru",e),$.subscribe("pageload.commentsvlru",e),$.subscribe("commentadd.commentsvlru",e),$.subscribe("commentedit.commentsvlru",e)}function commentsvlruInit(e){e.doLinkPhotos&&subscribeLinkComments(),$.subscribe("load.commentsvlru",makeCommentsSlider),$.subscribe("load.commentsvlru",function(){try{var e=commentsvlru.getCurrentThreadTotalCommentsCount(),t=$(".commentsHeading"),n=$(".commentsLink");e>0?(t.text(String(t.attr("countText")).replace("?",e)),n.size()&&n.text(String(n.text()).replace("?",e))):n.size()&&n.text(n.attr("addText")).attr("onclick",n.attr("addOnclick"))}catch(i){}}),commentsvlru.init({embedded:!0,features:e.features,threadName:e.threadName,addShareOnPost:!0,addShareBackUrl:location.href+"#comments",debug:e.debug,baseUrl:e.baseUrl,noLoginActionsOverride:!0,storeNameOnClient:!0,cssFiles:e.hasOwnProperty("cssFiles")?e.cssFiles:["/css/catalog.css"],theme:e.hasOwnProperty("theme")?e.theme:"",appVersion:1}),e.theme&&commentsvlru._require("imageUpload").setOpenOnInit(!0),commentsvlru.on("ThreadLoad",function(){$.publish("load.commentsvlru")}),commentsvlru.on("PageLoad",function(){$.publish("pageload.commentsvlru")}),commentsvlru.on("CommentAdd",function(){$.publish("commentadd.commentsvlru")}),commentsvlru.on("CommentEdit",function(){$.publish("commentedit.commentsvlru")}),commentsvlru.on("ThreadLoadRender",function(e){e.content=onThreadLoad(e.content)})}function commentsvlruInitForCompany(e){e.theme="company";var t={embedded:!0,features:e.features,threadName:e.threadName,addShareOnPost:!0,addShareBackUrl:location.href+"#comments",debug:e.debug,baseUrl:e.baseUrl,noLoginActionsOverride:!0,storeNameOnClient:!0,cssFiles:e.hasOwnProperty("cssFiles")?e.cssFiles:["/css/catalog.css"],theme:"company"};$(".commentsvlru").addClass("company"),e.doLinkPhotos&&subscribeLinkComments(),commentsvlru.init(t),bindCommentEvents(e),commentsvlru.require("catalog/tabs").init(commentsvlru),commentsvlru.require("likes").init(),commentsvlru._require("catalog/privateDialog").init(),commentsvlru._require("catalog/primkuponUser").init()}function bindCommentEvents(e,t){if(e=e||{},commentsvlru._require("catalog/desktopStars").init(),commentsvlru._require("catalog/notificationRules").init(),"company"==e.theme){var n=function(){commentsvlru.off("ThreadLoad",n),commentsvlru._require("catalog/collapsedForm").init(commentsvlru)};commentsvlru.on("ThreadLoad",n),commentsvlru._require("catalog/commentType").init()}commentsvlru._require("imageUpload").setOpenOnInit(!0),commentsvlru.on("BeforePostComment",function(t){function n(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))}t.customFields.partner=e.partnerLabel;var i=n("cmt-ref");i&&(t.customFields.cmtRef=i)}),t||commentsvlru.require("catalog/tabs").init(commentsvlru),commentsvlru.on("ThreadLoad",function(){$.publish("load.commentsvlru")}),commentsvlru.on("ThreadLoadRender",function(e){e.content=onThreadLoad(e.content)}),commentsvlru.on("PageLoad",function(){$.publish("pageload.commentsvlru")}),commentsvlru.on("CommentAdd",function(e){$.publish("commentadd.commentsvlru",e)}),commentsvlru.on("ThreadLoad",function(){if($(".user-info-block-embedded").size()){$("#photoReportsContainer").show();var e=$(".user-info-block-embedded"),t=e.offset().top,n=e.next().offset().top,i=30;$("#photoReportsContainer").hide(),t+i>n&&$("#photoReportsContainer").show()}})}function updateUserNameLink(e){try{var t=$("#CommentForm .userNameLabelWrapper",e);if(t.size()&&"anonymous"!=t.attr("type")&&t.attr("readonly")){var n=t.find(".userNameLabel");n.size()&&(t.removeAttr("no-image"),n.html('<a href="/profile" class="inner force-highlight edit-name-profile" title="Редактировать имя в профиле">'+n.text()+"</a>"))}}catch(i){}return e}function updateUserKeys(e){"object"==typeof e&&null!==e&&(e.embedded=!0,$.extend(commentsvlru.control.config,e)),commentsvlru._require("supercookie").init(),commentsvlru.utils.updateUserKey()}function commentsvlruInitForMobile(e){commentsvlru.init({embedded:!0,features:e.features||"",threadName:e.threadName,addShareOnPost:!0,addShareBackUrl:location.href+"#comments",debug:e.debug,baseUrl:e.baseUrl,baseUrlStatic:e.hasOwnProperty("baseUrlStatic")?e.baseUrlStatic:"",noLoginActionsOverride:!0,storeNameOnClient:!0,cssFiles:e.hasOwnProperty("cssFiles")?e.cssFiles:["/css/client-catalog-mobile.css"],theme:"catalog-mobile",appVersion:1}),bindMobileCommentEvents(e)}function bindMobileCommentEvents(e){commentsvlru._require("catalog/mobileStars").init(),commentsvlru._require("catalog/notificationRules").init(),commentsvlru._require("catalog-mobile/commentType").init(),commentsvlru.require("likes").init(),commentsvlru.on("ThreadLoadRender",function(e){e.content=mobileOnThreadLoad(e.content)}),commentsvlru._require("imageUpload").setOpenOnInit(!0),commentsvlru.on("BeforePostComment",function(t){t.customFields.partner=e.partnerLabel,t.customFields.isMobile=!0}),commentsvlru.on("AfterAddUploadButton",function(){$(".commentsvlru").find(":file").attr("accept","image/*")});var t=function(){commentsvlru.off("ThreadLoad",t),commentsvlru._require("catalog/mobileCollapsedForm").init(commentsvlru)};commentsvlru.on("ThreadLoad",t),commentsvlru.on("CommentAdd",function(e){commentsvlru.control.scrollTo.scroll(e)}),$(".commentsvlru").on("keydown","[name=name]",function(e){return 13==e.keyCode?(e.preventDefault(),e.stopPropagation(),$('.commentsvlru [name="comment"]').focus(),!1):void 0}),commentsvlru._require("catalog/primkuponUser").init()}function mobileOnThreadLoad(e){return e=$("<div>"+e+"</div>"),$(".inlineFormAuth",e).show(),e=changeLoginLinks(e),e.html()}function showLastReview(e){commentsvlru.require("catalog/widget").init({target:e,url:"/widgets/last-reviews"})}function showBestCommentators(e){commentsvlru.require("catalog/widget").init({target:e,url:"/widgets/best-commentators"}),commentsvlru.on("ProfileInitRender",function(e){e.content=onProfileInit(e.content)})}!function(){!function(e){function t(e){return"object"==typeof e?e:{top:e,left:e}}var n=e.scrollTo=function(t,n,i){e(window).scrollTo(t,n,i)};n.defaults={axis:"xy",duration:parseFloat(e.fn.jquery)>=1.3?0:1,limit:!0},n.window=function(){return e(window)._scrollable()},e.fn._scrollable=function(){return this.map(function(){var t=this,n=!t.nodeName||-1!=e.inArray(t.nodeName.toLowerCase(),["iframe","#document","html","body"]);if(!n)return t;var i=(t.contentWindow||t).document||t.ownerDocument||t;return/webkit/i.test(navigator.userAgent)||"BackCompat"==i.compatMode?i.body:i.documentElement})},e.fn.scrollTo=function(i,o,r){return"object"==typeof o&&(r=o,o=0),"function"==typeof r&&(r={onAfter:r}),"max"==i&&(i=9e9),r=e.extend({},n.defaults,r),o=o||r.duration,r.queue=r.queue&&r.axis.length>1,r.queue&&(o/=2),r.offset=t(r.offset),r.over=t(r.over),this._scrollable().each(function(){function a(e){c.animate(d,o,r.easing,e&&function(){e.call(this,i,r)})}if(i){var s,l=this,c=e(l),u=i,d={},m=c.is("html,body");switch(typeof u){case"number":case"string":if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(u)){u=t(u);break}if(u=e(u,this),!u.length)return;case"object":(u.is||u.style)&&(s=(u=e(u)).offset())}e.each(r.axis.split(""),function(e,t){var i="x"==t?"Left":"Top",o=i.toLowerCase(),h="scroll"+i,f=l[h],p=n.max(l,t);if(s)d[h]=s[o]+(m?0:f-c.offset()[o]),r.margin&&(d[h]-=parseInt(u.css("margin"+i))||0,d[h]-=parseInt(u.css("border"+i+"Width"))||0),d[h]+=r.offset[o]||0,r.over[o]&&(d[h]+=u["x"==t?"width":"height"]()*r.over[o]);else{var g=u[o];d[h]=g.slice&&"%"==g.slice(-1)?parseFloat(g)/100*p:g}r.limit&&/^\d+$/.test(d[h])&&(d[h]=d[h]<=0?0:Math.min(d[h],p)),!e&&r.queue&&(f!=d[h]&&a(r.onAfterFirst),delete d[h])}),a(r.onAfter)}}).end()},n.max=function(t,n){var i="x"==n?"Width":"Height",o="scroll"+i;if(!e(t).is("html,body"))return t[o]-e(t)[i.toLowerCase()]();var r="client"+i,a=t.ownerDocument.documentElement,s=t.ownerDocument.body;return Math.max(a[o],s[o])-Math.min(a[r],s[r])}}(jQuery),function(e){var t,n={className:"autosizejs",id:"autosizejs",append:"\n",callback:!1,resizeDelay:10,placeholder:!0},i=["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent","whiteSpace"],o=e('<textarea aria-hidden="true" tabindex="-1"/>').data("autosize",!0)[0];o.style.cssText="position:absolute; top:-999px; left:0; right:auto; bottom:auto; border:0; padding: 0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden; transition:none; -webkit-transition:none; -moz-transition:none;",o.style.lineHeight="99px","99px"===e(o).css("lineHeight")&&i.push("lineHeight"),o.style.lineHeight="",e.fn.autosize=function(r){return this.length?(r=e.extend({},n,r||{}),o.parentNode!==document.body&&e(document.body).append(o),this.each(function(){function n(){var t,n=window.getComputedStyle?window.getComputedStyle(m,null):null;n?(t=parseFloat(n.width),("border-box"===n.boxSizing||"border-box"===n.webkitBoxSizing||"border-box"===n.mozBoxSizing)&&e.each(["paddingLeft","paddingRight","borderLeftWidth","borderRightWidth"],function(e,i){t-=parseFloat(n[i])})):t=h.width(),o.style.width=Math.max(t,0)+"px"}function a(){var a={};if(t=m,o.className=r.className,o.id=r.id,c=parseFloat(h.css("maxHeight")),e.each(i,function(e,t){a[t]=h.css(t)}),e(o).css(a).attr("wrap",h.attr("wrap")),n(),window.chrome){var s=m.style.width;m.style.width="0px";{m.offsetWidth}m.style.width=s}}function s(){var e,i;t!==m?a():n(),o.value=!m.value&&r.placeholder?h.attr("placeholder")||"":m.value,o.value+=r.append||"",o.style.overflowY=m.style.overflowY,i=parseFloat(m.style.height)||0,o.scrollTop=0,o.scrollTop=9e4,e=o.scrollTop,c&&e>c?(m.style.overflowY="scroll",e=c):(m.style.overflowY="hidden",u>e&&(e=u)),e+=f,Math.abs(i-e)>.01&&(m.style.height=e+"px",o.className=o.className,p&&r.callback.call(m,m),h.trigger("autosize.resized"))}function l(){clearTimeout(d),d=setTimeout(function(){var e=h.width();e!==v&&(v=e,s())},parseInt(r.resizeDelay,10))}var c,u,d,m=this,h=e(m),f=0,p=e.isFunction(r.callback),g={height:m.style.height,overflow:m.style.overflow,overflowY:m.style.overflowY,wordWrap:m.style.wordWrap,resize:m.style.resize},v=h.width(),b=h.css("resize");h.data("autosize")||(h.data("autosize",!0),("border-box"===h.css("box-sizing")||"border-box"===h.css("-moz-box-sizing")||"border-box"===h.css("-webkit-box-sizing"))&&(f=h.outerHeight()-h.height()),u=Math.max(parseFloat(h.css("minHeight"))-f||0,h.height()),h.css({overflow:"hidden",overflowY:"hidden",wordWrap:"break-word"}),"vertical"===b?h.css("resize","none"):"both"===b&&h.css("resize","horizontal"),"onpropertychange"in m?"oninput"in m?h.on("input.autosize keyup.autosize",s):h.on("propertychange.autosize",function(){"value"===event.propertyName&&s()}):h.on("input.autosize",s),r.resizeDelay!==!1&&e(window).on("resize.autosize",l),h.on("autosize.resize",s),h.on("autosize.resizeIncludeStyle",function(){t=null,s()}),h.on("autosize.destroy",function(){t=null,clearTimeout(d),e(window).off("resize",l),h.off("autosize").off(".autosize").css(g).removeData("autosize")}),s())})):this}}(jQuery||$),function($){var escapeable=/["\\\x00-\x1f\x7f-\x9f]/g,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};$.toJSON="object"==typeof JSON&&JSON.stringify?JSON.stringify:function(e){if(null===e)return"null";var t=typeof e;if("undefined"===t)return void 0;if("number"===t||"boolean"===t)return""+e;if("string"===t)return $.quoteString(e);if("object"===t){if("function"==typeof e.toJSON)return $.toJSON(e.toJSON());if(e.constructor===Date){var n=e.getUTCMonth()+1,i=e.getUTCDate(),o=e.getUTCFullYear(),r=e.getUTCHours(),a=e.getUTCMinutes(),s=e.getUTCSeconds(),l=e.getUTCMilliseconds();return 10>n&&(n="0"+n),10>i&&(i="0"+i),10>r&&(r="0"+r),10>a&&(a="0"+a),10>s&&(s="0"+s),100>l&&(l="0"+l),10>l&&(l="0"+l),'"'+o+"-"+n+"-"+i+"T"+r+":"+a+":"+s+"."+l+'Z"'}if(e.constructor===Array){for(var c=[],u=0;u<e.length;u++)c.push($.toJSON(e[u])||"null");return"["+c.join(",")+"]"}var d,m,h=[];for(var f in e){if(t=typeof f,"number"===t)d='"'+f+'"';else{if("string"!==t)continue;d=$.quoteString(f)}t=typeof e[f],"function"!==t&&"undefined"!==t&&(m=$.toJSON(e[f]),h.push(d+":"+m))}return"{"+h.join(",")+"}"}},$.evalJSON="object"==typeof JSON&&JSON.parse?JSON.parse:function(src){return eval("("+src+")")},$.secureEvalJSON="object"==typeof JSON&&JSON.parse?JSON.parse:function(src){var filtered=src.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"");if(/^[\],:{}\s]*$/.test(filtered))return eval("("+src+")");throw new SyntaxError("Error parsing JSON, source is not valid.")},$.quoteString=function(e){return e.match(escapeable)?'"'+e.replace(escapeable,function(e){var t=meta[e];return"string"==typeof t?t:(t=e.charCodeAt(),"\\u00"+Math.floor(t/16).toString(16)+(t%16).toString(16))})+'"':'"'+e+'"'}}(jQuery),function(e){"use strict";function t(t){var n=t.data;t.isDefaultPrevented()||(t.preventDefault(),e(this).ajaxSubmit(n))}function n(t){var n=t.target,i=e(n);if(!i.is("[type=submit],[type=image]")){var o=i.closest("[type=submit]");if(0===o.length)return;n=o[0]}var r=this;if(r.clk=n,"image"==n.type)if(void 0!==t.offsetX)r.clk_x=t.offsetX,r.clk_y=t.offsetY;else if("function"==typeof e.fn.offset){var a=i.offset();r.clk_x=t.pageX-a.left,r.clk_y=t.pageY-a.top}else r.clk_x=t.pageX-n.offsetLeft,r.clk_y=t.pageY-n.offsetTop;setTimeout(function(){r.clk=r.clk_x=r.clk_y=null},100)}function i(){if(e.fn.ajaxSubmit.debug){var t="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(t):window.opera&&window.opera.postError&&window.opera.postError(t)}}var o={};o.fileapi=void 0!==e("<input type='file'/>").get(0).files,o.formdata=void 0!==window.FormData;var r=!!e.fn.prop;e.fn.attr2=function(){if(!r)return this.attr.apply(this,arguments);var e=this.prop.apply(this,arguments);return e&&e.jquery||"string"==typeof e?e:this.attr.apply(this,arguments)},e.fn.ajaxSubmit=function(t){function n(n){var i,o,r=e.param(n,t.traditional).split("&"),a=r.length,s=[];for(i=0;a>i;i++)r[i]=r[i].replace(/\+/g," "),o=r[i].split("="),s.push([decodeURIComponent(o[0]),decodeURIComponent(o[1])]);return s}function a(i){for(var o=new FormData,r=0;i.length>r;r++)o.append(i[r].name,i[r].value);if(t.extraData){var a=n(t.extraData);for(r=0;a.length>r;r++)a[r]&&o.append(a[r][0],a[r][1])}t.data=null;var s=e.extend(!0,{},e.ajaxSettings,t,{contentType:!1,processData:!1,cache:!1,type:l||"POST"});t.uploadProgress&&(s.xhr=function(){var n=e.ajaxSettings.xhr();return n.upload&&n.upload.addEventListener("progress",function(e){var n=0,i=e.loaded||e.position,o=e.total;e.lengthComputable&&(n=Math.ceil(100*(i/o))),t.uploadProgress(e,i,o,n)},!1),n}),s.data=null;var c=s.beforeSend;return s.beforeSend=function(e,t){t.data=o,c&&c.call(this,e,t)},e.ajax(s)}function s(n){function o(e){var t=null;try{e.contentWindow&&(t=e.contentWindow.document)}catch(n){i("cannot get iframe.contentWindow document: "+n)}if(t)return t;try{t=e.contentDocument?e.contentDocument:e.document}catch(n){i("cannot get iframe.contentDocument: "+n),t=e.document}return t}function a(){function t(){try{var e=o(v).readyState;i("state = "+e),e&&"uninitialized"==e.toLowerCase()&&setTimeout(t,50)}catch(n){i("Server abort: ",n," (",n.name,")"),s(S),x&&clearTimeout(x),x=void 0}}var n=d.attr2("target"),r=d.attr2("action");w.setAttribute("target",f),l||w.setAttribute("method","POST"),r!=m.url&&w.setAttribute("action",m.url),m.skipEncodingOverride||l&&!/post/i.test(l)||d.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),m.timeout&&(x=setTimeout(function(){k=!0,s(T)},m.timeout));var a=[];try{if(m.extraData)for(var c in m.extraData)m.extraData.hasOwnProperty(c)&&a.push(e.isPlainObject(m.extraData[c])&&m.extraData[c].hasOwnProperty("name")&&m.extraData[c].hasOwnProperty("value")?e('<input type="hidden" name="'+m.extraData[c].name+'">').val(m.extraData[c].value).appendTo(w)[0]:e('<input type="hidden" name="'+c+'">').val(m.extraData[c]).appendTo(w)[0]);m.iframeTarget||(g.appendTo("body"),v.attachEvent?v.attachEvent("onload",s):v.addEventListener("load",s,!1)),setTimeout(t,15);try{w.submit()}catch(u){var h=document.createElement("form").submit;h.apply(w)}}finally{w.setAttribute("action",r),n?w.setAttribute("target",n):d.removeAttr("target"),e(a).remove()}}function s(t){if(!b.aborted&&!O){if(P=o(v),P||(i("cannot access response document"),t=S),t===T&&b)return b.abort("timeout"),void _.reject(b,"timeout");if(t==S&&b)return b.abort("server abort"),void _.reject(b,"error","server abort");if(P&&P.location.href!=m.iframeSrc||k){v.detachEvent?v.detachEvent("onload",s):v.removeEventListener("load",s,!1);var n,r="success";try{if(k)throw"timeout";var a="xml"==m.dataType||P.XMLDocument||e.isXMLDoc(P);if(i("isXml="+a),!a&&window.opera&&(null===P.body||!P.body.innerHTML)&&--j)return i("requeing onLoad callback, DOM not available"),void setTimeout(s,250);var l=P.body?P.body:P.documentElement;b.responseText=l?l.innerHTML:null,b.responseXML=P.XMLDocument?P.XMLDocument:P,a&&(m.dataType="xml"),b.getResponseHeader=function(e){var t={"content-type":m.dataType};return t[e]},l&&(b.status=Number(l.getAttribute("status"))||b.status,b.statusText=l.getAttribute("statusText")||b.statusText);var c=(m.dataType||"").toLowerCase(),u=/(json|script|text)/.test(c);if(u||m.textarea){var d=P.getElementsByTagName("textarea")[0];if(d)b.responseText=d.value,b.status=Number(d.getAttribute("status"))||b.status,b.statusText=d.getAttribute("statusText")||b.statusText;else if(u){var f=P.getElementsByTagName("pre")[0],p=P.getElementsByTagName("body")[0];f?b.responseText=f.textContent?f.textContent:f.innerText:p&&(b.responseText=p.textContent?p.textContent:p.innerText)}}else"xml"==c&&!b.responseXML&&b.responseText&&(b.responseXML=A(b.responseText));try{E=D(b,c,m)}catch(y){r="parsererror",b.error=n=y||r}}catch(y){i("error caught: ",y),r="error",b.error=n=y||r}b.aborted&&(i("upload aborted"),r=null),b.status&&(r=b.status>=200&&300>b.status||304===b.status?"success":"error"),"success"===r?(m.success&&m.success.call(m.context,E,"success",b),_.resolve(b.responseText,"success",b),h&&e.event.trigger("ajaxSuccess",[b,m])):r&&(void 0===n&&(n=b.statusText),m.error&&m.error.call(m.context,b,r,n),_.reject(b,"error",n),h&&e.event.trigger("ajaxError",[b,m,n])),h&&e.event.trigger("ajaxComplete",[b,m]),h&&!--e.active&&e.event.trigger("ajaxStop"),m.complete&&m.complete.call(m.context,b,r),O=!0,m.timeout&&clearTimeout(x),setTimeout(function(){m.iframeTarget||g.remove(),b.responseXML=null},100)}}}var c,u,m,h,f,g,v,b,y,C,k,x,w=d[0],_=e.Deferred();if(n)for(u=0;p.length>u;u++)c=e(p[u]),r?c.prop("disabled",!1):c.removeAttr("disabled");if(m=e.extend(!0,{},e.ajaxSettings,t),m.context=m.context||m,f="jqFormIO"+(new Date).getTime(),m.iframeTarget?(g=e(m.iframeTarget),C=g.attr2("name"),C?f=C:g.attr2("name",f)):(g=e('<iframe name="'+f+'" src="'+m.iframeSrc+'" />'),g.css({position:"absolute",top:"-1000px",left:"-1000px"})),v=g[0],b={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(t){var n="timeout"===t?"timeout":"aborted";i("aborting upload... "+n),this.aborted=1;try{v.contentWindow.document.execCommand&&v.contentWindow.document.execCommand("Stop")}catch(o){}g.attr("src",m.iframeSrc),b.error=n,m.error&&m.error.call(m.context,b,n,t),h&&e.event.trigger("ajaxError",[b,m,n]),m.complete&&m.complete.call(m.context,b,n)}},h=m.global,h&&0===e.active++&&e.event.trigger("ajaxStart"),h&&e.event.trigger("ajaxSend",[b,m]),m.beforeSend&&m.beforeSend.call(m.context,b,m)===!1)return m.global&&e.active--,_.reject(),_;if(b.aborted)return _.reject(),_;y=w.clk,y&&(C=y.name,C&&!y.disabled&&(m.extraData=m.extraData||{},m.extraData[C]=y.value,"image"==y.type&&(m.extraData[C+".x"]=w.clk_x,m.extraData[C+".y"]=w.clk_y)));var T=1,S=2,I=e("meta[name=csrf-token]").attr("content"),F=e("meta[name=csrf-param]").attr("content");F&&I&&(m.extraData=m.extraData||{},m.extraData[F]=I),m.forceSync?a():setTimeout(a,10);var E,P,O,j=50,A=e.parseXML||function(e,t){return window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&"parsererror"!=t.documentElement.nodeName?t:null},M=e.parseJSON||function(e){return window.eval("("+e+")")},D=function(t,n,i){var o=t.getResponseHeader("content-type")||"",r="xml"===n||!n&&o.indexOf("xml")>=0,a=r?t.responseXML:t.responseText;return r&&"parsererror"===a.documentElement.nodeName&&e.error&&e.error("parsererror"),i&&i.dataFilter&&(a=i.dataFilter(a,n)),"string"==typeof a&&("json"===n||!n&&o.indexOf("json")>=0?a=M(a):("script"===n||!n&&o.indexOf("javascript")>=0)&&e.globalEval(a)),a};return _}if(!this.length)return i("ajaxSubmit: skipping submit process - no element selected"),this;var l,c,u,d=this;"function"==typeof t?t={success:t}:void 0===t&&(t={}),l=t.type||this.attr2("method"),c=t.url||this.attr2("action"),u="string"==typeof c?e.trim(c):"",u=u||window.location.href||"",u&&(u=(u.match(/^([^#]+)/)||[])[1]),t=e.extend(!0,{url:u,success:e.ajaxSettings.success,type:l||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},t);var m={};if(this.trigger("form-pre-serialize",[this,t,m]),m.veto)return i("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(t.beforeSerialize&&t.beforeSerialize(this,t)===!1)return i("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var h=t.traditional;void 0===h&&(h=e.ajaxSettings.traditional);var f,p=[],g=this.formToArray(t.semantic,p);if(t.data&&(t.extraData=t.data,f=e.param(t.data,h)),t.beforeSubmit&&t.beforeSubmit(g,this,t)===!1)return i("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[g,this,t,m]),m.veto)return i("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var v=e.param(g,h);f&&(v=v?v+"&"+f:f),"GET"==t.type.toUpperCase()?(t.url+=(t.url.indexOf("?")>=0?"&":"?")+v,t.data=null):t.data=v;var b=[];if(t.resetForm&&b.push(function(){d.resetForm()}),t.clearForm&&b.push(function(){d.clearForm(t.includeHidden)}),!t.dataType&&t.target){var y=t.success||function(){};b.push(function(n){var i=t.replaceTarget?"replaceWith":"html";e(t.target)[i](n).each(y,arguments)})}else t.success&&b.push(t.success);if(t.success=function(e,n,i){for(var o=t.context||this,r=0,a=b.length;a>r;r++)b[r].apply(o,[e,n,i||d,d])},t.error){var C=t.error;t.error=function(e,n,i){var o=t.context||this;C.apply(o,[e,n,i,d])}}if(t.complete){var k=t.complete;t.complete=function(e,n){var i=t.context||this;k.apply(i,[e,n,d])}}var x=e('input[type=file]:enabled[value!=""]',this),w=x.length>0,_="multipart/form-data",T=d.attr("enctype")==_||d.attr("encoding")==_,S=o.fileapi&&o.formdata;i("fileAPI :"+S);var I,F=(w||T)&&!S;t.iframe!==!1&&(t.iframe||F)?t.closeKeepAlive?e.get(t.closeKeepAlive,function(){I=s(g)}):I=s(g):I=(w||T)&&S?a(g):e.ajax(t),d.removeData("jqxhr").data("jqxhr",I);for(var E=0;p.length>E;E++)p[E]=null;return this.trigger("form-submit-notify",[this,t]),this},e.fn.ajaxForm=function(o){if(o=o||{},o.delegation=o.delegation&&e.isFunction(e.fn.on),!o.delegation&&0===this.length){var r={s:this.selector,c:this.context};return!e.isReady&&r.s?(i("DOM not ready, queuing ajaxForm"),e(function(){e(r.s,r.c).ajaxForm(o)}),this):(i("terminating; zero elements found by selector"+(e.isReady?"":" (DOM not ready)")),this)}return o.delegation?(e(document).off("submit.form-plugin",this.selector,t).off("click.form-plugin",this.selector,n).on("submit.form-plugin",this.selector,o,t).on("click.form-plugin",this.selector,o,n),this):this.ajaxFormUnbind().bind("submit.form-plugin",o,t).bind("click.form-plugin",o,n)},e.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},e.fn.formToArray=function(t,n){var i=[];if(0===this.length)return i;var r=this[0],a=t?r.getElementsByTagName("*"):r.elements;if(!a)return i;var s,l,c,u,d,m,h;for(s=0,m=a.length;m>s;s++)if(d=a[s],c=d.name,c&&!d.disabled)if(t&&r.clk&&"image"==d.type)r.clk==d&&(i.push({name:c,value:e(d).val(),type:d.type}),i.push({name:c+".x",value:r.clk_x},{name:c+".y",value:r.clk_y}));else if(u=e.fieldValue(d,!0),u&&u.constructor==Array)for(n&&n.push(d),l=0,h=u.length;h>l;l++)i.push({name:c,value:u[l]});else if(o.fileapi&&"file"==d.type){n&&n.push(d);var f=d.files;if(f.length)for(l=0;f.length>l;l++)i.push({name:c,value:f[l],type:d.type});else i.push({name:c,value:"",type:d.type})}else null!==u&&void 0!==u&&(n&&n.push(d),i.push({name:c,value:u,type:d.type,required:d.required}));if(!t&&r.clk){var p=e(r.clk),g=p[0];c=g.name,c&&!g.disabled&&"image"==g.type&&(i.push({name:c,value:p.val()}),i.push({name:c+".x",value:r.clk_x},{name:c+".y",value:r.clk_y}))}return i},e.fn.formSerialize=function(t){return e.param(this.formToArray(t))},e.fn.fieldSerialize=function(t){var n=[];return this.each(function(){var i=this.name;if(i){var o=e.fieldValue(this,t);if(o&&o.constructor==Array)for(var r=0,a=o.length;a>r;r++)n.push({name:i,value:o[r]});else null!==o&&void 0!==o&&n.push({name:this.name,value:o})}}),e.param(n)},e.fn.fieldValue=function(t){for(var n=[],i=0,o=this.length;o>i;i++){var r=this[i],a=e.fieldValue(r,t);null===a||void 0===a||a.constructor==Array&&!a.length||(a.constructor==Array?e.merge(n,a):n.push(a))}return n},e.fieldValue=function(t,n){var i=t.name,o=t.type,r=t.tagName.toLowerCase();if(void 0===n&&(n=!0),n&&(!i||t.disabled||"reset"==o||"button"==o||("checkbox"==o||"radio"==o)&&!t.checked||("submit"==o||"image"==o)&&t.form&&t.form.clk!=t||"select"==r&&-1==t.selectedIndex))return null;if("select"==r){var a=t.selectedIndex;if(0>a)return null;for(var s=[],l=t.options,c="select-one"==o,u=c?a+1:l.length,d=c?a:0;u>d;d++){var m=l[d];if(m.selected){var h=m.value;if(h||(h=m.attributes&&m.attributes.value&&!m.attributes.value.specified?m.text:m.value),c)return h;s.push(h)}}return s}return e(t).val()},e.fn.clearForm=function(t){return this.each(function(){e("input,select,textarea",this).clearFields(t)})},e.fn.clearFields=e.fn.clearInputs=function(t){var n=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var i=this.type,o=this.tagName.toLowerCase();n.test(i)||"textarea"==o?this.value="":"checkbox"==i||"radio"==i?this.checked=!1:"select"==o?this.selectedIndex=-1:"file"==i?/MSIE/.test(navigator.userAgent)?e(this).replaceWith(e(this).clone(!0)):e(this).val(""):t&&(t===!0&&/hidden/.test(i)||"string"==typeof t&&e(this).is(t))&&(this.value="")})},e.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})},e.fn.enable=function(e){return void 0===e&&(e=!0),this.each(function(){this.disabled=!e})},e.fn.selected=function(t){return void 0===t&&(t=!0),this.each(function(){var n=this.type;if("checkbox"==n||"radio"==n)this.checked=t;else if("option"==this.tagName.toLowerCase()){var i=e(this).parent("select");t&&i[0]&&"select-one"==i[0].type&&i.find("option").selected(!1),this.selected=t}})},e.fn.ajaxSubmit.debug=!1}(jQuery),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){function t(t){var n={},i=/^jQuery\d+$/;return e.each(t.attributes,function(e,t){t.specified&&!i.test(t.name)&&(n[t.name]=t.value)}),n}function n(t,n){var i=this,r=e(i);if(i.value==r.attr("placeholder")&&r.hasClass(m.customClass))if(r.data("placeholder-password")){if(r=r.hide().nextAll('input[type="password"]:first').show().attr("id",r.removeAttr("id").data("placeholder-id")),t===!0)return r[0].value=n;r.focus()}else i.value="",r.removeClass(m.customClass),i==o()&&i.select()}function i(){var i,o=this,r=e(o),a=this.id;if(""===o.value){if("password"===o.type){if(!r.data("placeholder-textinput")){try{i=r.clone().attr({type:"text"})}catch(s){i=e("<input>").attr(e.extend(t(this),{type:"text"}))}i.removeAttr("name").data({"placeholder-password":r,"placeholder-id":a}).bind("focus.placeholder",n),r.data({"placeholder-textinput":i,"placeholder-id":a}).before(i)}r=r.removeAttr("id").hide().prevAll('input[type="text"]:first').attr("id",a).show()}r.addClass(m.customClass),r[0].value=r.attr("placeholder")}else r.removeClass(m.customClass)}function o(){try{return document.activeElement}catch(e){}}var r,a,s="[object OperaMini]"==Object.prototype.toString.call(window.operamini),l="placeholder"in document.createElement("input")&&!s,c="placeholder"in document.createElement("textarea")&&!s,u=e.valHooks,d=e.propHooks;if(l&&c)a=e.fn.placeholder=function(){return this},a.input=a.textarea=!0;else{var m={};a=e.fn.placeholder=function(t){var o={customClass:"placeholder"};m=e.extend({},o,t);var r=this;return r.filter((l?"textarea":":input")+"[placeholder]").not("."+m.customClass).bind({"focus.placeholder":n,"blur.placeholder":i}).data("placeholder-enabled",!0).trigger("blur.placeholder"),r},a.input=l,a.textarea=c,r={get:function(t){var n=e(t),i=n.data("placeholder-password");return i?i[0].value:n.data("placeholder-enabled")&&n.hasClass("placeholder")?"":t.value},set:function(t,r){var a=e(t),s=a.data("placeholder-password");return s?s[0].value=r:a.data("placeholder-enabled")?(""===r?(t.value=r,t!=o()&&i.call(t)):a.hasClass(m.customClass)?n.call(t,!0,r)||(t.value=r):t.value=r,a):t.value=r}},l||(u.input=r,d.value=r),c||(u.textarea=r,d.value=r),e(function(){e(document).delegate("form","submit.placeholder",function(){var t=e("."+m.customClass,this).each(n);setTimeout(function(){t.each(i)},10)})}),e(window).bind("beforeunload.placeholder",function(){e("."+m.customClass).each(function(){this.value=""})})}}),function(e,t,n){function i(e,t){
var n=(e[0]||0)-(t[0]||0);return n>0||!n&&e.length>0&&i(e.slice(1),t.slice(1))}function o(e){if(typeof e!=s)return e;var t=[],n="";for(var i in e)n=typeof e[i]==s?o(e[i]):[i,l?encodeURI(e[i]):e[i]].join("="),t.push(n);return t.join("&")}function r(e){var t=[];for(var n in e)e[n]&&t.push([n,'="',e[n],'"'].join(""));return t.join(" ")}function a(e){var t=[];for(var n in e)t.push(['<param name="',n,'" value="',o(e[n]),'" />'].join(""));return t.join("")}var s="object",l=!0;try{var c=n.description||function(){return new n("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}()}catch(u){c="Unavailable"}var d=c.match(/\d+/g)||[0];e[t]={available:d[0]>0,activeX:n&&!n.name,version:{original:c,array:d,string:d.join("."),major:parseInt(d[0],10)||0,minor:parseInt(d[1],10)||0,release:parseInt(d[2],10)||0},hasVersion:function(e){return e=/string|number/.test(typeof e)?e.toString().split("."):/object/.test(typeof e)?[e.major,e.minor]:e||[0,0],i(d,e)},encodeParams:!0,expressInstall:"expressInstall.swf",expressInstallIsActive:!1,create:function(e){if(!e.swf||this.expressInstallIsActive||!this.available&&!e.hasVersionFail)return!1;if(!this.hasVersion(e.hasVersion||1)){if(this.expressInstallIsActive=!0,"function"==typeof e.hasVersionFail&&!e.hasVersionFail.apply(e))return!1;e={swf:e.expressInstall||this.expressInstall,height:137,width:214,flashvars:{MMredirectURL:location.href,MMplayerType:this.activeX?"ActiveX":"PlugIn",MMdoctitle:document.title.slice(0,47)+" - Flash Player Installation"}}}attrs={data:e.swf,type:"application/x-shockwave-flash",id:e.id||"flash_"+Math.floor(999999999*Math.random()),width:e.width||320,height:e.height||180,style:e.style||""},l="undefined"!=typeof e.useEncode?e.useEncode:this.encodeParams,e.movie=e.swf,e.wmode=e.wmode||"opaque",delete e.fallback,delete e.hasVersion,delete e.hasVersionFail,delete e.height,delete e.id,delete e.swf,delete e.useEncode,delete e.width;var t=document.createElement("div");return t.innerHTML=["<object ",r(attrs),">",a(e),"</object>"].join(""),t.firstChild}},e.fn[t]=function(n){var i=this.find(s).andSelf().filter(s);return/string|object/.test(typeof n)&&this.each(function(){var i,o=e(this);n=typeof n==s?n:{swf:n},n.fallback=this,(i=e[t].create(n))&&(o.children().remove(),o.html(i))}),"function"==typeof n&&i.each(function(){var i=this;i.jsInteractionTimeoutMs=i.jsInteractionTimeoutMs||0,i.jsInteractionTimeoutMs<660&&(i.clientWidth||i.clientHeight?n.call(i):setTimeout(function(){e(i)[t](n)},i.jsInteractionTimeoutMs+66))}),i}}(jQuery,"flash",navigator.plugins["Shockwave Flash"]||window.ActiveXObject),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e(window.jQuery)}(function(e){"use strict";var t=0;e.ajaxTransport("iframe",function(n){if(n.async){var i,o,r,a=n.initialIframeSrc||"javascript:false;";return{send:function(s,l){i=e('<form style="display:none;"></form>'),i.attr("accept-charset",n.formAcceptCharset),r=/\?/.test(n.url)?"&":"?","DELETE"===n.type?(n.url=n.url+r+"_method=DELETE",n.type="POST"):"PUT"===n.type?(n.url=n.url+r+"_method=PUT",n.type="POST"):"PATCH"===n.type&&(n.url=n.url+r+"_method=PATCH",n.type="POST"),t+=1,o=e('<iframe src="'+a+'" name="iframe-transport-'+t+'"></iframe>').bind("load",function(){var t,r=e.isArray(n.paramName)?n.paramName:[n.paramName];o.unbind("load").bind("load",function(){var t;try{if(t=o.contents(),!t.length||!t[0].firstChild)throw new Error}catch(n){t=void 0}l(200,"success",{iframe:t}),e('<iframe src="'+a+'"></iframe>').appendTo(i),window.setTimeout(function(){i.remove()},0)}),i.prop("target",o.prop("name")).prop("action",n.url).prop("method",n.type),n.formData&&e.each(n.formData,function(t,n){e('<input type="hidden"/>').prop("name",n.name).val(n.value).appendTo(i)}),n.fileInput&&n.fileInput.length&&"POST"===n.type&&(t=n.fileInput.clone(),n.fileInput.after(function(e){return t[e]}),n.paramName&&n.fileInput.each(function(t){e(this).prop("name",r[t]||n.paramName)}),i.append(n.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),n.fileInput.removeAttr("form")),i.submit(),t&&t.length&&n.fileInput.each(function(n,i){var o=e(t[n]);e(i).prop("name",o.prop("name")).attr("form",o.attr("form")),o.replaceWith(i)})}),i.append(o).appendTo(document.body)},abort:function(){o&&o.unbind("load").prop("src",a),i&&i.remove()}}}}),e.ajaxSetup({converters:{"iframe text":function(t){return t&&e(t[0].body).text()},"iframe json":function(t){return t&&e.parseJSON(e(t[0].body).text())},"iframe html":function(t){return t&&e(t[0].body).html()},"iframe xml":function(t){var n=t&&t[0];return n&&e.isXMLDoc(n)?n:e.parseXML(n.XMLDocument&&n.XMLDocument.xml||e(n.body).html())},"iframe script":function(t){return t&&e.globalEval(e(t[0].body).text())}}})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.ui.widget"],e):e(window.jQuery)}(function(e){"use strict";function t(t){var n="dragover"===t;return function(i){i.dataTransfer=i.originalEvent&&i.originalEvent.dataTransfer;var o=i.dataTransfer;o&&-1!==e.inArray("Files",o.types)&&this._trigger(t,e.Event(t,{delegatedEvent:i}))!==!1&&(i.preventDefault(),n&&(o.dropEffect="copy"))}}e.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||e('<input type="file">').prop("disabled")),e.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),e.support.xhrFormDataFileUpload=!!window.FormData,e.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),e.widget("blueimp.fileupload",{options:{dropZone:e(document),pasteZone:void 0,fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,n){return t=this.messages[t]||t.toString(),n&&e.each(n,function(e,n){t=t.replace("{"+e+"}",n)}),t},formData:function(e){return e.serializeArray()},add:function(t,n){return t.isDefaultPrevented()?!1:void((n.autoUpload||n.autoUpload!==!1&&e(this).fileupload("option","autoUpload"))&&n.process().done(function(){n.submit()}))},processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:e.support.blobSlice&&function(){var e=this.slice||this.webkitSlice||this.mozSlice;return e.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,n){var i=e-this.timestamp;return(!this.bitrate||!n||i>n)&&(this.bitrate=(t-this.loaded)*(1e3/i)*8,this.loaded=t,this.timestamp=e),this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(t){var n;return"function"===e.type(t.formData)?t.formData(t.form):e.isArray(t.formData)?t.formData:"object"===e.type(t.formData)?(n=[],e.each(t.formData,function(e,t){n.push({name:e,value:t})}),n):[]},_getTotal:function(t){var n=0;return e.each(t,function(e,t){n+=t.size||1}),n},_initProgressObject:function(t){var n={loaded:0,total:0,bitrate:0};t._progress?e.extend(t._progress,n):t._progress=n},_initResponseObject:function(e){var t;if(e._response)for(t in e._response)e._response.hasOwnProperty(t)&&delete e._response[t];else e._response={}},_onProgress:function(t,n){if(t.lengthComputable){var i,o=Date.now?Date.now():(new Date).getTime();if(n._time&&n.progressInterval&&o-n._time<n.progressInterval&&t.loaded!==t.total)return;n._time=o,i=Math.floor(t.loaded/t.total*(n.chunkSize||n._progress.total))+(n.uploadedBytes||0),this._progress.loaded+=i-n._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(o,this._progress.loaded,n.bitrateInterval),n._progress.loaded=n.loaded=i,n._progress.bitrate=n.bitrate=n._bitrateTimer.getBitrate(o,i,n.bitrateInterval),this._trigger("progress",e.Event("progress",{delegatedEvent:t}),n),this._trigger("progressall",e.Event("progressall",{delegatedEvent:t}),this._progress)}},_initProgressListener:function(t){var n=this,i=t.xhr?t.xhr():e.ajaxSettings.xhr();i.upload&&(e(i.upload).bind("progress",function(e){var i=e.originalEvent;e.lengthComputable=i.lengthComputable,e.loaded=i.loaded,e.total=i.total,n._onProgress(e,t)}),t.xhr=function(){return i})},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_initXHRData:function(t){var n,i=this,o=t.files[0],r=t.multipart||!e.support.xhrFileUpload,a="array"===e.type(t.paramName)?t.paramName[0]:t.paramName;t.headers=e.extend({},t.headers),t.contentRange&&(t.headers["Content-Range"]=t.contentRange),r&&!t.blob&&this._isInstanceOf("File",o)||(t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(o.name)+'"'),r?e.support.xhrFormDataFileUpload&&(t.postMessage?(n=this._getFormData(t),t.blob?n.push({name:a,value:t.blob}):e.each(t.files,function(i,o){n.push({name:"array"===e.type(t.paramName)&&t.paramName[i]||a,value:o})})):(i._isInstanceOf("FormData",t.formData)?n=t.formData:(n=new FormData,e.each(this._getFormData(t),function(e,t){n.append(t.name,t.value)})),t.blob?n.append(a,t.blob,o.name):e.each(t.files,function(o,r){(i._isInstanceOf("File",r)||i._isInstanceOf("Blob",r))&&n.append("array"===e.type(t.paramName)&&t.paramName[o]||a,r,r.uploadName||r.name)})),t.data=n):(t.contentType=o.type||"application/octet-stream",t.data=t.blob||o),t.blob=null},_initIframeSettings:function(t){var n=e("<a></a>").prop("href",t.url).prop("host");t.dataType="iframe "+(t.dataType||""),t.formData=this._getFormData(t),t.redirect&&n&&n!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e)},_getParamName:function(t){var n=e(t.fileInput),i=t.paramName;return i?e.isArray(i)||(i=[i]):(i=[],n.each(function(){for(var t=e(this),n=t.prop("name")||"files[]",o=(t.prop("files")||[1]).length;o;)i.push(n),o-=1}),i.length||(i=[n.prop("name")||"files[]"])),i},_initFormSettings:function(t){t.form&&t.form.length||(t.form=e(t.fileInput.prop("form")),t.form.length||(t.form=e(this.options.fileInput.prop("form")))),t.paramName=this._getParamName(t),t.url||(t.url=t.form.prop("action")||location.href),t.type=(t.type||"string"===e.type(t.form.prop("method"))&&t.form.prop("method")||"").toUpperCase(),"POST"!==t.type&&"PUT"!==t.type&&"PATCH"!==t.type&&(t.type="POST"),t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var n=e.extend({},this.options,t);return this._initFormSettings(n),this._initDataSettings(n),n},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(t,n,i){var o=e.Deferred(),r=o.promise();return n=n||this.options.context||r,t===!0?o.resolveWith(n,i):t===!1&&o.rejectWith(n,i),r.abort=o.promise,this._enhancePromise(r)},_addConvenienceMethods:function(t,n){var i=this,o=function(t){return e.Deferred().resolveWith(i,t).promise()};n.process=function(t,r){return(t||r)&&(n._processQueue=this._processQueue=(this._processQueue||o([this])).pipe(function(){return n.errorThrown?e.Deferred().rejectWith(i,[n]).promise():o(arguments)}).pipe(t,r)),this._processQueue||o([this])},n.submit=function(){return"pending"!==this.state()&&(n.jqXHR=this.jqXHR=i._trigger("submit",e.Event("submit",{delegatedEvent:t}),this)!==!1&&i._onSend(t,this)),this.jqXHR||i._getXHRPromise()},n.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",i._trigger("fail",null,this),i._getXHRPromise(!1))},n.state=function(){return this.jqXHR?i._getDeferredState(this.jqXHR):this._processQueue?i._getDeferredState(this._processQueue):void 0},n.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===i._getDeferredState(this._processQueue)},n.progress=function(){return this._progress},n.response=function(){return this._response}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),n=t&&t.split("-"),i=n&&n.length>1&&parseInt(n[1],10);return i&&i+1},_chunkedUpload:function(t,n){t.uploadedBytes=t.uploadedBytes||0;var i,o,r=this,a=t.files[0],s=a.size,l=t.uploadedBytes,c=t.maxChunkSize||s,u=this._blobSlice,d=e.Deferred(),m=d.promise();return this._isXHRUpload(t)&&u&&(l||s>c)&&!t.data?n?!0:l>=s?(a.error=t.i18n("uploadedBytes"),this._getXHRPromise(!1,t.context,[null,"error",a.error])):(o=function(){var n=e.extend({},t),m=n._progress.loaded;n.blob=u.call(a,l,l+c,a.type),n.chunkSize=n.blob.size,n.contentRange="bytes "+l+"-"+(l+n.chunkSize-1)+"/"+s,r._initXHRData(n),r._initProgressListener(n),i=(r._trigger("chunksend",null,n)!==!1&&e.ajax(n)||r._getXHRPromise(!1,n.context)).done(function(i,a,c){l=r._getUploadedBytes(c)||l+n.chunkSize,m+n.chunkSize-n._progress.loaded&&r._onProgress(e.Event("progress",{lengthComputable:!0,loaded:l-n.uploadedBytes,total:l-n.uploadedBytes}),n),t.uploadedBytes=n.uploadedBytes=l,n.result=i,n.textStatus=a,n.jqXHR=c,r._trigger("chunkdone",null,n),r._trigger("chunkalways",null,n),s>l?o():d.resolveWith(n.context,[i,a,c])}).fail(function(e,t,i){n.jqXHR=e,n.textStatus=t,n.errorThrown=i,r._trigger("chunkfail",null,n),r._trigger("chunkalways",null,n),d.rejectWith(n.context,[e,t,i])})},this._enhancePromise(m),m.abort=function(){return i.abort()},o(),m):!1},_beforeSend:function(e,t){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(t),this._initProgressObject(t),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(t,n,i,o){var r=o._progress.total,a=o._response;o._progress.loaded<r&&this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:r,total:r}),o),a.result=o.result=t,a.textStatus=o.textStatus=n,a.jqXHR=o.jqXHR=i,this._trigger("done",null,o)},_onFail:function(e,t,n,i){var o=i._response;i.recalculateProgress&&(this._progress.loaded-=i._progress.loaded,this._progress.total-=i._progress.total),o.jqXHR=i.jqXHR=e,o.textStatus=i.textStatus=t,o.errorThrown=i.errorThrown=n,this._trigger("fail",null,i)},_onAlways:function(e,t,n,i){this._trigger("always",null,i)},_onSend:function(t,n){n.submit||this._addConvenienceMethods(t,n);var i,o,r,a,s=this,l=s._getAJAXSettings(n),c=function(){return s._sending+=1,l._bitrateTimer=new s._BitrateTimer,i=i||((o||s._trigger("send",e.Event("send",{delegatedEvent:t}),l)===!1)&&s._getXHRPromise(!1,l.context,o)||s._chunkedUpload(l)||e.ajax(l)).done(function(e,t,n){s._onDone(e,t,n,l)}).fail(function(e,t,n){s._onFail(e,t,n,l)}).always(function(e,t,n){if(s._onAlways(e,t,n,l),s._sending-=1,s._active-=1,l.limitConcurrentUploads&&l.limitConcurrentUploads>s._sending)for(var i=s._slots.shift();i;){if("pending"===s._getDeferredState(i)){i.resolve();break}i=s._slots.shift()}0===s._active&&s._trigger("stop")})};return this._beforeSend(t,l),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(r=e.Deferred(),this._slots.push(r),a=r.pipe(c)):(this._sequence=this._sequence.pipe(c,c),a=this._sequence),a.abort=function(){return o=[void 0,"abort","abort"],i?i.abort():(r&&r.rejectWith(l.context,o),c())},this._enhancePromise(a)):c()},_onAdd:function(t,n){var i,o,r,a,s=this,l=!0,c=e.extend({},this.options,n),u=n.files,d=u.length,m=c.limitMultiFileUploads,h=c.limitMultiFileUploadSize,f=c.limitMultiFileUploadSizeOverhead,p=0,g=this._getParamName(c),v=0;if(!h||d&&void 0!==u[0].size||(h=void 0),(c.singleFileUploads||m||h)&&this._isXHRUpload(c))if(c.singleFileUploads||h||!m)if(!c.singleFileUploads&&h)for(r=[],i=[],a=0;d>a;a+=1)p+=u[a].size+f,(a+1===d||p+u[a+1].size+f>h||m&&a+1-v>=m)&&(r.push(u.slice(v,a+1)),o=g.slice(v,a+1),o.length||(o=g),i.push(o),v=a+1,p=0);else i=g;else for(r=[],i=[],a=0;d>a;a+=m)r.push(u.slice(a,a+m)),o=g.slice(a,a+m),o.length||(o=g),i.push(o);else r=[u],i=[g];return n.originalFiles=u,e.each(r||u,function(o,a){var c=e.extend({},n);return c.files=r?a:[a],c.paramName=i[o],s._initResponseObject(c),s._initProgressObject(c),s._addConvenienceMethods(t,c),l=s._trigger("add",e.Event("add",{delegatedEvent:t}),c)}),l},_replaceFileInput:function(t){var n=t.fileInput,i=n.clone(!0);t.fileInputClone=i,e("<form></form>").append(i)[0].reset(),n.after(i).detach(),e.cleanData(n.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,t){return t===n[0]?i[0]:t}),n[0]===this.element[0]&&(this.element=i)},_handleFileTreeEntry:function(t,n){var i,o=this,r=e.Deferred(),a=function(e){e&&!e.entry&&(e.entry=t),r.resolve([e])},s=function(e){o._handleFileTreeEntries(e,n+t.name+"/").done(function(e){r.resolve(e)}).fail(a)},l=function(){i.readEntries(function(e){e.length?(c=c.concat(e),l()):s(c)},a)},c=[];return n=n||"",t.isFile?t._file?(t._file.relativePath=n,r.resolve(t._file)):t.file(function(e){e.relativePath=n,r.resolve(e)},a):t.isDirectory?(i=t.createReader(),l()):r.resolve([]),r.promise()},_handleFileTreeEntries:function(t,n){var i=this;return e.when.apply(e,e.map(t,function(e){return i._handleFileTreeEntry(e,n)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var n=t.items;return n&&n.length&&(n[0].webkitGetAsEntry||n[0].getAsEntry)?this._handleFileTreeEntries(e.map(n,function(e){var t;return e.webkitGetAsEntry?(t=e.webkitGetAsEntry(),t&&(t._file=e.getAsFile()),t):e.getAsEntry()})):e.Deferred().resolve(e.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=e(t);var n,i,o=t.prop("webkitEntries")||t.prop("entries");if(o&&o.length)return this._handleFileTreeEntries(o);if(n=e.makeArray(t.prop("files")),n.length)void 0===n[0].name&&n[0].fileName&&e.each(n,function(e,t){t.name=t.fileName,t.size=t.fileSize});else{if(i=t.prop("value"),!i)return e.Deferred().resolve([]).promise();n=[{name:i.replace(/^.*\\/,"")}]}return e.Deferred().resolve(n).promise()},_getFileInputFiles:function(t){return t instanceof e&&1!==t.length?e.when.apply(e,e.map(t,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(t)},_onChange:function(t){var n=this,i={fileInput:e(t.target),form:e(t.target.form)};this._getFileInputFiles(i.fileInput).always(function(o){i.files=o,n.options.replaceFileInput&&n._replaceFileInput(i),n._trigger("change",e.Event("change",{delegatedEvent:t}),i)!==!1&&n._onAdd(t,i)})},_onPaste:function(t){var n=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,i={files:[]};n&&n.length&&(e.each(n,function(e,t){var n=t.getAsFile&&t.getAsFile();n&&i.files.push(n)}),this._trigger("paste",e.Event("paste",{delegatedEvent:t}),i)!==!1&&this._onAdd(t,i))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var n=this,i=t.dataTransfer,o={};i&&i.files&&i.files.length&&(t.preventDefault(),this._getDroppedFiles(i).always(function(i){o.files=i,n._trigger("drop",e.Event("drop",{delegatedEvent:t}),o)!==!1&&n._onAdd(t,o)}))},_onDragOver:t("dragover"),_onDragEnter:t("dragenter"),_onDragLeave:t("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste})),e.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(t,n){var i=-1!==e.inArray(t,this._specialOptions);i&&this._destroyEventHandlers(),this._super(t,n),i&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;void 0===t.fileInput?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof e||(t.fileInput=e(t.fileInput)),t.dropZone instanceof e||(t.dropZone=e(t.dropZone)),t.pasteZone instanceof e||(t.pasteZone=e(t.pasteZone))},_getRegExp:function(e){var t=e.split("/"),n=t.pop();return t.shift(),new RegExp(t.join("/"),n)},_isRegExpOption:function(t,n){return"url"!==t&&"string"===e.type(n)&&/^\/.*\/[igm]{0,3}$/.test(n)},_initDataAttributes:function(){var t=this,n=this.options,i=e(this.element[0].cloneNode(!1));e.each(i.data(),function(e,o){var r="data-"+e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();i.attr(r)&&(t._isRegExpOption(e,o)&&(o=t._getRegExp(o)),n[e]=o)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var n=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,n._onAdd(null,t)}):(t.files=e.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var n,i,o=this,r=e.Deferred(),a=r.promise();return a.abort=function(){return i=!0,n?n.abort():(r.reject(null,"abort","abort"),a)},this._getFileInputFiles(t.fileInput).always(function(e){if(!i){if(!e.length)return void r.reject();t.files=e,n=o._onSend(null,t),n.then(function(e,t,n){r.resolve(e,t,n)},function(e,t,n){r.reject(e,t,n)})}}),this._enhancePromise(a)}if(t.files=e.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","./jquery.fileupload.js"],e):e(window.jQuery)}(function(e){"use strict";var t=e.blueimp.fileupload.prototype.options.add;e.widget("blueimp.fileupload",e.blueimp.fileupload,{options:{processQueue:[],add:function(n,i){var o=e(this);i.process(function(){return o.fileupload("process",i)}),t.call(this,n,i)}},processActions:{},_processFile:function(t,n){var i=this,o=e.Deferred().resolveWith(i,[t]),r=o.promise();return this._trigger("process",null,t),e.each(t.processQueue,function(t,o){var a=function(t){return n.errorThrown?e.Deferred().rejectWith(i,[n]).promise():i.processActions[o.action].call(i,t,o)};r=r.pipe(a,o.always&&a)}),r.done(function(){i._trigger("processdone",null,t),i._trigger("processalways",null,t)}).fail(function(){i._trigger("processfail",null,t),i._trigger("processalways",null,t)}),r},_transformProcessQueue:function(t){var n=[];e.each(t.processQueue,function(){var i={},o=this.action,r=this.prefix===!0?o:this.prefix;e.each(this,function(n,o){i[n]="string"===e.type(o)&&"@"===o.charAt(0)?t[o.slice(1)||(r?r+n.charAt(0).toUpperCase()+n.slice(1):n)]:o}),n.push(i)}),t.processQueue=n},processing:function(){return this._processing},process:function(t){var n=this,i=e.extend({},this.options,t);return i.processQueue&&i.processQueue.length&&(this._transformProcessQueue(i),0===this._processing&&this._trigger("processstart"),e.each(t.files,function(o){var r=o?e.extend({},i):i,a=function(){return t.errorThrown?e.Deferred().rejectWith(n,[t]).promise():n._processFile(r,t)};r.index=o,n._processing+=1,n._processingQueue=n._processingQueue.pipe(a,a).always(function(){n._processing-=1,0===n._processing&&n._trigger("processstop")})})),this._processingQueue},_create:function(){this._super(),this._processing=0,this._processingQueue=e.Deferred().resolveWith(this).promise()}})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","./jquery.fileupload-process.js"],e):e(window.jQuery)}(function(e){"use strict";e.blueimp.fileupload.prototype.options.processQueue.push({action:"validate",always:!0,acceptFileTypes:"@",maxFileSize:"@",minFileSize:"@",maxNumberOfFiles:"@",disabled:"@disableValidation"}),e.widget("blueimp.fileupload",e.blueimp.fileupload,{options:{getNumberOfFiles:e.noop,messages:{maxNumberOfFiles:"Maximum number of files exceeded",acceptFileTypes:"File type not allowed",maxFileSize:"File is too large",minFileSize:"File is too small"}},processActions:{validate:function(t,n){if(n.disabled)return t;var i,o=e.Deferred(),r=this.options,a=t.files[t.index];return(n.minFileSize||n.maxFileSize)&&(i=a.size),"number"===e.type(n.maxNumberOfFiles)&&(r.getNumberOfFiles()||0)+t.files.length>n.maxNumberOfFiles?a.error=r.i18n("maxNumberOfFiles"):!n.acceptFileTypes||n.acceptFileTypes.test(a.type)||n.acceptFileTypes.test(a.name)?i>n.maxFileSize?a.error=r.i18n("maxFileSize"):"number"===e.type(i)&&i<n.minFileSize?a.error=r.i18n("minFileSize"):delete a.error:a.error=r.i18n("acceptFileTypes"),a.error||t.files.error?(t.files.error=!0,o.rejectWith(this,[t])):o.resolveWith(this,[t]),o.promise()}}})}),function(e,t,n,i,o,r){function a(e,t){var n=typeof e[t];return"function"==n||!("object"!=n||!e[t])||"unknown"==n}function s(e,t){return!("object"!=typeof e[t]||!e[t])}function l(e){return"[object Array]"===Object.prototype.toString.call(e)}function c(){var e="Shockwave Flash",t="application/x-shockwave-flash";if(!y(navigator.plugins)&&"object"==typeof navigator.plugins[e]){var n=navigator.plugins[e].description;n&&!y(navigator.mimeTypes)&&navigator.mimeTypes[t]&&navigator.mimeTypes[t].enabledPlugin&&(F=n.match(/\d+/g))}if(!F){var i;try{i=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),F=Array.prototype.slice.call(i.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1),i=null}catch(o){}}if(!F)return!1;var r=parseInt(F[0],10),a=parseInt(F[1],10);return E=r>9&&a>0,!0}function u(){if(!N){N=!0;for(var e=0;e<W.length;e++)W[e]();W.length=0}}function d(e,t){return N?void e.call(t):void W.push(function(){e.call(t)})}function m(){var e=parent;if(""!==H)for(var t=0,n=H.split(".");t<n.length;t++)e=e[n[t]];return e.easyXDM}function h(t){return e.easyXDM=B,H=t,H&&(q="easyXDM_"+H.replace(".","_")+"_"),L}function f(e){return e.match(D)[3]}function p(e){return e.match(D)[4]||""}function g(e){var t=e.toLowerCase().match(D),n=t[2],i=t[3],o=t[4]||"";return("http:"==n&&":80"==o||"https:"==n&&":443"==o)&&(o=""),n+"//"+i+o}function v(e){if(e=e.replace(R,"$1/"),!e.match(/^(http||https):\/\//)){var t="/"===e.substring(0,1)?"":n.pathname;"/"!==t.substring(t.length-1)&&(t=t.substring(0,t.lastIndexOf("/")+1)),e=n.protocol+"//"+n.host+t+e}for(;U.test(e);)e=e.replace(U,"");return e}function b(e,t){var n="",i=e.indexOf("#");-1!==i&&(n=e.substring(i),e=e.substring(0,i));var o=[];for(var a in t)t.hasOwnProperty(a)&&o.push(a+"="+r(t[a]));return e+(z?"#":-1==e.indexOf("?")?"?":"&")+o.join("&")+n}function y(e){return"undefined"==typeof e}function C(e,t,n){var i;for(var o in t)t.hasOwnProperty(o)&&(o in e?(i=t[o],"object"==typeof i?C(e[o],i,n):n||(e[o]=t[o])):e[o]=t[o]);return e}function k(){var e=t.body.appendChild(t.createElement("form")),n=e.appendChild(t.createElement("input"));n.name=q+"TEST"+A,I=n!==e.elements[n.name],t.body.removeChild(e)}function x(e){y(I)&&k();var n;I?n=t.createElement('<iframe name="'+e.props.name+'"/>'):(n=t.createElement("IFRAME"),n.name=e.props.name),n.id=n.name=e.props.name,delete e.props.name,"string"==typeof e.container&&(e.container=t.getElementById(e.container)),e.container||(C(n.style,{position:"absolute",top:"-2000px",left:"0px"}),e.container=t.body);var i=e.props.src;if(e.props.src="javascript:false",C(n,e.props),n.border=n.frameBorder=0,n.allowTransparency=!0,e.container.appendChild(n),e.onLoad&&P(n,"load",e.onLoad),e.usePost){var o,r=e.container.appendChild(t.createElement("form"));if(r.target=n.name,r.action=i,r.method="POST","object"==typeof e.usePost)for(var a in e.usePost)e.usePost.hasOwnProperty(a)&&(I?o=t.createElement('<input name="'+a+'"/>'):(o=t.createElement("INPUT"),o.name=a),o.value=e.usePost[a],r.appendChild(o));r.submit(),r.parentNode.removeChild(r)}else n.src=i;return e.props.src=i,n}function w(e,t){"string"==typeof e&&(e=[e]);for(var n,i=e.length;i--;)if(n=e[i],n=new RegExp("^"==n.substr(0,1)?n:"^"+n.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"),n.test(t))return!0;return!1}function _(i){var o,r=i.protocol;if(i.isHost=i.isHost||y(V.xdm_p),z=i.hash||!1,i.props||(i.props={}),i.isHost)i.remote=v(i.remote),i.channel=i.channel||"default"+A++,i.secret=Math.random().toString(16).substring(2),y(r)&&(r=g(n.href)==g(i.remote)?"4":a(e,"postMessage")||a(t,"postMessage")?"1":i.swf&&a(e,"ActiveXObject")&&c()?"6":"Gecko"===navigator.product&&"frameElement"in e&&-1==navigator.userAgent.indexOf("WebKit")?"5":i.remoteHelper?"2":"0");else if(i.channel=V.xdm_c.replace(/["'<>\\]/g,""),i.secret=V.xdm_s,i.remote=V.xdm_e.replace(/["'<>\\]/g,""),r=V.xdm_p,i.acl&&!w(i.acl,i.remote))throw new Error("Access denied for "+i.remote);switch(i.protocol=r,r){case"0":if(C(i,{interval:100,delay:2e3,useResize:!0,useParent:!1,usePolling:!1},!0),i.isHost){if(!i.local){for(var s,l=n.protocol+"//"+n.host,u=t.body.getElementsByTagName("img"),d=u.length;d--;)if(s=u[d],s.src.substring(0,l.length)===l){i.local=s.src;break}i.local||(i.local=e)}var m={xdm_c:i.channel,xdm_p:0};i.local===e?(i.usePolling=!0,i.useParent=!0,i.local=n.protocol+"//"+n.host+n.pathname+n.search,m.xdm_e=i.local,m.xdm_pa=1):m.xdm_e=v(i.local),i.container&&(i.useResize=!1,m.xdm_po=1),i.remote=b(i.remote,m)}else C(i,{channel:V.xdm_c,remote:V.xdm_e,useParent:!y(V.xdm_pa),usePolling:!y(V.xdm_po),useResize:i.useParent?!1:i.useResize});o=[new L.stack.HashTransport(i),new L.stack.ReliableBehavior({}),new L.stack.QueueBehavior({encode:!0,maxLength:4e3-i.remote.length}),new L.stack.VerifyBehavior({initiate:i.isHost})];break;case"1":o=[new L.stack.PostMessageTransport(i)];break;case"2":i.isHost&&(i.remoteHelper=v(i.remoteHelper)),o=[new L.stack.NameTransport(i),new L.stack.QueueBehavior,new L.stack.VerifyBehavior({initiate:i.isHost})];break;case"3":o=[new L.stack.NixTransport(i)];break;case"4":o=[new L.stack.SameOriginTransport(i)];break;case"5":o=[new L.stack.FrameElementTransport(i)];break;case"6":F||c(),o=[new L.stack.FlashTransport(i)]}return o.push(new L.stack.QueueBehavior({lazy:i.lazy,remove:!0})),o}function T(e){for(var t,n={incoming:function(e,t){this.up.incoming(e,t)},outgoing:function(e,t){this.down.outgoing(e,t)},callback:function(e){this.up.callback(e)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}},i=0,o=e.length;o>i;i++)t=e[i],C(t,n,!0),0!==i&&(t.down=e[i-1]),i!==o-1&&(t.up=e[i+1]);return t}function S(e){e.up.down=e.down,e.down.up=e.up,e.up=e.down=null}var I,F,E,P,O,j=this,A=Math.floor(1e4*Math.random()),M=Function.prototype,D=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,U=/[\-\w]+\/\.\.\//,R=/([^:])\/\//g,H="",L={},B=e.easyXDM,q="easyXDM_",z=!1;if(a(e,"addEventListener"))P=function(e,t,n){e.addEventListener(t,n,!1)},O=function(e,t,n){e.removeEventListener(t,n,!1)};else{if(!a(e,"attachEvent"))throw new Error("Browser not supported");P=function(e,t,n){e.attachEvent("on"+t,n)},O=function(e,t,n){e.detachEvent("on"+t,n)}}var $,N=!1,W=[];if("readyState"in t?($=t.readyState,N="complete"==$||~navigator.userAgent.indexOf("AppleWebKit/")&&("loaded"==$||"interactive"==$)):N=!!t.body,!N){if(a(e,"addEventListener"))P(t,"DOMContentLoaded",u);
else if(P(t,"readystatechange",function(){"complete"==t.readyState&&u()}),t.documentElement.doScroll&&e===top){var X=function(){if(!N){try{t.documentElement.doScroll("left")}catch(e){return void i(X,1)}u()}};X()}P(e,"load",u)}var V=function(e){e=e.substring(1).split("&");for(var t,n={},i=e.length;i--;)t=e[i].split("="),n[t[0]]=o(t[1]);return n}(/xdm_e=/.test(n.search)?n.search:n.hash),K=function(){var e={},t={a:[1,2,3]},n='{"a":[1,2,3]}';return"undefined"!=typeof JSON&&"function"==typeof JSON.stringify&&JSON.stringify(t).replace(/\s/g,"")===n?JSON:(Object.toJSON&&Object.toJSON(t).replace(/\s/g,"")===n&&(e.stringify=Object.toJSON),"function"==typeof String.prototype.evalJSON&&(t=n.evalJSON(),t.a&&3===t.a.length&&3===t.a[2]&&(e.parse=function(e){return e.evalJSON()})),e.stringify&&e.parse?(K=function(){return e},e):null)};C(L,{version:"2.4.18.25",query:V,stack:{},apply:C,getJSONObject:K,whenReady:d,noConflict:h}),L.DomHelper={on:P,un:O,requiresJSON:function(n){s(e,"JSON")||t.write('<script type="text/javascript" src="'+n+'"></script>')}},function(){var e={};L.Fn={set:function(t,n){e[t]=n},get:function(t,n){var i=e[t];return n&&delete e[t],i}}}(),L.Socket=function(e){var t=T(_(e).concat([{incoming:function(t,n){e.onMessage(t,n)},callback:function(t){e.onReady&&e.onReady(t)}}])),n=g(e.remote);this.origin=g(e.remote),this.destroy=function(){t.destroy()},this.postMessage=function(e){t.outgoing(e,n)},t.init()},L.Rpc=function(e,t){if(t.local)for(var n in t.local)if(t.local.hasOwnProperty(n)){var i=t.local[n];"function"==typeof i&&(t.local[n]={method:i})}var o=T(_(e).concat([new L.stack.RpcBehavior(this,t),{callback:function(t){e.onReady&&e.onReady(t)}}]));this.origin=g(e.remote),this.destroy=function(){o.destroy()},o.init()},L.stack.SameOriginTransport=function(e){var t,o,r,a;return t={outgoing:function(e,t,n){r(e),n&&n()},destroy:function(){o&&(o.parentNode.removeChild(o),o=null)},onDOMReady:function(){a=g(e.remote),e.isHost?(C(e.props,{src:b(e.remote,{xdm_e:n.protocol+"//"+n.host+n.pathname,xdm_c:e.channel,xdm_p:4}),name:q+e.channel+"_provider"}),o=x(e),L.Fn.set(e.channel,function(e){return r=e,i(function(){t.up.callback(!0)},0),function(e){t.up.incoming(e,a)}})):(r=m().Fn.get(e.channel,!0)(function(e){t.up.incoming(e,a)}),i(function(){t.up.callback(!0)},0))},init:function(){d(t.onDOMReady,t)}}},L.stack.FlashTransport=function(e){function o(e){i(function(){s.up.incoming(e,c)},0)}function a(n){var i=e.swf+"?host="+e.isHost,o="easyXDM_swf_"+Math.floor(1e4*Math.random());L.Fn.set("flash_loaded"+n.replace(/[\-.]/g,"_"),function(){L.stack.FlashTransport[n].swf=u=m.firstChild;for(var e=L.stack.FlashTransport[n].queue,t=0;t<e.length;t++)e[t]();e.length=0}),e.swfContainer?m="string"==typeof e.swfContainer?t.getElementById(e.swfContainer):e.swfContainer:(m=t.createElement("div"),C(m.style,E&&e.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0}),t.body.appendChild(m));var a="callback=flash_loaded"+r(n.replace(/[\-.]/g,"_"))+"&proto="+j.location.protocol+"&domain="+r(f(j.location.href))+"&port="+r(p(j.location.href))+"&ns="+r(H);m.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+o+"' data='"+i+"'><param name='allowScriptAccess' value='always'></param><param name='wmode' value='transparent'><param name='movie' value='"+i+"'></param><param name='flashvars' value='"+a+"'></param><embed type='application/x-shockwave-flash' FlashVars='"+a+"' allowScriptAccess='always' wmode='transparent' src='"+i+"' height='1' width='1'></embed></object>"}var s,l,c,u,m;return s={outgoing:function(t,n,i){u.postMessage(e.channel,t.toString()),i&&i()},destroy:function(){try{u.destroyChannel(e.channel)}catch(t){}u=null,l&&(l.parentNode.removeChild(l),l=null)},onDOMReady:function(){c=e.remote,L.Fn.set("flash_"+e.channel+"_init",function(){i(function(){s.up.callback(!0)})}),L.Fn.set("flash_"+e.channel+"_onMessage",o),e.swf=v(e.swf);var t=f(e.swf),r=function(){L.stack.FlashTransport[t].init=!0,u=L.stack.FlashTransport[t].swf,u.createChannel(e.channel,e.secret,g(e.remote),e.isHost),e.isHost&&(E&&e.swfNoThrottle&&C(e.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"}),C(e.props,{src:b(e.remote,{xdm_e:g(n.href),xdm_c:e.channel,xdm_p:6,xdm_s:e.secret}),name:q+e.channel+"_provider"}),l=x(e))};L.stack.FlashTransport[t]&&L.stack.FlashTransport[t].init?r():L.stack.FlashTransport[t]?L.stack.FlashTransport[t].queue.push(r):(L.stack.FlashTransport[t]={queue:[r]},a(t))},init:function(){d(s.onDOMReady,s)}}},L.stack.PostMessageTransport=function(t){function o(e){if(e.origin)return g(e.origin);if(e.uri)return g(e.uri);if(e.domain)return n.protocol+"//"+e.domain;throw"Unable to retrieve the origin of the event"}function r(e){var n=o(e);n==c&&e.data.substring(0,t.channel.length+1)==t.channel+" "&&a.up.incoming(e.data.substring(t.channel.length+1),n)}var a,s,l,c;return a={outgoing:function(e,n,i){l.postMessage(t.channel+" "+e,n||c),i&&i()},destroy:function(){O(e,"message",r),s&&(l=null,s.parentNode.removeChild(s),s=null)},onDOMReady:function(){if(c=g(t.remote),t.isHost){var o=function(n){n.data==t.channel+"-ready"&&(l="postMessage"in s.contentWindow?s.contentWindow:s.contentWindow.document,O(e,"message",o),P(e,"message",r),i(function(){a.up.callback(!0)},0))};P(e,"message",o),C(t.props,{src:b(t.remote,{xdm_e:g(n.href),xdm_c:t.channel,xdm_p:1}),name:q+t.channel+"_provider"}),s=x(t)}else P(e,"message",r),l="postMessage"in e.parent?e.parent:e.parent.document,l.postMessage(t.channel+"-ready",c),i(function(){a.up.callback(!0)},0)},init:function(){d(a.onDOMReady,a)}}},L.stack.FrameElementTransport=function(o){var r,a,s,l;return r={outgoing:function(e,t,n){s.call(this,e),n&&n()},destroy:function(){a&&(a.parentNode.removeChild(a),a=null)},onDOMReady:function(){l=g(o.remote),o.isHost?(C(o.props,{src:b(o.remote,{xdm_e:g(n.href),xdm_c:o.channel,xdm_p:5}),name:q+o.channel+"_provider"}),a=x(o),a.fn=function(e){return delete a.fn,s=e,i(function(){r.up.callback(!0)},0),function(e){r.up.incoming(e,l)}}):(t.referrer&&g(t.referrer)!=V.xdm_e&&(e.top.location=V.xdm_e),s=e.frameElement.fn(function(e){r.up.incoming(e,l)}),r.up.callback(!0))},init:function(){d(r.onDOMReady,r)}}},L.stack.NameTransport=function(e){function t(t){var n=e.remoteHelper+(s?"#_3":"#_2")+e.channel;l.contentWindow.sendMessage(t,n)}function n(){s?2!==++u&&s||a.up.callback(!0):(t("ready"),a.up.callback(!0))}function o(e){a.up.incoming(e,h)}function r(){m&&i(function(){m(!0)},0)}var a,s,l,c,u,m,h,f;return a={outgoing:function(e,n,i){m=i,t(e)},destroy:function(){l.parentNode.removeChild(l),l=null,s&&(c.parentNode.removeChild(c),c=null)},onDOMReady:function(){s=e.isHost,u=0,h=g(e.remote),e.local=v(e.local),s?(L.Fn.set(e.channel,function(t){s&&"ready"===t&&(L.Fn.set(e.channel,o),n())}),f=b(e.remote,{xdm_e:e.local,xdm_c:e.channel,xdm_p:2}),C(e.props,{src:f+"#"+e.channel,name:q+e.channel+"_provider"}),c=x(e)):(e.remoteHelper=e.remote,L.Fn.set(e.channel,o));var t=function(){var o=l||this;O(o,"load",t),L.Fn.set(e.channel+"_load",r),function a(){"function"==typeof o.contentWindow.sendMessage?n():i(a,50)}()};l=x({props:{src:e.local+"#_4"+e.channel},onLoad:t})},init:function(){d(a.onDOMReady,a)}}},L.stack.HashTransport=function(t){function n(e){if(p){var n=t.remote+"#"+h++ +"_"+e;(l||!v?p.contentWindow:p).location=n}}function o(e){m=e,s.up.incoming(m.substring(m.indexOf("_")+1),b)}function r(){if(f){var e=f.location.href,t="",n=e.indexOf("#");-1!=n&&(t=e.substring(n)),t&&t!=m&&o(t)}}function a(){c=setInterval(r,u)}var s,l,c,u,m,h,f,p,v,b;return s={outgoing:function(e){n(e)},destroy:function(){e.clearInterval(c),(l||!v)&&p.parentNode.removeChild(p),p=null},onDOMReady:function(){if(l=t.isHost,u=t.interval,m="#"+t.channel,h=0,v=t.useParent,b=g(t.remote),l){if(C(t.props,{src:t.remote,name:q+t.channel+"_provider"}),v)t.onLoad=function(){f=e,a(),s.up.callback(!0)};else{var n=0,o=t.delay/50;!function r(){if(++n>o)throw new Error("Unable to reference listenerwindow");try{f=p.contentWindow.frames[q+t.channel+"_consumer"]}catch(e){}f?(a(),s.up.callback(!0)):i(r,50)}()}p=x(t)}else f=e,a(),v?(p=parent,s.up.callback(!0)):(C(t,{props:{src:t.remote+"#"+t.channel+new Date,name:q+t.channel+"_consumer"},onLoad:function(){s.up.callback(!0)}}),p=x(t))},init:function(){d(s.onDOMReady,s)}}},L.stack.ReliableBehavior=function(){var e,t,n=0,i=0,o="";return e={incoming:function(r,a){var s=r.indexOf("_"),l=r.substring(0,s).split(",");r=r.substring(s+1),l[0]==n&&(o="",t&&t(!0)),r.length>0&&(e.down.outgoing(l[1]+","+n+"_"+o,a),i!=l[1]&&(i=l[1],e.up.incoming(r,a)))},outgoing:function(r,a,s){o=r,t=s,e.down.outgoing(i+","+ ++n+"_"+r,a)}}},L.stack.QueueBehavior=function(e){function t(){if(e.remove&&0===s.length)return void S(n);if(!l&&0!==s.length&&!a){l=!0;var o=s.shift();n.down.outgoing(o.data,o.origin,function(e){l=!1,o.callback&&i(function(){o.callback(e)},0),t()})}}var n,a,s=[],l=!0,c="",u=0,d=!1,m=!1;return n={init:function(){y(e)&&(e={}),e.maxLength&&(u=e.maxLength,m=!0),e.lazy?d=!0:n.down.init()},callback:function(e){l=!1;var i=n.up;t(),i.callback(e)},incoming:function(t,i){if(m){var r=t.indexOf("_"),a=parseInt(t.substring(0,r),10);c+=t.substring(r+1),0===a&&(e.encode&&(c=o(c)),n.up.incoming(c,i),c="")}else n.up.incoming(t,i)},outgoing:function(i,o,a){e.encode&&(i=r(i));var l,c=[];if(m){for(;0!==i.length;)l=i.substring(0,u),i=i.substring(l.length),c.push(l);for(;l=c.shift();)s.push({data:c.length+"_"+l,origin:o,callback:0===c.length?a:null})}else s.push({data:i,origin:o,callback:a});d?n.down.init():t()},destroy:function(){a=!0,n.down.destroy()}}},L.stack.VerifyBehavior=function(e){function t(){i=Math.random().toString(16).substring(2),n.down.outgoing(i)}var n,i,o;return n={incoming:function(r,a){var s=r.indexOf("_");-1===s?r===i?n.up.callback(!0):o||(o=r,e.initiate||t(),n.down.outgoing(r)):r.substring(0,s)===o&&n.up.incoming(r.substring(s+1),a)},outgoing:function(e,t,o){n.down.outgoing(i+"_"+e,t,o)},callback:function(){e.initiate&&t()}}},L.stack.RpcBehavior=function(e,t){function n(e){e.jsonrpc="2.0",r.down.outgoing(a.stringify(e))}function i(e,t){var i=Array.prototype.slice;return function(){var o,r=arguments.length,a={method:t};r>0&&"function"==typeof arguments[r-1]?(r>1&&"function"==typeof arguments[r-2]?(o={success:arguments[r-2],error:arguments[r-1]},a.params=i.call(arguments,0,r-2)):(o={success:arguments[r-1]},a.params=i.call(arguments,0,r-1)),c[""+ ++s]=o,a.id=s):a.params=i.call(arguments,0),e.namedParams&&1===a.params.length&&(a.params=a.params[0]),n(a)}}function o(e,t,i,o){if(!i)return void(t&&n({id:t,error:{code:-32601,message:"Procedure not found."}}));var r,a;t?(r=function(e){r=M,n({id:t,result:e})},a=function(e,i){a=M;var o={id:t,error:{code:-32099,message:e}};i&&(o.error.data=i),n(o)}):r=a=M,l(o)||(o=[o]);try{var s=i.method.apply(i.scope,o.concat([r,a]));y(s)||r(s)}catch(c){a(c.message)}}var r,a=t.serializer||K(),s=0,c={};return r={incoming:function(e){var i=a.parse(e);if(i.method)t.handle?t.handle(i,n):o(i.method,i.id,t.local[i.method],i.params);else{var r=c[i.id];i.error?r.error&&r.error(i.error):r.success&&r.success(i.result),delete c[i.id]}},init:function(){if(t.remote)for(var n in t.remote)t.remote.hasOwnProperty(n)&&(e[n]=i(t.remote[n],n));r.down.init()},destroy:function(){for(var n in t.remote)t.remote.hasOwnProperty(n)&&e.hasOwnProperty(n)&&delete e[n];r.down.destroy()}}},j.easyXDM=L}(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent),document.createElement("canvas").getContext||!function(){function e(){return this.context_||(this.context_=new c(this))}function t(e,t){var n=w.call(arguments,2);return function(){return e.apply(t,n.concat(w.call(arguments)))}}function n(e){var t=e.srcElement;switch(e.propertyName){case"width":t.style.width=t.attributes.width.nodeValue+"px",t.getContext().clearRect();break;case"height":t.style.height=t.attributes.height.nodeValue+"px",t.getContext().clearRect()}}function i(e){var t=e.srcElement;t.firstChild&&(t.firstChild.style.width=t.clientWidth+"px",t.firstChild.style.height=t.clientHeight+"px")}function o(){return[[1,0,0],[0,1,0],[0,0,1]]}function r(e,t){for(var n=o(),i=0;3>i;i++)for(var r=0;3>r;r++){for(var a=0,s=0;3>s;s++)a+=e[i][s]*t[s][r];n[i][r]=a}return n}function a(e,t){t.fillStyle=e.fillStyle,t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.shadowBlur=e.shadowBlur,t.shadowColor=e.shadowColor,t.shadowOffsetX=e.shadowOffsetX,t.shadowOffsetY=e.shadowOffsetY,t.strokeStyle=e.strokeStyle,t.globalAlpha=e.globalAlpha,t.arcScaleX_=e.arcScaleX_,t.arcScaleY_=e.arcScaleY_,t.lineScale_=e.lineScale_}function s(e){var t,n=1;if(e=String(e),"rgb"==e.substring(0,3)){var i=e.indexOf("(",3),o=e.indexOf(")",i+1),r=e.substring(i+1,o).split(",");t="#";for(var a=0;3>a;a++)t+=T[Number(r[a])];4==r.length&&"a"==e.substr(3,1)&&(n=r[3])}else t=e;return{color:t,alpha:n}}function l(e){switch(e){case"butt":return"flat";case"round":return"round";case"square":default:return"square"}}function c(e){this.m_=o(),this.mStack_=[],this.aStack_=[],this.currentPath_=[],this.strokeStyle="#000",this.fillStyle="#000",this.lineWidth=1,this.lineJoin="miter",this.lineCap="butt",this.miterLimit=1*k,this.globalAlpha=1,this.canvas=e;var t=e.ownerDocument.createElement("div");t.style.width=e.clientWidth+"px",t.style.height=e.clientHeight+"px",t.style.overflow="hidden",t.style.position="absolute",e.appendChild(t),this.element_=t,this.arcScaleX_=1,this.arcScaleY_=1,this.lineScale_=1}function u(e,t,n,i){e.currentPath_.push({type:"bezierCurveTo",cp1x:t.x,cp1y:t.y,cp2x:n.x,cp2y:n.y,x:i.x,y:i.y}),e.currentX_=i.x,e.currentY_=i.y}function d(e){for(var t=0;3>t;t++)for(var n=0;2>n;n++)if(!isFinite(e[t][n])||isNaN(e[t][n]))return!1;return!0}function m(e,t,n){if(d(t)&&(e.m_=t,n)){var i=t[0][0]*t[1][1]-t[0][1]*t[1][0];e.lineScale_=C(y(i))}}function h(e){this.type_=e,this.x0_=0,this.y0_=0,this.r0_=0,this.x1_=0,this.y1_=0,this.r1_=0,this.colors_=[]}function f(){}var p=Math,g=p.round,v=p.sin,b=p.cos,y=p.abs,C=p.sqrt,k=10,x=k/2,w=Array.prototype.slice,_={init:function(e){if(/MSIE/.test(navigator.userAgent)&&!window.opera){var n=e||document;n.createElement("canvas"),n.attachEvent("onreadystatechange",t(this.init_,this,n))}},init_:function(e){if(e.namespaces.g_vml_||e.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML"),e.namespaces.g_o_||e.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML"),!e.styleSheets.ex_canvas_){var t=e.createStyleSheet();t.owningElement.id="ex_canvas_",t.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}g_vml_\\:*{behavior:url(#default#VML)}g_o_\\:*{behavior:url(#default#VML)}"}for(var n=e.getElementsByTagName("canvas"),i=0;i<n.length;i++)this.initElement(n[i])},initElement:function(t){if(!t.getContext){t.getContext=e,t.innerHTML="",t.attachEvent("onpropertychange",n),t.attachEvent("onresize",i);var o=t.attributes;o.width&&o.width.specified?t.style.width=o.width.nodeValue+"px":t.width=t.clientWidth,o.height&&o.height.specified?t.style.height=o.height.nodeValue+"px":t.height=t.clientHeight}return t}};_.init();for(var T=[],S=0;16>S;S++)for(var I=0;16>I;I++)T[16*S+I]=S.toString(16)+I.toString(16);var F=c.prototype;F.clearRect=function(){this.element_.innerHTML=""},F.beginPath=function(){this.currentPath_=[]},F.moveTo=function(e,t){var n=this.getCoords_(e,t);this.currentPath_.push({type:"moveTo",x:n.x,y:n.y}),this.currentX_=n.x,this.currentY_=n.y},F.lineTo=function(e,t){var n=this.getCoords_(e,t);this.currentPath_.push({type:"lineTo",x:n.x,y:n.y}),this.currentX_=n.x,this.currentY_=n.y},F.bezierCurveTo=function(e,t,n,i,o,r){var a=this.getCoords_(o,r),s=this.getCoords_(e,t),l=this.getCoords_(n,i);u(this,s,l,a)},F.quadraticCurveTo=function(e,t,n,i){var o=this.getCoords_(e,t),r=this.getCoords_(n,i),a={x:this.currentX_+2/3*(o.x-this.currentX_),y:this.currentY_+2/3*(o.y-this.currentY_)},s={x:a.x+(r.x-this.currentX_)/3,y:a.y+(r.y-this.currentY_)/3};u(this,a,s,r)},F.arc=function(e,t,n,i,o,r){n*=k;var a=r?"at":"wa",s=e+b(i)*n-x,l=t+v(i)*n-x,c=e+b(o)*n-x,u=t+v(o)*n-x;s!=c||r||(s+=.125);var d=this.getCoords_(e,t),m=this.getCoords_(s,l),h=this.getCoords_(c,u);this.currentPath_.push({type:a,x:d.x,y:d.y,radius:n,xStart:m.x,yStart:m.y,xEnd:h.x,yEnd:h.y})},F.rect=function(e,t,n,i){this.moveTo(e,t),this.lineTo(e+n,t),this.lineTo(e+n,t+i),this.lineTo(e,t+i),this.closePath()},F.strokeRect=function(e,t,n,i){var o=this.currentPath_;this.beginPath(),this.moveTo(e,t),this.lineTo(e+n,t),this.lineTo(e+n,t+i),this.lineTo(e,t+i),this.closePath(),this.stroke(),this.currentPath_=o},F.fillRect=function(e,t,n,i){var o=this.currentPath_;this.beginPath(),this.moveTo(e,t),this.lineTo(e+n,t),this.lineTo(e+n,t+i),this.lineTo(e,t+i),this.closePath(),this.fill(),this.currentPath_=o},F.createLinearGradient=function(e,t,n,i){var o=new h("gradient");return o.x0_=e,o.y0_=t,o.x1_=n,o.y1_=i,o},F.createRadialGradient=function(e,t,n,i,o,r){var a=new h("gradientradial");return a.x0_=e,a.y0_=t,a.r0_=n,a.x1_=i,a.y1_=o,a.r1_=r,a},F.drawImage=function(e){var t,n,i,o,r,a,s,l,c=e.runtimeStyle.width,u=e.runtimeStyle.height;e.runtimeStyle.width="auto",e.runtimeStyle.height="auto";var d=e.width,m=e.height;if(e.runtimeStyle.width=c,e.runtimeStyle.height=u,3==arguments.length)t=arguments[1],n=arguments[2],r=a=0,s=i=d,l=o=m;else if(5==arguments.length)t=arguments[1],n=arguments[2],i=arguments[3],o=arguments[4],r=a=0,s=d,l=m;else{if(9!=arguments.length)throw Error("Invalid number of arguments");r=arguments[1],a=arguments[2],s=arguments[3],l=arguments[4],t=arguments[5],n=arguments[6],i=arguments[7],o=arguments[8]}var h=this.getCoords_(t,n),f=[],v=10,b=10;if(f.push(" <g_vml_:group",' coordsize="',k*v,",",k*b,'"',' coordorigin="0,0"',' style="width:',v,"px;height:",b,"px;position:absolute;"),1!=this.m_[0][0]||this.m_[0][1]){var y=[];y.push("M11=",this.m_[0][0],",","M12=",this.m_[1][0],",","M21=",this.m_[0][1],",","M22=",this.m_[1][1],",","Dx=",g(h.x/k),",","Dy=",g(h.y/k),"");var C=h,x=this.getCoords_(t+i,n),w=this.getCoords_(t,n+o),_=this.getCoords_(t+i,n+o);C.x=p.max(C.x,x.x,w.x,_.x),C.y=p.max(C.y,x.y,w.y,_.y),f.push("padding:0 ",g(C.x/k),"px ",g(C.y/k),"px 0;filter:progid:DXImageTransform.Microsoft.Matrix(",y.join(""),", sizingmethod='clip');")}else f.push("top:",g(h.y/k),"px;left:",g(h.x/k),"px;");f.push(' ">','<g_vml_:image src="',e.src,'"',' style="width:',k*i,"px;"," height:",k*o,'px;"',' cropleft="',r/d,'"',' croptop="',a/m,'"',' cropright="',(d-r-s)/d,'"',' cropbottom="',(m-a-l)/m,'"'," />","</g_vml_:group>"),this.element_.insertAdjacentHTML("BeforeEnd",f.join(""))},F.stroke=function(e){var t=[],n=s(e?this.fillStyle:this.strokeStyle),i=n.color,o=n.alpha*this.globalAlpha,r=10,a=10;t.push("<g_vml_:shape",' filled="',!!e,'"',' style="position:absolute;width:',r,"px;height:",a,'px;"',' coordorigin="0 0" coordsize="',k*r," ",k*a,'"',' stroked="',!e,'"',' path="');for(var c={x:null,y:null},u={x:null,y:null},d=0;d<this.currentPath_.length;d++){var m,h=this.currentPath_[d];switch(h.type){case"moveTo":m=h,t.push(" m ",g(h.x),",",g(h.y));break;case"lineTo":t.push(" l ",g(h.x),",",g(h.y));break;case"close":t.push(" x "),h=null;break;case"bezierCurveTo":t.push(" c ",g(h.cp1x),",",g(h.cp1y),",",g(h.cp2x),",",g(h.cp2y),",",g(h.x),",",g(h.y));break;case"at":case"wa":t.push(" ",h.type," ",g(h.x-this.arcScaleX_*h.radius),",",g(h.y-this.arcScaleY_*h.radius)," ",g(h.x+this.arcScaleX_*h.radius),",",g(h.y+this.arcScaleY_*h.radius)," ",g(h.xStart),",",g(h.yStart)," ",g(h.xEnd),",",g(h.yEnd))}h&&((null==c.x||h.x<c.x)&&(c.x=h.x),(null==u.x||h.x>u.x)&&(u.x=h.x),(null==c.y||h.y<c.y)&&(c.y=h.y),(null==u.y||h.y>u.y)&&(u.y=h.y))}if(t.push(' ">'),e)if("object"==typeof this.fillStyle){var f=this.fillStyle,v=0,b={x:0,y:0},y=0,C=1;if("gradient"==f.type_){var x=f.x0_/this.arcScaleX_,w=f.y0_/this.arcScaleY_,_=f.x1_/this.arcScaleX_,T=f.y1_/this.arcScaleY_,S=this.getCoords_(x,w),I=this.getCoords_(_,T),F=I.x-S.x,E=I.y-S.y;v=180*Math.atan2(F,E)/Math.PI,0>v&&(v+=360),1e-6>v&&(v=0)}else{var S=this.getCoords_(f.x0_,f.y0_),P=u.x-c.x,O=u.y-c.y;b={x:(S.x-c.x)/P,y:(S.y-c.y)/O},P/=this.arcScaleX_*k,O/=this.arcScaleY_*k;var j=p.max(P,O);y=2*f.r0_/j,C=2*f.r1_/j-y}var A=f.colors_;A.sort(function(e,t){return e.offset-t.offset});for(var M=A.length,D=A[0].color,U=A[M-1].color,R=A[0].alpha*this.globalAlpha,H=A[M-1].alpha*this.globalAlpha,L=[],d=0;M>d;d++){var B=A[d];L.push(B.offset*C+y+" "+B.color)}t.push('<g_vml_:fill type="',f.type_,'"',' method="none" focus="100%"',' color="',D,'"',' color2="',U,'"',' colors="',L.join(","),'"',' opacity="',H,'"',' g_o_:opacity2="',R,'"',' angle="',v,'"',' focusposition="',b.x,",",b.y,'" />')}else t.push('<g_vml_:fill color="',i,'" opacity="',o,'" />');else{var q=this.lineScale_*this.lineWidth;1>q&&(o*=q),t.push("<g_vml_:stroke",' opacity="',o,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',l(this.lineCap),'"',' weight="',q,'px"',' color="',i,'" />')}t.push("</g_vml_:shape>"),this.element_.insertAdjacentHTML("beforeEnd",t.join(""))},F.fill=function(){this.stroke(!0)},F.closePath=function(){this.currentPath_.push({type:"close"})},F.getCoords_=function(e,t){var n=this.m_;return{x:k*(e*n[0][0]+t*n[1][0]+n[2][0])-x,y:k*(e*n[0][1]+t*n[1][1]+n[2][1])-x}},F.save=function(){var e={};a(this,e),this.aStack_.push(e),this.mStack_.push(this.m_),this.m_=r(o(),this.m_)},F.restore=function(){a(this.aStack_.pop(),this),this.m_=this.mStack_.pop()},F.translate=function(e,t){var n=[[1,0,0],[0,1,0],[e,t,1]];m(this,r(n,this.m_),!1)},F.rotate=function(e){var t=b(e),n=v(e),i=[[t,n,0],[-n,t,0],[0,0,1]];m(this,r(i,this.m_),!1)},F.scale=function(e,t){this.arcScaleX_*=e,this.arcScaleY_*=t;var n=[[e,0,0],[0,t,0],[0,0,1]];m(this,r(n,this.m_),!0)},F.transform=function(e,t,n,i,o,a){var s=[[e,t,0],[n,i,0],[o,a,1]];m(this,r(s,this.m_),!0)},F.setTransform=function(e,t,n,i,o,r){var a=[[e,t,0],[n,i,0],[o,r,1]];m(this,a,!0)},F.clip=function(){},F.arcTo=function(){},F.createPattern=function(){return new f},h.prototype.addColorStop=function(e,t){t=s(t),this.colors_.push({offset:e,color:t.color,alpha:t.alpha})},G_vmlCanvasManager=_,CanvasRenderingContext2D=c,CanvasGradient=h,CanvasPattern=f}(),function(e){"use strict";var t={},n=Math.max,i=Math.min;t.c={},t.c.d=e(document),t.c.t=function(e){return e.originalEvent.touches.length-1},t.o=function(){var n=this;this.o=null,this.$=null,this.i=null,this.g=null,this.v=null,this.cv=null,this.x=0,this.y=0,this.w=0,this.h=0,this.$c=null,this.c=null,this.t=0,this.isInit=!1,this.fgColor=null,this.pColor=null,this.dH=null,this.cH=null,this.eH=null,this.rH=null,this.scale=1,this.relative=!1,this.relativeWidth=!1,this.relativeHeight=!1,this.$div=null,this.run=function(){var t=function(e,t){var i;for(i in t)n.o[i]=t[i];n._carve().init(),n._configure()._draw()};if(!this.$.data("kontroled")){if(this.$.data("kontroled",!0),this.extend(),this.o=e.extend({min:void 0!==this.$.data("min")?this.$.data("min"):0,max:void 0!==this.$.data("max")?this.$.data("max"):100,stopper:!0,readOnly:this.$.data("readonly")||"readonly"===this.$.attr("readonly"),cursor:this.$.data("cursor")===!0&&30||this.$.data("cursor")||0,thickness:this.$.data("thickness")&&Math.max(Math.min(this.$.data("thickness"),1),.01)||.35,lineCap:this.$.data("linecap")||"butt",width:this.$.data("width")||200,height:this.$.data("height")||200,displayInput:null==this.$.data("displayinput")||this.$.data("displayinput"),displayPrevious:this.$.data("displayprevious"),fgColor:this.$.data("fgcolor")||"#87CEEB",inputColor:this.$.data("inputcolor"),font:this.$.data("font")||"Arial",fontWeight:this.$.data("font-weight")||"bold",inline:!1,step:this.$.data("step")||1,rotation:this.$.data("rotation"),draw:null,change:null,cancel:null,release:null,format:function(e){return e},parse:function(e){return parseFloat(e)}},this.o),this.o.flip="anticlockwise"===this.o.rotation||"acw"===this.o.rotation,this.o.inputColor||(this.o.inputColor=this.o.fgColor),this.$.is("fieldset")?(this.v={},this.i=this.$.find("input"),this.i.each(function(t){var i=e(this);n.i[t]=i,n.v[t]=n.o.parse(i.val()),i.bind("change blur",function(){var e={};e[t]=i.val(),n.val(e)})}),this.$.find("legend").remove()):(this.i=this.$,this.v=this.o.parse(this.$.val()),""===this.v&&(this.v=this.o.min),this.$.bind("change blur",function(){n.val(n._validate(n.o.parse(n.$.val())))})),!this.o.displayInput&&this.$.hide(),this.$c=e(document.createElement("canvas")).attr({width:this.o.width,height:this.o.height}),this.$div=e('<div style="'+(this.o.inline?"display:inline;":"")+"width:"+this.o.width+"px;height:"+this.o.height+'px;"></div>'),this.$.wrap(this.$div).before(this.$c),this.$div=this.$.parent(),"undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement(this.$c[0]),this.c=this.$c[0].getContext?this.$c[0].getContext("2d"):null,!this.c)throw{name:"CanvasNotSupportedException",message:"Canvas not supported. Please use excanvas on IE8.0.",toString:function(){return this.name+": "+this.message}};return this.scale=(window.devicePixelRatio||1)/(this.c.webkitBackingStorePixelRatio||this.c.mozBackingStorePixelRatio||this.c.msBackingStorePixelRatio||this.c.oBackingStorePixelRatio||this.c.backingStorePixelRatio||1),this.relativeWidth=this.o.width%1!==0&&this.o.width.indexOf("%"),this.relativeHeight=this.o.height%1!==0&&this.o.height.indexOf("%"),this.relative=this.relativeWidth||this.relativeHeight,this._carve(),this.v instanceof Object?(this.cv={},this.copy(this.v,this.cv)):this.cv=this.v,this.$.bind("configure",t).parent().bind("configure",t),this._listen()._configure()._xy().init(),this.isInit=!0,this.$.val(this.o.format(this.v)),this._draw(),this}},this._carve=function(){if(this.relative){var e=this.relativeWidth?this.$div.parent().width()*parseInt(this.o.width)/100:this.$div.parent().width(),t=this.relativeHeight?this.$div.parent().height()*parseInt(this.o.height)/100:this.$div.parent().height();this.w=this.h=Math.min(e,t)}else this.w=this.o.width,this.h=this.o.height;return this.$div.css({width:this.w+"px",height:this.h+"px"}),this.$c.attr({width:this.w,height:this.h}),1!==this.scale&&(this.$c[0].width=this.$c[0].width*this.scale,this.$c[0].height=this.$c[0].height*this.scale,this.$c.width(this.w),this.$c.height(this.h)),this},this._draw=function(){var e=!0;n.g=n.c,n.clear(),n.dH&&(e=n.dH()),e!==!1&&n.draw()},this._touch=function(e){var i=function(e){var t=n.xy2val(e.originalEvent.touches[n.t].pageX,e.originalEvent.touches[n.t].pageY);t!=n.cv&&(n.cH&&n.cH(t)===!1||(n.change(n._validate(t)),n._draw()))};return this.t=t.c.t(e),i(e),t.c.d.bind("touchmove.k",i).bind("touchend.k",function(){t.c.d.unbind("touchmove.k touchend.k"),n.val(n.cv)}),this},this._mouse=function(e){var i=function(e){var t=n.xy2val(e.pageX,e.pageY);t!=n.cv&&(n.cH&&n.cH(t)===!1||(n.change(n._validate(t)),n._draw()))};return i(e),t.c.d.bind("mousemove.k",i).bind("keyup.k",function(e){if(27===e.keyCode){if(t.c.d.unbind("mouseup.k mousemove.k keyup.k"),n.eH&&n.eH()===!1)return;n.cancel()}}).bind("mouseup.k",function(){t.c.d.unbind("mousemove.k mouseup.k keyup.k"),n.val(n.cv)}),this},this._xy=function(){var e=this.$c.offset();return this.x=e.left,this.y=e.top,this},this._listen=function(){return this.o.readOnly?this.$.attr("readonly","readonly"):(this.$c.bind("mousedown",function(e){e.preventDefault(),n._xy()._mouse(e)}).bind("touchstart",function(e){e.preventDefault(),n._xy()._touch(e)}),this.listen()),this.relative&&e(window).resize(function(){n._carve().init(),n._draw()}),this},this._configure=function(){return this.o.draw&&(this.dH=this.o.draw),this.o.change&&(this.cH=this.o.change),this.o.cancel&&(this.eH=this.o.cancel),this.o.release&&(this.rH=this.o.release),this.o.displayPrevious?(this.pColor=this.h2rgba(this.o.fgColor,"0.4"),this.fgColor=this.h2rgba(this.o.fgColor,"0.6")):this.fgColor=this.o.fgColor,this},this._clear=function(){this.$c[0].width=this.$c[0].width},this._validate=function(e){return~~((0>e?-.5:.5)+e/this.o.step)*this.o.step},this.listen=function(){},this.extend=function(){},this.init=function(){},this.change=function(){},this.val=function(){},this.xy2val=function(){},this.draw=function(){},this.clear=function(){this._clear()},this.h2rgba=function(e,t){var n;return e=e.substring(1,7),n=[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)],"rgba("+n[0]+","+n[1]+","+n[2]+","+t+")"},this.copy=function(e,t){for(var n in e)t[n]=e[n]}},t.Dial=function(){t.o.call(this),this.startAngle=null,this.xy=null,this.radius=null,this.lineWidth=null,this.cursorExt=null,this.w2=null,this.PI2=2*Math.PI,this.extend=function(){this.o=e.extend({bgColor:this.$.data("bgcolor")||"#EEEEEE",angleOffset:this.$.data("angleoffset")||0,angleArc:this.$.data("anglearc")||360,inline:!0},this.o)},this.val=function(e,t){return null==e?this.v:(e=this.o.parse(e),void(t!==!1&&e!=this.v&&this.rH&&this.rH(e)===!1||(this.cv=this.o.stopper?n(i(e,this.o.max),this.o.min):e,this.v=this.cv,this.$.val(this.o.format(this.v)),this._draw())))},this.xy2val=function(e,t){var o,r;return o=Math.atan2(e-(this.x+this.w2),-(t-this.y-this.w2))-this.angleOffset,this.o.flip&&(o=this.angleArc-o-this.PI2),this.angleArc!=this.PI2&&0>o&&o>-.5?o=0:0>o&&(o+=this.PI2),r=~~(.5+o*(this.o.max-this.o.min)/this.angleArc)+this.o.min,this.o.stopper&&(r=n(i(r,this.o.max),this.o.min)),r},this.listen=function(){var t,o,r,a,s=this,l=function(e){e.preventDefault();var r=e.originalEvent,a=r.detail||r.wheelDeltaX,l=r.detail||r.wheelDeltaY,c=s._validate(s.o.parse(s.$.val()))+(a>0||l>0?s.o.step:0>a||0>l?-s.o.step:0);c=n(i(c,s.o.max),s.o.min),s.val(c,!1),s.rH&&(clearTimeout(t),t=setTimeout(function(){s.rH(c),t=null},100),o||(o=setTimeout(function(){t&&s.rH(c),o=null},200)))},c=1,u={37:-s.o.step,38:s.o.step,39:s.o.step,40:-s.o.step};this.$.bind("keydown",function(t){var o=t.keyCode;if(o>=96&&105>=o&&(o=t.keyCode=o-48),r=parseInt(String.fromCharCode(o)),isNaN(r)&&(13!==o&&8!==o&&9!==o&&189!==o&&(190!==o||s.$.val().match(/\./))&&t.preventDefault(),e.inArray(o,[37,38,39,40])>-1)){t.preventDefault();var l=s.o.parse(s.$.val())+u[o]*c;s.o.stopper&&(l=n(i(l,s.o.max),s.o.min)),s.change(l),s._draw(),a=window.setTimeout(function(){c*=2},30)}}).bind("keyup",function(){isNaN(r)?a&&(window.clearTimeout(a),a=null,c=1,s.val(s.$.val())):s.$.val()>s.o.max&&s.$.val(s.o.max)||s.$.val()<s.o.min&&s.$.val(s.o.min)}),this.$c.bind("mousewheel DOMMouseScroll",l),this.$.bind("mousewheel DOMMouseScroll",l)},this.init=function(){(this.v<this.o.min||this.v>this.o.max)&&(this.v=this.o.min),this.$.val(this.v),this.w2=this.w/2,this.cursorExt=this.o.cursor/100,this.xy=this.w2*this.scale,this.lineWidth=this.xy*this.o.thickness,this.lineCap=this.o.lineCap,this.radius=this.xy-this.lineWidth/2,this.o.angleOffset&&(this.o.angleOffset=isNaN(this.o.angleOffset)?0:this.o.angleOffset),this.o.angleArc&&(this.o.angleArc=isNaN(this.o.angleArc)?this.PI2:this.o.angleArc),this.angleOffset=this.o.angleOffset*Math.PI/180,this.angleArc=this.o.angleArc*Math.PI/180,this.startAngle=1.5*Math.PI+this.angleOffset,this.endAngle=1.5*Math.PI+this.angleOffset+this.angleArc;var e=n(String(Math.abs(this.o.max)).length,String(Math.abs(this.o.min)).length,2)+2;this.o.displayInput&&this.i.css({width:(this.w/2+4>>0)+"px",height:(this.w/3>>0)+"px",position:"absolute","vertical-align":"middle","margin-top":(this.w/3>>0)+"px","margin-left":"-"+(3*this.w/4+2>>0)+"px",border:0,background:"none",font:this.o.fontWeight+" "+(this.w/e>>0)+"px "+this.o.font,"text-align":"center",color:this.o.inputColor||this.o.fgColor,padding:"0px","-webkit-appearance":"none"})||this.i.css({width:"0px",visibility:"hidden"})},this.change=function(e){this.cv=e,this.$.val(this.o.format(e))},this.angle=function(e){return(e-this.o.min)*this.angleArc/(this.o.max-this.o.min)},this.arc=function(e){var t,n;return e=this.angle(e),this.o.flip?(t=this.endAngle+1e-5,n=t-e-1e-5):(t=this.startAngle-1e-5,n=t+e+1e-5),this.o.cursor&&(t=n-this.cursorExt)&&(n+=this.cursorExt),{s:t,e:n,d:this.o.flip&&!this.o.cursor}},this.draw=function(){
var e,t=this.g,n=this.arc(this.cv),i=1;t.beginPath(),t.lineWidth=this.lineWidth,t.lineCap=this.lineCap,t.strokeStyle=this.o.bgColor,t.arc(this.xy,this.xy,this.radius,this.endAngle-1e-5,this.startAngle+1e-5,!0),t.stroke(),this.o.displayPrevious&&(e=this.arc(this.v),t.beginPath(),t.strokeStyle=this.pColor,t.arc(this.xy,this.xy,this.radius,e.s,e.e,e.d),t.stroke(),i=this.cv==this.v),t.beginPath(),t.strokeStyle=i?this.o.fgColor:this.fgColor,t.arc(this.xy,this.xy,this.radius,n.s,n.e,n.d),t.stroke()},this.cancel=function(){this.val(this.v)}},e.fn.dial=e.fn.knob=function(n){return this.each(function(){var i=new t.Dial;i.o=n,i.$=e(this),i.run()}).parent()}}(jQuery);var Lightbox;!function(e,t){Lightbox=function(n){e.extend(this,{options:{resizeDuration:50,fadeDuration:200},album:[],currentImageIndex:null,location:{},imageLoadingProgress:0,$lightbox:null,init:function(){this.location={originalURL:document.URL,originalTitle:document.title,depth:0},this.build(),this.staticBinds()},isFirst:function(){return this.currentImageIndex<=0},isLast:function(){return this.currentImageIndex>=this.album.length-1},thumbnailClick:function(t){var n=t.data,i=e(t.currentTarget);t.stopPropagation(),t.preventDefault(),n.buildAlbum(i.attr("rel")),n.start(i.data("image-index"))},staticBinds:function(){e("body").off("click._cmt-lightbox").on("click._cmt-lightbox",".commentsvlru-lightbox-wrapper a[rel^=lightbox], .commentsvlru a[rel^=lightbox]",this,this.thumbnailClick)},binds:function(){var n=this;n.$lightbox.on("click.cmt-lightbox",".cmt-lightbox__outer-container",function(t){return e(t.target).is(".cmt-lightbox__outer-container")?n.end():!(0==e(t.target).closest(".cmt-lightbox__data-container").length)}),n.$lightbox.on("click.cmt-lightbox",".cmt_lightbox__prev.enabled",e.proxy(n.prevImage,n)),n.$lightbox.on("click.cmt-lightbox",".cmt-lightbox__next.enabled",e.proxy(n.nextImage,n)),n.$lightbox.on("click.cmt-lightbox",".cmt-lightbox__close",e.proxy(n.end,n)),e(t).on("resize.cmt-lightbox",{self:this},this.adjustLightboxSize),n.$lightbox.find(".cmt-lightbox__image").hover(function(){n.$lightbox.find(".cmt-lightbox__next").addClass("hover")},function(){n.$lightbox.find(".cmt-lightbox__next").removeClass("hover")}),n.$lightbox.on("click.cmt-lightbox",".cmt-lightbox__image",e.proxy(n.nextImage,n))},spinner:function(){var t=this,n=e("#comments-lightbox .cmt-lightbox__container"),i=e("<div>",{"class":"cmt-lightbox__spinner"}).appendTo(n),o=e("<input>",{"class":"lb-image-loading-progress",type:"text","data-width":"100","data-readOnly":!0}).appendTo(n);this.isOldIE()?o.hide():(o.knob().closest("div").addClass("cmt-lightbox__throbber"),i.hide());var r=["0","1","2","3","4","5","6","7"],a=120,s=0,l=function(){var n=o.closest(".cmt-lightbox__container").width()/2-50,i=o.closest(".cmt-lightbox__container").height()/2-50;e(".cmt-lightbox__throbber").css("left",n+"px").css("top",i+"px");var c=e(".cmt-lightbox__spinner").get(0);e(".lb-image-loading-progress").val(t.imageLoadingProgress).trigger("change"),c&&(c.innerHTML=r[s],s=s<r.length-1?s+1:0),setTimeout(l,a)};return l(),i},isOldIE:function(){var e=navigator.userAgent.toLowerCase(),t=-1!=e.indexOf("msie")?parseInt(e.split("msie")[1]):!1;return t&&10>t},build:function(){var t=e(e.parseHTML('<div id="cmt-lightbox__overlay"></div><div id="comments-lightbox"><table><tr><td class="cmt_lightbox__prev"><span class="arrow">Ô</span></td><td class="cmt-lightbox__outer-container"><div class="cmt-lightbox__shadow"><div class="cmt-lightbox__container"><img class="cmt-lightbox__image"/></div><div class="cmt-lightbox__data-container"><div class="cmt-lightbox__data clearfix"><div class="cmt-lightbox__details"><span class="cmt-lightbox__index">&nbsp;</span><span class="cmt-lightbox__caption">&nbsp;</span><a class="cmt-lightbox__download-link font-icon" title="Просмотр в оригинальном размере" target="_blank">p</a></div><span class="cmt-lightbox__progress"></span></div></td><td class="cmt-lightbox__next"><span class="arrow">×</span><div class="cmt-lightbox__close" title="Закрыть">&#206;</span></td></table></div>'));e("#comments-lightbox").remove(),e("#cmt-lightbox__overlay").remove(),t.appendTo(e("body")),this.$lightbox=e("#comments-lightbox").hide(),this.$lightboxOverlay=e("#cmt-lightbox__overlay").hide(),this.$image=this.$lightbox.find(".cmt-lightbox__image"),this.sizeContainer(400,400,!1),this.$spinner=this.spinner()},buildAlbum:function(t){var n,i,o,r;for(this.album=[],r=e("a[rel="+t+"]"),i=0,o=r.length;o>i;i++)n=e(r[i]),this.album[i]={link:n.attr("href"),title:n.attr("title"),originalSizeUrl:n.data("orig-url"),index:i+1},n.data("image-index",i)},start:function(t){e("object, embed").css({visibility:"hidden"}),e("body").addClass("cmt_lightbox__no-scroll"),this.$lightbox.fadeIn(this.options.fadeDuration),this.$lightboxOverlay.fadeIn(this.options.fadeDuration),this.setImage(t),this.binds()},nextImage:function(){this.isLast()||this.setImage(this.currentImageIndex+1)},prevImage:function(){return this.isFirst()?void 0:this.setImage(this.currentImageIndex-1)},setImage:function(e){var t,n,i=this;this.imageLoadingProgress=0,this.disableKeyboardNav(),t=this.$image.removeAttr("src"),t.width(t.width()-1).width(t.width()+1),n=new Image,i.$spinner.css("zIndex",function(){return i.$image.css("zIndex")+2}),n.onload=function(){t.attr("src",n.src),i.image={originalWidth:n.width,originalHeight:n.height};var o=i.calculateImageSize(n.width,n.height);return i.$spinner.css("zIndex",function(){return i.$image.css("zIndex")-2}),i.album[e].preloaded=!0,i.sizeContainer(o[0],o[1],!0)},this.isOldIE()?n.src=this.album[e].link:i.loadImage(n,this.album[e].link),this.$lightbox.find(".cmt-lightbox__progress").css("width",(e+1)/this.album.length*100+"%"),this.currentImageIndex=e,this.updateNav()},loadImage:function(e,n){var i=this,o=new XMLHttpRequest;o.open("GET",n,!0),t.opera?o.overrideMimeType("text/plain; charset=x-user-defined"):o.responseType="arraybuffer",o.onload=function(){if(t.opera)e.src="data:image/jpeg;base64,"+i.base64Encode(this.responseText);else{var n=new Blob([this.response]);e.src=t.URL.createObjectURL(n)}e.completedPercentage=0},o.onprogress=function(n){i.imageLoadingProgress=parseInt(t.opera&&parseFloat(opera.version())<13?e.completedPercentage=n.loaded/n.total*100/2:e.completedPercentage=n.loaded/n.total*100)},o.onloadstart=function(){e.completedPercentage=0},o.send(null)},base64Encode:function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="",i=0;i<e.length;){var o,r,a=255&e.charCodeAt(i++),s=255&e.charCodeAt(i++),l=255&e.charCodeAt(i++),c=a>>2,u=(3&a)<<4|s>>4;isNaN(s)?o=r=64:(o=(15&s)<<2|l>>6,r=isNaN(l)?64:63&l),n+=t.charAt(c)+t.charAt(u)+t.charAt(o)+t.charAt(r)}return n},adjustLightboxSize:function(e){var t,n,i=e.data.self;t=i.image,n=i.calculateImageSize(t.originalWidth,t.originalHeight),i.$lightbox.find(".cmt-lightbox__outer-container").css({width:n[0],height:n[1]+47}),i.$lightbox.find(".cmt-lightbox__container").css({width:n[0],height:n[1]}),i.$lightbox.find(".cmt-lightbox__image").css({width:n[0],height:n[1]})},calculateImageSize:function(n,i){var o,r=0,a=0,s=120,l=80;o=e(t);var c=o.width(),u=o.height();if(n+s>c||i+l>u){r=(c-2*s)/n,a=(u-l)/i;var d=Math.min(r,a);n*=d,i*=d}return[n,i]},sizeContainer:function(e,t,n){var i,o,r,a,s,l,c,u,d,m,h,f,p,g,v=this;if(o=this.$lightbox,r=o.find(".cmt-lightbox__outer-container"),g=o.find(".cmt-lightbox__image"),h=r.outerWidth(),m=r.outerHeight(),i=o.find(".cmt-lightbox__container"),f=o.find(".cmt-lightbox__data-container"),c=parseInt(i.css("padding-top"),10),l=parseInt(i.css("padding-right"),10),a=parseInt(i.css("padding-bottom"),10),s=parseInt(i.css("padding-left"),10),p=f.height(),d=e+s+l,u=t+c+a+p,d!==h&&u!==m?(r.css({width:d,height:u}),g.css({width:e,height:t})):d!==h?(r.css({width:d}),g.css({width:e})):u!==m&&(r.css({height:u}),g.css({height:t})),i.css({width:e,height:t}),n){var b=this;setTimeout(function(){v.showImage()},b.options.resizeDuration)}},showImage:function(){this.updateDetails(),this.enableKeyboardNav(),this.preloadNeighboringImages()},updateNav:function(){var e=this.$lightbox;this.isFirst()?e.find(".cmt_lightbox__prev .arrow").css("visibility","hidden").end().find(".cmt_lightbox__prev").removeClass("enabled"):e.find(".cmt_lightbox__prev .arrow").css("visibility","visible").end().find(".cmt_lightbox__prev").addClass("enabled"),this.isLast()?e.find(".cmt-lightbox__next .arrow").css("visibility","hidden").end().find(".cmt-lightbox__next").removeClass("enabled"):e.find(".cmt-lightbox__next .arrow").css("visibility","visible").end().find(".cmt-lightbox__next").addClass("enabled")},updateDetails:function(){var e=this.$lightbox,t=this.currentImageIndex;"undefined"!=typeof this.album[t].title&&""!==this.album[t].title&&e.find(".cmt-lightbox__caption").html(this.album[t].title).fadeIn("fast"),this.album[t].originalSizeUrl!=this.album[t].link?e.find(".cmt-lightbox__download-link").attr("href",this.album[t].originalSizeUrl).fadeIn("fast"):e.find(".cmt-lightbox__download-link").attr("href",this.album[t].originalSizeUrl).fadeOut("fast"),this.album.length>0?e.find(".cmt-lightbox__index").html(this.album[t].index):e.find(".cmt-lightbox__index").hide(),e.find(".cmt-lightbox__outer-container").removeClass("animating"),e.find(".cmt-lightbox__data-container").fadeIn(this.resizeDuration)},preloadNeighboringImages:function(){this.isLast()||this.preloadImage(this.currentImageIndex+1),this.isFirst()||this.preloadImage(this.currentImageIndex-1)},preloadImage:function(e){if(!this.album[e].preloaded){var t=new Image;this.isOldIE()?t.src=this.album[e].link:this.loadImage(t,this.album[e].link)}},enableKeyboardNav:function(){e(document).on("keyup.cmt-keyboard",e.proxy(this.keyboardAction,this)),e(document).on("keydown.cmt-keyboard",e.proxy(this.disableKeyboardScroll,this)),e(document).on("keypress.cmt-keyboard",e.proxy(this.downloadAction,this)),e(document).on("keydown.cmt-keyboard",e.proxy(this.downloadAction,this))},disableKeyboardNav:function(){e(document).off(".cmt-keyboard")},keyboardAction:function(e){var t,n,i,o,r;t=27,n=37,i=39,r=e.keyCode,o=String.fromCharCode(r).toLowerCase(),r===t||o.match(/x|o|c/)?this.end():"p"===o||r===n?this.isFirst()||this.prevImage():("n"===o||r===i)&&(this.isLast()||this.nextImage())},downloadAction:function(e){var n,i,o,r=this.$lightbox;return n=32,o=e.keyCode,i=String.fromCharCode(o).toLowerCase()," "===i||o===n?(t.open(r.find(".cmt-lightbox__download-link").attr("href")),e.preventDefault(),e.stopPropagation(),!1):!0},disableKeyboardScroll:function(e){var t,n=37,i=39;return t=e.keyCode,t===n||t===i?(e.preventDefault(),e.stopPropagation(),!1):!0},end:function(n){return void 0!=n&&n.stopPropagation(),e("body").removeClass("cmt_lightbox__no-scroll"),this.disableKeyboardNav(),this.$lightbox.off(".cmt-lightbox"),this.$lightboxOverlay.off(".cmt-lightbox"),e(t).off(".cmt-lightbox"),this.$lightbox.fadeOut(this.options.fadeDuration),this.$lightboxOverlay.fadeOut(this.options.fadeDuration),this.album=[],e("object, embed").css({visibility:"visible"})}}),e.extend(this.options,n),this.init()}}($,window),function(e,t){"function"==typeof define&&define.amd?define("bloodhound",["jquery"],function(n){return e.Bloodhound=t(n)}):"object"==typeof exports?module.exports=t(require("jquery")):e.Bloodhound=t(jQuery)}(this,function(e){var t=function(){"use strict";return{isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},isBlankString:function(e){return!e||/^\s*$/.test(e)},escapeRegExChars:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isArray:e.isArray,isFunction:e.isFunction,isObject:e.isPlainObject,isUndefined:function(e){return"undefined"==typeof e},isElement:function(e){return!(!e||1!==e.nodeType)},isJQuery:function(t){return t instanceof e},toStr:function(e){return t.isUndefined(e)||null===e?"":e+""},bind:e.proxy,each:function(t,n){function i(e,t){return n(t,e)}e.each(t,i)},map:e.map,filter:e.grep,every:function(t,n){var i=!0;return t?(e.each(t,function(e,o){return(i=n.call(null,o,e,t))?void 0:!1}),!!i):i},some:function(t,n){var i=!1;return t?(e.each(t,function(e,o){return(i=n.call(null,o,e,t))?!1:void 0}),!!i):i},mixin:e.extend,identity:function(e){return e},clone:function(t){return e.extend(!0,{},t)},getIdGenerator:function(){var e=0;return function(){return e++}},templatify:function(t){function n(){return String(t)}return e.isFunction(t)?t:n},defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var i,o;return function(){var r,a,s=this,l=arguments;return r=function(){i=null,n||(o=e.apply(s,l))},a=n&&!i,clearTimeout(i),i=setTimeout(r,t),a&&(o=e.apply(s,l)),o}},throttle:function(e,t){var n,i,o,r,a,s;return a=0,s=function(){a=new Date,o=null,r=e.apply(n,i)},function(){var l=new Date,c=t-(l-a);return n=this,i=arguments,0>=c?(clearTimeout(o),o=null,a=l,r=e.apply(n,i)):o||(o=setTimeout(s,c)),r}},stringify:function(e){return t.isString(e)?e:JSON.stringify(e)},noop:function(){}}}(),n="0.11.1",i=function(){"use strict";function e(e){return e=t.toStr(e),e?e.split(/\s+/):[]}function n(e){return e=t.toStr(e),e?e.split(/\W+/):[]}function i(e){return function(n){return n=t.isArray(n)?n:[].slice.call(arguments,0),function(i){var o=[];return t.each(n,function(n){o=o.concat(e(t.toStr(i[n])))}),o}}}return{nonword:n,whitespace:e,obj:{nonword:i(n),whitespace:i(e)}}}(),o=function(){"use strict";function n(n){this.maxSize=t.isNumber(n)?n:100,this.reset(),this.maxSize<=0&&(this.set=this.get=e.noop)}function i(){this.head=this.tail=null}function o(e,t){this.key=e,this.val=t,this.prev=this.next=null}return t.mixin(n.prototype,{set:function(e,t){var n,i=this.list.tail;this.size>=this.maxSize&&(this.list.remove(i),delete this.hash[i.key],this.size--),(n=this.hash[e])?(n.val=t,this.list.moveToFront(n)):(n=new o(e,t),this.list.add(n),this.hash[e]=n,this.size++)},get:function(e){var t=this.hash[e];return t?(this.list.moveToFront(t),t.val):void 0},reset:function(){this.size=0,this.hash={},this.list=new i}}),t.mixin(i.prototype,{add:function(e){this.head&&(e.next=this.head,this.head.prev=e),this.head=e,this.tail=this.tail||e},remove:function(e){e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev},moveToFront:function(e){this.remove(e),this.add(e)}}),n}(),r=function(){"use strict";function n(e,n){this.prefix=["__",e,"__"].join(""),this.ttlKey="__ttl__",this.keyMatcher=new RegExp("^"+t.escapeRegExChars(this.prefix)),this.ls=n||s,!this.ls&&this._noop()}function i(){return(new Date).getTime()}function o(e){return JSON.stringify(t.isUndefined(e)?null:e)}function r(t){return e.parseJSON(t)}function a(e){var t,n,i=[],o=s.length;for(t=0;o>t;t++)(n=s.key(t)).match(e)&&i.push(n.replace(e,""));return i}var s;try{s=window.localStorage,s.setItem("~~~","!"),s.removeItem("~~~")}catch(l){s=null}return t.mixin(n.prototype,{_prefix:function(e){return this.prefix+e},_ttlKey:function(e){return this._prefix(e)+this.ttlKey},_noop:function(){this.get=this.set=this.remove=this.clear=this.isExpired=t.noop},_safeSet:function(e,t){try{this.ls.setItem(e,t)}catch(n){"QuotaExceededError"===n.name&&(this.clear(),this._noop())}},get:function(e){return this.isExpired(e)&&this.remove(e),r(this.ls.getItem(this._prefix(e)))},set:function(e,n,r){return t.isNumber(r)?this._safeSet(this._ttlKey(e),o(i()+r)):this.ls.removeItem(this._ttlKey(e)),this._safeSet(this._prefix(e),o(n))},remove:function(e){return this.ls.removeItem(this._ttlKey(e)),this.ls.removeItem(this._prefix(e)),this},clear:function(){var e,t=a(this.keyMatcher);for(e=t.length;e--;)this.remove(t[e]);return this},isExpired:function(e){var n=r(this.ls.getItem(this._ttlKey(e)));return t.isNumber(n)&&i()>n?!0:!1}}),n}(),a=function(){"use strict";function n(e){e=e||{},this.cancelled=!1,this.lastReq=null,this._send=e.transport,this._get=e.limiter?e.limiter(this._get):this._get,this._cache=e.cache===!1?new o(0):s}var i=0,r={},a=6,s=new o(10);return n.setMaxPendingRequests=function(e){a=e},n.resetCache=function(){s.reset()},t.mixin(n.prototype,{_fingerprint:function(t){return t=t||{},t.url+t.type+e.param(t.data||{})},_get:function(e,t){function n(e){t(null,e),u._cache.set(l,e)}function o(){t(!0)}function s(){i--,delete r[l],u.onDeckRequestArgs&&(u._get.apply(u,u.onDeckRequestArgs),u.onDeckRequestArgs=null)}var l,c,u=this;l=this._fingerprint(e),this.cancelled||l!==this.lastReq||((c=r[l])?c.done(n).fail(o):a>i?(i++,r[l]=this._send(e).done(n).fail(o).always(s)):this.onDeckRequestArgs=[].slice.call(arguments,0))},get:function(n,i){var o,r;i=i||e.noop,n=t.isString(n)?{url:n}:n||{},r=this._fingerprint(n),this.cancelled=!1,this.lastReq=r,(o=this._cache.get(r))?i(null,o):this._get(n,i)},cancel:function(){this.cancelled=!0}}),n}(),s=window.SearchIndex=function(){"use strict";function n(n){n=n||{},n.datumTokenizer&&n.queryTokenizer||e.error("datumTokenizer and queryTokenizer are both required"),this.identify=n.identify||t.stringify,this.datumTokenizer=n.datumTokenizer,this.queryTokenizer=n.queryTokenizer,this.reset()}function i(e){return e=t.filter(e,function(e){return!!e}),e=t.map(e,function(e){return e.toLowerCase()})}function o(){var e={};return e[l]=[],e[s]={},e}function r(e){for(var t={},n=[],i=0,o=e.length;o>i;i++)t[e[i]]||(t[e[i]]=!0,n.push(e[i]));return n}function a(e,t){var n=0,i=0,o=[];e=e.sort(),t=t.sort();for(var r=e.length,a=t.length;r>n&&a>i;)e[n]<t[i]?n++:e[n]>t[i]?i++:(o.push(e[n]),n++,i++);return o}var s="c",l="i";return t.mixin(n.prototype,{bootstrap:function(e){this.datums=e.datums,this.trie=e.trie},add:function(e){var n=this;e=t.isArray(e)?e:[e],t.each(e,function(e){var r,a;n.datums[r=n.identify(e)]=e,a=i(n.datumTokenizer(e)),t.each(a,function(e){var t,i,a;for(t=n.trie,i=e.split("");a=i.shift();)t=t[s][a]||(t[s][a]=o()),t[l].push(r)})})},get:function(e){var n=this;return t.map(e,function(e){return n.datums[e]})},search:function(e){var n,o,c=this;return n=i(this.queryTokenizer(e)),t.each(n,function(e){var t,n,i,r;if(o&&0===o.length)return!1;for(t=c.trie,n=e.split("");t&&(i=n.shift());)t=t[s][i];return t&&0===n.length?(r=t[l].slice(0),void(o=o?a(o,r):r)):(o=[],!1)}),o?t.map(r(o),function(e){return c.datums[e]}):[]},all:function(){var e=[];for(var t in this.datums)e.push(this.datums[t]);return e},reset:function(){this.datums={},this.trie=o()},serialize:function(){return{datums:this.datums,trie:this.trie}}}),n}(),l=function(){"use strict";function e(e){this.url=e.url,this.ttl=e.ttl,this.cache=e.cache,this.prepare=e.prepare,this.transform=e.transform,this.transport=e.transport,this.thumbprint=e.thumbprint,this.storage=new r(e.cacheKey)}var n;return n={data:"data",protocol:"protocol",thumbprint:"thumbprint"},t.mixin(e.prototype,{_settings:function(){return{url:this.url,type:"GET",dataType:"json"}},store:function(e){this.cache&&(this.storage.set(n.data,e,this.ttl),this.storage.set(n.protocol,location.protocol,this.ttl),this.storage.set(n.thumbprint,this.thumbprint,this.ttl))},fromCache:function(){var e,t={};return this.cache?(t.data=this.storage.get(n.data),t.protocol=this.storage.get(n.protocol),t.thumbprint=this.storage.get(n.thumbprint),e=t.thumbprint!==this.thumbprint||t.protocol!==location.protocol,t.data&&!e?t.data:null):null},fromNetwork:function(e){function t(){e(!0)}function n(t){e(null,o.transform(t))}var i,o=this;e&&(i=this.prepare(this._settings()),this.transport(i).fail(t).done(n))},clear:function(){return this.storage.clear(),this}}),e}(),c=function(){"use strict";function e(e){this.url=e.url,this.prepare=e.prepare,this.transform=e.transform,this.transport=new a({cache:e.cache,limiter:e.limiter,transport:e.transport})}return t.mixin(e.prototype,{_settings:function(){return{url:this.url,type:"GET",dataType:"json"}},get:function(e,t){function n(e,n){t(e?[]:o.transform(n))}var i,o=this;if(t)return e=e||"",i=this.prepare(e,this._settings()),this.transport.get(i,n)},cancelLastRequest:function(){this.transport.cancel()}}),e}(),u=function(){"use strict";function i(i){var o;return i?(o={url:null,ttl:864e5,cache:!0,cacheKey:null,thumbprint:"",prepare:t.identity,transform:t.identity,transport:null},i=t.isString(i)?{url:i}:i,i=t.mixin(o,i),!i.url&&e.error("prefetch requires url to be set"),i.transform=i.filter||i.transform,i.cacheKey=i.cacheKey||i.url,i.thumbprint=n+i.thumbprint,i.transport=i.transport?s(i.transport):e.ajax,i):null}function o(n){var i;if(n)return i={url:null,cache:!0,prepare:null,replace:null,wildcard:null,limiter:null,rateLimitBy:"debounce",rateLimitWait:300,transform:t.identity,transport:null},n=t.isString(n)?{url:n}:n,n=t.mixin(i,n),!n.url&&e.error("remote requires url to be set"),n.transform=n.filter||n.transform,n.prepare=r(n),n.limiter=a(n),n.transport=n.transport?s(n.transport):e.ajax,delete n.replace,delete n.wildcard,delete n.rateLimitBy,delete n.rateLimitWait,n}function r(e){function t(e,t){return t.url=r(t.url,e),t}function n(e,t){return t.url=t.url.replace(a,encodeURIComponent(e)),t}function i(e,t){return t}var o,r,a;return o=e.prepare,r=e.replace,a=e.wildcard,o?o:o=r?t:e.wildcard?n:i}function a(e){function n(e){return function(n){return t.debounce(n,e)}}function i(e){return function(n){return t.throttle(n,e)}}var o,r,a;return o=e.limiter,r=e.rateLimitBy,a=e.rateLimitWait,o||(o=/^throttle$/i.test(r)?i(a):n(a)),o}function s(n){return function(i){function o(e){t.defer(function(){a.resolve(e)})}function r(e){t.defer(function(){a.reject(e)})}var a=e.Deferred();return n(i,o,r),a}}return function(n){var r,a;return r={initialize:!0,identify:t.stringify,datumTokenizer:null,queryTokenizer:null,sufficient:5,sorter:null,local:[],prefetch:null,remote:null},n=t.mixin(r,n||{}),!n.datumTokenizer&&e.error("datumTokenizer is required"),!n.queryTokenizer&&e.error("queryTokenizer is required"),a=n.sorter,n.sorter=a?function(e){return e.sort(a)}:t.identity,n.local=t.isFunction(n.local)?n.local():n.local,n.prefetch=i(n.prefetch),n.remote=o(n.remote),n}}(),d=function(){"use strict";function n(e){e=u(e),this.sorter=e.sorter,this.identify=e.identify,this.sufficient=e.sufficient,this.local=e.local,this.remote=e.remote?new c(e.remote):null,this.prefetch=e.prefetch?new l(e.prefetch):null,this.index=new s({identify:this.identify,datumTokenizer:e.datumTokenizer,queryTokenizer:e.queryTokenizer}),e.initialize!==!1&&this.initialize()}var o;return o=window&&window.Bloodhound,n.noConflict=function(){return window&&(window.Bloodhound=o),n},n.tokenizers=i,t.mixin(n.prototype,{__ttAdapter:function(){function e(e,t,i){return n.search(e,t,i)}function t(e,t){return n.search(e,t)}var n=this;return this.remote?e:t},_loadPrefetch:function(){function t(e,t){return e?n.reject():(o.add(t),o.prefetch.store(o.index.serialize()),void n.resolve())}var n,i,o=this;return n=e.Deferred(),this.prefetch?(i=this.prefetch.fromCache())?(this.index.bootstrap(i),n.resolve()):this.prefetch.fromNetwork(t):n.resolve(),n.promise()},_initialize:function(){function e(){t.add(t.local)}var t=this;return this.clear(),(this.initPromise=this._loadPrefetch()).done(e),this.initPromise},initialize:function(e){return!this.initPromise||e?this._initialize():this.initPromise},add:function(e){return this.index.add(e),this},get:function(e){return e=t.isArray(e)?e:[].slice.call(arguments),this.index.get(e)},search:function(e,n,i){function o(e){var n=[];t.each(e,function(e){!t.some(r,function(t){return a.identify(e)===a.identify(t)})&&n.push(e)}),i&&i(n)}var r,a=this;return r=this.sorter(this.index.search(e)),n(this.remote?r.slice():r),this.remote&&r.length<this.sufficient?this.remote.get(e,o):this.remote&&this.remote.cancelLastRequest(),this},all:function(){return this.index.all()},clear:function(){return this.index.reset(),this},clearPrefetchCache:function(){return this.prefetch&&this.prefetch.clear(),this},clearRemoteCache:function(){return a.resetCache(),this},ttAdapter:function(){return this.__ttAdapter()}}),n}();return d}),function(e,t){"function"==typeof define&&define.amd?define("typeahead.js",["jquery"],function(e){return t(e)}):"object"==typeof exports?module.exports=t(require("jquery")):t(jQuery)}(this,function(e){var t=function(){"use strict";return{isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},isBlankString:function(e){return!e||/^\s*$/.test(e)},escapeRegExChars:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isArray:e.isArray,isFunction:e.isFunction,isObject:e.isPlainObject,isUndefined:function(e){return"undefined"==typeof e},isElement:function(e){return!(!e||1!==e.nodeType)},isJQuery:function(t){return t instanceof e},toStr:function(e){return t.isUndefined(e)||null===e?"":e+""},bind:e.proxy,each:function(t,n){function i(e,t){return n(t,e)}e.each(t,i)},map:e.map,filter:e.grep,every:function(t,n){var i=!0;return t?(e.each(t,function(e,o){return(i=n.call(null,o,e,t))?void 0:!1}),!!i):i},some:function(t,n){var i=!1;return t?(e.each(t,function(e,o){return(i=n.call(null,o,e,t))?!1:void 0}),!!i):i},mixin:e.extend,identity:function(e){return e},clone:function(t){return e.extend(!0,{},t)},getIdGenerator:function(){var e=0;return function(){return e++}},templatify:function(t){function n(){return String(t)}return e.isFunction(t)?t:n},defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var i,o;return function(){var r,a,s=this,l=arguments;return r=function(){i=null,n||(o=e.apply(s,l))},a=n&&!i,clearTimeout(i),i=setTimeout(r,t),a&&(o=e.apply(s,l)),o}},throttle:function(e,t){var n,i,o,r,a,s;return a=0,s=function(){a=new Date,o=null,r=e.apply(n,i)},function(){var l=new Date,c=t-(l-a);return n=this,i=arguments,0>=c?(clearTimeout(o),o=null,a=l,r=e.apply(n,i)):o||(o=setTimeout(s,c)),r}},stringify:function(e){return t.isString(e)?e:JSON.stringify(e)},noop:function(){}}}(),n=function(){"use strict";function e(e){var a,s;return s=t.mixin({},r,e),a={css:o(),classes:s,html:n(s),selectors:i(s)},{css:a.css,html:a.html,classes:a.classes,selectors:a.selectors,mixin:function(e){t.mixin(e,a)}}}function n(e){return{wrapper:'<span class="'+e.wrapper+'"></span>',menu:'<div class="'+e.menu+'"></div>'}}function i(e){var n={};return t.each(e,function(e,t){n[t]="."+e}),n}function o(){var e={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none",opacity:"1"},input:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},inputWithNoHint:{position:"relative",verticalAlign:"top"},menu:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"},ltr:{left:"0",right:"auto"},rtl:{left:"auto",right:" 0"}};return t.isMsie()&&t.mixin(e.input,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"}),e}var r={wrapper:"twitter-typeahead",input:"tt-input",hint:"tt-hint",menu:"tt-menu",dataset:"tt-dataset",suggestion:"tt-suggestion",selectable:"tt-selectable",empty:"tt-empty",open:"tt-open",cursor:"tt-cursor",highlight:"tt-highlight"};return e}(),i=function(){"use strict";function n(t){t&&t.el||e.error("EventBus initialized without el"),this.$el=e(t.el)}var i,o;return i="typeahead:",o={render:"rendered",cursorchange:"cursorchanged",select:"selected",autocomplete:"autocompleted"},t.mixin(n.prototype,{_trigger:function(t,n){var o;return o=e.Event(i+t),(n=n||[]).unshift(o),this.$el.trigger.apply(this.$el,n),o},before:function(e){var t,n;return t=[].slice.call(arguments,1),n=this._trigger("before"+e,t),n.isDefaultPrevented()},trigger:function(e){var t;this._trigger(e,[].slice.call(arguments,1)),(t=o[e])&&this._trigger(t,[].slice.call(arguments,1))}}),n}(),o=function(){"use strict";function e(e,t,n,i){var o;if(!n)return this;for(t=t.split(l),n=i?s(n,i):n,this._callbacks=this._callbacks||{};o=t.shift();)this._callbacks[o]=this._callbacks[o]||{sync:[],async:[]},this._callbacks[o][e].push(n);return this}function t(t,n,i){return e.call(this,"async",t,n,i)}function n(t,n,i){return e.call(this,"sync",t,n,i)}function i(e){var t;if(!this._callbacks)return this;for(e=e.split(l);t=e.shift();)delete this._callbacks[t];return this}function o(e){var t,n,i,o,a;if(!this._callbacks)return this;for(e=e.split(l),i=[].slice.call(arguments,1);(t=e.shift())&&(n=this._callbacks[t]);)o=r(n.sync,this,[t].concat(i)),a=r(n.async,this,[t].concat(i)),o()&&c(a);return this}function r(e,t,n){function i(){for(var i,o=0,r=e.length;!i&&r>o;o+=1)i=e[o].apply(t,n)===!1;return!i}return i}function a(){var e;return e=window.setImmediate?function(e){setImmediate(function(){e()})}:function(e){setTimeout(function(){e()},0)}}function s(e,t){return e.bind?e.bind(t):function(){e.apply(t,[].slice.call(arguments,0))}}var l=/\s+/,c=a();return{onSync:n,onAsync:t,off:i,trigger:o}}(),r=function(e){"use strict";function n(e,n,i){for(var o,r=[],a=0,s=e.length;s>a;a++)r.push(t.escapeRegExChars(e[a]));return o=i?"\\b("+r.join("|")+")\\b":"("+r.join("|")+")",n?new RegExp(o):new RegExp(o,"i")}var i={node:null,pattern:null,tagName:"strong",className:null,wordsOnly:!1,caseSensitive:!1};return function(o){function r(t){var n,i,r;return(n=s.exec(t.data))&&(r=e.createElement(o.tagName),o.className&&(r.className=o.className),i=t.splitText(n.index),i.splitText(n[0].length),r.appendChild(i.cloneNode(!0)),t.parentNode.replaceChild(r,i)),!!n}function a(e,t){for(var n,i=3,o=0;o<e.childNodes.length;o++)n=e.childNodes[o],n.nodeType===i?o+=t(n)?1:0:a(n,t)}var s;o=t.mixin({},i,o),o.node&&o.pattern&&(o.pattern=t.isArray(o.pattern)?o.pattern:[o.pattern],s=n(o.pattern,o.caseSensitive,o.wordsOnly),a(o.node,r))}}(window.document),a=function(){"use strict";function n(n,o){n=n||{},n.input||e.error("input is missing"),o.mixin(this),this.$hint=e(n.hint),this.$input=e(n.input),this.query=this.$input.val(),this.queryWhenFocused=this.hasFocus()?this.query:null,this.$overflowHelper=i(this.$input),this._checkLanguageDirection(),0===this.$hint.length&&(this.setHint=this.getHint=this.clearHint=this.clearHintIfInvalid=t.noop)}function i(t){return e('<pre aria-hidden="true"></pre>').css({position:"absolute",visibility:"hidden",whiteSpace:"pre",fontFamily:t.css("font-family"),fontSize:t.css("font-size"),fontStyle:t.css("font-style"),fontVariant:t.css("font-variant"),fontWeight:t.css("font-weight"),wordSpacing:t.css("word-spacing"),letterSpacing:t.css("letter-spacing"),textIndent:t.css("text-indent"),textRendering:t.css("text-rendering"),textTransform:t.css("text-transform")}).insertAfter(t)}function r(e,t){return n.normalizeQuery(e)===n.normalizeQuery(t)}function a(e){return e.altKey||e.ctrlKey||e.metaKey||e.shiftKey}var s;return s={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"},n.normalizeQuery=function(e){return t.toStr(e).replace(/^\s*/g,"").replace(/\s{2,}/g," ")},t.mixin(n.prototype,o,{_onBlur:function(){this.resetInputValue(),this.trigger("blurred")},_onFocus:function(){this.queryWhenFocused=this.query,this.trigger("focused")},_onKeydown:function(e){var t=s[e.which||e.keyCode];this._managePreventDefault(t,e),t&&this._shouldTrigger(t,e)&&this.trigger(t+"Keyed",e)},_onInput:function(){this._setQuery(this.getInputValue()),this.clearHintIfInvalid(),this._checkLanguageDirection()},_managePreventDefault:function(e,t){var n;switch(e){case"up":case"down":n=!a(t);break;default:n=!1}n&&t.preventDefault()},_shouldTrigger:function(e,t){var n;switch(e){case"tab":n=!a(t);break;default:n=!0}return n},_checkLanguageDirection:function(){var e=(this.$input.css("direction")||"ltr").toLowerCase();this.dir!==e&&(this.dir=e,this.$hint.attr("dir",e),this.trigger("langDirChanged",e))},_setQuery:function(e,t){var n,i;n=r(e,this.query),i=n?this.query.length!==e.length:!1,this.query=e,t||n?!t&&i&&this.trigger("whitespaceChanged",this.query):this.trigger("queryChanged",this.query)},bind:function(){var e,n,i,o,r=this;return e=t.bind(this._onBlur,this),n=t.bind(this._onFocus,this),i=t.bind(this._onKeydown,this),o=t.bind(this._onInput,this),
this.$input.on("blur.tt",e).on("focus.tt",n).on("keydown.tt",i),!t.isMsie()||t.isMsie()>9?this.$input.on("input.tt",o):this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function(e){s[e.which||e.keyCode]||t.defer(t.bind(r._onInput,r,e))}),this},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getLangDir:function(){return this.dir},getQuery:function(){return this.query||""},setQuery:function(e,t){this.setInputValue(e),this._setQuery(e,t)},hasQueryChangedSinceLastFocus:function(){return this.query!==this.queryWhenFocused},getInputValue:function(){return this.$input.val()},setInputValue:function(e){this.$input.val(e),this.clearHintIfInvalid(),this._checkLanguageDirection()},resetInputValue:function(){this.setInputValue(this.query)},getHint:function(){return this.$hint.val()},setHint:function(e){this.$hint.val(e)},clearHint:function(){this.setHint("")},clearHintIfInvalid:function(){var e,t,n,i;e=this.getInputValue(),t=this.getHint(),n=e!==t&&0===t.indexOf(e),i=""!==e&&n&&!this.hasOverflow(),!i&&this.clearHint()},hasFocus:function(){return this.$input.is(":focus")},hasOverflow:function(){var e=this.$input.width()-2;return this.$overflowHelper.text(this.getInputValue()),this.$overflowHelper.width()>=e},isCursorAtEnd:function(){var e,n,i;return e=this.$input.val().length,n=this.$input[0].selectionStart,t.isNumber(n)?n===e:document.selection?(i=document.selection.createRange(),i.moveStart("character",-e),e===i.text.length):!0},destroy:function(){this.$hint.off(".tt"),this.$input.off(".tt"),this.$overflowHelper.remove(),this.$hint=this.$input=this.$overflowHelper=e("<div>")}}),n}(),s=function(){"use strict";function n(n,o){n=n||{},n.templates=n.templates||{},n.templates.notFound=n.templates.notFound||n.templates.empty,n.source||e.error("missing source"),n.node||e.error("missing node"),n.name&&!s(n.name)&&e.error("invalid dataset name: "+n.name),o.mixin(this),this.highlight=!!n.highlight,this.name=n.name||c(),this.limit=n.limit||5,this.displayFn=i(n.display||n.displayKey),this.templates=a(n.templates,this.displayFn),this.source=n.source.__ttAdapter?n.source.__ttAdapter():n.source,this.async=t.isUndefined(n.async)?this.source.length>2:!!n.async,this._resetLastSuggestion(),this.$el=e(n.node).addClass(this.classes.dataset).addClass(this.classes.dataset+"-"+this.name)}function i(e){function n(t){return t[e]}return e=e||t.stringify,t.isFunction(e)?e:n}function a(n,i){function o(t){return e("<div>").text(i(t))}return{notFound:n.notFound&&t.templatify(n.notFound),pending:n.pending&&t.templatify(n.pending),header:n.header&&t.templatify(n.header),footer:n.footer&&t.templatify(n.footer),suggestion:n.suggestion||o}}function s(e){return/^[_a-zA-Z0-9-]+$/.test(e)}var l,c;return l={val:"tt-selectable-display",obj:"tt-selectable-object"},c=t.getIdGenerator(),n.extractData=function(t){var n=e(t);return n.data(l.obj)?{val:n.data(l.val)||"",obj:n.data(l.obj)||null}:null},t.mixin(n.prototype,o,{_overwrite:function(e,t){t=t||[],t.length?this._renderSuggestions(e,t):this.async&&this.templates.pending?this._renderPending(e):!this.async&&this.templates.notFound?this._renderNotFound(e):this._empty(),this.trigger("rendered",this.name,t,!1)},_append:function(e,t){t=t||[],t.length&&this.$lastSuggestion.length?this._appendSuggestions(e,t):t.length?this._renderSuggestions(e,t):!this.$lastSuggestion.length&&this.templates.notFound&&this._renderNotFound(e),this.trigger("rendered",this.name,t,!0)},_renderSuggestions:function(e,t){var n;n=this._getSuggestionsFragment(e,t),this.$lastSuggestion=n.children().last(),this.$el.html(n).prepend(this._getHeader(e,t)).append(this._getFooter(e,t))},_appendSuggestions:function(e,t){var n,i;n=this._getSuggestionsFragment(e,t),i=n.children().last(),this.$lastSuggestion.after(n),this.$lastSuggestion=i},_renderPending:function(e){var t=this.templates.pending;this._resetLastSuggestion(),t&&this.$el.html(t({query:e,dataset:this.name}))},_renderNotFound:function(e){var t=this.templates.notFound;this._resetLastSuggestion(),t&&this.$el.html(t({query:e,dataset:this.name}))},_empty:function(){this.$el.empty(),this._resetLastSuggestion()},_getSuggestionsFragment:function(n,i){var o,a=this;return o=document.createDocumentFragment(),t.each(i,function(t){var i,r;r=a._injectQuery(n,t),i=e(a.templates.suggestion(r)).data(l.obj,t).data(l.val,a.displayFn(t)).addClass(a.classes.suggestion+" "+a.classes.selectable),o.appendChild(i[0])}),this.highlight&&r({className:this.classes.highlight,node:o,pattern:n}),e(o)},_getFooter:function(e,t){return this.templates.footer?this.templates.footer({query:e,suggestions:t,dataset:this.name}):null},_getHeader:function(e,t){return this.templates.header?this.templates.header({query:e,suggestions:t,dataset:this.name}):null},_resetLastSuggestion:function(){this.$lastSuggestion=e()},_injectQuery:function(e,n){return t.isObject(n)?t.mixin({_query:e},n):n},update:function(t){function n(e){a||(a=!0,e=(e||[]).slice(0,o.limit),s=e.length,o._overwrite(t,e),s<o.limit&&o.async&&o.trigger("asyncRequested",t))}function i(n){n=n||[],!r&&s<o.limit&&(o.cancel=e.noop,s+=n.length,o._append(t,n.slice(0,o.limit-s)),o.async&&o.trigger("asyncReceived",t))}var o=this,r=!1,a=!1,s=0;this.cancel(),this.cancel=function(){r=!0,o.cancel=e.noop,o.async&&o.trigger("asyncCanceled",t)},this.source(t,n,i),!a&&n([])},cancel:e.noop,clear:function(){this._empty(),this.cancel(),this.trigger("cleared")},isEmpty:function(){return this.$el.is(":empty")},destroy:function(){this.$el=e("<div>")}}),n}(),l=function(){"use strict";function n(n,i){function o(t){var n=r.$node.find(t.node).first();return t.node=n.length?n:e("<div>").appendTo(r.$node),new s(t,i)}var r=this;n=n||{},n.node||e.error("node is required"),i.mixin(this),this.$node=e(n.node),this.query=null,this.datasets=t.map(n.datasets,o)}return t.mixin(n.prototype,o,{_onSelectableClick:function(t){this.trigger("selectableClicked",e(t.currentTarget))},_onRendered:function(e,t,n,i){this.$node.toggleClass(this.classes.empty,this._allDatasetsEmpty()),this.trigger("datasetRendered",t,n,i)},_onCleared:function(){this.$node.toggleClass(this.classes.empty,this._allDatasetsEmpty()),this.trigger("datasetCleared")},_propagate:function(){this.trigger.apply(this,arguments)},_allDatasetsEmpty:function(){function e(e){return e.isEmpty()}return t.every(this.datasets,e)},_getSelectables:function(){return this.$node.find(this.selectors.selectable)},_removeCursor:function(){var e=this.getActiveSelectable();e&&e.removeClass(this.classes.cursor)},_ensureVisible:function(e){var t,n,i,o;t=e.position().top,n=t+e.outerHeight(!0),i=this.$node.scrollTop(),o=this.$node.height()+parseInt(this.$node.css("paddingTop"),10)+parseInt(this.$node.css("paddingBottom"),10),0>t?this.$node.scrollTop(i+t):n>o&&this.$node.scrollTop(i+(n-o))},bind:function(){var e,n=this;return e=t.bind(this._onSelectableClick,this),this.$node.on("click.tt",this.selectors.selectable,e),t.each(this.datasets,function(e){e.onSync("asyncRequested",n._propagate,n).onSync("asyncCanceled",n._propagate,n).onSync("asyncReceived",n._propagate,n).onSync("rendered",n._onRendered,n).onSync("cleared",n._onCleared,n)}),this},isOpen:function(){return this.$node.hasClass(this.classes.open)},open:function(){this.$node.addClass(this.classes.open)},close:function(){this.$node.removeClass(this.classes.open),this._removeCursor()},setLanguageDirection:function(e){this.$node.attr("dir",e)},selectableRelativeToCursor:function(e){var t,n,i,o;return n=this.getActiveSelectable(),t=this._getSelectables(),i=n?t.index(n):-1,o=i+e,o=(o+1)%(t.length+1)-1,o=-1>o?t.length-1:o,-1===o?null:t.eq(o)},setCursor:function(e){this._removeCursor(),(e=e&&e.first())&&(e.addClass(this.classes.cursor),this._ensureVisible(e))},getSelectableData:function(e){return e&&e.length?s.extractData(e):null},getActiveSelectable:function(){var e=this._getSelectables().filter(this.selectors.cursor).first();return e.length?e:null},getTopSelectable:function(){var e=this._getSelectables().first();return e.length?e:null},update:function(e){function n(t){t.update(e)}var i=e!==this.query;return i&&(this.query=e,t.each(this.datasets,n)),i},empty:function(){function e(e){e.clear()}t.each(this.datasets,e),this.query=null,this.$node.addClass(this.classes.empty)},destroy:function(){function n(e){e.destroy()}this.$node.off(".tt"),this.$node=e("<div>"),t.each(this.datasets,n)}}),n}(),c=function(){"use strict";function e(){l.apply(this,[].slice.call(arguments,0))}var n=l.prototype;return t.mixin(e.prototype,l.prototype,{open:function(){return!this._allDatasetsEmpty()&&this._show(),n.open.apply(this,[].slice.call(arguments,0))},close:function(){return this._hide(),n.close.apply(this,[].slice.call(arguments,0))},_onRendered:function(){return this._allDatasetsEmpty()?this._hide():this.isOpen()&&this._show(),n._onRendered.apply(this,[].slice.call(arguments,0))},_onCleared:function(){return this._allDatasetsEmpty()?this._hide():this.isOpen()&&this._show(),n._onCleared.apply(this,[].slice.call(arguments,0))},setLanguageDirection:function(e){return this.$node.css("ltr"===e?this.css.ltr:this.css.rtl),n.setLanguageDirection.apply(this,[].slice.call(arguments,0))},_hide:function(){this.$node.hide()},_show:function(){this.$node.css("display","block")}}),e}(),u=function(){"use strict";function n(n,o){var r,a,s,l,c,u,d,m,h,f,p;n=n||{},n.input||e.error("missing input"),n.menu||e.error("missing menu"),n.eventBus||e.error("missing event bus"),o.mixin(this),this.eventBus=n.eventBus,this.minLength=t.isNumber(n.minLength)?n.minLength:1,this.input=n.input,this.menu=n.menu,this.enabled=!0,this.active=!1,this.input.hasFocus()&&this.activate(),this.dir=this.input.getLangDir(),this._hacks(),this.menu.bind().onSync("selectableClicked",this._onSelectableClicked,this).onSync("asyncRequested",this._onAsyncRequested,this).onSync("asyncCanceled",this._onAsyncCanceled,this).onSync("asyncReceived",this._onAsyncReceived,this).onSync("datasetRendered",this._onDatasetRendered,this).onSync("datasetCleared",this._onDatasetCleared,this),r=i(this,"activate","open","_onFocused"),a=i(this,"deactivate","_onBlurred"),s=i(this,"isActive","isOpen","_onEnterKeyed"),l=i(this,"isActive","isOpen","_onTabKeyed"),c=i(this,"isActive","_onEscKeyed"),u=i(this,"isActive","open","_onUpKeyed"),d=i(this,"isActive","open","_onDownKeyed"),m=i(this,"isActive","isOpen","_onLeftKeyed"),h=i(this,"isActive","isOpen","_onRightKeyed"),f=i(this,"_openIfActive","_onQueryChanged"),p=i(this,"_openIfActive","_onWhitespaceChanged"),this.input.bind().onSync("focused",r,this).onSync("blurred",a,this).onSync("enterKeyed",s,this).onSync("tabKeyed",l,this).onSync("escKeyed",c,this).onSync("upKeyed",u,this).onSync("downKeyed",d,this).onSync("leftKeyed",m,this).onSync("rightKeyed",h,this).onSync("queryChanged",f,this).onSync("whitespaceChanged",p,this).onSync("langDirChanged",this._onLangDirChanged,this)}function i(e){var n=[].slice.call(arguments,1);return function(){var i=[].slice.call(arguments);t.each(n,function(t){return e[t].apply(e,i)})}}return t.mixin(n.prototype,{_hacks:function(){var n,i;n=this.input.$input||e("<div>"),i=this.menu.$node||e("<div>"),n.on("blur.tt",function(e){var o,r,a;o=document.activeElement,r=i.is(o),a=i.has(o).length>0,t.isMsie()&&(r||a)&&(e.preventDefault(),e.stopImmediatePropagation(),t.defer(function(){n.focus()}))}),i.on("mousedown.tt",function(e){e.preventDefault()})},_onSelectableClicked:function(e,t){this.select(t)},_onDatasetCleared:function(){this._updateHint()},_onDatasetRendered:function(e,t,n,i){this._updateHint(),this.eventBus.trigger("render",n,i,t)},_onAsyncRequested:function(e,t,n){this.eventBus.trigger("asyncrequest",n,t)},_onAsyncCanceled:function(e,t,n){this.eventBus.trigger("asynccancel",n,t)},_onAsyncReceived:function(e,t,n){this.eventBus.trigger("asyncreceive",n,t)},_onFocused:function(){this._minLengthMet()&&this.menu.update(this.input.getQuery())},_onBlurred:function(){this.input.hasQueryChangedSinceLastFocus()&&this.eventBus.trigger("change",this.input.getQuery())},_onEnterKeyed:function(e,t){var n;(n=this.menu.getActiveSelectable())&&this.select(n)&&t.preventDefault()},_onTabKeyed:function(e,t){var n;(n=this.menu.getActiveSelectable())?this.select(n)&&t.preventDefault():(n=this.menu.getTopSelectable())&&this.autocomplete(n)&&t.preventDefault()},_onEscKeyed:function(){this.close()},_onUpKeyed:function(){this.moveCursor(-1)},_onDownKeyed:function(){this.moveCursor(1)},_onLeftKeyed:function(){"rtl"===this.dir&&this.input.isCursorAtEnd()&&this.autocomplete(this.menu.getTopSelectable())},_onRightKeyed:function(){"ltr"===this.dir&&this.input.isCursorAtEnd()&&this.autocomplete(this.menu.getTopSelectable())},_onQueryChanged:function(e,t){this._minLengthMet(t)?this.menu.update(t):this.menu.empty()},_onWhitespaceChanged:function(){this._updateHint()},_onLangDirChanged:function(e,t){this.dir!==t&&(this.dir=t,this.menu.setLanguageDirection(t))},_openIfActive:function(){this.isActive()&&this.open()},_minLengthMet:function(e){return e=t.isString(e)?e:this.input.getQuery()||"",e.length>=this.minLength},_updateHint:function(){var e,n,i,o,r,s,l;e=this.menu.getTopSelectable(),n=this.menu.getSelectableData(e),i=this.input.getInputValue(),!n||t.isBlankString(i)||this.input.hasOverflow()?this.input.clearHint():(o=a.normalizeQuery(i),r=t.escapeRegExChars(o),s=new RegExp("^(?:"+r+")(.+$)","i"),l=s.exec(n.val),l&&this.input.setHint(i+l[1]))},isEnabled:function(){return this.enabled},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},isActive:function(){return this.active},activate:function(){return this.isActive()?!0:!this.isEnabled()||this.eventBus.before("active")?!1:(this.active=!0,this.eventBus.trigger("active"),!0)},deactivate:function(){return this.isActive()?this.eventBus.before("idle")?!1:(this.active=!1,this.close(),this.eventBus.trigger("idle"),!0):!0},isOpen:function(){return this.menu.isOpen()},open:function(){return this.isOpen()||this.eventBus.before("open")||(this.menu.open(),this._updateHint(),this.eventBus.trigger("open")),this.isOpen()},close:function(){return this.isOpen()&&!this.eventBus.before("close")&&(this.menu.close(),this.input.clearHint(),this.input.resetInputValue(),this.eventBus.trigger("close")),!this.isOpen()},setVal:function(e){this.input.setQuery(t.toStr(e))},getVal:function(){return this.input.getQuery()},select:function(e){var t=this.menu.getSelectableData(e);return t&&!this.eventBus.before("select",t.obj)?(this.input.setQuery(t.val,!0),this.eventBus.trigger("select",t.obj),this.close(),!0):!1},autocomplete:function(e){var t,n,i;return t=this.input.getQuery(),n=this.menu.getSelectableData(e),i=n&&t!==n.val,i&&!this.eventBus.before("autocomplete",n.obj)?(this.input.setQuery(n.val),this.eventBus.trigger("autocomplete",n.obj),!0):!1},moveCursor:function(e){var t,n,i,o,r;return t=this.input.getQuery(),n=this.menu.selectableRelativeToCursor(e),i=this.menu.getSelectableData(n),o=i?i.obj:null,r=this._minLengthMet()&&this.menu.update(t),r||this.eventBus.before("cursorchange",o)?!1:(this.menu.setCursor(n),i?this.input.setInputValue(i.val):(this.input.resetInputValue(),this._updateHint()),this.eventBus.trigger("cursorchange",o),!0)},destroy:function(){this.input.destroy(),this.menu.destroy()}}),n}();!function(){"use strict";function o(t,n){t.each(function(){var t,i=e(this);(t=i.data(p.typeahead))&&n(t,i)})}function r(e,t){return e.clone().addClass(t.classes.hint).removeData().css(t.css.hint).css(d(e)).prop("readonly",!0).removeAttr("id name placeholder required").attr({autocomplete:"off",spellcheck:"false",tabindex:-1})}function s(e,t){e.data(p.attrs,{dir:e.attr("dir"),autocomplete:e.attr("autocomplete"),spellcheck:e.attr("spellcheck"),style:e.attr("style")}),e.addClass(t.classes.input).attr({autocomplete:"off",spellcheck:!1});try{!e.attr("dir")&&e.attr("dir","auto")}catch(n){}return e}function d(e){return{backgroundAttachment:e.css("background-attachment"),backgroundClip:e.css("background-clip"),backgroundColor:e.css("background-color"),backgroundImage:e.css("background-image"),backgroundOrigin:e.css("background-origin"),backgroundPosition:e.css("background-position"),backgroundRepeat:e.css("background-repeat"),backgroundSize:e.css("background-size")}}function m(e){var n,i;n=e.data(p.www),i=e.parent().filter(n.selectors.wrapper),t.each(e.data(p.attrs),function(n,i){t.isUndefined(n)?e.removeAttr(i):e.attr(i,n)}),e.removeData(p.typeahead).removeData(p.www).removeData(p.attr).removeClass(n.classes.input),i.length&&(e.detach().insertAfter(i),i.remove())}function h(n){var i,o;return i=t.isJQuery(n)||t.isElement(n),o=i?e(n).first():[],o.length?o:null}var f,p,g;f=e.fn.typeahead,p={www:"tt-www",attrs:"tt-attrs",typeahead:"tt-typeahead"},g={initialize:function(o,d){function m(){var n,m,g,v,b,y,C,k,x,w,_;t.each(d,function(e){e.highlight=!!o.highlight}),n=e(this),m=e(f.html.wrapper),g=h(o.hint),v=h(o.menu),b=o.hint!==!1&&!g,y=o.menu!==!1&&!v,b&&(g=r(n,f)),y&&(v=e(f.html.menu).css(f.css.menu)),g&&g.val(""),n=s(n,f),(b||y)&&(m.css(f.css.wrapper),n.css(b?f.css.input:f.css.inputWithNoHint),n.wrap(m).parent().prepend(b?g:null).append(y?v:null)),_=y?c:l,C=new i({el:n}),k=new a({hint:g,input:n},f),x=new _({node:v,datasets:d},f),w=new u({input:k,menu:x,eventBus:C,minLength:o.minLength},f),n.data(p.www,f),n.data(p.typeahead,w)}var f;return d=t.isArray(d)?d:[].slice.call(arguments,1),o=o||{},f=n(o.classNames),this.each(m)},isEnabled:function(){var e;return o(this.first(),function(t){e=t.isEnabled()}),e},enable:function(){return o(this,function(e){e.enable()}),this},disable:function(){return o(this,function(e){e.disable()}),this},isActive:function(){var e;return o(this.first(),function(t){e=t.isActive()}),e},activate:function(){return o(this,function(e){e.activate()}),this},deactivate:function(){return o(this,function(e){e.deactivate()}),this},isOpen:function(){var e;return o(this.first(),function(t){e=t.isOpen()}),e},open:function(){return o(this,function(e){e.open()}),this},close:function(){return o(this,function(e){e.close()}),this},select:function(t){var n=!1,i=e(t);return o(this.first(),function(e){n=e.select(i)}),n},autocomplete:function(t){var n=!1,i=e(t);return o(this.first(),function(e){n=e.autocomplete(i)}),n},moveCursor:function(e){var t=!1;return o(this.first(),function(n){t=n.moveCursor(e)}),t},val:function(e){var t;return arguments.length?(o(this,function(t){t.setVal(e)}),this):(o(this.first(),function(e){t=e.getVal()}),t)},destroy:function(){return o(this,function(e,t){m(t),e.destroy()}),this}},e.fn.typeahead=function(e){return g[e]?g[e].apply(this,[].slice.call(arguments,1)):g.initialize.apply(this,arguments)},e.fn.typeahead.noConflict=function(){return e.fn.typeahead=f,this}}()});var define=null,require=null;!function(){var e={};define=function(t,n,i){e[t]={dependencies:n,factory:i}},require=function(t){if(!e.hasOwnProperty(t))return null;if("undefined"==typeof e[t].module){var n={},i=function(t){n[t]=!0;for(var o=0;o<e[t].dependencies.length;o++){var r=e[t].dependencies[o];if(n.hasOwnProperty(r))throw Error("Dependency cycle detected in module "+t+" on "+r);if(!e.hasOwnProperty(r))throw new Error("Unknown dependency "+r+" in module "+t);i(r),delete n[r]}};i(t);var o=e[t].factory;if("function"==typeof o){for(var r=[],a=0;a<e[t].dependencies.length;a++){var s=require(e[t].dependencies[a]);r.push(s)}e[t].module=o.apply(null,r)}else e[t].module=o}return e[t].module}}(),define("restoreComment",["jquery","core","console","events"],function(e,t,n,i){function o(i){if(i.preventDefault(),i.stopPropagation(),confirm("Восстановить комментарий?")){var o=e(i.target).attr("data-comment-id");t.jsonRequest({url:t.getRightUrl("/ajax/comment/restore/"),method:"POST",data:{commentId:o},successCallback:r,failureCallback:a,progressElement:e(i.target),logFunc:n.log,param:o})}}function r(e,t,n,o){i.fire("CommentRestore",o)}function a(e){alert(e)}var s={},l=".action-restore";return s.init=function(e){e.off("click",l,o).on("click",l,o).find(l).show()},s}),define("reasons",["jquery","core","console","events","modalForms","handlebars","config"],function(e,t,n,i,o,r,a){function s(){return x(e("#DeleteReasons"),{}).split("\n")}function l(i,r){a.threadId?(_=a.threadId,r(s()),o.centerModalForm()):t.jsonRequest({url:t.getRightUrl("/ajax/moderator/deleted-cause"),method:"GET",data:{commentId:i},successCallback:function(t){_=t.threadId,t.reasons?(e(".delete-cause-block").removeClass("hidden"),r(t.reasons)):e(".delete-cause-block").addClass("hidden"),o.centerModalForm()},failureCallback:k,progressElement:"#deleteCausesReasons",logFunc:n.log})}function c(e){return setTimeout(function(){l(e,function(e){u(e,"#DeleteReasonTemplate")})},0),S}function u(t,n){var i,o,r=[],a=t.length;for(i=0;a>i;i++)o=e.trim(t[i]),o&&r.push(x(e(n),{reason:o}));var s=x(e("#DeleteCause"),{reasons:r.join("")});e("#deleteCausesReasons").replaceWith(s)}function d(t){t.preventDefault(),t.stopPropagation(),o.hideModal(),o.showModalForm("#EditReasonForm",{type:"dialog",hideTriangle:!0,reasons:S}),l(w,function(e){u(e,"#ReasonItem")}),e("#addReason").off("click",p).on("click",p),o.modalForm.find('input[name="new-reason"]').off("keydown",g).on("keydown",g),o.modalForm.off("click",".remove-reason",f).on("click",".remove-reason",f).off("click",".reason-up",m).on("click",".reason-up",m).off("click",".reason-down",h).on("click",".reason-down",h),e("#okModalReason").off("click",b).on("click",b),e("#cancelModalReason").off("click",C).on("click",C),e(document).off("keydown",C).on("keydown",C),e(document).off("keydown",v).on("keydown",v),i.on("ModalFormHideModal",function(){e(document).off("keydown",v)})}function m(t){t.preventDefault(),t.stopPropagation();var n=e(this).parent().parent();n.prev().before(n)}function h(t){t.preventDefault(),t.stopPropagation();var n=e(this).parent().parent();n.next().after(n)}function f(t){t.preventDefault(),t.stopPropagation(),confirm("Удалить причину?")&&e(this).parent().remove()}function p(t){t.preventDefault(),t.stopPropagation();var n=o.modalForm.find('input[name="new-reason"]'),i=e.trim(n.val());if(i){var r=x(e("#ReasonItem"),{reason:i});o.modalForm.find(".delete-cause-list").append(r),n.val("")}}function g(t){13==t.keyCode&&(t.preventDefault(),t.stopPropagation(),e("#addReason").click())}function v(t){t.ctrlKey&&13==t.keyCode&&e("#okModalReason").click()}function b(i){i.preventDefault(),i.stopPropagation();var r=[];0!=o.modalForm.find(".delete-cause-list").size()&&o.modalForm.find('.delete-cause-list input[name="reason"]').each(function(t,n){var i=e.trim(e(n).val());i&&r.push(i)});try{e("#DeleteReasons").html(r.join("\n"))}catch(s){n.log(s)}t.jsonRequest({url:t.getRightUrl("/ajax/moderator/deleted-cause-save"),method:"POST",data:{reasons:r.join("\n"),threadId:_||a.threadId},successCallback:y,failureCallback:k,progressElement:e(i.target),logFunc:n.log})}function y(){o.hideModal(),"function"==typeof T&&T.call()}function C(t){("keydown"!=t.type||27==t.keyCode)&&(t.preventDefault(),t.stopPropagation(),o.hideModal(),e(document).off("keydown",C),"function"==typeof T&&T.call())}function k(e){o.modalForm.find(".error").text(e).show()}function x(e,t){var n=r.compile(e.html());return n(t)}var w,_,T=null,S='<div id="deleteCausesReasons">Загрузка...</div>';return{getLinkClick:function(e,t){return T=t,w=e,d},getDeleteCauses:c}}),define("ban",["jquery","core","console","events","modalForms","handlebars","reasons"],function(e,t,n,i,o,r,a){function s(t){var n=t;t.preventDefault(),t.stopPropagation(),g=e(t.target).attr("data-comment-id"),o.showModalForm("#BanForm",{clickedTarget:e(t.target),type:"dialog",hideTriangle:!0,deleteCauses:a.getDeleteCauses(g)}),l(g),o.modalForm.find(".edit-reasons").on("click",a.getLinkClick(g,function(){s(n)})),e("#okModal").off("click",d).on("click",d),e("#cancelModal").off("click",h).on("click",h),e(document).off("keydown",h).on("keydown",h),e(document).off("keydown",u).on("keydown",u),i.on("ModalFormHideModal",function(){e(document).off("keydown",u)}),e('.commentsvlru-modal-box.ban-form input[name="actionId"]').on("change",c),c()}function l(t){var n=e("[comment="+t+"]"),i=n.hasClass("premoderate")||n.find(".comment").hasClass("premoderate");i?o.modalForm.find(".premoderation").show():o.modalForm.find(".premoderation").hide()}function c(){var t=e('.commentsvlru-modal-box.ban-form input[name="footprintBan"]');1==o.modalForm.find('[name="actionId"]:checked').val()?(t.removeAttr("disabled"),t.parent().show()):(t.attr("disabled","disabled"),t.parent().hide())}function u(t){t.ctrlKey&&13==t.keyCode&&e("#okModal").click()}function d(i){i.preventDefault(),i.stopPropagation();var r=o.modalForm.find('input[name="actionId"]:checked').val(),a=o.modalForm.find('input[name="duration"]:checked').val(),s="";0!=o.modalForm.find(".delete-cause-list").length&&(o.modalForm.find(".delete-cause-list input:checked").each(function(t,n){s+=e(n).closest("label").text()+"\n"}),s=e.trim(s));var l=o.modalForm.find('input[name="private-note"]').val(),c=o.modalForm.find('input[name="footprintBan"]').is(":checked"),u=t.getRightUrl("/ajax/comment/ban");v={commentId:g,actionId:r,duration:a,note:s,privateNote:l,footprintBan:c},t.jsonRequest({url:u,method:"POST",data:v,successCallback:m,failureCallback:f,progressElement:e(i.target),logFunc:n.log})}function m(e){o.hideModal(),i.fire("CommentBan",e)}function h(t){("keydown"!=t.type||27==t.keyCode)&&(t.preventDefault(),t.stopPropagation(),o.hideModal(),e(document).off("keydown",h))}function f(e){o.modalForm.find(".error").text(e).show()}var p="[action=ban]",g=null,v=null;return{init:function(e){e.off("click",p,s).on("click",p,s),e.find(p).show()}}}),define("appVersion",[],function(){return"20160603220051"}),define("core",["config","jquery","console","appVersion"],function(e,t,n,i){function o(e){function t(){var r,a=+new Date;setTimeout(function(){r=+new Date,o+=r-a,o>=n?e.fail&&e.fail():e.check()?e.success():t()},i)}var n=3e4,i=50,o=0;t()}function r(e,n){function i(e,t){t.retryCount=(t.retryCount||0)+1,t.retryCount>3||u.jsonRequest({url:e,method:"POST",data:t,logError:!1,failureCallback:function(){i(this.url,this.data)}})}var o=6e4,a=10,u=c;if(l||(l=setTimeout(r,o),t(window).bind("beforeunload",function(){r(!1,!0)})),(!(s.length<a&&e)||n)&&(clearTimeout(l),l=setTimeout(r,o),s.length)){var d=u.getRightUrl("/ajax/errorlog"),m={};m.errors=s,s=[],i(d,m)}}function a(e){var t,n={readyState:0,responseText:"",status:0,statusText:"error"};for(t in n)if(e[t]!==n[t])return!1;return!0}var s=[],l=!1,c={getRightUrl:function(t){t=String(t);var n=t.length,o=".css"==t.substr(n-4,4)||".js"==t.substr(n-3,3)||".swf"==t.substr(n-4,4)||"/apples/"==t.substr(0,8)||".html"==t.substr(n-5,5),r=o?e.baseUrlStatic:e.baseUrl,a=String(e.embedded?r+t:t);return e.theme&&(a=a+(a.indexOf("?")>=0?"&":"?")+"theme="+e.theme),a=a+(a.indexOf("?")>=0?"&":"?")+"appVersion="+i},getRightStaticUrl:function(t){return t=String(t),e.baseUrlStatic+t},setCookie:function(e,t,n,i){var o=new Date;o.setDate(o.getDate()+n);var r=encodeURIComponent(t)+(null==n?"":"; expires="+o.toUTCString());i&&(r&&(r+="; "),r=r+"path="+i),document.cookie=e+"="+r},getCookie:function(e){var t,n,i,o=document.cookie.split(";");for(t=0;t<o.length;t++)if(n=o[t].substr(0,o[t].indexOf("=")),i=o[t].substr(o[t].indexOf("=")+1),n=n.replace(/^\s+|\s+$/g,""),n==e)return decodeURIComponent(i)},defer:function(e,t){var n=window.setTimeout(function(){window.clearTimeout(n),e()},t)},getQueryParam:function(e){var t=(RegExp(e+"=(.+?)(&|$)").exec(location.search)||[,null])[1];return t?decodeURIComponent(t):null},jsonRequest:function(e){var n=e.url,i=String(e.method).toUpperCase(),o=e.data,r=e.successCallback,a=e.failureCallback,s=e.scope,l=e.param,c=e.progressElement,u=e.progressClass?e.progressClass:"ajax-progress",d=e.debug,m=this,h=function(t){e.logFunc&&e.logFunc(t)};c&&t(c).addClass(u);var f,p=this.isCrossDomain(n),g=function(e){c&&t(c).removeClass(u);var n="";try{if(e)if(e.success)if(void 0!==e.data)try{r&&r.call(s||window,e.data,e.total,e.message,l)}catch(i){h(i),n="Ошибка обработки данных: "+i.toString()}else n="Неправильный формат ответа сервера";else n=e.message?e.message:"Неизвестная ошибка";else n="Неправильный формат ответа сервера"}catch(i){h(i),n="Ошибка обработки запроса: "+i.toString()}n&&(a?a.call(s||window,n,l,e):alert(n))},v=function(n){try{a&&a.call(s||window,"Не удалось загрузить данные:\n"+n.status+" ("+n.statusText+")",l,null)}catch(i){h(i)}c&&t(c).removeClass(u),m.errorRequest(n,e)};if(!p||"POST"!=i&&"DELETE"!=i&&"PUT"!=i)f=t.ajax({url:"GET"==i?n+(n.indexOf("?")>=0?"&":"?")+"_dc="+Math.random():n,type:i,error:v,data:"GET"==i||e.noEncodeData?o:JSON.stringify(o),dataType:p?"jsonp":"json",jsonp:p?void 0:!1,processData:"GET"==i||e.noEncodeData,success:g});else{var b=document.createElement("a");b.href=n,f=new easyXDM.Rpc({remote:b.protocol+"//"+b.hostname+"/cors/index."+(d?"":"min.")+"html"},{remote:{request:{}}}),f.request({url:n,method:i,data:o},function(e){if(200==e.status)try{g(JSON.parse(e.data))}catch(t){v({status:"",statusText:"Parsing error"})}else v(e)},function(e){v({status:e.code,statusText:e.message})})}return f},isCrossDomain:function(e){if(e&&"/"!=e[0]){var t=location.protocol+"//"+location.hostname;return e.substr(0,t.length)!=t}return!1},errorRequest:function(e,t){var n=parseInt(e.status),i="undefined"==typeof t.logError?!0:t.logError;if(!(!i||isNaN(n)||e.status>=200&&e.status<400)){var o=e.statusText,l=t.url,c=String(t.method||t.type).toUpperCase(),u=e.responseText,d=t.data||{},m=t.clearParams||[];try{"object"==typeof d&&(d=JSON.stringify(d)),d=JSON.parse(d)}catch(h){d={}}for(var f=0;f<m.length;f++)delete d[m[f]];d=JSON.stringify(d),u="undefined"==typeof u?null:JSON.stringify(u).substr(0,500);var p=new Date,g={date:p.toString(),data:d,status:n,statusText:o,url:l,method:c,responseText:u,disconnect:a(e)};s.push(JSON.stringify(g)),r(!0)}},catchError:function(e){try{var t,i={};for(t in navigator)i[t]=navigator[t];delete i.plugins,delete i.mimeTypes;var o=new Date,a={date:o.toString(),name:e.name||"",message:e.message||"",stack:e.stack||"",href:location.href,navigator:JSON.stringify(i),cookie:document.cookie};s.push(JSON.stringify(a)),r(!0)}catch(l){n.log(l)}},detectMobile:function(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)?!0:!1},escapeHtml:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},loadCss:function(e,n,i){function r(){var l=e.shift();if(l){var c=s.getRightUrl(l),d=t("<link>",{rel:"stylesheet",type:"text/css",href:c});if(!i&&!u&&"onload"in d[0])d.load(r);else{var m="commentsvlru-android-css-onload";t("body").append('<div id="'+m+'">'),o({success:function(){t("#"+m).remove(),r()},check:function(){return"666"==window.getComputedStyle(document.getElementById(m)).zIndex}})}a.append(d)}else"function"==typeof n&&n.call()}var a=t("head"),s=this,l=navigator.userAgent,c=/CriOS|Chrome/.test(l),u=/Mozilla\/5.0/.test(l)&&/Android/.test(l)&&/AppleWebKit/.test(l)&&!c;r()}};return c.getModule=function(t){var n={company:"catalog"},i=n[e.theme]||e.theme;return require(i+"/"+t)||require(t)},c}),define("config",[],{threadId:null,threadName:null,threadKeys:[],commentAttributesFilter:{},relatedThreads:!1,mergeTypes:"",pageTitle:"",subscribeEmail:null,isThreadSubscribed:!1,commentTemplate:"",defaultPosterName:null,addShareOnPost:!1,addShareUrl:"",addShareBackUrl:"",lastCommentId:null,prevPageId:null,commentsCount:10,commentsLimit:10,baseUrl:"http://comments.vl.ru",baseUrlStatic:"http://comments.vl.ru",embedded:!1,reloadCounter:0,totalCommentsCount:0,showDeletedComments:!1,storeNameOnClient:!1,anonPosterNameCookie:"poster_name",noLoginActionsOverride:!1,userProviderName:null,userProviderId:null,listeners:{},maxFileSize:10485760,cssFiles:["/css/client.css"],commentFormAtBottom:null,sortMode:null,hilightEnabled:!0,theme:"",bindAnonymousCommentsDialog:null,
profileId:null,useAnonymousProfiles:!1,socketServer:"",enableSubscribe:!0,enableSocketIO:!0,isMobile:function(){var e=["mobile","catalog-mobile","kino-vl-mobile"];return!!($.inArray(this.theme,e)+1)}}),define("console",[],{_enabled:!1,log:function(e){this._enabled&&window.console&&(e instanceof Error&&(e=e.stack),window.console.log(e))},enable:function(){this._enabled=!0}}),define("linkConverter",["config"],function(e){function t(e){return e=n(e),e=i(e)}function n(t){if(e.embedded){var n=e.baseUrl,i=e.baseUrlStatic;if(n&&"/"!=n[0]){var o=window.location.protocol+"//"+window.location.hostname;n.substr(0,o.length)!=o&&(t=t.replace(/(<a[^>]+)(href=("|'))\//gim,'$1 target="commentschild" $2'+n+"/")),i.substr(0,o.length)!=o&&(t=t.replace(/(<img[^>]+src=("|'))\//gim,"$1"+i+"/"),t=t.replace(/(background-image:\s*(url|)\(('|"|))\//gim,"$1"+i+"/"),t=t.replace(/((<a[^>]+)static([^>]+)(href=("|')))\//gim,"$1"+i+"/"),t=t.replace(/((<a[^>]+)static([^>]+)(data-orig-url=("|')))\//gim,"$1"+i+"/"))}}return t}function i(t){return e.embedded&&(t=t.replace(/(<a[^>]+action="copy-link"[^>]+href=")[^"]+\?p=(\d+)("[^>]*>)/gim,"$1#p$2$3"),t=t.replace(/(<a[^>]+action="copy-link"[^>]+)target="commentschild"/gim,"$1")),t}return{convertContentUrls:t}}),define("events",["config","console","jquery"],function(e,t,n){function i(e,t){return e===t||e&&t&&e.hasOwnProperty("guid")&&t.hasOwnProperty("guid")&&e.guid===t.guid}return{on:function(t,i,o){if(n.isArray(t)){var r=this;n.each(t,function(e,t){r.on(t,i,o)})}else if(i){this.off(t,i);var a,s;t=String(t).toLowerCase(),e.listeners[t]||(e.listeners[t]=[]),"function"==typeof i?(a=i,o="object"==typeof o?o:window,s=void 0):(a=i.fn,o=i.scope||window,s=i.params),e.listeners[t].push({fn:a,scope:o,params:s})}},off:function(t,n){if(n){t=String(t).toLowerCase();var o=e.listeners[t];if(o)for(var r="function"==typeof n?n:n.fn,a=0;a<o.length;a++){var s=o[a];if(i(s.fn,r)){o.splice(a,1);break}}}},fire:function(i){i=String(i).toLowerCase();var o=n.extend([],e.listeners[i]);if(o)for(var r=0;r<o.length;r++)try{var a=o[r],s=Array.prototype.slice.call(arguments,1).concat(a.params||[]);if(a.fn.apply(a.scope,s)===!1)return!1}catch(l){t.log(l)}},clear:function(){e.listeners={}}}}),define("pastafarian",["core","console","supercookie"],function(e,t,n){function i(e){n.set(r,e),o=e}var o=null,r="pastafarian",a=!1;return{getUserKey:function(){return a||this.updateUserKey(),o||""},updateUserKey:function(){a=!0,o=n.getImmediate(r),n.getDelayed(r,function(n){n?(o=n,e.setCookie(r,n,7300,"/")):e.jsonRequest({url:e.getRightStaticUrl("/ajax/check-user"),method:"POST",successCallback:function(t){var n;(n=e.getCookie(r))?i(n):t&&i(t)},scope:this,logFunc:t.log})},this)}}}),define("modalForms",["jquery","console","handlebars","events","config"],function(e,t,n,i,o){return{modalForm:null,beforeHide:null,hideModalHandlerBound:!1,modalFormsUIInitializers:[],overlay:null,timeout:null,showModalForm:function(r,a,s,l){this.modalForm&&(this.modalForm.remove(),this.modalForm.removeProp("clickedTarget"));var c,u;if(l)u=l;else if(s)c=n.compile(s)(a),u=e(e.parseHTML(e.trim(c)));else{var d=e(r);if(1!=d.length)return void t.log("Invalid modal form configuration ("+r+")");c=n.compile(d.html())(a),u=e(e.parseHTML(e.trim(c)))}i.fire("ModalFormShowModal",r,u);var m=a&&a.hideTriangle?Boolean(a.hideTriangle):!1;o.isMobile()&&(m=!0);var h=e("body"),f=a&&a.$parent?a.$parent:h;if("dialog"==a.type)return u.params=a,this.initializeModalForm(r,u),this.overlay=e("<div class='commentsvlru-overlay-modal'></div>"),this.overlay.appendTo(h),h.addClass("cmt-modal-form__no-scroll"),a.beforeShow&&a.beforeShow(u),u.appendTo(f).show().children("input").focus(),this.modalForm=u,this.centerModalForm(),m&&this.modalForm.addClass("noTriangle"),this.beforeHide=a.hasOwnProperty("beforeHide")?a.beforeHide:null,void i.fire("AfterShowModalForm");var p=e(a.clickedTarget);u.params=a,u.prop("clickedTarget",p),this.initializeModalForm(r,u),u.css({opacity:0,left:"-9999px",top:"-9999px"}).appendTo(f);var g=p.offset().top+(a.topOffset?parseInt(a.topOffset):0);m||(g+=15);var v={top:g,left:p.offset().left+(a.leftOffset?parseInt(a.leftOffset):0)};v.left+u.outerWidth()>e(window).width()&&(v.left-=v.left+u.outerWidth()-e(window).width(),v.left<0&&(v.left=0,v.right=0)),a.beforeShow&&a.beforeShow(u),u.css(v).animate({top:"+="+p.outerHeight(),opacity:1},100),u.children("input").focus(),m&&u.addClass("noTriangle"),this.hideModalHandlerBound||(h.on("click",e.proxy(this.hideModal,this)),e("html").on("click",e.proxy(this.hideModal,this)),this.hideModalHandlerBound=!0),this.beforeHide=a.hasOwnProperty("beforeHide")?a.beforeHide:null,this.modalForm=u,i.fire("AfterShowModalForm")},alert:function(t,n,o){function r(e){if(e){if("keydown"==e.type&&27!=e.keyCode)return;e.preventDefault(),e.stopPropagation()}s.hideModal()}function a(){s.timeout&&clearTimeout(s.timeout),e("#okModal").off("click.cmtModalForms",r),e("#cancelModal").off("click.cmtModalForms",r),e(document).off("keydown.cmtModalForms",r).off("click.cmtModalForms",r),e(":input").off("focus.cmtModalForms",r),i.off("ModalFormHideModal",a)}var s=this;return s.hideModal(),s.showModalForm(t,n),i.on("ModalFormHideModal",a),e(document).off("keydown.cmtModalForms",r).on("keydown.cmtModalForms",r).off("click.cmtModalForms",r).on("click.cmtModalForms",r),e(":input").off("focus.cmtModalForms",r).on("focus.cmtModalForms",r),e("#okModal").off("click.cmtModalForms",r).on("click.cmtModalForms",r),e("#cancelModal").off("click.cmtModalForms",r).on("click.cmtModalForms",r),o&&(s.timeout&&clearTimeout(this.timeout),s.timeout=setTimeout(r,o)),s},hideModal:function(t){if(!t||!e(t.target).closest(".commentsvlru-modal-box").size()){this.beforeHide&&(this.beforeHide(this.modalForm),this.beforeHide=null);var n=e("body");n.hasClass("cmt-modal-form__no-scroll")&&n.removeClass("cmt-modal-form__no-scroll"),this.overlay&&(this.overlay.remove(),this.overlay=null),i.fire("ModalFormHideModal");var o=this.modalForm;o&&(t&&(t.stopPropagation(),t.preventDefault()),o.animate({top:"-=20",opacity:0},{duration:100,complete:e.proxy(function(){o.remove()},this)}),o.removeProp("clickedTarget"),this.modalForm=null)}},addFormUIInitializer:function(e,t,n){this.modalFormsUIInitializers.push({formId:e,handler:t,scope:n})},initializeModalForm:function(e,n){i.fire("ModalFormUIInitializer",e,n);for(var o=0;o<this.modalFormsUIInitializers.length;o++){var r=this.modalFormsUIInitializers[o];if(r.formId==e)try{r.handler.call(r.scope||window,e,n)}catch(a){t.log(a)}}},centerModalForm:function(){if(this.modalForm){var t={x:!1,y:!1},n=50-parseInt(50*this.modalForm.outerHeight()/e(window).height());0>n&&(n=0,t.y="auto"),n+="%";var i=50-Math.ceil(50*this.modalForm.outerWidth()/e(window).width());0>i&&(i=0,t.x="auto"),i+="%";var o={top:n,left:i,opacity:1};t.y&&(o.bottom="0%",o["overflow-y"]=t.y),t.x&&(o.right="0%",o["overflow-x"]=t.x),this.modalForm.css(o)}}}}),define("subscribeActions",["core","config","events","modalForms","console","pastafarian"],function(e,t,n,i,o,r){var a={control:null,subscribeBtnSelector:"#subscButton",subscribeEmail:"#subscEmail",unsubscribeBtnSelector:"#unsubscButton",overlay:".cmt-ui-widget-overlay",errorContainer:"#subscError",subscribeModalFormId:"#CommentSubscSubmitModal",unsubscribeModalFormId:"#CommentUnsubscSubmitModal",subscribeUrl:"/ajax/subscribe",unsubscribeUrl:"/ajax/unsubscribe",actions:{subscribe:"subscribe",unsubscribe:"unsubscribe"},actionHandlerObj:null,subscribeBtnHandlerObj:null,unsubscribeBtnHandlerObj:null,activeCommentId:null};return a.init=function(){t.enableSubscribe&&(this.actionHandlerObj=$.proxy(this.actionHandler,this),this.subscribeBtnHandlerObj=$.proxy(this.subscribeBtnHandler,this),this.unsubscribeBtnHandlerObj=$.proxy(this.unsubscribeBtnHandler,this),n.on("UiInitialize",this.uiInitializer,this),n.on("CommentAdd",this.showControls,this),this.showControls())},a.showControls=function(){$(".commentsvlru .cmt-hidden-subscription").removeClass("cmt-hidden-subscription")},a.beforeShowModal=function(e){this.activeCommentId?e.removeClass("thread-subscription"):e.addClass("thread-subscription"),e.find(this.subscribeBtnSelector).off("click",this.subscribeBtnHandlerObj).on("click",this.subscribeBtnHandlerObj),e.find(this.unsubscribeBtnSelector).off("click",this.unsubscribeBtnHandlerObj).on("click",this.unsubscribeBtnHandlerObj),e.find(".subscribe-form__cancel").on("touchstart click",function(e){e.preventDefault(),e.stopPropagation(),i.hideModal()}),t.isMobile()&&($("body").addClass("cmt-subscribe-form__no-scroll").on("click.cmt-subscribe-actions touchstart.cmt-subscribe-actions",$.proxy(i.hideModal,i)),$("html").on("click.cmt-subscribe-actions touchstart.cmt-subscribe-actions",$.proxy(i.hideModal,i)))},a.beforeHideModal=function(){a.activeCommentId&&($(".commentsvlru [comment="+a.activeCommentId+"]").removeClass("has-subscription-form"),a.activeCommentId=null),$(".commentsvlru #global_subscribe").removeClass("clicked"),t.isMobile()&&($("body").removeClass("cmt-subscribe-form__no-scroll").off("click.cmt-subscribe-actions touchstart.cmt-subscribe-actions"),$("html").off("click.cmt-subscribe-actions touchstart.cmt-subscribe-actions"))},a.initGlobalButton=function(){var e=["subscribe","unsubscribe"],n=$(".commentsvlru #global_subscribe"),i=t.isThreadSubscribed?1:0,o=e[i],r=function(){$(this).addClass("clicked")};n.text(n.attr("text_"+o)).attr({action:o,title:n.attr("title_"+o)}).off("click",r).on("click",r),n.show()},a.uiInitializer=function(){this.initGlobalButton(),this.showControls(),$(".commentsvlru .subscription-aware").removeClass("hidden"),t.isThreadSubscribed?($("li[comment!=0]").find("[action=subscribe], [action=unsubscribe]").addClass("hidden"),$(".commentsvlru .subscribe-check-container, .commentsvlru .subscription .subscription-aware").addClass("hidden")):($("li[comment!=0][isSubscribed=1]").find("[action=subscribe], [action=unsubscribe]").each(function(){var e=$(this);e.find("span").attr({action:a.actions.unsubscribe}).text(e.attr("text_unsubscribe")),e.attr({action:a.actions.unsubscribe,title:e.attr("text_unsubscribe")}),e.hasClass("company")||e.hasClass("marisa")||a.showElement(e)}),$("li[comment!=0][isSubscribed=0]").find("[action=subscribe], [action=unsubscribe]").each(function(){var e=$(this);e.find("span").attr({action:a.actions.subscribe}).text(e.attr("text_subscribe")),e.attr({action:a.actions.subscribe,title:e.attr("text_subscribe")}),e.hasClass("company")||e.hasClass("marisa")||a.showElement(e)}));for(var e in this.actions)$("[action="+this.actions[e]+"]").not("em").not(".cmt-skip-bind").off("click",this.actionHandlerObj).on("click",this.actionHandlerObj)},a.showElement=function(e){e.removeClass("hidden"),e.is(":hidden")&&e.show()},a.actionHandler=function(e){e.preventDefault(),e.stopPropagation();var t=$(e.target),n=t.attr("action"),i=parseInt(t.closest(".subscription").attr("data-comment-id"));this[n+"ActionHandler"].call(this,i,e.target)},a.subscribeActionHandler=function(e,t){a.actionClick(this.subscribeModalFormId,e,t)},a.unsubscribeActionHandler=function(e,t){a.actionClick(this.unsubscribeModalFormId,e,t)},a.actionClick=function(e,n,o){var r={commentId:n,email:t.subscribeEmail,beforeShow:$.proxy(this.beforeShowModal,this),beforeHide:$.proxy(this.beforeHideModal,this)},a=$(o);t.isMobile()?r.type="dialog":a.is(".thread-subscription.flat")?(r.leftOffset=a.width()-180,r.hideTriangle=!0,r.clickedTarget=o):r.clickedTarget=o,n?(this.activeCommentId=n,a.closest(".commentsvlru [comment]").addClass("has-subscription-form")):this.activeCommentId=null,i.showModalForm(e,r)},a.subscribeBtnHandler=function(a){if(a.preventDefault(),a.stopPropagation(),$(a.target).attr("closeModal"))i.hideModal();else{var s=i.modalForm,l=s.params,c=s.find(this.subscribeEmail).val();this.validateEmail(c)?e.jsonRequest({url:e.getRightUrl(this.subscribeUrl),method:"POST",data:{type:l.commentId?2:1,threadId:t.threadId,commentId:l.commentId?l.commentId:0,email:c,pastafarian:r.getUserKey()},successCallback:function(){i.hideModal(),l.commentId?$("li[comment="+l.commentId+"]").attr("isSubscribed",1):(t.isThreadSubscribed=!0,$("li[comment!=0]").attr("isSubscribed",0)),n.fire("SubscribeAction",t.isThreadSubscribed),n.fire("UiInitialize")},failureCallback:this.showError,scope:this,param:null,progressElement:$(a.target),logFunc:o.log}):this.showError("Неправильный формат e-mail")}},a.unsubscribeBtnHandler=function(a){a.preventDefault(),a.stopPropagation();var s=i.modalForm,l=s.params;e.jsonRequest({url:e.getRightUrl(this.unsubscribeUrl),method:"POST",data:{type:l.commentId?2:1,threadId:t.threadId,commentId:l.commentId?l.commentId:0,pastafarian:r.getUserKey()},successCallback:function(){i.hideModal(),l.commentId?$("li[comment="+l.commentId+"]").find("[comment]").andSelf().attr("isSubscribed",0):t.isThreadSubscribed=!1,n.fire("SubscribeAction"),n.fire("UiInitialize")},failureCallback:this.showError,scope:this,param:null,progressElement:$(a.target),logFunc:o.log})},a.validateEmail=function(e){return/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]+$/i.test(e)},a.showError=function(e,t,n){var o=i.modalForm;o&&o.find(this.errorContainer).html(e).show(),n&&n.data&&n.data.errorType&&"expected"==n.data.errorType&&o.find(this.subscribeBtnSelector).attr("closeModal","closeModal").text("Закрыть")},a}),define("subscriptionToComment",["jquery","events","config"],function(e,t,n){function i(){return"new"===c&&!n.isThreadSubscribed&&("question"===l||"complaint"===l)}function o(e){l=e,m.refreshSubscribeChecker()}function r(e){c=e,m.refreshSubscribeChecker()}function a(t){"boolean"!=typeof t&&t===!0&&m.setSubscribeCheckerState(!1);var i=!n.enableSubscribe||n.isThreadSubscribed;if(!i){var o=h.closest('[level="0"]');o.find("[comment]").andSelf().each(function(){1==e(this).attr("issubscribed")&&(i=!0)})}i?e(".subscribe-check-container",h).addClass("hidden"):e(".subscribe-check-container",h).removeClass("hidden")}function s(){var t=f.is(":checked");e(".cmt-subscribe-email",h).toggleClass("cmt-unchecked",!t)}var l,c="new",u=!1,d=!1,m={},h=null,f=null,p="input#subscribeCheck";return m.refreshSubscribeChecker=function(){var e=i();f.prop("disabled",e),d&&e?m.setSubscribeCheckerState("new"===c||u):d&&!e?(m.setSubscribeCheckerState(u),d=e):!d&&e&&(u=f.is(":checked"),m.setSubscribeCheckerState(!0),d=e),s()},m.setSubscribeCheckerState=function(e){f.prop("checked",e)},m.init=function(e){l=null,h=e,f=h.find(p),f.off("change",s).on("change",s),t.on("BeforeSetPostMode",r),t.on("ChangeCommentType",o),t.on(["SetFormToComment","SetFormToThread","SubscribeAction"],a),d=i(),u=f.is(":checked")},m}),define("spinner",["jquery"],function(e){var t=["0","1","2","3","4","5","6","7"],n=120,i=0,o={},r=".commentsvlru .image-spinner",a=function(r){return function(){var s=e(r);i=i<t.length-1?i+1:0,s.each(function(){e(this).html(t[i])}),o[r]=setTimeout(a(r),n)}},s={};return s.start=function(e){e=e||r,"undefined"==typeof o[e]&&a(e||r).call()},s.stop=function(e){e=e||r,"undefined"!=typeof o[e]&&(clearTimeout(o[e]),delete o[e])},s}),define("imageUpload",["jquery","console","modalForms","config","core","events","spinner","pastafarian","browserDetect"],function(e,t,n,i,o,r,a,s,l){return{uploadBlock:null,uploadForm:null,showBtn:null,supportMultiple:!1,maxImagesInComment:20,anonymousAuthForm:"#AuthModalForm",editImageButtonsTpl:"#EditImagesButtons",cancelImageButtonsTpl:"#CancelImagesButtons",addImageButtonTpl:"#AddImageButton",addedImageItemTpl:"#AddedImageItem",commentId:0,uploadContainer:[],deletionContainer:[],goodBrowser:!1,openOnInit:!1,init:function(){this.uploadBlock=e(".commentsvlru .image-container"),this.uploadBlock.show(),this.uploadForm=this.uploadBlock.find(".upload-form"),this.showBtn=this.uploadBlock.find(".add-images"),this.showBtn.addClass("add-images-hover").removeClass("add-images-hover");var t=this;if(this.uploadForm.size())if(t.openOnInit){t.uploadForm.show(),t.showBtn.hide(),t.addUploadButton();var i=t.uploadForm.find(":file:empty");i.css({width:"100px",height:"100px"})}else this.showBtn.on("click",function(e){e.preventDefault(),e.stopPropagation(),t.uploadForm.show(),t.showBtn.hide(),t.addUploadButton()});else this.showBtn.on("click",function(e){e.preventDefault(),e.stopPropagation();var i={clickedTarget:t.showBtn,message:"Для добавления фотографий к сообщению необходимо авторизоваться",leftOffset:-17};n.showModalForm(t.anonymousAuthForm,i)});require("lightbox_init"),a.start(".commentsvlru .image-container .image-spinner")},getUrl:function(e){var t="?threadId="+i.threadId+"&pastafarian="+s.getUserKey();return e&&(t=t+"&sid="+e),this.commentId&&(t=t+"&commentId="+this.commentId),o.getRightUrl("/ajax/comment/image"+t)},initUpload:function(e){var t=l.getInfo();this.goodBrowser=!("msie"===t.name&&t.version<9);var n=this.getUrl(),i=this;e.fileInput.fileupload({url:n,dataType:"json",autoUpload:!1,acceptFileTypes:/(\.|\/)(jpe?g|png)$/i,maxFileSize:1e7,messages:{maxNumberOfFiles:"Вы можете загрузить не более "+i.maxImagesInComment+" фотографий",acceptFileTypes:"Можно загружать только JPG и PNG",maxFileSize:i.getMaxSizeText(),minFileSize:"Слишком маленький файл"},xhrFields:{withCredentials:!0}}).on("fileuploadadd",function(t,n){n.itemInfo=e,i.fileUpload.add(n,i)}).on("fileuploadprocessalways",function(e,t){i.fileUpload.processAlways(t,i)}).on("fileuploadprogress",function(e,t){i.fileUpload.progress(t,i)}).on("fileuploaddone",function(e,t){i.fileUpload.done(t,i)}).on("fileuploadfail",function(e,t){i.fileUpload.fail(t,i)}).on("fileuploadsubmit",function(e,t){i.fileUpload.submit(t,i)}).on("fileuploadprocesssop",function(e){e.fileUpload.stop(e)})},fileUpload:{getCurrent:function(e){return e.uploadBlock.find(".now-uploaded:eq(0)").find('[name="images[]"][value=""]').parent()},clean:function(t){var n=t.uploadBlock.find('[name="images[]"][value=""]');n.val("delete");var i=n.first().parent().data("data");e.each(n,function(e,t){e&&t.parent().remove()}),n.first().val(""),i&&i.abort&&i.abort(),t.uploadingEnded()},submit:function(e,t){var n;"undefined"!=typeof FormData&&t.goodBrowser||(n=(new Date).getTime()),e.sid=n,e.url=t.getUrl(n)},add:function(t,n){function i(e,i){var o=n.createImageItem();return i.error?(n.addError(o,i.error),!1):i.size>n.maxFileSize?(n.showErrorMaxSize(o,i.fileName),!1):(r.before(o),n.imageLoaderStart(o),o.addClass("now-uploaded"),o.data("data",t),o.data("data-index",e),n.addCancelButtonsToItem(o,n.cancelHandler(n,this,o)),o)}var o=t.itemInfo,r=o.addItem,a=n.uploadBlock.find('input[type="file"]'),s=a.data("blueimp-fileupload")||a.data("fileupload"),l=e.Deferred();t.items=[];var c=n.getTotalImageCount()+t.files.length;if(c>n.maxImagesInComment)return e.each(t.files,function(e){t.files[e].error="Вы можете загрузить не более "+n.maxImagesInComment+" фотографий"}),t.files.error=!0,l.rejectWith(this,[t]),n.addError(null,"Вы можете загрузить не более "+n.maxImagesInComment+" фотографий"),!1;if(s&&s.process(t),t.files.error)return e.each(t.files,function(e){t.files[e].error&&n.addError(null,t.files[e].error)}),l.rejectWith(this,[t]),!1;c==n.maxImagesInComment&&setTimeout(function(){r.hide()},0);var u=n.isActive();return e.each(t.files,function(e,n){t.items[e]=i(e,n)}),u||t.submit(),!0},processAlways:function(t,n){if(!e.isArray(t.items))return!1;var i=t.index,o=t.files[i],r=t.items[i];return r?o.error?(n.addError(r,o.error),!1):!0:!1},progress:function(t,n){if(e.isArray(t.items)){var i=null;if(e.each(t.items,function(e,t){i||t.find('[name="images[]"][value=""]').size()&&(i=t)}),i){i.addClass("image-loading"),n.goodBrowser&&!i.find("input.progress-throbber").size()&&(n.imageLoaderStop(i),i.append('<input type="text" class="progress-throbber" />').find("input.progress-throbber").val(0).knob({width:100,height:100,readOnly:!0}),i.find("input.progress-throbber").parent().css({display:"block","float":"left"}));var o=Math.floor(t.loaded/t.total*100),r=i.find("input.progress-throbber");r.size()&&r.val(o).trigger("change")}}},done:function(t,n){if("undefined"!=typeof t.result||"undefined"==typeof t.sid||n.goodBrowser)return this.doneCallback(t,n);var i=n.getUrl(t.sid),r=this;return e.ajax({url:i+"_dc="+Math.random(),type:"GET",dataType:"jsonp",processData:!0,success:function(e){t.result=e,r.doneCallback(t,n)},error:function(e){o.errorRequest(e,{url:i,type:"GET"}),t.result=void 0,r.doneCallback(t,n)}}),null},doneCallback:function(t,n){var i=t.result;return i&&i.success&&i.data?(e.each(i.data.data,function(e,t){var i=n.fileUpload.getCurrent(n);if(t.success){var o=t.url+"?_dc="+String(Math.random());n.imagePreload(i,o),i.removeClass("now-uploaded"),i.attr("image-id",t.id),i.attr("new-image","true"),i.find('input[name="images[]"][value=""]').val(t.id),i.find(".selected-file").remove(),i.find(".upload-preview").remove(),i.find("input.progress-throbber").closest("div").remove()}else n.addError(i,t.msg);n.addButtonsToItem(i),n.checkImagesCountAndAddButton()}),n.uploadingEnded(),r.fire("ImageAdd",i.data),!0):(n.addError(n.fileUpload.getCurrent(n),"HTTP ошибка загрузки"),n.uploadingEnded(),!1)},fail:function(e,t){var n=t.fileUpload.getCurrent(t);n.find("input.progress-throbber").closest("div").remove(),"abort"!==e.errorThrown&&t.addError(n,"Ошибка загрузки"),t.checkImagesCountAndAddButton(),t.uploadingEnded()},always:function(e,t){t.uploadingEnded()},stop:function(e){e.uploadingEnded()}},cancelHandler:function(t,n,i){return function(o){if(o.preventDefault(),o.stopPropagation(),!confirm("Отменить загрузку?"))return!1;var a=e(i).attr("image-id");if(a)return t.deletionContainer.push(a),i.remove(),t.checkImagesCountAndAddButton(),void r.fire("ImageDelete",a,!0);var s=e.Deferred(),l=i.data("data"),c=i.data("data-index"),u=t.fileUpload.getCurrent(t);u.data("data-index")==c&&(l.abort?l.abort():(l.errorThrown="abort",this._trigger("fail",o,l))),l.files[c].error="abort",l.files.error=!0,s.rejectWith(n,[l]),u.remove(),t.addUploadButton().addItem.show()}},uploadingEnded:function(){var e=this.fileUpload.getCurrent(this).data("data");e?e.submit():n.hideModal()},isActive:function(){if(!this.uploadBlock)return!1;var t=!1;return this.uploadBlock.find('[name="images[]"][value=""]').each(function(){e(this).val()||(t=!0)}),t},addUploadButton:function(){var e=this.uploadForm.find(":file:empty");if(e.length){var t=e.parents("form.native-form").parent();return{addItem:t,fileInput:e,progress:t.find(".progress")}}var n={addItem:this.createAddButtonItem()};return n.fileInput=n.addItem.find(":file"),n.itemLabel=n.addItem.find(".selected-file .label"),n.progress=n.addItem.find(".progress"),n.addItem.find("input[name=threadId]").val(i.threadId),this.uploadForm.append(n.addItem),this.supportMultiple=void 0!==n.fileInput.get(0).files,this.supportMultiple&&(n.fileInput.attr("multiple","multiple"),n.itemLabel.html(n.itemLabel.html()+"ы")),this.initUpload(n),r.fire("AfterAddUploadButton"),n},compileTemplate:function(t,n){var i=e(t);if(i&&i.length){var o=Handlebars.compile(i.html());if(o&&(o=o(n||[])))return e(e.parseHTML(e.trim(o)))}return null},createAddButtonItem:function(){return this.compileTemplate(this.addImageButtonTpl)},createImageItem:function(){return this.compileTemplate(this.addedImageItemTpl)},showErrorMaxSize:function(e,t){t=t?t+": ":t,this.addError(e,t+this.getMaxSizeText()),this.checkImagesCountAndAddButton()},getMaxSizeText:function(){for(var e=i.maxFileSize,t=["","Кб","Мб","Гб","Тб"],n=0;e>1024;)e/=1024,n++;return e+=t[n],"Превышен максимальный размер файла в "+e},imagePreload:function(e,t){var n=this;n.imageLoaderStart(e);var i=new Image,o=function(){return function(){n.imageLoaderStop(e),e.css("background-image",'url("'+t+'")'),e.data("background-image",t),e.removeClass("image-loading")}};i.onload=o(),i.src=t},imageLoaderStart:function(t){t.find(".image-spinner").size()||e("<div>",{"class":"image-spinner"}).appendTo(t)},imageLoaderStop:function(e){e.find(".image-spinner").remove()},renderUploadedImages:function(e,t,n){for(var i,o=e.count,r=0;o>r;r++){if(i=this.createImageItem(),r==o-1?t.replaceWith(i):t.before(i),e.data[r].success){var a=e.data[r].url+"?_dc="+String(Math.random());i.css("background-image",'url("'+a+'")'),i.attr("image-id",e.data[r].id),n&&i.attr("new-image","true"),i.find("input[type=hidden]").val(e.data[r].id),i.find(".selected-file").remove(),i.data("background-image",a)}else this.addError(i,e.data[r].msg);this.addButtonsToItem(i)}this.checkImagesCountAndAddButton()},checkImagesCountAndAddButton:function(){var e=this.uploadForm.find(".item .native-form"),t=e.size()?!!this.isActive():!0;this.getTotalImageCount()<this.maxImagesInComment&&t?this.addUploadButton():this.getTotalImageCount()<this.maxImagesInComment&&e.parent().is(":hidden")&&e.parent().show()},getTotalImageCount:function(){var e=this.uploadForm.find(".item[image-id]"),t=this.uploadForm.find('.item [name="images[]"][value=""]').size();return e.size()+t},deleteItem:function(e){e.preventDefault(),e.stopPropagation();var t=e.data,n=t.attr("new-image"),i=!1;"undefined"!=typeof n&&n!==!1&&(i=!0);var o=t.attr("image-id"),a=t.find("button");if(!a.attr("disabled"))if(o){if(!confirm("Удалить фотографию?"))return!1;this.deletionContainer.push(o),t.remove(),this.checkImagesCountAndAddButton(),r.fire("ImageDelete",o,i)}else t.remove(),this.checkImagesCountAndAddButton()},getDeletedImages:function(){return this.deletionContainer},getUploadCount:function(){var t,n=e(".commentsvlru .upload-form .item"),i=e(".commentsvlru .upload-form .native-form");return t=n.size()-i.size()},turnImage:function(n){var i=n.data,a=i.attr("image-id"),l=i.find("button"),c=e(n.delegateTarget);if(!l.attr("disabled")&&a&&c.size()){var u=i.find(".progress");l.attr("disabled","disabled"),o.jsonRequest({url:o.getRightUrl("/ajax/comment/image/turn"),method:"POST",data:{imageId:a,direction:c.hasClass("turn-left")?"left":"right",pastafarian:s.getUserKey()},successCallback:function(e){l.removeAttr("disabled");var t=i.data("background-image")+"?_dc="+String(Math.random());i.css("background-image",'url("'+t+'")'),r.fire("ImageTurn",a,e)},failureCallback:function(e){l.removeAttr("disabled"),alert(e)},scope:this,progressElement:u,logFunc:t.log})}return!1},clearForm:function(){this.deletionContainer=[],this.uploadForm.empty(),this.fileUpload.clean(this),this.openOnInit?this.checkImagesCountAndAddButton():(this.uploadForm.hide(),this.showBtn.show()),this.uploadForm.parent().find(".upload-error").remove()},addButtonsToItem:function(t){var n=this.compileTemplate(this.editImageButtonsTpl);if(n){n.attr("enabled","enabled"),t.find(".buttons").remove(),t.prepend(n);var i=n.find(".del");i.on("click","",t,e.proxy(this.deleteItem,this));var o=n.find(".turn-right,.turn-left");o.on("click","",t,e.proxy(this.turnImage,this)),t.find(".selected-file .label.error").size()&&o.hide()}},addCancelButtonsToItem:function(e,t){var n=this.compileTemplate(this.cancelImageButtonsTpl);if(n){n.attr("enabled","enabled"),e.prepend(n);var i=n.find(".cancel");i.on("click",t)}},addError:function(t,n){function i(e){var t=0;if(0==e.length)return t;for(var n=0;n<e.length;n++){var i=e.charCodeAt(n);t=(t<<5)-t+i,t&=t}return t}t&&t.size()&&t.remove();var o=this.uploadForm.parent();e(".commentsvlru").hasClass("company")&&(o=e("#formErrCont .othersError"),e("#formErrCont").show(),o.show());var r="err"+i(n),a=o.find(".upload-error."+r);a.size()||(a=e('<div class="upload-error '+r+'">'+n+' (<a href="#">Удалить</a>)</div>'),a.find("a").on("click",function(){return e(this).parent().animate({opacity:0},250,function(){e(this).remove()}),!1}),a.appendTo(o)),a.stop().css({"background-color":"#FFFF88"}).animate({"background-color":"#FFFFFF"},500,function(){e(this).css({"background-color":"transparent"})})},setOpenOnInit:function(e){this.openOnInit=e}}}),define("user_bananas",["core","jquery","console"],function(e,t,n){return{flashContainerId:"banana-container",init:function(){var n=this;t(function(){var i=n.getContainer(),o=t.flash.available&&!/Firefox\/\d/.test(navigator.userAgent);0==i.size()&&o&&(i=t("<div>").attr("id",n.flashContainerId),i.appendTo(t("body")),i.flash({swf:e.getRightUrl("/swf/banana.swf"),id:"bananaobj",name:"bananaobj",allowScriptAccess:"always",wmode:"transparent",width:1,height:1}))})},getContainer:function(){return t("#"+this.flashContainerId)},collectBananas:function(){return{banana1:this.collectFonts(),banana2:this.collectBrowserInfo(),banana3:this.collectPlugins(),banana4:this.collectDateTime(),banana5:this.collectMimeTypes(),banana6:this.collectSystemInfo()}},collectFonts:function(){var e=this.getContainer();if(!e.size())return[];var t=document.getElementById("bananaobj");try{return t.getFontsList()}catch(i){return n.log(i),[]}},collectBrowserInfo:function(){function e(e,n){try{n=String(n)}catch(i){n=JSON.stringify(n)}t[e]=n}var t={};return e("navigator.appName",navigator.appName),e("navigator.appCodeName",navigator.appCodeName),e("navigator.appVersion",navigator.appVersion),e("navigator.appMinorVersion",navigator.appMinorVersion),e("navigator.vendor",navigator.vendor),e("navigator.userAgent",navigator.userAgent),e("navigator.oscpu",navigator.oscpu),e("navigator.platform",navigator.platform),e("navigator.securityPolicy",navigator.securityPolicy),e("navigator.onLine",navigator.onLine),e("navigator.javaEnabled",navigator.javaEnabled?navigator.javaEnabled():void 0),e("navigator.ActiveXSupported","undefined"!=typeof window.ActiveXObject),e("navigator.GeckoActiveXSupported","undefined"!=typeof GeckoActiveXObject),t},collectPlugins:function(){var e=[];if(navigator.plugins)for(var t=navigator.plugins.length,n=0;t>n;n++){var i=navigator.plugins[n];e.push({name:i.name,description:i.description,filename:i.filename})}return e},collectDateTime:function(){function e(e,t){try{t=String(t)}catch(i){t=JSON.stringify(t)}n[e]=t}var t=new Date,n={};return"object"==typeof t&&(e("dateTime",t.toString()),e("gmtTime","function"==typeof t.toGMTString?t.toGMTString():"")),n},collectMimeTypes:function(){if(navigator.mimeTypes){var e=[],t=navigator.mimeTypes.length;if(t)for(var n=0;t>n;n++){var i=navigator.mimeTypes[n];e.push({type:i.type,description:i.description,suffixes:i.suffixes})}return e}return[]},collectSystemInfo:function(){function e(e,n){try{n=String(n)}catch(i){n=JSON.stringify(n)}t[e]=n}var t={};return e("screen.width",screen.width),e("screen.height",screen.height),e("screen.availWidth",screen.availWidth),e("screen.availHeight",screen.availHeight),e("screen.colorDepth",screen.colorDepth),e("screen.deviceXDPI",screen.deviceXDPI),e("screen.deviceYDPI",screen.deviceYDPI),e("screen.logicalXDPI",screen.logicalXDPI),e("screen.logicalYDPI",screen.logicalYDPI),t}}}),define("userName",["jquery","events","profile","config"],function(e,t,n){function i(e){return""==e||"Введите имя"==e}function o(){var e=c.formContainer.find(c.nameInputSelector);return i(e.val())}function r(e){var t=c.formContainer.find(c.nameInputSelector);t.val(e)}function a(){var t=c.formContainer.find(c.nameInputSelector);if(c.api.control.commentForm.postMode===c.api.control.commentForm.POST_MODE_EDIT)e(".commentsvlru.marisa").size()||(c.formContainer.find(".userNameLabelWrapper").hide(),t.hide());else{var n=c.formContainer.find(".userNameLabelWrapper");if(t.length&&n.size()){var o=t.val();c.formContainer.find("div.readonly.user-info").remove(),i(o)?(t.show(),n.hide()):(t.hide(),n.show())}else t.length&&t.show()}}function s(){var e=c.formContainer.find(c.nameInputSelector);c.api.control.commentForm.postMode===c.api.control.commentForm.POST_MODE_EDIT?e.attr("readonly",!0):e.hasClass("disabled")||e.removeAttr("readonly")}function l(o){c.api=o,c.formContainer=e(o.control.commentForm.FormContainerSelector);var r=c.formContainer.find(".userNameLabelWrapper"),l=c.formContainer.find(c.nameInputSelector),u=function(){e(this).closest(".cmt-edit-comment").size()||(r.hide(),l.show().focus())};if(i(l.val())&&l.val(c.api.utils.getAnonPosterName()),"undefined"!=typeof l.attr("data-use-change-name-dialog")){var d=l.val();n.changeNameDialog(l,function(){return!0},function(){var e=c.formContainer.find(".userNameLabelWrapper span");l.val(d),e.size()&&e.text(d),r.length&&(r.show(),l.hide())})}if(t.on("profile.name.change",function(e){
l.val(e)}),!r.length)return void t.on("UiInitialize",s);if("text"==l.attr("type")){var m=c.formContainer.find(".userNameLabelWrapper span"),h=l.val();i(h)||m.text(h);var f=function(){var e=l.val();!i(e)&&r.size()&&(r.show(),l.hide(),h=e,c.formContainer.find(":input:visible").first().focus())},p=function(){l.val(h),r.size()&&m.text(h),!i(h)&&r.size()&&(r.show(),l.hide())};l.on("change keyup",function(){r.size()&&m.text(l.val())}),l.on("blur",f),l.on("keydown",function(e){13==e.keyCode?(e.stopPropagation(),e.preventDefault(),f()):27==e.keyCode&&(e.stopPropagation(),e.preventDefault(),p())}),r.size()&&r.on("click",u)}t.on("UiInitialize",a)}var c={api:null,formContainer:null,nameInputSelector:"input#login"};return{init:l,isEmptyDisplayName:o,setDisplayName:r}}),define("supercookie",["core","jquery"],function(core,$){function getContainer(){return $("#"+module.flashContainerId)}function setTransportCookie(e,t){core.setCookie(e,t,100,"/")}function clearTransportCookie(e){core.setCookie(e,"",-100,"/")}function readMagicValue(e,t,n){clearTransportCookie("supercookie_"+e);var i=core.getRightUrl("/apples/"+e+".php?name="+t);$.ajax(core.isCrossDomain(i)?{url:i,dataType:"jsonp",jsonp:!1,cache:!0,jsonpCallback:"sccallback_"+e,success:n}:{url:i,contents:{script:/json/},success:function(t){"undefined"!=typeof t?(t=String(t).replace(new RegExp("sccallback_"+e+'\\("(.*)"\\);'),"$1"),n(t)):n("")}})}function saveMagicValue(e,t,n){var i=core.getRightUrl("/apples/"+e+".php?name="+t);if(core.isCrossDomain(i))var o=$("<iframe>").hide().load(function(){core.defer(function(){o.remove()},1e3)}).attr("src",core.getRightUrl("/apples/apple.html")+"?name="+t+"&value="+n+"&apple="+e).appendTo("body");else setTransportCookie("supercookie_"+e,n),$(new Image).css({visibility:"hidden",position:"absolute"}).load(function(){clearTransportCookie("supercookie_"+e)}).attr("src",i)}function findBestCandidate(e){var t,n,i=[],o=0;for(n in e)"undefined"!=typeof e[n]&&"null"!=typeof e[n]&&""!=e[n]&&"null"!=e[n]&&"undefined"!=e[n]&&null!=e[n]&&checkPastafarian(e[n])&&(i[e[n]]="undefined"==typeof i[e[n]]?1:i[e[n]]+1);for(n in i)i[n]>o&&(o=i[n],t=n);return t}function getImmediateValues(e){return{userData:storeUserDataGet(e),cookieData:storeCookieGet(e),localData:storeLocalStorageGet(e),globalData:storeGlobalStorageGet(e),sessionData:storeSessionStorageGet(e),windowData:storeWindowGet(e)}}function getDelayedValues(e,t){function n(){for(var e in o)if("undefined"==typeof o[e])return!1;return!0}function i(){n()?t(o):(r++,delayedReadCount>=r?core.defer(i,delayedReadTimeout):t(o))}var o={cacheData:void 0,etagData:void 0};canUseFlash&&(o.flashData=void 0,storeFlashGet(e,function(e){o.flashData=e})),canUsePng&&(o.pngData=void 0,storePngGet(e,function(e){o.pngData=e})),storeCacheGet(e,function(e){o.cacheData=e}),storeEtagGet(e,function(e){o.etagData=e});var r=0;i()}function saveValues(e,t){storeUserDataSet(e,t),storeCookieSet(e,t),storeLocalStorageSet(e,t),storeGlobalStorageSet(e,t),storeSessionStorageSet(e,t),storeWindowSet(e,t),canUseFlash&&storeFlashSet(e,t),canUsePng&&storePngSet(e,t),storeCacheSet(e,t),storeEtagSet(e,t)}function updateValues(e,t,n){n.userData!==t&&storeUserDataSet(e,t),n.cookieData!==t&&storeCookieSet(e,t),n.localData!==t&&storeLocalStorageSet(e,t),n.globalData!==t&&storeGlobalStorageSet(e,t),n.sessionData!==t&&storeSessionStorageSet(e,t),n.windowData!==t&&storeWindowSet(e,t),canUseFlash&&n.flashData!==t&&storeFlashSet(e,t),canUsePng&&n.pngData!==t&&storePngSet(e,t),n.cacheData!==t&&storeCacheSet(e,t),n.etagData!==t&&storeEtagSet(e,t)}function getHost(){var e=document.location.host;return 0==e.indexOf("www.")&&(e=e.replace("www.","")),e}function createElem(e,t,n){var i;return i="undefined"!=typeof t&&document.getElementById(t)?document.getElementById(t):document.createElement(e),i.style.visibility="hidden",i.style.position="absolute",t&&i.setAttribute("id",t),n&&document.body.appendChild(i),i}function getFromStr(e,t){if("string"==typeof t){for(var n=e+"=",i=t.split(/[;&]/),o=0;o<i.length;o++){for(var r=i[o];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(n))return r.substring(n.length,r.length)}return""}}function _ec_replace(e,t,n){if(e.indexOf("&"+t+"=")>-1||0==e.indexOf(t+"=")){var i=e.indexOf("&"+t+"=");-1==i&&(i=e.indexOf(t+"="));var o,r=e.indexOf("&",i+1);return o=-1!=r?e.substr(0,i)+e.substr(r+(i?0:1))+"&"+t+"="+n:e.substr(0,i)+"&"+t+"="+n}return e+"&"+t+"="+n}function storeWindowGet(e){try{return getFromStr(e,window[e])}catch(t){}}function storeWindowSet(e,t){try{window[e]=_ec_replace(window[e],e,t)}catch(n){}}function storeUserDataGet(e){try{var t=createElem("div","userdata_el",1);return t.style.behavior="url(#default#userData)",t.load(e),t.getAttribute(e)}catch(n){}}function storeUserDataSet(e,t){try{var n=createElem("div","userdata_el",1);n.style.behavior="url(#default#userData)",n.setAttribute(e,t),n.save(e)}catch(i){}}function storeLocalStorageGet(e){try{if(window.localStorage)return localStorage.getItem(e)}catch(t){}}function storeLocalStorageSet(e,t){try{window.localStorage&&localStorage.setItem(e,t)}catch(n){}}function storeSessionStorageGet(e){try{if(window.sessionStorage)return sessionStorage.getItem(e)}catch(t){}}function storeSessionStorageSet(e,t){try{window.sessionStorage&&sessionStorage.setItem(e,t)}catch(n){}}function storeGlobalStorageGet(name){try{if(window.globalStorage){var host=getHost();return eval("globalStorage[host]."+name)}}catch(e){}}function storeGlobalStorageSet(name,value){try{if(window.globalStorage){var host=getHost();eval("globalStorage[host]."+name+" = value")}}catch(e){}}function storeCookieGet(e){return core.getCookie(e)}function storeCookieSet(e,t){core.setCookie(e,"",-100,"/"),core.setCookie(e,t,7300,"/")}function storeCacheGet(e,t){readMagicValue("cache",e,t)}function storeCacheSet(e,t){saveMagicValue("cache",e,t)}function storeEtagGet(e,t){readMagicValue("etag",e,t)}function storeEtagSet(e,t){saveMagicValue("etag",e,t)}function storeFlashGet(e,t){function n(){var o=getContainer();if(o.size()){var r=document.getElementById("bananaobj");try{var a=r.getCookieData();return void t(getFromStr(e,a))}catch(s){}}i++,delayedReadCount>i&&core.defer(n,delayedReadTimeout)}if(canUseFlash){var i=0;n()}}function storeFlashSet(e,t){if(canUseFlash){var n=getContainer();if(n.size()){var i=document.getElementById("bananaobj");try{i.setCookieData(e+"="+t)}catch(o){}}}}function storePngGet(e,t){if(canUsePng){var n=core.getRightUrl("/apples/png.php?name="+e),i=document.createElement("canvas");i.style.visibility="hidden",i.style.position="absolute",i.width=200,i.height=1;var o=i.getContext("2d");clearTransportCookie("supercookie_png");var r=new Image;$(r).css({visibility:"hidden",position:"absolute"}).attr("crossOrigin","anonymous").load(function(){var e="";o.drawImage(r,0,0);for(var n=o.getImageData(0,0,200,1),i=n.data,a=0,s=i.length;s>a&&0!=i[a]&&(e+=String.fromCharCode(i[a]),0!=i[a+1])&&(e+=String.fromCharCode(i[a+1]),0!=i[a+2]);a+=4)e+=String.fromCharCode(i[a+2]);t(e)}).attr("src",n)}}function storePngSet(e,t){canUsePng&&saveMagicValue("png",e,t)}function checkPastafarian(e){return!!e.match(/^[A-Za-z0-9]{0,64}$/i)}var canUsePng,canUseFlash,delayedReadCount=10,delayedReadTimeout=300,module={flashContainerId:"banana-container",getDelayed:function(e,t,n){function i(i){var o=$.extend(i,getImmediateValues(e)),r=findBestCandidate(o);updateValues(e,r,o),t.call(n||window,r)}getDelayedValues(e,i)},getImmediate:function(e){var t=getImmediateValues(e);return findBestCandidate(t)},set:function(e,t){saveValues(e,t)},init:function(){var e=this;canUsePng="undefined"!=typeof document.createElement("canvas").getContext,canUseFlash=$.flash.available&&!/Firefox\/\d/.test(navigator.userAgent),canUseFlash&&$(function(){var t=getContainer();0==t.size()&&(t=$("<div>").attr("id",e.flashContainerId),t.appendTo($("body")),t.flash({swf:core.getRightUrl("/swf/banana.swf"),id:"bananaobj",name:"bananaobj",allowScriptAccess:"always",wmode:"transparent",width:1,height:1}))})}};return module}),define("logger",["core","console"],function(e,t){return{log:function(n,i,o,r){var a=e.getRightUrl("/ajax/internallog"),s={group:n,action:i,description:o};"undefined"!=typeof r&&null!=r&&(s.pseudoCommentId=r),e.jsonRequest({url:a,method:"POST",data:s,scope:this,logFunc:t.log,failureCallback:function(e){t.log(e)}})}}}),define("timings",["jquery","core","config","events","logger","formTypeDetect","mobileDetect","browserDetect"],function(e,t,n,i,o,r,a,s){return{commentForm:null,logTimer:null,logCounter:0,logMaxCount:3,pseudoCommentId:null,textField:null,printCommentsHandlerObj:null,clearCommentsHandlerObj:null,threadInfo:"",waitingTime:3e4,commentStarted:!1,ieFirstLoad:!0,init:function(t){this.commentForm=t,this.threadInfo=n.threadId?"Client:\nThreadId: "+n.threadId:"Client:\nThreadType: "+n.threadName.type+"\nThreadName: "+n.threadName.name,this.textField=this.commentForm.FormContainer.find("textarea"),this.printCommentsHandlerObj=e.proxy(this.printCommentsHandler,this),this.clearCommentsHandlerObj=e.proxy(this.clearCommentsHandler,this);var o="keypress paste input";a.any&&(o+=" propertychange"),this.textField.off(o,this.printCommentsHandlerObj).on(o,this.printCommentsHandlerObj),i.on("ImageAdd",this.printCommentsHandlerObj),i.on("BeforeCommentAddRender",this.clearCommentsHandlerObj),this.clearTiming()},log:function(e,t){t=this.threadInfo+"\nFormType: "+r.detectFormType()+"\n"+t,o.log("comments",e,t,this.pseudoCommentId)},printCommentsHandler:function(e){var t=s.getInfo();if(!this.commentStarted&&this.commentForm.postMode!==this.commentForm.POST_MODE_EDIT){if("msie"===t.name&&"input"===e.type&&this.ieFirstLoad)return void(this.ieFirstLoad=!1);this.commentStarted=!0,this.pseudoCommentId=(new Date).getTime()+"-"+Math.random(),this.log("add-comment-start","");var n=this;this.logTimer=setInterval(function(){n.logCounter<n.logMaxCount?(n.log("add-comment-waiting",n.textField.val()),n.logCounter++):n.clearTiming()},n.waitingTime)}},clearCommentsHandler:function(){return this.clearTiming(),this.commentStarted=!1,this.logTimer=null,this.logCounter=0,!0},clearTiming:function(){null!==this.logTimer&&(clearInterval(this.logTimer),this.logTimer=!1)},getPseudoCommentId:function(){return this.pseudoCommentId}}}),define("deletedComments",["jquery"],function(e){var t=null,n=".commentsvlru #moderatorMode",i=null;return{init:function(o){i=o,t=e.proxy(this.showDeletedCommentsHandler,this),e(n).off("change",t).on("change",t)},showDeletedCommentsHandler:function(){if(i.config.embedded)i.embeddedControl.reloadThread(this.isChecked());else{var e=document.location.href,t=e.indexOf("#");-1!=t&&(e=e.substring(0,t)),this.isChecked()?e=e.replace("moderatorMode=0",""):(-1==e.indexOf("?")?e+="?":"&"!=e.slice(-1)&&"?"!=e.slice(-1)&&(e+="&"),e+="moderatorMode=0"),document.location=e}},isChecked:function(){return e(n).is(":checked")}}}),define("history",["jquery","console"],function(e,t){var n={},i=e;return function(e,t){"use strict";if("undefined"!=typeof n.Adapter)throw new Error("History.js Adapter has already been loaded...");n.Adapter={bind:function(e,t,n){i(e).bind(t,n)},trigger:function(e,t,n){i(e).trigger(t,n)},extractEventData:function(e,n,i){var o=n&&n.originalEvent&&n.originalEvent[e]||i&&i[e]||t;return o},onDomLoad:function(e){i(e)}},"undefined"!=typeof n.init&&n.init()}(window),function(e,i){"use strict";var o=e.document,r=e.navigator,a=!1,s=e.setTimeout,l=e.clearTimeout,c=e.setInterval,u=e.clearInterval,d={},m=e.alert,h=e.history;try{a=e.sessionStorage,a.setItem("TEST","1"),a.removeItem("TEST")}catch(f){a=!1}if(d.stringify=e.JSON.stringify||e.JSON.encode,d.parse=e.JSON.parse||e.JSON.decode,"undefined"!=typeof n.init)throw new Error("History.js Core has already been loaded...");n.init=function(){return"undefined"==typeof n.Adapter?!1:("undefined"!=typeof n.initCore&&n.initCore(),"undefined"!=typeof n.initHtml4&&n.initHtml4(),!0)},n.initCore=function(){if("undefined"!=typeof n.initCore.initialized)return!1;if(n.initCore.initialized=!0,n.options=n.options||{},n.options.hashChangeInterval=n.options.hashChangeInterval||100,n.options.safariPollInterval=n.options.safariPollInterval||500,n.options.doubleCheckInterval=n.options.doubleCheckInterval||500,n.options.disableSuid=n.options.disableSuid||!1,n.options.storeInterval=n.options.storeInterval||1e3,n.options.busyDelay=n.options.busyDelay||250,n.options.debug=n.options.debug||!1,n.options.initialTitle=n.options.initialTitle||o.title,n.options.html4Mode=n.options.html4Mode||!1,n.options.delayInit=n.options.delayInit||!1,n.intervalList=[],n.clearAllIntervals=function(){var e,t=n.intervalList;if("undefined"!=typeof t&&null!==t){for(e=0;e<t.length;e++)u(t[e]);n.intervalList=null}},n.debug=function(){n.options.debug&&n.log.apply(n,arguments)},n.log=function(){var e,n,i,r,a,s=!("undefined"==typeof t||"undefined"==typeof t.log||"undefined"==typeof t.log.apply),l=o.getElementById("log");for(s?(r=Array.prototype.slice.call(arguments),e=r.shift(),"undefined"!=typeof t.debug?t.debug.apply(t,[e,r]):t.log.apply(t,[e,r])):e="\n"+arguments[0]+"\n",n=1,i=arguments.length;i>n;++n){if(a=arguments[n],"object"==typeof a&&"undefined"!=typeof d)try{a=d.stringify(a)}catch(c){}e+="\n"+a+"\n"}return l?(l.value+=e+"\n-----\n",l.scrollTop=l.scrollHeight-l.clientHeight):s||m(e),!0},n.getInternetExplorerMajorVersion=function(){var e=n.getInternetExplorerMajorVersion.cached="undefined"!=typeof n.getInternetExplorerMajorVersion.cached?n.getInternetExplorerMajorVersion.cached:function(){for(var e=3,t=o.createElement("div"),n=t.getElementsByTagName("i");(t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->")&&n[0];);return e>4?e:!1}();return e},n.isInternetExplorer=function(){var e=n.isInternetExplorer.cached="undefined"!=typeof n.isInternetExplorer.cached?n.isInternetExplorer.cached:Boolean(n.getInternetExplorerMajorVersion());return e},n.emulated=n.options.html4Mode?{pushState:!0,hashChange:!0}:{pushState:!Boolean(e.history&&e.history.pushState&&e.history.replaceState&&!(/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(r.userAgent)||/AppleWebKit\/5([0-2]|3[0-2])/i.test(r.userAgent))),hashChange:Boolean(!("onhashchange"in e||"onhashchange"in o)||n.isInternetExplorer()&&n.getInternetExplorerMajorVersion()<8)},n.enabled=!n.emulated.pushState,n.bugs={setHash:Boolean(!n.emulated.pushState&&"Apple Computer, Inc."===r.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(r.userAgent)),safariPoll:Boolean(!n.emulated.pushState&&"Apple Computer, Inc."===r.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(r.userAgent)),ieDoubleCheck:Boolean(n.isInternetExplorer()&&n.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(n.isInternetExplorer()&&n.getInternetExplorerMajorVersion()<7)},n.isEmptyObject=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},n.cloneObject=function(e){var t,n;return e?(t=d.stringify(e),n=d.parse(t)):n={},n},n.getRootUrl=function(){var e=o.location.protocol+"//"+(o.location.hostname||o.location.host);return o.location.port&&(e+=":"+o.location.port),e+="/"},n.getBaseHref=function(){var e=o.getElementsByTagName("base"),t=null,n="";return 1===e.length&&(t=e[0],n=t.href.replace(/[^\/]+$/,"")),n=n.replace(/\/+$/,""),n&&(n+="/"),n},n.getBaseUrl=function(){var e=n.getBaseHref()||n.getBasePageUrl()||n.getRootUrl();return e},n.getPageUrl=function(){var e,t=n.getState(!1,!1),i=(t||{}).url||n.getLocationHref();return e=i.replace(/\/+$/,"").replace(/[^\/]+$/,function(e){return/\./.test(e)?e:e+"/"})},n.getBasePageUrl=function(){var e=n.getLocationHref().replace(/[#\?].*/,"").replace(/[^\/]+$/,function(e){return/[^\/]$/.test(e)?"":e}).replace(/\/+$/,"")+"/";return e},n.getFullUrl=function(e,t){var i=e,o=e.substring(0,1);return t="undefined"==typeof t?!0:t,/[a-z]+\:\/\//.test(e)||(i="/"===o?n.getRootUrl()+e.replace(/^\/+/,""):"#"===o?n.getPageUrl().replace(/#.*/,"")+e:"?"===o?n.getPageUrl().replace(/[\?#].*/,"")+e:t?n.getBaseUrl()+e.replace(/^(\.\/)+/,""):n.getBasePageUrl()+e.replace(/^(\.\/)+/,"")),i.replace(/\#$/,"")},n.getShortUrl=function(e){var t=e,i=n.getBaseUrl(),o=n.getRootUrl();return n.emulated.pushState&&(t=t.replace(i,"")),t=t.replace(o,"/"),n.isTraditionalAnchor(t)&&(t="./"+t),t=t.replace(/^(\.\/)+/g,"./").replace(/\#$/,"")},n.getLocationHref=function(e){return e=e||o,e.URL===e.location.href?e.location.href:e.location.href===decodeURIComponent(e.URL)?e.URL:e.location.hash&&decodeURIComponent(e.location.href.replace(/^[^#]+/,""))===e.location.hash?e.location.href:-1==e.URL.indexOf("#")&&-1!=e.location.href.indexOf("#")?e.location.href:e.URL||e.location.href},n.store={},n.idToState=n.idToState||{},n.stateToId=n.stateToId||{},n.urlToId=n.urlToId||{},n.storedStates=n.storedStates||[],n.savedStates=n.savedStates||[],n.normalizeStore=function(){n.store.idToState=n.store.idToState||{},n.store.urlToId=n.store.urlToId||{},n.store.stateToId=n.store.stateToId||{}},n.getState=function(e,t){"undefined"==typeof e&&(e=!0),"undefined"==typeof t&&(t=!0);var i=n.getLastSavedState();return!i&&t&&(i=n.createStateObject()),e&&(i=n.cloneObject(i),i.url=i.cleanUrl||i.url),i},n.getIdByState=function(e){var t,i=n.extractId(e.url);if(!i)if(t=n.getStateString(e),"undefined"!=typeof n.stateToId[t])i=n.stateToId[t];else if("undefined"!=typeof n.store.stateToId[t])i=n.store.stateToId[t];else{for(;;)if(i=(new Date).getTime()+String(Math.random()).replace(/\D/g,""),"undefined"==typeof n.idToState[i]&&"undefined"==typeof n.store.idToState[i])break;n.stateToId[t]=i,n.idToState[i]=e}return i},n.normalizeState=function(e){var t,i;return e&&"object"==typeof e||(e={}),"undefined"!=typeof e.normalized?e:(e.data&&"object"==typeof e.data||(e.data={}),t={},t.normalized=!0,t.title=e.title||"",t.url=n.getFullUrl(e.url?e.url:n.getLocationHref()),t.hash=n.getShortUrl(t.url),t.data=n.cloneObject(e.data),t.id=n.getIdByState(t),t.cleanUrl=t.url.replace(/\??\&_suid.*/,""),t.url=t.cleanUrl,i=!n.isEmptyObject(t.data),(t.title||i)&&n.options.disableSuid!==!0&&(t.hash=n.getShortUrl(t.url).replace(/\??\&_suid.*/,""),/\?/.test(t.hash)||(t.hash+="?"),t.hash+="&_suid="+t.id),t.hashedUrl=n.getFullUrl(t.hash),(n.emulated.pushState||n.bugs.safariPoll)&&n.hasUrlDuplicate(t)&&(t.url=t.hashedUrl),t)},n.createStateObject=function(e,t,i){var o={data:e,title:t,url:i};return o=n.normalizeState(o)},n.getStateById=function(e){e=String(e);var t=n.idToState[e]||n.store.idToState[e]||i;return t},n.getStateString=function(e){var t,i,o;return t=n.normalizeState(e),i={data:t.data,title:e.title,url:e.url},o=d.stringify(i)},n.getStateId=function(e){var t,i;return t=n.normalizeState(e),i=t.id},n.getHashByState=function(e){var t,i;return t=n.normalizeState(e),i=t.hash},n.extractId=function(e){var t,n,i,o;return o=-1!=e.indexOf("#")?e.split("#")[0]:e,n=/(.*)\&_suid=([0-9]+)$/.exec(o),i=n?n[1]||e:e,t=n?String(n[2]||""):"",t||!1},n.isTraditionalAnchor=function(e){var t=!/[\/\?\.]/.test(e);return t},n.extractState=function(e,t){var i,o,r=null;return t=t||!1,i=n.extractId(e),i&&(r=n.getStateById(i)),r||(o=n.getFullUrl(e),i=n.getIdByUrl(o)||!1,i&&(r=n.getStateById(i)),r||!t||n.isTraditionalAnchor(e)||(r=n.createStateObject(null,null,o))),r},n.getIdByUrl=function(e){var t=n.urlToId[e]||n.store.urlToId[e]||i;return t},n.getLastSavedState=function(){return n.savedStates[n.savedStates.length-1]||i},n.getLastStoredState=function(){return n.storedStates[n.storedStates.length-1]||i},n.hasUrlDuplicate=function(e){var t,i=!1;return t=n.extractState(e.url),i=t&&t.id!==e.id},n.storeState=function(e){return n.urlToId[e.url]=e.id,n.storedStates.push(n.cloneObject(e)),e},n.isLastSavedState=function(e){var t,i,o,r=!1;return n.savedStates.length&&(t=e.id,i=n.getLastSavedState(),o=i.id,r=t===o),r},n.saveState=function(e){return n.isLastSavedState(e)?!1:(n.savedStates.push(n.cloneObject(e)),!0)},n.getStateByIndex=function(e){var t=null;return t="undefined"==typeof e?n.savedStates[n.savedStates.length-1]:0>e?n.savedStates[n.savedStates.length+e]:n.savedStates[e]},n.getCurrentIndex=function(){var e=null;return e=n.savedStates.length<1?0:n.savedStates.length-1},n.getHash=function(e){var t,i=n.getLocationHref(e);return t=n.getHashByUrl(i)},n.unescapeHash=function(e){var t=n.normalizeHash(e);return t=decodeURIComponent(t)},n.normalizeHash=function(e){var t=e.replace(/[^#]*#/,"").replace(/#.*/,"");return t},n.setHash=function(e,t){var i,r;return t!==!1&&n.busy()?(n.pushQueue({scope:n,callback:n.setHash,args:arguments,queue:t}),!1):(n.busy(!0),i=n.extractState(e,!0),i&&!n.emulated.pushState?n.pushState(i.data,i.title,i.url,!1):n.getHash()!==e&&(n.bugs.setHash?(r=n.getPageUrl(),n.pushState(null,null,r+"#"+e,!1)):o.location.hash=e),n)},n.escapeHash=function(t){var i=n.normalizeHash(t);return i=e.encodeURIComponent(i),n.bugs.hashEscape||(i=i.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")),i},n.getHashByUrl=function(e){var t=String(e).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");return t=n.unescapeHash(t)},n.setTitle=function(e){var t,i=e.title;i||(t=n.getStateByIndex(0),t&&t.url===e.url&&(i=t.title||n.options.initialTitle));try{o.getElementsByTagName("title")[0].innerHTML=i.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(r){}return o.title=i,n},n.queues=[],n.busy=function(e){if("undefined"!=typeof e?n.busy.flag=e:"undefined"==typeof n.busy.flag&&(n.busy.flag=!1),!n.busy.flag){l(n.busy.timeout);var t=function(){var e,i,o;if(!n.busy.flag)for(e=n.queues.length-1;e>=0;--e)i=n.queues[e],0!==i.length&&(o=i.shift(),n.fireQueueItem(o),n.busy.timeout=s(t,n.options.busyDelay))};n.busy.timeout=s(t,n.options.busyDelay)}return n.busy.flag},n.busy.flag=!1,n.fireQueueItem=function(e){return e.callback.apply(e.scope||n,e.args||[])},n.pushQueue=function(e){return n.queues[e.queue||0]=n.queues[e.queue||0]||[],n.queues[e.queue||0].push(e),n},n.queue=function(e,t){return"function"==typeof e&&(e={callback:e}),"undefined"!=typeof t&&(e.queue=t),n.busy()?n.pushQueue(e):n.fireQueueItem(e),n},n.clearQueue=function(){return n.busy.flag=!1,n.queues=[],n},n.stateChanged=!1,n.doubleChecker=!1,n.doubleCheckComplete=function(){return n.stateChanged=!0,n.doubleCheckClear(),n},n.doubleCheckClear=function(){return n.doubleChecker&&(l(n.doubleChecker),n.doubleChecker=!1),n},n.doubleCheck=function(e){return n.stateChanged=!1,n.doubleCheckClear(),n.bugs.ieDoubleCheck&&(n.doubleChecker=s(function(){return n.doubleCheckClear(),n.stateChanged||e(),!0},n.options.doubleCheckInterval)),n},n.safariStatePoll=function(){var t,i=n.extractState(n.getLocationHref());if(!n.isLastSavedState(i))return t=i,t||(t=n.createStateObject()),n.Adapter.trigger(e,"popstate"),n},n.back=function(e){return e!==!1&&n.busy()?(n.pushQueue({scope:n,callback:n.back,args:arguments,queue:e}),!1):(n.busy(!0),n.doubleCheck(function(){n.back(!1)}),h.go(-1),!0)},n.forward=function(e){return e!==!1&&n.busy()?(n.pushQueue({scope:n,callback:n.forward,args:arguments,queue:e}),!1):(n.busy(!0),n.doubleCheck(function(){n.forward(!1)}),h.go(1),!0)},n.go=function(e,t){var i;if(e>0)for(i=1;e>=i;++i)n.forward(t);else{if(!(0>e))throw new Error("History.go: History.go requires a positive or negative integer passed.");for(i=-1;i>=e;--i)n.back(t)}return n},n.emulated.pushState){var f=function(){};n.pushState=n.pushState||f,n.replaceState=n.replaceState||f}else n.onPopState=function(t,i){var o,r,a=!1,s=!1;return n.doubleCheckComplete(),(o=n.getHash())?(r=n.extractState(o||n.getLocationHref(),!0),r?n.replaceState(r.data,r.title,r.url,!1):(n.Adapter.trigger(e,"anchorchange"),n.busy(!1)),n.expectedStateId=!1,!1):(a=n.Adapter.extractEventData("state",t,i)||!1,s=a?n.getStateById(a):n.expectedStateId?n.getStateById(n.expectedStateId):n.extractState(n.getLocationHref()),s||(s=n.createStateObject(null,null,n.getLocationHref())),n.expectedStateId=!1,n.isLastSavedState(s)?(n.busy(!1),!1):(n.storeState(s),n.saveState(s),n.setTitle(s),n.Adapter.trigger(e,"statechange"),n.busy(!1),!0))},n.Adapter.bind(e,"popstate",n.onPopState),n.pushState=function(t,i,o,r){if(n.getHashByUrl(o)&&n.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(r!==!1&&n.busy())return n.pushQueue({scope:n,callback:n.pushState,args:arguments,queue:r}),!1;n.busy(!0);var a=n.createStateObject(t,i,o);return n.isLastSavedState(a)?n.busy(!1):(n.storeState(a),n.expectedStateId=a.id,h.pushState(a.id,a.title,a.url),n.Adapter.trigger(e,"popstate")),!0},n.replaceState=function(t,i,o,r){if(n.getHashByUrl(o)&&n.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(r!==!1&&n.busy())return n.pushQueue({scope:n,callback:n.replaceState,args:arguments,queue:r}),!1;n.busy(!0);var a=n.createStateObject(t,i,o);return n.isLastSavedState(a)?n.busy(!1):(n.storeState(a),n.expectedStateId=a.id,h.replaceState(a.id,a.title,a.url),n.Adapter.trigger(e,"popstate")),!0};if(a){try{n.store=d.parse(a.getItem("History.store"))||{}}catch(p){n.store={}}n.normalizeStore()}else n.store={},n.normalizeStore();n.Adapter.bind(e,"unload",n.clearAllIntervals),n.saveState(n.storeState(n.extractState(n.getLocationHref(),!0))),a&&(n.onUnload=function(){var e,t,i;try{e=d.parse(a.getItem("History.store"))||{}}catch(o){e={}}e.idToState=e.idToState||{},e.urlToId=e.urlToId||{},e.stateToId=e.stateToId||{};for(t in n.idToState)n.idToState.hasOwnProperty(t)&&(e.idToState[t]=n.idToState[t]);for(t in n.urlToId)n.urlToId.hasOwnProperty(t)&&(e.urlToId[t]=n.urlToId[t]);for(t in n.stateToId)n.stateToId.hasOwnProperty(t)&&(e.stateToId[t]=n.stateToId[t]);n.store=e,n.normalizeStore(),i=d.stringify(e);try{a.setItem("History.store",i)}catch(r){if(r.code!==DOMException.QUOTA_EXCEEDED_ERR)throw r;a.length&&(a.removeItem("History.store"),a.setItem("History.store",i))}},n.intervalList.push(c(n.onUnload,n.options.storeInterval)),n.Adapter.bind(e,"beforeunload",n.onUnload),n.Adapter.bind(e,"unload",n.onUnload)),n.emulated.pushState||(n.bugs.safariPoll&&n.intervalList.push(c(n.safariStatePoll,n.options.safariPollInterval)),("Apple Computer, Inc."===r.vendor||"Mozilla"===(r.appCodeName||""))&&(n.Adapter.bind(e,"hashchange",function(){n.Adapter.trigger(e,"popstate")}),n.getHash()&&n.Adapter.onDomLoad(function(){n.Adapter.trigger(e,"hashchange")})))},n.options&&n.options.delayInit||n.init()}(window),{getHistory:function(){return n}}}),define("mobileLightbox",["jquery","core","history"],function(e,t,n){function i(){s();var n="touchstart click",i="";t.detectMobile()&&(i=" touchend"),e("body").off(n+i,".commentsvlru a[rel^=lightbox]",l).on(n+i,".commentsvlru a[rel^=lightbox]",l).off(n,".cmt-lightbox-close",o).on(n,".cmt-lightbox-close",o).off(n+i,".cmt-lightbox-image-overlay",a).on(n+i,".cmt-lightbox-image-overlay",a),(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i))&&e("body").off("touchmove",".cmt-lightbox-image-overlay",r).on("touchmove",".cmt-lightbox-image-overlay",r),e(window).on("orientationchange resize",function(e){e.preventDefault(),e.stopPropagation(),p()})}function o(t){t.preventDefault(),t.stopPropagation(),e("body").removeClass("cmt-mobile-lightbox-body"),e(v).hide(),C||(C=0),g=null,e(window).trigger("resize"),e(window).scrollTop(C),"undefined"!=typeof window.$&&null!=window.$&&window.$(window).trigger("resize")}function r(e){e.preventDefault(),e.stopPropagation()}function a(n){n.preventDefault(),n.stopPropagation();var i=null;if("touchstart"==n.type){if(n.originalEvent.touches.length>1)return;return void(b=n.originalEvent.touches[0].pageX)}if("touchend"==n.type){if(n.originalEvent.changedTouches.length>1)return;i=n.originalEvent.changedTouches[0].pageX}else"click"==n.type&&(i=n.pageX);if(!(b&&i&&!c(b,i)||t.detectMobile()&&"click"==n.type)){b=null;var o=e(n.target),r=null,a=g.parent();o.width()/2>i?a.is(":first-child")||(r=a.prev().find("a")):a.is(":last-child")||(r=a.next().find("a")),r&&d(r)}}function s(){var t='<div class="cmt-mobile-lightbox-overlay"><div class="cmt-mobile-lightbox"><div class="cmt-lightbox-header"><div class="cmt-lightbox-counter"><span class="cmt-lightbox-index"></span><span>/</span><span class="cmt-lightbox-amount"></span></div><div class="cmt-lightbox-close"></div></div><div class="cmt-lightbox-container"><div class="cmt-lightbox-image"><span class="cmt-helper"></span><img /></div><div class="cmt-lightbox-image-prev"></div><div class="cmt-lightbox-image-next"></div><div class="cmt-lightbox-image-overlay"></div></div></div></div>',n=e(e.parseHTML(t));e(v).remove(),e(".cmt-mobile-lightbox").remove(),n.appendTo("body"),e(v).hide()}function l(t){C=e(window).scrollTop();var n=null;return"touchstart"==t.type?void(b=t.originalEvent.touches[0].pageX):("touchend"==t.type?n=t.originalEvent.changedTouches[0].pageX:"click"==t.type&&(n=b=t.pageX),null!=b&&null!=n&&c(b,n)?(b=null,t.preventDefault(),t.stopPropagation(),u(),y.pushState(null,"Lightbox open","?lightbox=1"),e(v).css("display","block"),e("body").addClass("cmt-mobile-lightbox-body"),d(e(t.target)),void f()):(t.preventDefault(),void t.stopPropagation()))}function c(e,t){return Math.abs(e-t)<4}function u(){e("*").blur()}function d(t){g=t;var n=t.parent("div"),i=n.closest(".comment-images").find(".item").length,o=n.closest(".comment-images").find(".item").index(n);o++,e(".cmt-lightbox-image-prev, .cmt-lightbox-image-next").show(),1==o&&e(".cmt-lightbox-image-prev").hide(),o==i&&e(".cmt-lightbox-image-next").hide(),e(".cmt-lightbox-index").text(o),e(".cmt-lightbox-amount").text(i),e(".cmt-lightbox-image img").removeAttr("src").hide(),m();var r=new Image;r.onload=p,r.src=t.attr("href")}function m(){e(".cmt-lightbox-image").addClass("cmt-lightbox-throbber")}function h(){e(".cmt-lightbox-image").removeClass("cmt-lightbox-throbber")}function f(){var t=e(".cmt-lightbox-container"),n=e(window).height()-e(".cmt-lightbox-header").height()-20;return t.height(n),t}function p(){if(g){var t=e(".cmt-lightbox-image img"),n=f();t.css("max-height",n.height()),t.css("max-width",n.width()),t.attr("src",g.attr("href")),h(),t.show()}}var g,v=".cmt-mobile-lightbox-overlay",b=null,y=n.getHistory(),C=null;return y.Adapter.bind(window,"statechange",function(e){var t=y.getState();"Lightbox open"!=t.title&&o(e)}),{init:i}}),define("mobileCommentMenu",["console","config","events","complaint","subscribeActions"],function(e,t,n,i,o){"use strict";var r={api:null,control:null,actionSelector:".comment-menu",popup:null};return r.onCopyLink=function(e){if(!$(e.target).hasClass("comment-menu-popup")&&(r.hidePopup(),t.embedded)){e.preventDefault(),e.stopPropagation();var n=$(e.target).closest(".action.copy-link").attr("data-comment-id");window.location.hash="#p"+n,r.api.features.scrollTo.scroll(n)}},r.onSubscribeToCommentClick=function(e){return $(e.target).hasClass("comment-menu-popup")?void 0:(e.preventDefault(),e.stopPropagation(),r.hidePopup(),o.actionHandlerObj(e),!1)},r.onComplaintClick=function(e){if(!$(e.target).hasClass("comment-menu-popup")){e.preventDefault(),e.stopPropagation(),r.hidePopup();var t=$(e.target).closest(".action.cmt-complaint-create"),n=t.closest('.comment[type="container"]'),o=n.innerWidth()-270,a=-t.offset().top+parseInt(n.css("padding-top"));i.doLinkClick(t,n,o,a)}},r.hidePopup=function(){r.popup&&($("body").off("touchstart.cmt-comment-menu-popup click.cmt-comment-menu-popup"),r.popup.addClass("cmt-hidden").hide(),r.popup=null)},r.onMenuClick=function(e){e.preventDefault(),e.stopPropagation();var t=$(e.target);if(r.hidePopup(),r.popup=t.find(".comment-menu-popup:first"),$("body").off("touchstart.cmt-comment-menu-popup click.cmt-comment-menu-popup").on("touchstart.cmt-comment-menu-popup click.cmt-comment-menu-popup",function(e){$(e.target).hasClass("comment-menu-popup")||(e.preventDefault(),e.stopPropagation(),r.hidePopup())}),!r.popup.data("events-binded")){r.popup.data("events-binded",1);var n;n=r.popup.find(".action.subscription").get(0),n&&new FastButton(n,r.onSubscribeToCommentClick),n=r.popup.find(".action.copy-link").get(0),n&&new FastButton(n,r.onCopyLink),n=r.popup.find(".action.cmt-complaint-create").get(0),n&&new FastButton(n,r.onComplaintClick);

}return r.popup.removeClass("cmt-hidden").show(),!1},r.initActions=function(){r.control.find(r.actionSelector).each(function(){var e=this;e.fastClick||(e.fastClick=new FastButton(e,r.onMenuClick)),$(e).show()})},r.init=function(e,i){t.isMobile()&&(r.api=e,r.control=i,n.on(["UiInitialize"],r.initActions))},{init:r.init}}),function(){function e(e,t,n,i){if(e.addEventListener)return e.addEventListener(t,n,i),{destroy:function(){e.removeEventListener(t,n,i)}};var o=function(){n.handleEvent(window.event,n)};return e.attachEvent("on"+t,o),{destroy:function(){e.detachEvent("on"+t,o)}}}var t="ontouchstart"in window;this.FastButton=function(n,i,o){this.events=[],this.touchEvents=[],this.element=n,this.handler=i,this.useCapture=o,t&&this.events.push(e(n,"touchstart",this,this.useCapture)),this.events.push(e(n,"click",this,this.useCapture))},this.FastButton.prototype.destroy=function(){for(i=this.events.length-1;i>=0;i-=1)this.events[i].destroy();this.events=this.touchEvents=this.element=this.handler=this.fastButton=null},this.FastButton.prototype.handleEvent=function(e){switch(e.type){case"touchstart":this.onTouchStart(e);break;case"touchmove":this.onTouchMove(e);break;case"touchend":this.onClick(e);break;case"click":this.onClick(e)}},this.FastButton.prototype.onTouchStart=function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,this.touchEvents.push(e(this.element,"touchend",this,this.useCapture)),this.touchEvents.push(e(document.body,"touchmove",this,this.useCapture)),this.startX=t.touches[0].clientX,this.startY=t.touches[0].clientY},this.FastButton.prototype.onTouchMove=function(e){(Math.abs(e.touches[0].clientX-this.startX)>10||Math.abs(e.touches[0].clientY-this.startY)>10)&&this.reset()},this.FastButton.prototype.onClick=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,this.reset();var t=this.handler.call(this.element,e);return"touchend"==e.type&&clickbuster.preventGhostClick(this.startX,this.startY),t},this.FastButton.prototype.reset=function(){for(i=this.touchEvents.length-1;i>=0;i-=1)this.touchEvents[i].destroy();this.touchEvents=[]},this.clickbuster=function(){},this.clickbuster.preventGhostClick=function(e,t){clickbuster.coordinates.push(e,t),window.setTimeout(clickbuster.pop,2500)},this.clickbuster.pop=function(){clickbuster.coordinates.splice(0,2)},this.clickbuster.onClick=function(e){for(var t=0;t<clickbuster.coordinates.length;t+=2){var n=clickbuster.coordinates[t],i=clickbuster.coordinates[t+1];Math.abs(e.clientX-n)<25&&Math.abs(e.clientY-i)<25&&(e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault?e.preventDefault():e.returnValue=!1)}},t&&(document.addEventListener("click",clickbuster.onClick,!0),clickbuster.coordinates=[])}(this),define("lightbox_init",["jquery","mobileLightbox","config"],function(e,t,n){return n.isMobile()?t.init():new Lightbox,null}),define("deleteComment",["jquery","core","console","events","modalForms","handlebars","reasons","pastafarian"],function(e,t,n,i,o,r,a,s){function l(t){var n=t;t.preventDefault(),t.stopPropagation(),p=e(t.target).closest(".action-delete").attr("data-comment-id");var r;r=e(t.target).hasClass("require-cause")?"#DeleteCommentCause":"#DeleteComment",o.showModalForm(r,{clickedTarget:e(t.target),type:"dialog",hideTriangle:!0,deleteCauses:a.getDeleteCauses(p)}),o.modalForm.find(".edit-reasons").on("click",a.getLinkClick(p,function(){l(n)})),e("#okModal").off("click",u).on("click",u),e("#cancelModal").off("click",h).on("click",h),e(document).off("keydown",h).on("keydown",h),e(document).off("keydown",c).on("keydown",c),i.on("ModalFormHideModal",function(){e(document).off("keydown",c)})}function c(t){t.ctrlKey&&13==t.keyCode&&e("#okModal").click()}function u(i){i.preventDefault(),i.stopPropagation();var r="";return 0!=o.modalForm.find(".delete-cause-list").length&&(o.modalForm.find(".delete-cause-list input:checked").each(function(t,n){r+=e(n).closest("label").text()+"\n"}),""==e.trim(r))?void o.modalForm.find(".error").show():void t.jsonRequest({url:t.getRightUrl("/ajax/comment/delete/"+p),method:"POST",data:{cause:r,pastafarian:s.getUserKey()},successCallback:d,failureCallback:m,scope:this,param:p,progressElement:e(i.target),logFunc:n.log})}function d(e,t,n,r){o.hideModal(),i.fire("CommentDelete",e,t,n,r)}function m(e){o.hideModal(),i.fire("CommentDeleteFail",e)}function h(t){("keydown"!=t.type||27==t.keyCode)&&(t.preventDefault(),t.stopPropagation(),o.hideModal(),e(document).off("keydown",h))}var f=".action-delete",p=null;return{init:function(e){e.off("click",f,l).on("click",f,l),e.find(f).show()}}}),define("resolveComplaint",["jquery","core","events","console","pastafarian"],function(e,t,n,i,o){function r(n){if(n.preventDefault(),n.stopPropagation(),c=e(n.target).attr("data-comment-id"),confirm("Вы действительно хотите закрыть жалобу?")){var r=t.getRightUrl("/ajax/comment/resolve-complaint"),l={commentId:c,pastafarian:o.getUserKey()};t.jsonRequest({url:r,method:"POST",data:l,successCallback:a,failureCallback:s,progressElement:e(n.target),logFunc:i.log})}}function a(e){n.fire("CommentResolveComplaint",e)}function s(e){alert(e)}function l(e){for(var t=0;t<e.length;t++)u.utils.renderComment(e[t])}var c,u,d="[action=resolve]";return{init:function(e,t){u=e,t.off("click",d,r).on("click",d,r),t.find(d).show(),n.on("CommentResolveComplaint",l)}}}),define("bestComment",["jquery","core","events"],function(e,t,n){function i(n){var i=e(n.target),a=i.parent(".action-set-best-comment"),s=i.val(),l=i.attr("data-comment-id"),c=t.getRightUrl("/ajax/comment/set-best-comment");t.jsonRequest({url:c,method:"POST",data:{commentId:l,type:s},successCallback:o(i),failureCallback:r(i),progressElement:a,logFunc:console.log})}function o(e){return function(){e.data("old-value",e.val())}}function r(e){return function(t){alert(t),e.val(e.data("old-value"))}}function a(){l.off("change",s,i).on("change",s,i),l.find(s).show();var t=l.find(s);t.each(function(t,n){e(n).data("old-value",e(n).val())})}var s=".action-set-best-comment .action",l=null;return{init:function(e){l=e,a(),n.on(["PageLoad","UiInitialize","CommentAdd","CommentEdit"],a)}}}),define("showConversation",["jquery","events","config","handlebars"],function(e,t,n,i){function o(){e(".commentsvlru").off("click",m,r).on("click",m,r).off("click",h,r).on("click",h,r)}function r(t){t.preventDefault(),t.stopPropagation();var n,i=e(t.target).closest("a"),o=i.closest("li");if(i.hasClass("closed")){var r=e("#CommentsList").find("[comment="+o.attr("parent")+"]"),s={comments:[]};if(i.hasClass("cmt-show-parent-action"))n=m,s.comments.push(a(r));else{n=h;do s.comments.push(a(r)),r=e("[comment="+r.attr("parent")+"]");while(r.attr("parent"));s.comments=s.comments.reverse()}c(o,s,n)}else u(o)}function a(e){var t=s(e),n=e.find(".comment-text:first").eq(0).html();return""==n&&""==t&&(n=e.find(".notifications:first").eq(0).text()),{name:e.find(".user-name:first").eq(0).text(),time:e.find(".time:first").eq(0).text(),comment:n,images:t}}function s(e){var t=e.find(".comment:first .comment-body").find(".comment-images:first");return t.length?l(t).html():""}function l(t){var n=e("<div>"+t.html()+"</div>"),i=(new Date).getTime();return e("a[rel]",n).each(function(){e(this).attr("rel",e(this).attr("rel")+"-conversation-"+i)}),n}function c(t,n,i){u(t);var o=d(e(p),n),r=e(e.parseHTML(e.trim(o)));t.find(i).removeClass("closed").addClass("opened").closest(f).after(r)}function u(e){e.find(g).remove(),e.find(m).removeClass("opened").addClass("closed"),e.find(h).removeClass("opened").addClass("closed")}function d(e,t){var n=i.compile(e.html());return n(t)}var m=".cmt-show-parent-action",h=".cmt-conversation-action",f=".cmt-conversation",p="#ParentComment",g=".cmt-parent-comment";return{init:o}}),define("catalog/privateDialog",["jquery","events","console"],function(e,t){function n(){return e("#startPrivateDialog")}function i(){return n().parent()}function o(){i().hide()}function r(){n().show(),i().show()}function a(){var t=e("<div>",{"class":"private-note"});t.text("скрытый комментарий"),t.insertAfter(".commentsvlru .form .comment-body")}function s(){e(".commentsvlru .private-note").remove()}function l(){return n().is(":visible:checked")}function c(t){return"undefined"!=typeof e('li[comment="'+t+'"]').attr(f)}function u(e){return e.customFields=e.customFields||{},e.customFields.startPrivateDialog=l(),!0}function d(t){return"1"==e('li[comment="'+t+'"]').attr("canreplyprivate")}function m(e){n().removeAttr("checked"),o(),s(),e.postMode===e.POST_MODE_REPLY&&!c(e.parentIdField.val())&&d(e.parentIdField.val())?r():e.postMode===e.POST_MODE_REPLY&&c(e.parentIdField.val())&&a()}function h(){s(),e(".commentsvlru li[rootprivatecommentid]").addClass("comment-private")}var f="rootprivatecommentid";return{init:function(){t.on("UiInitialize",h),t.on("SetFormToComment",m),n().size()&&t.on("BeforePostComment",u)}}}),define("catalog/tabs",["jquery","events","config","core","catalog/commentType"],function(e,t,n,i,o){function r(e){h.activeTabIndex=e,n.commentAttributesFilter={commentType:h.commentTypes[e]},h.api.control.lastApiConfig.commentAttributesFilter={commentType:h.commentTypes[e]}}function a(t){r(t),e(".commentsvlru .threadLoadingStatus").show(),h.api.reInit(!0)}function s(){a(parseInt(e(this).data("index")))}function l(){var t=e(".commentsvlru .tabs .tab.active"),n=!0;r(t.length?t.data("index"):0);for(var i=0;i<h.commentTypes.length;i++)h.counts[i]=parseInt(e('.commentsvlru .tabs .tab[data-index="'+i+'"] .count').text()),null===h.activeTabIndex&&(h.activeTabIndex=i),h.counts[i]>0&&n&&(n=!1);e(".commentsvlru .tabs .tab").each(function(){var t=e(this);t.off("click",s);var i=parseInt(t.data("index"));i===h.activeTabIndex||n&&0===i?t.removeClass("hidden").addClass("active"):h.counts[i]?t.removeClass("hidden active").on("click",s):t.removeClass("active").addClass("hidden");var o=h.counts[i];t.find(".count").text(o||n&&0===i?"("+o+")":"")})}function c(t){for(var n=0;n<h.commentTypes.length;n++)if(-1!==e.inArray(t,h.commentTypes[n]))return n;return null}function u(n){function i(){t.off("ThreadLoad",i),h.api.control.scrollTo.scroll(n.id)}if(n.hasOwnProperty("attributes")&&n.attributes.hasOwnProperty("commentType")){var o=c(n.attributes.commentType);return null!==o&&(h.counts[o]+=1,e('.commentsvlru .tabs .tab[data-index="'+o+'"] .count').text("("+h.counts[o]+")"),o!==h.activeTabIndex)?(setTimeout(function(){t.on("ThreadLoad",i),a(o)}),!1):void 0}}function d(e){var t=c(e);return null===t?null:t===h.activeTabIndex}function m(e){h.api=e,t.on("ThreadLoad",l),t.on("CommentAddRender",u)}var h={api:null,commentTypes:[["review"],["question","complaint","proposal"]],activeTabIndex:null,counts:[0,0]};return{init:m,isActiveTab:d}}),define("likes",["jquery","core","modalForms","console","events","pastafarian","commentForm"],function(e,t,n,i,o,r,a){function s(t,n,i,o){return function(){o=Math.max(o,0);var r=a.getCommentContainer(t);r.each(function(){var t=e(this);t.find(n).first().removeClass("voted"),t.find(i).first().text(o)}),u.uiInitializer()}}function l(e,t){var n=a.getCommentContainer(e),i=parseInt(n.find(t).first().text());return i?i:0}function c(t,n,i,o,r){var s=a.getCommentContainer(t);s.each(function(){var t=e(this);t.find(i).first().addClass("voted"),t.find(o).first().text(n)}),r&&u.disableLikeActions(t)}var u={likeSelector:".likes .like .action",activeLikeSelector:".likes.active .like .action",dislikeSelector:".likes .dislike .action",activeDislikeSelector:".likes.active .dislike .action",likeCounterSelector:".like .counter",dislikeCounterSelector:".dislike .counter",likeAuthForm:"#AuthModalForm",url:"/ajax/like",likeHandlerObj:null,dislikeHandlerObj:null},d={};return u.uiInitializer=function(){e(this.activeLikeSelector).off("click",this.likeHandlerObj).on("click",this.likeHandlerObj).show(),e(this.activeDislikeSelector).off("click",this.dislikeHandlerObj).on("click",this.dislikeHandlerObj).show()},u.modalFormUiInitializer=function(t,n){var i=n.prop("clickedTarget");if(i&&i.size()){var o=e(i).attr("data-action"),r=a.readCommentId(i);if(("vote-for"===o||"vote-against"===o)&&r){var s=String("&action={action}_{commentId}").replace("{action}",o).replace("{commentId}",r);n.find(".open-auth-link").each(function(t,n){var i=e(n);-1===i.attr("href").indexOf("&action=")&&i.attr("href",i.attr("href")+s)})}}},u.likeHandler=function(o){o.preventDefault(),o.stopPropagation();var d=e(o.target),m=d.closest(".likes");if(m.hasClass("need-login"))n.showModalForm(this.likeAuthForm,{clickedTarget:d,message:"Перед тем, как отмечать понравившиеся комментарии, пожалуйста, авторизуйтесь",leftOffset:-23});else if(m.hasClass("active")){var h=a.readCommentId(o.target),f=l(h,u.likeCounterSelector);c(h,f+1,u.likeSelector,u.likeCounterSelector,!0),t.jsonRequest({url:t.getRightUrl(this.url),method:"POST",data:{action:"like",commentId:h,pastafarian:r.getUserKey()},successCallback:this.likeHandlerCallback,failureCallback:s(h,u.likeSelector,u.likeCounterSelector,f),scope:this,param:h,progressElement:d.parent(),logFunc:i.log})}},u.dislikeHandler=function(o){o.preventDefault(),o.stopPropagation();var d=e(o.target),m=d.closest(".likes");if(m.hasClass("need-login"))n.showModalForm(this.likeAuthForm,{clickedTarget:d,message:"Перед тем, как отмечать не понравившиеся комментарии, пожалуйста, авторизуйтесь",leftOffset:-23});else if(m.hasClass("active")){var h=a.readCommentId(o.target),f=l(h,u.dislikeCounterSelector);c(h,f+1,u.dislikeSelector,u.dislikeCounterSelector,!0),t.jsonRequest({url:t.getRightUrl(this.url),method:"POST",data:{action:"dislike",commentId:h,pastafarian:r.getUserKey()},successCallback:this.dislikeHandlerCallback,failureCallback:s(h,u.dislikeSelector,u.dislikeCounterSelector,f),scope:this,param:h,progressElement:d.parent(),logFunc:i.log})}},u.likeHandlerCallback=function(e,t,n,i){c(i,e,u.likeSelector,u.likeCounterSelector,!1)},u.dislikeHandlerCallback=function(e,t,n,i){c(i,e,u.dislikeSelector,u.dislikeCounterSelector,!1)},u.disableLikeActions=function(t){var n=a.getCommentContainer(t);n.each(function(){var t=e(this);t.find(".likes").first().removeClass("active"),t.find(u.likeSelector).first().add(t.find(u.dislikeSelector).first()).off("click",u.likeHandlerObj).off("click",u.dislikeHandlerObj)})},d.init=u.init=function(){u.likeHandlerObj=e.proxy(u.likeHandler,u),u.dislikeHandlerObj=e.proxy(u.dislikeHandler,u),o.on("UiInitialize",u.uiInitializer,u),n.addFormUIInitializer(u.likeAuthForm,u.modalFormUiInitializer,u)},d}),define("outdatedLikes",["jquery","core","modalForms","console","pastafarian","likes","commentForm","events"],function(e,t,n,i,o,r,a,s){return{control:null,likeSelector:"span.action[action=vote-for]",dislikeSelector:"span.action[action=vote-against]",likesCounterSelector:".vote-for .counter",dislikesCounterSelector:".vote-against .counter",likeAuthForm:"#AuthModalForm",url:"/ajax/like",likeHandlerObj:null,dislikeHandlerObj:null,bestComments:".best-comments",init:function(){this.likeHandlerObj=e.proxy(this.likeHandler,this),this.dislikeHandlerObj=e.proxy(this.dislikeHandler,this),s.on("UiInitialize",this.uiInitializer,this),n.addFormUIInitializer(this.likeAuthForm,this.modalFormUiInitializer,this),r.init()},modalFormUiInitializer:function(t,n){if(!n.hasClass("company")&&!n.hasClass("marisa")){var i=this,o=n.prop("clickedTarget");if(o&&o.size()){var r=e(o).attr("data-action"),a=i.readCommentId(o);if(("vote-for"===r||"vote-against"===r)&&a){var s=String("&action={action}_{commentId}").replace("{action}",r).replace("{commentId}",a);n.find(".open-auth-link").each(function(t,n){var i=e(n);-1===i.attr("href").indexOf("&action=")&&i.attr("href",i.attr("href")+s)})}}}},uiInitializer:function(){e(this.likeSelector).off("click",this.likeHandlerObj).on("click",this.likeHandlerObj).show(),e(this.dislikeSelector).off("click",this.dislikeHandlerObj).on("click",this.dislikeHandlerObj).show()},readCommentId:function(e){return parseInt(a.getClosestCommentContainer(e).attr(a.CommentAttrName))},likeHandler:function(o){o.preventDefault(),o.stopPropagation();var r=e(o.target);if(!r.closest(this.bestComments).size()&&r.hasClass("action"))if("anonymous"==r.attr("type"))n.showModalForm(this.likeAuthForm,{clickedTarget:r,message:"Перед тем, как отмечать понравившиеся комментарии, пожалуйста, авторизуйтесь",leftOffset:-23});else{var a=this.readCommentId(o.target);this.renderLikeAction(a,this.getValue(a,!0)+1,!0,!0),t.jsonRequest({url:t.getRightUrl(this.url),method:"POST",data:{action:"like",commentId:a,pastafarian:require("pastafarian").getUserKey()},successCallback:this.likeHandlerCallback,failureCallback:null,scope:this,param:a,progressElement:r.parent(),logFunc:i.log})}},likeHandlerCallback:function(e,t,n,i){this.renderLikeAction(i,e,!0,!1)},dislikeHandler:function(o){o.preventDefault(),o.stopPropagation();var r=e(o.target);if(!r.closest(this.bestComments).size()&&r.hasClass("action"))if("anonymous"==r.attr("type"))n.showModalForm(this.likeAuthForm,{clickedTarget:r,message:"Перед тем, как отмечать не понравившиеся комментарии, пожалуйста, авторизуйтесь",leftOffset:-23});else{var a=this.readCommentId(o.target);this.renderLikeAction(a,this.getValue(a,!1)+1,!1,!0),t.jsonRequest({url:t.getRightUrl(this.url),method:"POST",data:{action:"dislike",commentId:a,pastafarian:require("pastafarian").getUserKey()},successCallback:this.dislikeHandlerCallback,failureCallback:null,scope:this,param:a,progressElement:r.parent(),logFunc:i.log})}},dislikeHandlerCallback:function(e,t,n,i){this.renderLikeAction(i,e,!1,!1)},hideCommentLikeButtons:function(t){var n=a.getCommentContainer(t),i=this;n.each(function(){var t=e(this);t.find(i.likeSelector).first().add(t.find(i.dislikeSelector).first()).removeClass("action").addClass("sign").off("click",i.likeHandlerObj).off("click",i.dislikeHandlerObj)})},getValue:function(e,t){var n=a.getCommentContainer(e),i=this,o=t?i.likesCounterSelector:i.dislikesCounterSelector,r=n.find(o).first().text();return r=parseInt(r),r?r:0},renderLikeAction:function(t,n,i,o){var r=a.getCommentContainer(t),s=this,l=i?s.likesCounterSelector:s.dislikesCounterSelector,c=i?s.likeSelector:s.dislikeSelector,u=i?s.dislikeSelector:s.likeSelector,d=i?s.dislikesCounterSelector:s.likesCounterSelector;r.each(function(){var t=e(this);t.find(l).first().text(n),t.find(c).first().parent().removeClass("empty"),t.find(u).first().parent().removeClass("empty");var i=t.find(d).first().parent().find(".counter");""==e.trim(i.text())&&i.text("0")}),o&&this.hideCommentLikeButtons(t)}}}),define("catalog/desktopStars",["jquery","events","config","catalog/commentType"],function(e,t,n,i){function o(){e(".active",e(m)).attr("data-value","").width(0)}function r(){"question"!==i.getValue()&&l().show()}function a(t){var n=e('[comment="'+t+'"]'),i=n.attr("level");0!=i||n.find(".comment:first").hasClass("cant-edit-rating")?s():d(t)}function s(){l().hide(),o()}function l(){return e(m).closest(".cmt-field")}function c(e){["review","complaint","proposal"].indexOf(e)>=0?r():s()}function u(){function t(e){var t=e.pageX-o.offset().left;return 1+Math.min(Math.floor(Math.max(t-2,0)/17),4)}function n(e){var t=parseFloat(e);return isNaN(t)?0:t}var i=e(".star-rating",e(m)),o=e(".active",i);i.mouseover(function(){o.addClass("hovered")}).mousemove(function(e){o.width(2+17*t(e))}).mouseleave(function(){var e=n(o.attr("data-value"))||0;o.attr("data-value",e),o.removeClass("hovered clicked").width(2+Math.ceil(85*e))}).mousedown(function(e){var n=t(e);o.attr("data-value",20*n/100).addClass("clicked").width(2+17*n)}),r()}function d(t){var n=e(".active",e(".commentsvlru .form .cmt-form-stars .cmt-field-data")),i=e('li[comment="'+t+'"]').find(".comment .star-rating .active"),o=i.attr("data-value"),r=92*o;n.attr("data-value",o),e(".active",e(m)).attr("data-value",o).width(r)}var m=".commentsvlru .form .cmt-form-stars .cmt-field-data";return{init:function(){t.on("ThreadLoad",function(){n.threadName&&-1!==["company"].indexOf(n.threadName.type)&&u()}),t.on("ChangeCommentType",c),t.on("BeforeSetPostMode",function(e,t){switch(e){case"new":o(),r();break;case"edit":a(t);break;case"reply":s()}}),t.on("CommentEdit",r),t.on(["CommentAddRender","CommentEditRender"],function(){o(),r()}),t.on(["BeforePostComment","BeforeEditComment"],function(t){var n=e(".active",e(m)),i=parseFloat(n.attr("data-value"));i&&(t.hasOwnProperty("customFields")?t.customFields["user-rating"]=i:t["user-rating"]=i)})}}}),define("catalog/mobileStars",["jquery","events","config"],function(e,t,n){function i(){var t=e(".starRatingColor","#commentStarRatingBlock");t.data("user-rating",""),t.data("orig-width","0px"),t.css("width","0px")}function o(t){"undefined"==typeof t&&(t=!1),("question"!=e("[name=commentType]","#CommentForm").val()||t)&&e("#commentStarRatingBlock").show()}function r(){e("#commentStarRatingBlock").hide(),i()}function a(e){["review","complaint","proposal"].indexOf(e)>=0?o():r()}function s(){var t=e("#commentStarRatingBlock"),n=e(".commentStarRatingWrap.inlineBlock .starRatingHover",t),i="0 "+h,r=d+"px",a=-1;n.mouseenter(function(){r=e(this).prev().data("orig-width"),e(this).prev().css("width",d+"px")}),n.mousemove(function(t){var n=e(this),i=t.pageX-n.offset().left-d;if(i=Math.max(Math.ceil(i/m),-4)*m,!n.prev().is(":animated")&&n.css("background-position")!=i+"px "+h){var o=150,r=150;a>i?(n.css("background-position",i+"px "+h),o=0):r=0,n.prev().stop(!0).animate({opacity:0},r,function(){e(this).css("background-position",i+"px "+h),e(this).stop(!0).animate({opacity:1},o,function(){n.css("background-position",i+"px "+h)})}),a=i}}),n.mouseout(function(){var t=e(this);t.prev().stop(!0).animate({opacity:0},100,function(){t.css("background-position","-"+2*d+"px "+h),e(this).css({width:e(this).data("orig-width"),"background-position":i}),e(this).animate({opacity:1},100)})}),n.on("click touchstart",function(t){var n=e(this);n.css("background-position",a+"px "+h);var i;i="touchstart"==t.type?t.originalEvent.touches[0].pageX:t.pageX;var o=i-e(this).offset().left,s=Math.max(Math.ceil(o/m),1);r=s*m;var l=n.siblings(".starRatingColor");l.data("orig-width",r),l.data("user-rating",.2*s),l.css("width",r)}),o()}function l(t){var n=e('li[comment="'+t+'"]').find(".comment .star-rating .active"),i=n.attr("data-value"),o=d*i,r=e(".commentsvlru #CommentForm .starRatingColor");r.data("orig-width",o).width(o)}function c(t){var n=e('[comment="'+t+'"]'),i=n.attr("level");0!=i||n.find(".comment:first").hasClass("cant-edit-rating")?r():(o(!0),l(t))}function u(){t.on("ThreadLoad",function(){n.threadName&&-1!==["company"].indexOf(n.threadName.type)&&s()}),t.on("ChangeCommentType",a),t.on("BeforeSetPostMode",function(e,t){switch(e){case"new":r(),o();break;case"edit":i(),c(t);break;case"reply":r()}}),t.on("CommentEdit",o),t.on("CommentAddRender","CommentEditRender",function(){i(),o()}),t.on(["BeforePostComment","BeforeEditComment"],function(t){var n=e(".starRatingColor","#CommentForm"),i=parseFloat(n.data("user-rating"));i&&(t.hasOwnProperty("customFields")?t.customFields["user-rating"]=i:t["user-rating"]=i)})}var d=205,m=d/5,h="-39px";return{init:u}}),define("catalog/notificationRules",["jquery","core","events","browserDetect"],function(e,t,n,i){function o(){n.on("ThreadLoad",function(){var n=e(".best-comments");0==n.length&&e(s).addClass("without-top-margin");var i=t.getCookie("hide_notification_rules");i||(e(s).removeClass("hidden"),e(s).find(".hide").on("click touchstart",a))})}function r(){return!t.getCookie("hide_notification_rules")}function a(){t.setCookie("hide_notification_rules","1",3650,"/"),e(s).addClass("hidden");var n=i.getInfo();"msie"===n.name&&n.version<10&&(e(".commentsvlru #CommentForm").width(e(".commentsvlru #CommentForm").width()+1),e(".commentsvlru #CommentForm").width(e(".commentsvlru #CommentForm").width()-1))}var s=".commentsvlru .notification-rules";return{init:o,hasNotificationRules:r}}),define("replaceComment",["jquery","core","console","events","modalForms"],function(e,t,n,i,o){function r(t){t.preventDefault(),t.stopPropagation();var n=e(t.target).attr("data-comment-id");o.showModalForm("#ReplaceForm",{clickedTarget:e(t.target),type:"dialog",hideTriangle:!0}),e("#okModalReplace").off("click",a(n)).on("click",a(n)),e("#cancelModalReplace").off("click",c).on("click",c),e(document).off("keydown",c).on("keydown",c)}function a(i){return function(r){r.preventDefault(),r.stopPropagation();var a=o.modalForm.find('input[name="thread"]').val(),l=o.modalForm.find('textarea[name="description"]').val();if(!e.trim(a).length)return void alert("Необходимо указать тред назначения");var c=t.getRightUrl("/ajax/admin/tools/replace-comment"),d={commentId:i,destination:a,description:l};t.jsonRequest({url:c,method:"POST",data:d,successCallback:s(i,r),failureCallback:u,progressElement:e(r.target),logFunc:n.log})}}function s(t,n){return function(){e("body .catalog-moderation").length?(i.fire("CommentReplace"),o.hideModal()):l(t,n)}}function l(r,a){t.jsonRequest({url:t.getRightUrl("/ajax/moderator/comments/approve"),method:"POST",data:{commentId:r,isApproved:1},successCallback:function(){o.hideModal(),i.fire("CommentReplace",[r])},failureCallback:function(e){alert("Комментарий успешно перенесён, но при установке проверенности произошла ошибка: "+e)},progressElement:e(a.target),logFunc:n.log})}function c(t){("keydown"!=t.type||27==t.keyCode)&&(t.preventDefault(),t.stopPropagation(),o.hideModal(),e(document).off("keydown",c))}function u(e){o.modalForm.find(".error").text(e).show()}var d="[action=replace]";return{init:function(e){e.off("click",d,r).on("click",d,r),e.find(d).show()}}}),define("companyReaction",["jquery","core","events"],function(e,t,n){function i(n){n.preventDefault(),n.stopPropagation();var i=e(n.target),a=(i.val(),i.closest("[comment]").attr("comment")),s=t.getRightUrl("/ajax/comment/set-require-reaction");s+=-1==s.indexOf("?")?"?commentId="+a:"&commentId="+a,t.jsonRequest({url:s,method:"POST",data:{},successCallback:o,failureCallback:r,progressElement:i,logFunc:console.log})}function o(){n.fire("CompanyReaction")}function r(e){alert(e)}var a="a[action=comment-company-reaction]";return{init:function(e){e.find(a).show(),e.off("click",a,i).on("click",a,i)}}}),define("autosave",["jquery","core","console","events","config","imageUpload","pastafarian","subscriptionToComment"],function(e,t,n,i,o,r,a,s){function l(t){x=t;var n=x.features.commentForm,o=n.FormContainer,r=o.find("textarea"),a=o.find(n.inputs.name),s=function(){p()?d():m()},l=function(){g()};i.on(["CommentAdd","SetFormToComment"],e.proxy(m,this)),e(window).off("beforeunload",l).on("beforeunload",l),r.off("keypress paste",s).on("keypress paste",s),a.off("keypress paste",s).on("keypress paste",s),i.on("ImageAdd",s),c()}function c(){var t=e(".commentsvlru script.comments-autosave-block");if(t.size()){var i=e.trim(t.html());if(t.remove(),i){try{i=JSON.parse(i)}catch(o){return void n.log("Autosave data is not JSON type")}u(i)}}}function u(t){if("undefined"==typeof t.comment)return void n.log("Autosave data hasn't comment text");if("object"!=typeof t.attributes||null===t.attributes)return void n.log("Autosave data hasn't array of attributes");if(!e.isArray(t.attachments))return void n.log("Autosave data hasn't array of attachments");var i,o=x.features.commentForm,a=o.FormContainer,l=require("catalog/branch");b(t),o.setCommentText(t.comment),x.fire("commentResize");for(i in t.attributes)if(t.attributes.hasOwnProperty(i)&&("name"!==i||""==a.find('[name="name"]').val())&&"subscribeEmail"!==i){var c=a.find('[name="'+i+'"]');c.is('[type="radio"]')?c.each(function(){this.value==t.attributes[i]&&e(this).trigger("click")}):c.is('[type="checkbox"]')?c.each(function(){e(this).prop("checked",!1),this.value==t.attributes[i]&&e(this).trigger("click")}):(c.val(t.attributes[i]),c.trigger("change"))}if(t.attachments.length&&e(".commentsvlru .image-container").find(".upload-form").size()){r.init(),r.uploadForm.show(),r.showBtn.hide();var u=r.addUploadButton().addItem,m={count:t.attachments.length,data:[]},h=!0;for(i in t.attachments)m.data.push(t.attachments[i]);r.renderUploadedImages(m,u,h)}s.refreshSubscribeChecker(),l&&l.refresh(),d()}function d(){_=!0,f()}function m(){_=!1,h()}function h(){T&&(clearTimeout(T),T=!1)}function f(){h(),T=setTimeout(e.proxy(g,this),S)}function p(){var e=x.features.commentForm;return e.postMode===e.POST_MODE_NEW&&x.utils.getUserKey()}function g(){if(_&&p()){var e=v();require("core").jsonRequest({url:t.getRightUrl("/ajax/comment/autosave"),method:"POST",data:e,successCallback:C,failureCallback:k,scope:this,logFunc:n.log})}}function v(){var e=x.features.commentForm,t=e.FormContainer.find("form"),n=t.serializeArray(),i={threadId:o.threadId,pastafarian:a.getUserKey(),comment:"",attributes:{},attachments:[]};for(var r in n)if(n.hasOwnProperty(r))switch(n[r].name){case"comment":i.comment||(i.comment=e.isPlaceholderValue()?"":e.getCommentText());break;case"images[]":i.attachments.push(n[r].value);break;default:i.attributes[n[r].name]=n[r].value}return b(i)}function b(e){return w=e,y()}function y(){return w}function C(){}function k(){}var x,w,_=!1,T=!1,S=1e4;return{init:l,getData:y}}),define("annotation",["jquery","core","modalForms","events"],function(e,t,n,i){function o(t){t.preventDefault(),t.stopPropagation(),f=e(t.target),d=f.data("comment-id"),n.showModalForm("#Annotation",{clickedTarget:f,type:"dialog",hideTriangle:!0}),h=n.modalForm.find("textarea"),h.val(f.closest("div").find(".annotation").text());var i=h.val();n.modalForm.find(".symbols-counter").text(m-i.length),h.off("keyup change",a).on("keyup change",a),e("#okModal").off("click",r).on("click",r),e("#cancelModal").off("click",c).on("click",c),e(document).off("keydown",c).on("keydown",c)}function r(e){e.preventDefault(),e.stopPropagation();var n=t.getRightUrl("/ajax/comment/add-annotation");t.jsonRequest({url:n,method:"POST",data:{commentId:d,annotation:h.val()},successCallback:s,failureCallback:l,logFunc:console.log})}function a(){n.modalForm.find(".symbols-counter").text(m-h.val().length)}function s(){var t=e.trim(h.val());f.closest("div").find(".annotation").text(t),t.length?(f.closest("div").find(u).attr("title","Редактировать аннотацию к отзыву"),f.closest("div").find(u).text("редактировать аннотацию")):(f.closest("div").find(u).attr("title","Добавить аннотацию к отзыву"),f.closest("div").find(u).text("добавить аннотацию")),n.hideModal(),i.fire("CommentAddAnnotation",d)}function l(e){n.modalForm.find(".error").text(e).show()}function c(t){("keydown"!=t.type||27==t.keyCode)&&(t.preventDefault(),t.stopPropagation(),n.hideModal(),e(document).off("keydown",c))}var u="[action=add-annotation]",d=null,m=80,h=null,f=null;return{init:function(e){e.off("click",u,o).on("click",u,o),e.find(u).show()}}}),define("profile",["jquery","core","events","handlebars","pastafarian","modalForms","handlebars-profile-container","handlebars-embedded-profile","handlebars-profile-name-dialog","console","config","handlebars-profile-anonymous-input-name"],function(e,t,n,i,o,r,a,s,l,c,u,d){function m(t){var n=e.trim(t.val());return f.test(n)?n:""}var h={projectId:null,profileId:null,userId:null,editable:!1,containerTemplate:null,container:null,nameLabel:null,nameInput:null,oldName:"",birthday:null,xhr:null,abortFlag:!1,scroller:{container:null,offset:null,enabled:!0,isScrolling:!1},changeNameState:null,isCurrentUser:!1},f=/([0-9]{2}\.[0-9]{2}\.[0-9]{4})/;return h.profileLinkClick=function(t){var n=e(t.target);return n.hasClass("cmt-profile__link")||(n=n.closest(".cmt-profile__link"),n.size())?(r.hideModal(),h.open(n.attr("data-project-id"),n.attr("data-user-id"),1==n.attr("data-editable"),n.attr("data-profile-id")),!1):!1},h.profileLinkIcoClick=function(){n.off("ProfileFormInit",h.onProfileFormInit),n.on("ProfileFormInit",h.onProfileFormInit)},h.onProfileFormInit=function(){n.off("ProfileFormInit",h.onProfileFormInit),e(".cmt-profile__display-name .cmt-profile__label",h.container).click()},h.open=function(t,n,i,o){h.projectId=t,h.editable=i,h.profileId=o,h.userId=n,h.container=e(h.containerTemplate),h.close(),e("body").addClass("cmt-profile__no-scroll").on("mousedown.profile",h.wheelButtonScroll),
e(".cmt-profile__overlay,.cmt-profile__close",h.container).click(h.close),e(".cmt-profile__reload",h.container).click(h.profileReload),h.loadInitialData();var r={};r=u.isMobile()?{width:"100%","min-width":"320px","max-width":"730px"}:{width:"40%","min-width":"670px","max-width":"730px"},h.container.appendTo(document.body).find(".cmt-profile__content-wrap").animate(r,200),h.scroller.enabled=!0,h.scroller.offset=null},h.wheelButtonScroll=function(e){e=e||window.event,"object"==typeof e&&1==e.button&&e.preventDefault()},h.close=function(){e("body").removeClass("cmt-profile__no-scroll").off("mousedown.profile"),e(".cmt-profile").remove()},h.loadInitialData=function(){var n=e(".cmt-profile__trobber",h.container);n.show(),h.abortPreviousRequest(),h.xhr=t.jsonRequest({url:t.getRightUrl("/ajax/profile"),method:"GET",data:{projectId:h.projectId,profileId:h.profileId,userId:h.userId,pastafarian:o.getUserKey()},successCallback:e.proxy(h.profileLoadSuccess,h),failureCallback:h.profileLoadError,progressElement:n})},h.profileLoadError=function(){h.xhr=null,h.abortFlag||(e(".cmt-profile__trobber",h.container).removeClass("ajax-progress").hide(),e(".cmt-profile__reload",h.container).show(),e(".cmt-profile__content",h.container).remove())},h.profileReload=function(){e(".cmt-profile__reload",h.container).hide(),e(".cmt-profile__trobber",h.container).show(),h.loadInitialData()},h.profileLoadSuccess=function(o){h.xhr=null,h.profileId=o.profileId,h.userId=o.userId,h.isCurrentUser=o.isCurrentUser;var r=e.extend({editable:this.editable,jumbo:this.editable&&!this.userId&&!t.getCookie("cmt-profile_hide_jumbo"),sexM:1==o.sex,sexF:2==o.sex,following:!1,followers:!1,canFollow:!0,showFollowButton:!h.isCurrentUser&&o.enableFollowers,projectId:h.projectId},o),a=i.compile(s)(r),l={content:a};n.fire("ProfileInitRender",l),e(".cmt-profile__content-wrap",this.container).html(l.content),this.editable&&this.initEditForm(),r.jumbo&&this.container.find(".cmt-profile-jumbo").each(function(){var n=e(this);n.find(".hide").on("click touchstart",function(){t.setCookie("cmt-profile_hide_jumbo","1",3650,"/"),n.remove()})}),u.isMobile()&&(e(".cmt-profile__stat",h.container).append(e(".cmt-profile__right-block",h.container)),h.initTooltipMobile()),h.scroller.container=e(".cmt-profile__content-wrap",this.container),o.commentsCount>0?(this.scroller.container.scroll(this.scrollHandler),this.renderThreads(o.comments)):(this.scroller.enabled=!1,this.renderNoComments(o.displayName,o.sex)),this.container.on("click",".cmt-profile__more-comments",this.moreCommentsClick),e(".cmt-profile__menu-item",this.container).click(this.menuClick)},h.menuClick=function(t){var i=this,o=e(t.target).closest(".cmt-profile__menu-item");o.hasClass("cmt_active")||(e(".cmt-profile__menu-item",this.container).each(function(){var t=e(this);t.removeClass("cmt_active"),e(t.attr("data-target"),i.container).hide()}),o.addClass("cmt_active"),e(o.attr("data-target"),i.container).show(),n.fire("ProfileTabChanged",o))},h.saveBirthdayOnClose=function(t){var n=e(t.target),i=e(".cmt-profile__birthday input",h.container);n.closest("#cmt-ui-datepicker-div").size()||n.closest(i).size()||h.birthdayChange(m(i))},h.initEditForm=function(){this.nameLabel=e(".cmt-profile__display-name .cmt-profile__label",this.container),this.nameInput=e(".cmt-profile__display-name input",h.container),this.oldName=this.nameInput.val(),this.nameLabel.click(this.startEditName),h.userId?this.nameInput.on("blur",function(){h.endEditName()}).on("keydown",function(e){13==e.keyCode?(e.stopPropagation(),e.preventDefault(),h.endEditName()):27==e.keyCode&&(e.stopPropagation(),e.preventDefault(),h.cancelEditName())}):this.changeNameDialog(this.nameInput,this.endEditName,h.cancelEditName),e(".cmt-profile__birthday input",this.container).datepicker({changeYear:!0,yearRange:"1920:2002",changeMonth:!0,dateFormat:"dd.mm.yy",onSelect:h.birthdayChange}).on("focusin",function(){h.birthday=m(e(this))}).on("focusout",function(){var t=m(e(this));""===t&&t!==h.birthday&&h.birthdayChange(t)}).on("focus",function(){e(document).on("click",h.saveBirthdayOnClose)}),e(".cmt-profile__sex-edit select",this.container).change(this.sexChange);var i=t.getRightUrl("/ajax/profile/avatar?profileId="+this.profileId+"&pastafarian="+o.getUserKey());e('.cmt-profile__avatar.cmt-profile_editable input[name="avatar"]',this.container).fileupload({url:i,dataType:"json",xhrFields:{withCredentials:!0},add:this.avatarAdded,done:this.avatarUploaded}),e(".cmt-profile__avatar.cmt-profile_editable",this.container).on("mouseover",function(){e(".cmt-profile__avatar-form",h.container).show()}).on("mouseleave",function(){e(".cmt-profile__avatar-form",h.container).hide()}),e(".cmt-profile__avatar-delete",this.container).toggle(!!e(".cmt-profile__avatar-image img",this.container).length).click(this.deleteAvatar),n.fire("ProfileFormInit")},h.changeNameDialog=function(t,n,i){function o(e){s(e),n()}function a(e){s(e),i()}function s(e){e.preventDefault(),e.stopPropagation(),h.changeNameState=null,r.hideModal()}function c(n){return t.val()!=u?(n.stopPropagation(),n.preventDefault(),h.changeNameState="dialog-opened",r.showModalForm("handlebarsProfileNameDialog",{clickedTarget:e(n.target),type:"dialog",hideTriangle:!0},l),e("#okModal").off("click",o).on("click",o),e("#cancelModal").off("click",a).on("click",a),e(r.overlay).css("z-index",9001),e(r.modalForm).focus(),!1):!0}var u=t.val();t.on("focus",function(){u=t.val()}),t.on("blur",function(e){"dialog-opened"!==h.changeNameState&&c(e)}).on("keydown",function(e){13==e.keyCode?(e.stopPropagation(),e.preventDefault(),c(e)):27==e.keyCode&&(e.stopPropagation(),e.preventDefault(),i())})},h.moreCommentsClick=function(n){var i=e(n.target);if(1!=i.attr("data-loading")){var r=i.attr("data-thread-id"),a=i.attr("data-comment-id"),s=i.attr("data-state");if(s&&"error"!==s)"expanded"===s?(e('.feed-item[data-thread-id="'+r+'"]:gt(1)',h.container).hide(),i.attr("data-state","collapsed").text(i.attr("data-orig-text"))):"collapsed"===s&&(e('.feed-item[data-thread-id="'+r+'"]:gt(1)',h.container).show(),i.attr("data-state","expanded").text("Скрыть комментарии"));else try{i.attr("data-loading",1),h.abortPreviousRequest(),h.xhr=t.jsonRequest({url:t.getRightUrl("/ajax/profile/comments"),method:"GET",data:{profileId:h.profileId,threadId:r,commentId:a,pastafarian:o.getUserKey()},successCallback:e.proxy(h.moreCommentsLoaded,h,i),failureCallback:e.proxy(h.moreCommentsError,h,i),progressElement:i})}catch(l){throw i.attr("data-loading",0),l}}},h.moreCommentsLoaded=function(t,i){t.attr("data-loading",0),h.xhr=null,t.attr("data-state")||t.attr("data-orig-text",t.text()),t.attr("data-state","expanded").text("Скрыть комментарии"),e(i.content).insertAfter(t),n.fire("UiInitialize")},h.moreCommentsError=function(e){e.attr("data-loading",0),h.xhr=null,h.abortFlag||(e.attr("data-state")||e.attr("data-orig-text",e.text()),e.attr("data-state","error").text("Не удалось загрузить комментарии. Повторить"))},h.scrollHandler=function(){var n=h.scroller.enabled&&!h.scroller.isScrolling&&h.scroller.container.scrollTop()+h.container.height()+3>h.scroller.container.prop("scrollHeight");if(n){h.scroller.isScrolling=!0;try{h.abortPreviousRequest(),h.xhr=t.jsonRequest({url:t.getRightUrl("/ajax/profile/threads"),method:"GET",data:{profileId:h.profileId,offset:h.scroller.offset,pastafarian:o.getUserKey()},successCallback:function(e){h.scroller.isScrolling=!1,h.renderThreads(e)},failureCallback:function(){h.scroller.isScrolling=!1,h.setError(null)},progressElement:e(".cmt-profile__comments-wrap",h.container)})}catch(i){throw h.scroller.isScrolling=!1,i}}},h.abortPreviousRequest=function(){h.xhr&&(h.abortFlag=!0,h.xhr.abort(),h.abortFlag=!1)},h.renderThreads=function(t){h.xhr=null,h.scroller.offset=t.offset,e(".cmt-profile__comments",h.container).append(t.content),t.offset?h.scrollHandler():h.scroller.enabled=!1,n.fire("UiInitialize")},h.renderNoComments=function(n,i){var o;if(this.editable)o="У вас нет ни одного комментария.";else{var r;switch(i){case 1:r="";break;case 2:r="а";break;default:r="(а)"}o='<div class="cmt-profile__comments-sadness"></div><span>'+t.escapeHtml(n)+" пока что не написал"+r+" ни одного комментария</span>"}e(".cmt-profile__comments",this.container).html(o)},h.deleteAvatar=function(){var n=e(".cmt-profile__avatar",h.container);t.jsonRequest({url:t.getRightUrl("/ajax/profile/avatar/delete"),method:"POST",data:{profileId:h.profileId,pastafarian:o.getUserKey()},successCallback:h.avatarDeleted,failureCallback:e.proxy(h.setError,h,n),progressElement:n,progressClass:"cmt-profile__avatar-progress"})},h.avatarDeleted=function(){h.clearErrors(),e(".cmt-profile__avatar-image",h.container).html('<div class="cmt-profile__avatar-stub"></div>'),e(".cmt-profile__avatar-delete",h.container).hide()},h.avatarAdded=function(n,i){var o=[],r=/(\.|\/)(jpe?g|png)$/i,a=i.originalFiles[0].name;a&&!r.test(a)&&o.push(t.escapeHtml(a)+": можно загружать только JPG и PNG"),i.originalFiles[0].hasOwnProperty("size")&&i.originalFiles[0].size.length&&i.originalFiles[0].size>1e7&&o.push(t.escapeHtml(a)+": слишком большой файл"),o.length?h.setError(".cmt-profile__avatar",o.join("<br/>")):(h.clearErrors(),e(".cmt-profile__avatar",h.container).addClass("cmt-profile__avatar-progress"),i.submit())},h.avatarUploaded=function(n,i){e(".cmt-profile__avatar",h.container).removeClass("cmt-profile__avatar-progress");var o=navigator.userAgent.toLowerCase(),r=-1!=o.indexOf("msie")?parseInt(o.split("msie")[1])<9:!1;if(r&&"undefined"==typeof i.result)return void h.open(h.projectId,h.userId,h.editable,h.profileId);if(!i.hasOwnProperty("result")||!i.result.success){var a=i&&i.originalFiles&&i.originalFiles.length?t.escapeHtml(i.originalFiles[0].name)+": ":"";return a+=i.hasOwnProperty("result")&&i.result.message?i.result.message:"не удалось загрузить изображение",void h.setError(".cmt-profile__avatar",a)}var s=i.result.data;e(".cmt-profile__avatar-image",h.container).html('<img src="'+s+'" alt=""/>'),e(".cmt-profile__avatar-delete",h.container).show(),h.clearErrors()},h.sexChange=function(){var n=e(".cmt-profile__sex-edit select",h.container);t.jsonRequest({url:t.getRightUrl("/ajax/profile"),method:"POST",data:{profileId:h.profileId,pastafarian:o.getUserKey(),name:"sex",value:n.val()},successCallback:h.clearErrors,failureCallback:e.proxy(h.setError,h,n),progressElement:n})},h.birthdayChange=function(n){if(e(document).off("click",h.saveBirthdayOnClose),h.birthday!==n){h.birthday=n;var i=e(".cmt-profile__birthday input",h.container);t.jsonRequest({url:t.getRightUrl("/ajax/profile"),method:"POST",data:{profileId:h.profileId,pastafarian:o.getUserKey(),name:"birthday",value:n},successCallback:h.clearErrors,failureCallback:e.proxy(h.setError,h,i),progressElement:i})}},h.setError=function(t,n){h.xhr=null,h.abortFlag||(e(".cmt-profile__error-border",h.container).removeClass("cmt-profile__error-border"),t&&n&&e(t,h.control).addClass("cmt-profile__error-border"),e(".cmt-profile__error-text",h.container).html(n).toggle(!!n))},h.startEditName=function(){h.showInput(),h.nameInput.focus()},h.endEditName=function(){var n=h.nameInput.val();return""===e.trim(n)||n===h.oldName?void h.cancelEditName():void t.jsonRequest({url:t.getRightUrl("/ajax/profile/name"),method:"POST",data:{profileId:h.profileId,pastafarian:o.getUserKey(),value:n},successCallback:h.saveNameSuccess,failureCallback:e.proxy(h.setError,h,h.nameInput),progressElement:h.nameInput})},h.saveNameSuccess=function(o){var r,a=h.nameInput.val();if(h.nameLabel.text(a),u.isMobile()||h.showLabel(),h.profileId!=o){if(r=e('.commentsvlru #CommentForm .cmt-profile__name[data-content="name"]'),r.size())if(u.theme){var s=r.closest(u.isMobile()||"company"===u.theme?".cmt-user-info-name":".comment-form__user-data");s&&s.html(i.compile(d)({name:t.escapeHtml(a),company:"company"===u.theme,mobile:u.isMobile()}))}else r.html(t.escapeHtml(a)),r.attr("data-profile-id",o);h.changeAnonProfileLinks(o),h.profileId=o,u.profileId=o,h.profileReload()}else h.oldName=a,h.clearErrors(),r=e('.commentsvlru .cmt-profile__name[data-project-id="'+h.projectId+'"][data-user-id="'+h.userId+'"][data-content="name"]'),r.size()&&r.html(t.escapeHtml(a));n.fire("profile.name.change",a)},h.changeAnonProfileLinks=function(t){if(e(".commentsvlru .cmt-my-comments").attr("data-editable",1).attr("data-profile-id",t),u.profileId){var n='[data-profile-id="'+u.profileId+'"]';e(".commentsvlru .cmt-profile__link"+n).removeAttr("data-editable"),e(".cmt-badge__small"+n).remove(),e(".cmt-auth-motivator"+n).remove()}},h.clearErrors=function(){h.setError(null,"")},h.cancelEditName=function(){h.nameLabel.text(h.oldName),h.nameInput.val(h.oldName),u.isMobile()||h.showLabel()},h.showLabel=function(){u.isMobile()||(h.nameLabel.show(),h.nameInput.hide())},h.showInput=function(){u.isMobile()||(h.nameInput.show(),h.nameLabel.hide())},h.uiInititalize=function(){e(".commentsvlru .cmt-profile__link").off("click",h.profileLinkClick).on("click",h.profileLinkClick),e(".commentsvlru .cmt-profile__link i").off("click",h.profileLinkIcoClick).on("click",h.profileLinkIcoClick)},h.onCommentAddRender=function(e){e.profileId&&e.profileId!=h.profileId&&(h.changeAnonProfileLinks(e.profileId),h.profileId=e.profileId,u.profileId=e.profileId)},h.updateUserCommentsCount=function(){var n=e(".commentsvlru #CommentForm").data("project-id");n&&0!=e(".cmt-anon-profile").length&&t.jsonRequest({url:t.getRightUrl("/ajax/profile/get-comments-count"),method:"GET",data:{pastafarian:o.getUserKey(),projectId:n},successCallback:h.setUserCommentsCount,failureCallback:function(e){c.log(e)}})},h.updateAnonName=function(){var n=e(".commentsvlru #CommentForm").data("project-id");n&&u.useAnonymousProfiles&&0===e(".cmt-user-info-name-user .cmt-profile__link").length&&t.jsonRequest({url:t.getRightUrl("/ajax/profile/get-anon-name"),method:"GET",data:{pastafarian:o.getUserKey(),projectId:n},successCallback:h.setAnonName,failureCallback:function(e){c.log(e)}})},h.setAnonName=function(t){var n=e(".commentsvlru #CommentForm .cmt-user-info-name-input");n.length&&t.content&&(n.replaceWith(t.content),h.uiInititalize())},h.setUserCommentsCount=function(t){var n=e(".cmt-my-comments");n.length?t.content?n.replaceWith(t.content):n.remove():e(".cmt-form-fields__sidebar-cell").prepend(t.content),h.uiInititalize()},h.initAnonDataUpdate=function(){var t=e(".commentsvlru");t.hasClass("marisa")?(n.on("CommentAddRender",h.updateAnonName),n.on("CommentDelete",h.updateAnonName)):(n.on("CommentAddRender",h.updateUserCommentsCount),n.on("CommentDelete",h.updateUserCommentsCount))},h.init=function(){require("lightbox_init"),h.containerTemplate=i.compile(a)(),n.on(["UiInitialize","FollowFeedInit"],h.uiInititalize),n.on("CommentAddRender",h.onCommentAddRender),h.initAnonDataUpdate();var e=window.location.hash;if(e&&1==e.indexOf("profile")){var t=parseInt(e.replace(/^\D+/g,""));t&&h.open(null,null,null,t)}},h.getCurrentProfileId=function(){return e(".cmt-profile").length?h.profileId:null},h.isProfileOfCurrentUser=function(){return h.isCurrentUser},h.initTooltipMobile=function(){function t(t){t.stopPropagation(),t.preventDefault(),n();var i=e(t.target).closest("[title]"),o=e(".cmt-profile__content-wrap"),r=e("<div>",{"class":"cmt-achievements-bubble"}),a=i.position();r.html(i.attr("title")),r.css({top:a.top+i.height()+o.scrollTop()+5+"px",left:a.left-93+"px"}),o.append(r),r[0].getBoundingClientRect().right>=e(window).width()-20&&r.css({left:"auto",right:"20px"}),r[0].getBoundingClientRect().left<=o[0].getBoundingClientRect().left&&r.css({left:"20px",right:"auto"}),r[0].getBoundingClientRect().bottom>e(".cmt-profile")[0].getBoundingClientRect().bottom&&r.css({top:"auto",bottom:e(window).height()-a.top-o.scrollTop()+5+"px"}),i.addClass("cmt-badge-active"),e("body").on("click",n),e(window).on("orientationchange",n)}function n(){e(".cmt-achievements-bubble").remove(),e(".cmt-badge-active").removeClass("cmt-badge-active"),e("body").off("click",n),e(window).off("orientationchange",n)}e(".cmt-profile__achievements-wrap .cmt-profile__badge",h.container).on("click",t)},{init:h.init,open:h.open,changeNameDialog:h.changeNameDialog,profileLinkClick:h.profileLinkClick,getCurrentProfileId:h.getCurrentProfileId,isProfileOfCurrentUser:h.isProfileOfCurrentUser,getProjectId:function(){return h.projectId||e(".commentsvlru #CommentForm").attr("data-project-id")}}}),define("follower",["jquery","core","profile","events","modalForms","handlebars-profile-followers","handlebars","pastafarian","config"],function(e,t,n,i,o,r,a,s,l){var c={followActionSelector:".cmt-profile__follow-action",buttonSelector:".cmt-profile__button",$currentTarget:null,disabledButtons:!1};return c.unfollow=function(e){c.disabledButtons=!0,t.jsonRequest({url:t.getRightUrl("/ajax/profile/unfollow"),method:"GET",data:{profileId:e},successCallback:function(){c.unfollowSuccess(c.$currentTarget)},failureCallback:c.failureCallback,progressElement:c.$currentTarget.find(c.buttonSelector)})},c.unfollowSuccess=function(e){c.disabledButtons=!1,n.isProfileOfCurrentUser()?c.changeCounter(!0,-1):e.data("profile-id")==n.getCurrentProfileId()&&c.changeCounter(!1,-1),e.attr("action","follow").removeClass("cmt-profile__not-follow").addClass("cmt-profile__follow")},c.follow=function(e){c.disabledButtons=!0,t.jsonRequest({url:t.getRightUrl("/ajax/profile/follow"),method:"GET",data:{profileId:e},successCallback:function(){c.followSuccess(c.$currentTarget)},failureCallback:c.failureCallback,progressElement:c.$currentTarget.find(c.buttonSelector)})},c.failureCallback=function(){c.disabledButtons=!1},c.followSuccess=function(e){c.disabledButtons=!1,n.isProfileOfCurrentUser()?c.changeCounter(!0,1):e.data("profile-id")==n.getCurrentProfileId()&&c.changeCounter(!1,1),e.attr("action","unfollow").removeClass("cmt-profile__follow").addClass("cmt-profile__not-follow")},c.changeCounter=function(t,n){var i;i=e(t?".cmt-profile__menu-item-followig .cmt-profile__menu-count":".cmt-profile__menu-item-follower .cmt-profile__menu-count");var o=parseInt(i.text())?parseInt(i.text()):0;o+=n,i.text(o),i.parent().toggleClass("cmt-motivation",0===o)},c.clickHandler=function(t){if(t.stopPropagation(),t.preventDefault(),!c.disabledButtons){var n=e(this).attr("action");if(c.$currentTarget=e(t.target).closest(c.followActionSelector),c.$currentTarget.hasClass("need-login"))return void c.getAuthProviders();var i=e(this).data("profile-id");"follow"==n?c.follow(i):"unfollow"==n&&c.unfollow(i)}},c.showModalForm=function(t){var n=e(".cmt-profile__content-wrap"),i=e(window).width()-(c.$currentTarget.offset().left+c.$currentTarget.outerWidth()),s=-23-n.offset().left;100>i&&(s-=150);var l=-1*n.offset().top+n.scrollTop(),u=a.compile(r)({authView:t});o.showModalForm("handlebarsProfileFollowers",{clickedTarget:c.$currentTarget,leftOffset:s,topOffset:l,hideTriangle:!0,$parent:n},u)},c.getAuthProviders=function(){var e=n.getCurrentProfileId();t.jsonRequest({url:t.getRightUrl("/get-login-form?hash=profile-"+e+"&theme="+l.theme),method:"GET",successCallback:function(e){c.showModalForm(e.content)},progressElement:c.$currentTarget.find(c.buttonSelector)})},c.getFollowings=function(e){t.jsonRequest({url:t.getRightUrl("/ajax/profile/get-followings"),method:"GET",data:{profileId:n.getCurrentProfileId()},successCallback:function(t){c.setData(t,e)},progressElement:e})},c.getMotivation=function(e){t.jsonRequest({url:t.getRightUrl("/ajax/profile/get-motivation"),method:"GET",data:{projectId:n.getProjectId(),pastafarian:s.getUserKey()},successCallback:function(t){c.setData(t,e)},progressElement:e})},c.getFollowers=function(e){t.jsonRequest({url:t.getRightUrl("/ajax/profile/get-followers"),method:"GET",data:{profileId:n.getCurrentProfileId()},successCallback:function(t){c.setData(t,e)},progressElement:e})},c.setData=function(e,t){t.html(e.content),i.fire("FollowFeedInit")},c.tabChangeHandler=function(t){t.hasClass("cmt-motivation")?c.getMotivation(e(t.data("target"))):t.hasClass("cmt-profile__menu-item-followig")?c.getFollowings(e(t.data("target"))):t.hasClass("cmt-profile__menu-item-follower")&&c.getFollowers(e(t.data("target")))},c.modalFormUiInitializer=function(t,n){var i=n.prop("clickedTarget");if(i&&i.size()){var o=i.data("profile-id"),r=String("&action={action}_{profile-id}").replace("{action}",e(i).attr("action")).replace("{profile-id}",o);n.find(".open-auth-link").each(function(t,n){var i=e(n);i.attr("href",i.attr("href")+r)})}},c.init=function(){e("body").off("click.follower").on("click.follower",c.followActionSelector,c.clickHandler),i.on("ProfileTabChanged",c.tabChangeHandler),o.addFormUIInitializer("handlebarsProfileFollowers",c.modalFormUiInitializer,c)},{init:c.init}}),define("mobileDetect",[],function(){var e=/iPhone/i,t=/iPod/i,n=/iPad/i,i=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,o=/Android/i,r=/IEMobile/i,a=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,s=/BlackBerry/i,l=/BB10/i,c=/Opera Mini/i,u=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,d=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),m=function(e,t){return e.test(t)},h=function(h){var f=h||navigator.userAgent;return this.apple={phone:m(e,f),ipod:m(t,f),tablet:m(n,f),device:m(e,f)||m(t,f)||m(n,f)},this.android={phone:m(i,f),tablet:!m(i,f)&&m(o,f),device:m(i,f)||m(o,f)},this.windows={phone:m(r,f),tablet:m(a,f),device:m(r,f)||m(a,f)},this.other={blackberry:m(s,f),blackberry10:m(l,f),opera:m(c,f),firefox:m(u,f),device:m(s,f)||m(l,f)||m(c,f)||m(u,f)},this.seven_inch=m(d,f),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window?this:void 0},f=function(){var e=new h;return e.Class=h,e};return f()}),define("browserDetect",["jquery"],function(e){function t(){var e,t=navigator.userAgent.toLowerCase(),n=t.match(/(opera|chrome|safari|firefox|msie|trident|edge(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?(e=/\brv[ :]+(\d+)/g.exec(t)||[],{name:"msie",version:parseInt(e[1])||0}):"chrome"===n[1]&&(e=t.match(/\bOPR\/(\d+)/),null!=e)?{name:"opera",version:parseInt(e[1])}:(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],e=t.match(/version\/(\d+)/i),null!=e&&n.splice(1,1,e[1]),{name:n[0],version:parseInt(n[1])})}function n(){if(!e.browser){var n=t(),i={};n.name&&(i[n.name]=!0,i.version=n.version),i.chrome?i.webkit=!0:i.webkit&&(i.safari=!0),e.browser=i}}return{getInfo:t,init:n}}),define("widget",["jquery","core","console"],function(e,t,n){function i(i,o,r){function a(){var e=t.getRightStaticUrl(o);t.jsonRequest({url:e,method:"GET",successCallback:s,failureCallback:l,logFunc:n.log})}function s(e){e&&(c.html(e),u&&u())}function l(){n.log("Widget error")}var c,u="function"==typeof r?r:null;return c=e(i),c.size()?a():n.log("Target not found"),this}function o(e){return e.hasOwnProperty("target")&&e.hasOwnProperty("url")?new i(e.target,e.url,e.onLoad):void n.log("Wrong config")}return{init:o}}),define("tooltip",["jquery","mobileDetect","config","core"],function(e,t,n,i){function o(){if(!(t.any||n.isMobile()||i.detectMobile()||-1!==navigator.userAgent.toLowerCase().indexOf("firefox"))){var o=".commentsvlru:not(.catalog-mobile, .mobile, .kino-vl-mobile), .cmt-profile, .commentsvlru-modal-box:not(.catalog-mobile, .kino-vl-mobile, .mobile)";e(o).off("mouseenter.tooltip").off("mouseleave.tooltip").off("mousemove.tooltip").on("mouseenter.tooltip","[title]",a).on("mouseleave.tooltip","[title]",s).on("mousemove.tooltip","[title]",l)}}function r(){e(".cmt-tooltip").each(function(){var t=e(this),n=t.closest("[title]");n.data("tip-text")&&n.attr("title",n.data("tip-text")),t.remove()}),e("."+u).removeClass(u),c=null}function a(t){t.stopPropagation(),r();var n=e(t.target).closest("[title]");n.addClass(u);var i=n.attr("title");n.data("tip-text",i).attr("title",""),null===c&&(c=e('<p class="cmt-tooltip"></p>').appendTo(n)),l(t),c.text(i)}function s(){r()}function l(e){var t=e.clientX+5,n=e.clientY+15;c&&c.css({top:n,left:t})}var c=null,u="cmt-tooltip-target";return{init:o}}),define("mediaCss",["jquery","events","config"],function(e,t,n){function i(){return{"data-min-width":o(),"data-browser-name":r(),"data-browser":a(),"data-thread-type":n.threadName?n.threadName.type:void 0}}function o(){for(var e=d[0],t=c.width(),n=1;n<d.length;n++){if(d[n]>t)return e;e=d[n]}return e}function r(){return"undefined"==typeof m[0]?void 0:m[0].toLowerCase()}function a(){return m.join(" ").replace(/\s/g,"-").toLowerCase()}function s(){var e=i();u!=e&&(c.attr(e),u=e)}function l(){e(".commentsvlru-modal-box").attr(i())}var c,u,d=[480,560,600],m=function(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?(e=/\brv[ :]+(\d+)/g.exec(t)||[],["IE",e[1]||""]):"Chrome"===n[1]&&(e=t.match(/\b(OPR|Edge)\/(\d+)/),null!=e)?e.slice(1).join(" ").replace("OPR","Opera").split(" "):(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),n)}();return{init:function(n){c=n,e(window).on("resize",s),s(),t.on("AfterShowModalForm",l)}}}),define("commentForm",["jquery","core","events","timings","autosave","imageUpload","subscriptionToComment","resolveComplaint","bestComment","userName","formTypeDetect","deleteComment","deletedComments","modalForms","pastafarian","handlebars","console","bindAnonymousCommentsDialog","authMotivator","config","linkConverter","subscribeActions"],function(e,t,n,i,o,r,a,s,l,c,u,d,m,h,f,p,g,v,b,y,C,k){var x={api:null,control:null,commentUrl:"/ajax/comment/{commentId}",FormContainerSelector:"#CommentForm",FormContainer:null,FormContainerBase:null,parentIdField:null,CommentAttrName:"comment",CommentContainerIdent:".commentsvlru [comment]",commentItemSelector:".commentsvlru [comment={id}]",commentItemAtListSelector:".commentsvlru #CommentsList [comment={id}]",CommentBodyIdent:"div.comment",replyBtnSelector:"[action=reply]",replyToCommentTpl:"#ReplyToComment",editCommentTpl:"#EditComment",okModal:"#okModal",cancelModal:"#cancelModal",selectedComment:"selectedComment",okReplyBtnHandlerObj:null,cancelReplyBtnHandlerObj:null,okEditBtnHandlerObj:null,cancelEditBtnHandlerObj:null,actionReplyCancelSelector:".action[action=cancel-reply]",addCommentBtnSelector:"[action=ajaxSubmit]",updateCommentBtnSelector:"[action=ajaxUpdate]",editBtnContainerSelector:".edit-btn-container",errorMsgSelector:"#formErrCont",crossPostContainer:"div.crossPostContainer",crossPostCheckSelector:"input#crossPostCheck",approveCommentBtnSelector:".action-set-approved",approveCommentBtnHandlerObj:null,authSelector:".inlineFormAuth a",slideUpDown:500,flickerTime:1e3,redBorderTimeout:{comment:null,name:null,subscribeEmail:null},flickerTimeOut:{comment:null,name:null,subscribeEmail:null},errorFieldSelector:{comment:null,name:null,subscribeEmail:null},blockFlickerFlag:{comment:!1,name:!1,subscribeEmail:!1},inputs:{name:"input#login",comment:"textarea#comment",parentId:"input#parentId",subscribeCheck:"input#subscribeCheck:checked",subscribeEmail:"input#subscribeEmail",crossPostCheck:"input#crossPostCheck:checked",images:"input[type=hidden][name^=images]"},textError:"#TextError",messagesTpl:{writeCommentTpl:".writeComment",writeNameTpl:".writeName",writeEmailTpl:".writeEmail",writeRightEmailTpl:".writeRightEmail"},messages:{writeComment:null,writeName:null,writeEmail:null,writeRightEmail:null},errorSelector:{comment:[".comment-body","#comment"]},setFormToThreadHandlerObj:null,addCommentHandlerObj:null,replyActionHandlerObj:null,updateCommentHandlerObj:null,editActionHandlerObj:null,commentResizeObj:null,errorHandlerObj:null,updateTurnedImagesObj:null,progressElement:".comment-body",POST_MODE_NEW:"new",POST_MODE_EDIT:"edit",POST_MODE_REPLY:"reply",postMode:"new",turnedImages:[],setErrorMessages:function(t,n){var i=e(t);if(i&&i.length){var o=p.compile(i.html());if(o&&(o=o(n||[]))){var r=e.parseHTML(e.trim(o));this.messages.writeComment=e(r).find(this.messagesTpl.writeCommentTpl).text(),this.messages.writeName=e(r).find(this.messagesTpl.writeNameTpl).text(),this.messages.writeEmail=e(r).find(this.messagesTpl.writeEmailTpl).text(),this.messages.writeRightEmail=e(r).find(this.messagesTpl.writeRightEmailTpl).text()}}},init:function(){this.FormContainer=e(this.FormContainerSelector),this.FormContainerBase=this.FormContainer.parent(),this.FormContainerBase.show(),this.parentIdField=this.FormContainer.find("#parentId"),this.setFormToThreadHandlerObj=e.proxy(this.setFormToThread,this,!1),this.addCommentHandlerObj=e.proxy(this.addCommentHandler,this),this.updateCommentHandlerObj=e.proxy(this.updateCommentHandler,this),this.replyActionHandlerObj=e.proxy(this.replyActionHandler,this),this.editActionHandlerObj=e.proxy(this.editActionHandler,this),this.commentResizeObj=e.proxy(this.commentResizeHandler,this),this.errorHandlerObj=e.proxy(this.errorHandler,this),n.on("commentResize",this.commentResizeObj),this.okReplyBtnHandlerObj=e.proxy(this.okReplyBtnHandler,this),this.cancelReplyBtnHandlerObj=e.proxy(this.cancelReplyBtnHandler,this),this.okEditBtnHandlerObj=e.proxy(this.okEditBtnHandler,this),this.cancelEditBtnHandlerObj=e.proxy(this.cancelEditBtnHandler,this),this.approveCommentBtnHandlerObj=e.proxy(this.approveCommentBtnHandler,this),this.updateTurnedImagesObj=e.proxy(this.updateTurnedImages,this),n.on("CommentDelete",e.proxy(this.deleteActionCallback,this)),n.on("CommentDeleteFail",e.proxy(this.deleteActionFail,this)),this.turnedImages=[],n.on("CommentEdit",this.updateTurnedImagesObj);var t=e(".commentsvlru");a.init(this.FormContainer),s.init(this.api,t),l.init(t),c.init(this.api),u.init(this),v.init(),b.init(),this.setErrorMessages(this.textError),this.setCommentTextToTemplate(),""!=e.trim(this.control.config.subscribeEmail)&&this.FormContainer.find(this.inputs.subscribeEmail).val(this.control.config.subscribeEmail),this.setPostMode(this.POST_MODE_NEW,0),n.on("UiInitialize",this.uiInitializer,this),e(".commentsvlru textarea").autosize({append:""});var r=this;0==this.FormContainer.find(".special-buttons").length&&this.FormContainer.find(this.inputs.comment).on("keydown",function(e){e.ctrlKey&&13==e.keyCode&&(r.postMode===r.POST_MODE_EDIT?r.FormContainer.find(r.updateCommentBtnSelector).click():r.addCommentHandler(e))}),this.control.config.embedded&&r.FormContainer.find(r.authSelector).each(function(t,n){var i=e(n).attr("href");i+="&anchor=comments",e(n).attr("href",i)}),this.control.imageUpload&&(n.on("ImageDelete",this.onImageDelete,this),n.on("ImageTurn",this.onImageTurn,this),n.on("ImageAdd",this.onImageAdd,this)),this.FormContainerBase.css("min-height",this.FormContainerBase.height()),this.resizeTextareaWidth(),i.init(this),this.control.config.addShareOnPost||this.FormContainer.find(this.crossPostContainer).hide(),o.init(this.api),n.on("ChangeCommentType",function(){r.flickerResetSingleField("comment")})},uiInitializer:function(){this.FormContainer.find(this.actionReplyCancelSelector).off("click",this.setFormToThreadHandlerObj).on("click",this.setFormToThreadHandlerObj),this.FormContainer.find(this.addCommentBtnSelector).off("click",this.addCommentHandlerObj).on("click",this.addCommentHandlerObj);var t=e(this.replyBtnSelector);t.off("click",this.replyActionHandlerObj).on("click",this.replyActionHandlerObj),t.hasClass("company")||t.hasClass("marisa")||t.show(),this.FormContainer.find(this.updateCommentBtnSelector).off("click",this.updateCommentHandlerObj).on("click",this.updateCommentHandlerObj),d.init(e(".commentsvlru")),m.init(this.control),e(this.approveCommentBtnSelector).show().off("click",this.approveCommentBtnHandlerObj).on("click",this.approveCommentBtnHandlerObj);var n=e(this.editBtnContainerSelector);e("a",n).off("click",this.editActionHandlerObj).on("click",this.editActionHandlerObj).show(),n.show(),e(".commentsvlru.company .action-edit, .commentsvlru.marisa .action-edit").off("click",this.editActionHandlerObj).on("click",this.editActionHandlerObj),this.postMode===this.POST_MODE_NEW?(this.FormContainerBase.removeClass("answer"),
this.FormContainer.removeClass("answer")):(this.FormContainerBase.addClass("answer"),this.FormContainer.addClass("answer")),e(this.errorMsgSelector).find("div").html("").hide(),e(this.errorMsgSelector).hide(),this.flickerReset();var i=this.FormContainer.find(this.actionReplyCancelSelector);this.FormContainer.find(".crossPostContainer").removeClass("hidden"),this.postMode===this.POST_MODE_EDIT?(i.is(".company, .marisa, .mobile")||i.text("ОТМЕНА"),i.attr("title","отмена").show(),this.FormContainer.find(".crossPostContainer").addClass("hidden")):this.postMode===this.POST_MODE_REPLY?(i.hasClass("company")||i.hasClass("marisa")||i.hasClass("mobile")||i.text("передумал отвечать"),i.attr("title","передумал отвечать").show()):!i.hasClass("mobile")||this.postMode===this.POST_MODE_NEW&&(e(".commentsvlru").hasClass("mobile")||e(".commentsvlru").hasClass("kino-vl-mobile"))?i.hide():i.show();var o=this,r=this.FormContainer.find(".userNameLabelWrapper");this.postMode===this.POST_MODE_EDIT?(this.FormContainer.find('.cmt-button[type="submit"]').each(function(){var t=e(this).is(o.updateCommentBtnSelector),n=t?"inline-block":"none";e(this).css("display",n),t&&e(this).removeProp("disabled")}),this.FormContainer.addClass("edit"),this.toggleTitle(r,!1)):(this.FormContainer.find('.cmt-button[type="submit"]').each(function(){var t=e(this).is(o.updateCommentBtnSelector);e(this).toggle(!t)}),this.FormContainer.removeClass("edit"),this.toggleTitle(r,!0))},onImageDelete:function(e,t){if(this.postMode===this.POST_MODE_EDIT){var n=this.parentIdField.val(),i=this.getCommentContainer(n),o=this.getCommentContainerBody(i),r=o.find(".comment-images .item[data-id="+e+"]");t?r.remove():r.hide()}},onImageTurn:function(e,t){if(this.postMode===this.POST_MODE_EDIT){var n=this.parentIdField.val(),i=this.getCommentContainer(n),o=this.getCommentContainerBody(i),r=o.find(".comment-images .item[data-id="+e+"]");r.replaceWith(t.content),this.turnedImages.indexOf(e)<0&&this.turnedImages.push(e)}},onImageAdd:function(t){if(this.postMode===this.POST_MODE_EDIT){var n=this.parentIdField.val(),i=this.getCommentContainer(n),o=this.getCommentContainerBody(i),r=o.find(".comment-images");r.length||(r=e('<div class="comment-images"></div>').insertAfter(o.find("blockquote:first p")));for(var a=0;a<t.data.length;a++)"undefined"!=typeof t.data[a].content&&r.append(t.data[a].content)}},updateTurnedImages:function(){var t;for(t in this.turnedImages)e('.commentsvlru .comment-images .item[data-id="'+this.turnedImages[t]+'"]').each(function(){var t=e(this),n=t.attr("data-background-image");t.css("background-image","url('"+n+"?_dc="+String(Math.random())+"')")})},getCommentContainer:function(t){return e(this.commentItemSelector.replace("{id}",t))},getCommentFeedContainer:function(t){return e(this.commentItemAtListSelector.replace("{id}",t))},getCommentContainerBody:function(e){return e.find(this.CommentBodyIdent).first()},getClosestCommentContainer:function(t){return e(t).closest(this.CommentContainerIdent)},readCommentId:function(e){return parseInt(this.getClosestCommentContainer(e).attr(this.CommentAttrName))},checkCancelReply:function(){if(this.postMode===this.POST_MODE_EDIT){var t=this.parentIdField.val(),n=this.getCommentContainer(t);n.find("[new-image=true]").each(function(t,i){var o=e(i).attr("image-id");n.find("[data-id="+o+"]").remove()}),n.find(".item").show();var i=this.getCommentContainerBody(n);i.show()}},setPostMode:function(e,t){n.fire("BeforeSetPostMode",e,t),this.postMode=e,this.parentIdField.val(t),this.control.imageUpload&&(r.commentId=this.postMode==this.POST_MODE_EDIT?t:0)},setFormToComment:function(i,o){e(".commentsvlru [comment]").removeClass("has-reply-form").removeClass("cmt-edit-comment");var a=this.getCommentContainerBody(i),s=a.closest("[comment]").addClass("has-reply-form"),l=s.parents("[comment]");l.length&&l.addClass("has-reply-form");var c=this.FormContainer;if(this.flickerReset(),e(this.errorMsgSelector).find("div").html(""),e(this.errorMsgSelector).hide(),c.parent()[0]!==a.parent()[0]||this.postMode!==o){if(this.checkCancelReply(),o===this.POST_MODE_EDIT){s.addClass("cmt-edit-comment"),a.hide();var u=a.find(".user-info .user-name").text();u=t.escapeHtml(u),c.find("div.readonly.user-info").remove(),c.find(".userNameLabelWrapper").after('<div class="readonly user-info"><span class="user-name">'+u+"</span></div>")}var d=parseInt(i.attr(this.CommentAttrName));this.setPostMode(o,d),this.control.imageUpload&&r.clearForm(),n.fire("UiInitialize"),n.fire("BeforeSetFormToComment",this),c.insertAfter(a),this.resizeTextareaWidth(),this.setCommentTextToFormContainer(c,a,o),this.copyImagesFromCommentToForm(a,c,o),c.show(),c.find("form.comment").hide().slideDown(100),y.isMobile()&&o!==this.POST_MODE_EDIT?(c.find("textarea").prop("placeholder","Ваш ответ"),""!==e.trim(c.find("input[name=name]").val())&&c.find("textarea").focus()):""!==e.trim(c.find("input[name=name]").val())?c.find("textarea").focus():c.find("form.comment").find(":input:visible").first().focus(),n.fire("SetFormToComment",this)}},toggleTitle:function(e,t){var n="";t?(n=e.data("title"),e.attr("title",n),e.removeData("title")):(n=e.attr("title"),e.data("title",n),e.removeAttr("title"))},clearForm:function(){this.control.imageUpload&&r.clearForm(),this.FormContainer.find("textarea").val(""),this.setCommentTextToTemplate()},setFormToThread:function(t,i){null!=i&&(i.preventDefault(),i.stopPropagation()),e(".commentsvlru [comment]").removeClass("has-reply-form"),this.checkCancelReply(),this.setPostMode(this.POST_MODE_NEW,0);var o=this.FormContainer;t||this.clearForm(),n.fire("UiInitialize"),o.appendTo(this.FormContainerBase),o.find("form.comment").hide().slideDown(100),this.resizeTextareaWidth(),y.isMobile()&&o.find("textarea").prop("placeholder","Написать комментарий"),n.fire("SetFormToThread",this)},resizeTextareaWidth:function(){var e=this.FormContainer.find("textarea"),t=this.FormContainer.find('.comment-body .cmt-button[type="submit"]').is(":visible");e.toggleClass("full-width",!t)},setCommentTextToFormContainer:function(t,n,i){var o;i==this.POST_MODE_EDIT?(o=n.find("blockquote:first p").html(),o=o.replace(/\n/gim,""),o=o.replace(/<br\/?>/gim,"\n"),o=o.replace(/\n\n/gim,"\n"),o=o.replace(/<b>(.*?)<\/b>/gim,"\n$1"),o=e.trim(o)):o="",this.setCommentText(o)},copyImagesFromCommentToForm:function(t,n,i){if(this.control.imageUpload){var o={data:[],count:0};if(i==this.POST_MODE_EDIT&&(t.find(".comment-body .comment-images .item").each(function(){o.data.push({id:e(this).attr("data-id"),url:e(this).attr("data-background-image"),success:!0})}),o.count=o.data.length),o.count){r.uploadForm.empty();var a=r.addUploadButton();r.renderUploadedImages(o,a.addItem,!1),r.showBtn.hide(),r.uploadForm.show()}else r.clearForm()}},setCommentTextToTemplate:function(){var e=this.FormContainer.find("textarea"),t={tpl:y.commentTemplate};n.fire("onApplyCommentTemplate",t);var i=t.tpl?t.tpl:"";e.val(i).trigger("autosize.resize")},commentResizeHandler:function(){this.FormContainer.find("textarea").trigger("autosize.resize")},replyActionHandler:function(t){var n=e(t.target);if(n.hasClass("need-auth")||n.parent().hasClass("need-auth"))return t.preventDefault(),t.stopPropagation(),h.showModalForm("#AuthModalForm",{clickedTarget:n,message:"Чтобы оставить комментарий, пожалуйста, авторизуйтесь!",leftOffset:-23}),!1;var i=this.isPlaceholderValue()?"":this.getCommentText();if(r.getUploadCount()||this.templateValidate(i)&&""!=e.trim(i)&&this.postMode==this.POST_MODE_NEW)h.showModalForm(this.replyToCommentTpl,{type:"dialog",hideTriangle:!0}),this.getClosestCommentContainer(n).addClass(this.selectedComment),this.initializePopup(this.okReplyBtnHandlerObj,this.cancelReplyBtnHandlerObj);else{var o=this.getClosestCommentContainer(t.target);this.setFormToComment(o,this.POST_MODE_REPLY)}return!1},approveCommentBtnHandler:function(n){n.preventDefault(),n.stopPropagation();var i=e(n.target),o=i.data("value"),r=this.readCommentId(n.target),a=this;t.jsonRequest({url:t.getRightUrl("/ajax/moderator/comments/approve"),method:"POST",data:{commentId:r,isApproved:o},successCallback:function(){var i={};a.api.control.config.relatedThreads&&(i.relatedThreads=1),a.api.control.config.mergeTypes&&(i.mergeTypes=a.api.control.config.mergeTypes),t.jsonRequest({url:t.getRightUrl(a.commentUrl.replace("{commentId}",r)),method:"GET",data:i,successCallback:function(t){var n={comment:t};n.comment=C.convertContentUrls(e.trim(n.comment)),a.api.fire("CommentApproveRender",n);var i=e(e.parseHTML(n.comment)),o=a.getCommentContainer(r),s=a.getCommentContainerBody(o),l=a.getCommentContainerBody(i);s.replaceWith(l),a.api.fire("UiInitialize"),a.api.utils.hilightReset(a.FormContainer.find("blockquote"));var c=i.find("blockquote");a.api.utils.hilight(c,c.hasClass("moderation")),a.api.fire("CommentApprove")},failureCallback:function(e){e="Сообщение проверено, но произошла ошибка при попытке показать его. Администрация в курсе. Перезагрузите страницу для просмотра вашего сообщения.",alert(e)},scope:this,progressElement:e(n.target)})},failureCallback:function(e){alert(e)}})},initializePopup:function(t,n){e(this.okModal).off("click",t).on("click",t),e(this.cancelModal).off("click",n).on("click",n),e(document).off("keydown",n).on("keydown",n)},okReplyBtnHandler:function(t){t.preventDefault(),t.stopPropagation(),h.hideModal();var n=e("."+this.selectedComment);this.setFormToComment(n,this.POST_MODE_REPLY),n.removeClass(this.selectedComment),this.control.scrollTo.scroll("commentForm")},cancelReplyBtnHandler:function(t){("keydown"!=t.type||27==t.keyCode)&&(t.preventDefault(),t.stopPropagation(),e(document).off("keydown",this.cancelReplyBtnHandlerObj),e("."+this.selectedComment).removeClass(this.selectedComment),h.hideModal(),this.control.scrollTo.scroll("commentForm"))},addCommentHandler:function(i){i.preventDefault(),i.stopPropagation();var o={},a={},s=this.control.config;if(this.collectFormData(o,a,i),o.name&&s.storeNameOnClient){var l=s.anonPosterNameCookie;n.fire("SaveAnonPosterName",o.name,l)!==!1&&l&&null===s.defaultPosterName&&t.setCookie(l,o.name)}var c,u=[];if(o.subscribeCheck&&!k.validateEmail(o.subscribeEmail)&&(c=this.FormContainer.find(this.inputs.subscribeEmail),u.push(/^\s*$/.test(o.subscribeEmail)?[this.messages.writeEmail,c,c]:[this.messages.writeRightEmail,c,c])),/^\s*$/.test(o.name)&&(c=this.FormContainer.find(this.inputs.name),u.push([this.messages.writeName,c,c])),this.templateValidate(o.comment)&&""!=e.trim(o.comment)||(0==r.getUploadCount()?u.push([this.messages.writeComment,this.FormContainer.find(this.errorSelector.comment[0]),this.FormContainer.find(this.errorSelector.comment[1])]):o.comment=""),0==u.length){var d=this.FormContainer.find(".comment-body a.ajaxSubmit"),m={text:o.comment,name:o.name,parentCommentId:o.parentId,subscribeCheck:Boolean(o.subscribeCheck),subscribeEmail:o.subscribeEmail?o.subscribeEmail:!1,crossPost:o.crossPostCheck,customFields:a,imagesIds:o.images,progressElement:e(this.FormContainer).find(this.progressElement),successCallback:this.addCommentCallback,failureCallback:this.addCommentFailure,scope:this,param:e.extend({},a,o,{button:d})};n.fire("BeforePostComment",m)!==!1&&this.api.postComment(m)}else for(var h=0;h<u.length;h++)this.setError(u[h][0],u[h][1],u[h][2])},editActionHandler:function(t){t.preventDefault(),t.stopPropagation();var n=this.getCommentText();if(r.getUploadCount()||this.templateValidate(n)&&""!=e.trim(n)&&this.postMode==this.POST_MODE_NEW)h.showModalForm(this.editCommentTpl,{type:"dialog",hideTriangle:!0}),this.getClosestCommentContainer(e(t.target)).addClass(this.selectedComment),this.initializePopup(this.okEditBtnHandlerObj,this.cancelEditBtnHandlerObj);else{var i=this.getClosestCommentContainer(t.target);this.setFormToComment(i,this.POST_MODE_EDIT)}},okEditBtnHandler:function(t){t.preventDefault(),t.stopPropagation(),h.hideModal();var n=e("."+this.selectedComment);this.setFormToComment(n,this.POST_MODE_EDIT),n.removeClass(this.selectedComment),this.control.scrollTo.scroll("commentForm")},cancelEditBtnHandler:function(t){("keydown"!=t.type||27==t.keyCode)&&(t.preventDefault(),t.stopPropagation(),e(document).off("keydown",this.cancelEditBtnHandlerObj),e("."+this.selectedComment).removeClass(this.selectedComment),h.hideModal(),this.control.scrollTo.scroll("commentForm"))},updateCommentHandler:function(i){i.preventDefault(),i.stopPropagation();var o={},a={};this.collectFormData(o,a,i);var s=this.readCommentId(i.target);if(this.api.checkUploadProcess())return!1;if(o.deleteImages=r.getDeletedImages(),o.pastafarian=f.getUserKey(),n.fire("BeforeEditComment",o),"undefined"!=typeof o.comment){var l=this.getCommentContainer(s),c=this.getCommentContainerBody(l),u=c.find("blockquote:first p").text(),d=l.find(".comment .star-rating .active"),m=!1;d.size()&&(m=d.attr("data-value"));var h=!1;if(o.hasOwnProperty("user-rating")&&(h=o["user-rating"]),o.comment===u&&(""!=u||r.getUploadCount()>0)&&0==o.deleteImages.length&&0==this.getClosestCommentContainer(i.target).find("[new-image=true]").length&&!this.isForceUpdate()&&h===m)return this.setFormToThread(!1,null),!1}var p=this,v=e(i.target);return t.jsonRequest({url:t.getRightUrl("/ajax/comment/update/"+s),method:"POST",data:o,debug:this.control.config.debug,successCallback:function(i){i.hasOwnProperty("errorMessage")&&i.errorMessage&&alert(i.errorMessage);var a={pastafarian:f.getUserKey()};p.api.control.config.relatedThreads&&(a.relatedThreads=1),p.api.control.config.mergeTypes&&(a.mergeTypes=p.api.control.config.mergeTypes),t.jsonRequest({url:t.getRightUrl(p.commentUrl.replace("{commentId}",s)),method:"GET",data:a,debug:p.control.config.debug,successCallback:function(t){var i={comment:t};i.comment=C.convertContentUrls(e.trim(i.comment)),n.fire("CommentEditRender",i);var o=e(e.parseHTML(i.comment)),a=p.getCommentContainer(s),l=a.filter(function(){return e(this).closest("#CommentsList").size()}),c=a.filter(function(){return!e(this).closest("#CommentsList").size()}),u=p.getCommentContainerBody(l),d=p.getCommentContainerBody(o);u.replaceWith(d),c.remove(),p.control.imageUpload&&r.clearForm(),p.setFormToThread(!1,null),n.fire("UiInitialize"),p.api.utils.hilightReset(e("blockquote"));var m=o.find("blockquote");p.api.utils.hilight(m,m.hasClass("moderation")),n.fire("CommentEdit")},failureCallback:function(e,t,n){e="Сообщение добавлено, но произошла ошибка при попытке показать его. Администрация в курсе. Перезагрузите страницу для просмотра вашего сообщения.";try{p.addCommentFailure(e,{button:v},n)}catch(i){g.log(i)}},scope:this,progressElement:e(o.progressElement)})},failureCallback:function(e,t,n){try{p.addCommentFailure(e,{button:v},n)}catch(i){g.log(i)}},scope:this,param:null,progressElement:e(this.FormContainer).find(this.progressElement),logFunc:g.log}),v.prop("disabled","disabled"),!1},collectFormData:function(t,n,i){var o,r,a,s,l,c=this;for(e.each(this.inputs,function(n,i){var o=c.FormContainer.find(i).first();if(o.size()&&("checkbox"!=o.attr("type")||o.is(":visible"))){var r=o.val(),a=o.attr("placeholder")||o.prop("placeholder");t[n]=r===a?"":e.trim(r)}else t[n]=0}),t.name==this.FormContainer.find(this.inputs.name).attr("placeholder")&&(t.name=""),o=this.FormContainer.find(":input"),s=0;s<o.length;s++)if(r=e(o[s]),a=r.attr("type"),"radio"!=a&&(l=r.attr("name"),l&&"undefined"==typeof t[l])){var u="checkbox"==a?r.prop("checked")&&r.is(":visible"):e.trim(r.val());"undefined"==typeof this.inputs[l]?n[l]=u:t[l]=u}var d=i.srcElement?i.srcElement:i.target;if("undefined"!=typeof d){var m=e(d),h=m.attr("data-field");"undefined"!=typeof h&&(n[h]=e(d).attr("data-value"))}for(o=this.FormContainer.find(":radio:checked:visible"),s=0;s<o.length;s++)r=e(o[s]),a=r.attr("type"),l=r.attr("name"),l&&"undefined"==typeof t[l]&&(n[l]=e.trim(r.val()));if(this.control.imageUpload){var f=this.FormContainer.find(this.inputs.images);t.images=[],e.each(f,function(n,i){var o=e(i);t.images.push(o.val())})}else t.images=null},setProperCheckboxStateOnCallback:function(e){a.setSubscribeCheckerState(e.subscribeCheck),e.crossPostCheck?this.FormContainer.find(this.crossPostCheckSelector).attr("checked","checked"):this.FormContainer.find(this.crossPostCheckSelector).removeAttr("checked")},addCommentCallback:function(t,n,i,o){this.setProperCheckboxStateOnCallback(o),o.button.removeProp("disabled"),this.FormContainer.find(this.errorMsgSelector).hide().find("div").html(""),e.each(this.inputs,function(t,n){var i=e(n);"checkbox"!=i.attr("type")&&i.val("")}),this.FormContainer.find(this.inputs.name).val(o.name),this.FormContainer.find(this.inputs.subscribeEmail).val(o.subscribeEmail),this.control.imageUpload&&r.clearForm(),this.setFormToThread(!1,null)},sortFailureArray:function(e){for(var t=[],n=[],i=[],o=0;o<e.length;o++)"comment"==e[o].field?t.push(e[o]):"name"==e[o].field?n.push(e[o]):i.push(e[o]);return i.concat(n.concat(t))},addCommentFailure:function(e,t,n){this.setProperCheckboxStateOnCallback(t),t.button.removeProp("disabled");var i;if(!n||!n.data)return void this.setError(e,null,null);var o=n.data;for(o=this.sortFailureArray(o),j=0;j<o.length;j++)"comment"==o[j].field?this.setError(o[j].msg,this.FormContainer.find(".comment-body"),this.FormContainer.find("[name="+o[j].field+"]")):""!=o[j][1]?(i=this.FormContainer.find("[name="+o[j].field+"]"),i.length?this.setError(o[j].msg,i,i):this.setError(o[j].msg,null,null)):this.setError(o[j].msg,null,null)},templateValidate:function(t){var n=e.trim(y.commentTemplate);if(n){if(e.trim(t)==n)return!1;for(var i=e.trim(t).split("\n"),o=n.split("\n"),r=0;r<o.length;r++)if(o[r]=e.trim(o[r]),o[r])for(var a=0;a<i.length;a++)if(i[a]=e.trim(i[a]),i[a]){if(i[a]==o[r]){i[a]="";break}}else i[a]="";return e.trim(i.join(" "))}return!0},isPlaceholderValue:function(){var e=this.FormContainer.find("textarea[name=comment]");return(e.attr("placeholder")||e.prop("placeholder"))===e.val()},isForceUpdate:function(){return!1},setError:function(t,n,o){var r="Error: "+t+"\nComment: "+this.getCommentText();i.log("add-comment-failure",r);var a=null!=n?o.attr("name"):"others";this.errorFieldSelector[a]=n,""==e.trim(e(this.errorMsgSelector).text())?e(this.errorMsgSelector).find("."+a+"Error").html(t).show():""==e.trim(e(this.errorMsgSelector).find("."+a+"Error").text())?e(this.errorMsgSelector).find("."+a+"Error").hide().html(t).slideDown(this.slideUpDown):e(this.errorMsgSelector).find("."+a+"Error:animated").stop(!1,!0).html(t).slideDown(this.slideUpDown),e(this.errorMsgSelector).slideDown(this.slideUpDown),o&&(o.focus(),o.data("name",a).data("errorField",n),o.unbind("keypress paste",this.errorHandlerObj).bind("keypress paste",this.errorHandlerObj)),n&&!this.blockFlickerFlag[a]&&this.flickerStart(n,a)},flickerResetSingleField:function(t){var n=this.errorFieldSelector[t];n&&(this.blockFlickerFlag[t]=!1,this.redBorderTimeout[t]&&clearTimeout(this.redBorderTimeout[t]),this.flickerTimeOut[t]&&clearTimeout(this.flickerTimeOut[t]),e.each(n,function(){var t=e(this);t.stop();var n=t.data("original-borders");n&&t.css(n)}))},errorHandler:function(t){var n=e(t.target).data("name");this.flickerResetSingleField(n);var i=e(this.errorMsgSelector);i.find("."+n+"Error").slideUp(this.slideUpDown,function(){i.find("."+n+"Error").html("").show(),""==e.trim(i.text())&&i.hide()}),e(t.target).unbind("keypress paste",this.errorHandlerObj)},flickerStart:function(t,n){function i(t,n){var i={};e.each(["top","right","bottom","left"],function(e,t){i["border-"+t+"-color"]="red"}),t.animate(i,r.flickerTime,n)}var o=2,r=this;e.each(t,function(){var t=e(this);t.data("original-borders")||t.data("original-borders",{"border-top-color":t.css("border-top-color"),"border-right-color":t.css("border-right-color"),"border-bottom-color":t.css("border-bottom-color"),"border-left-color":t.css("border-left-color")})});for(var a=0;o>a;a++)this.flickerTimeOut[n]=setTimeout(function(){e.each(t,function(){var t=e(this);i(t,function(){t.animate(t.data("original-borders"),r.flickerTime)})})},a*this.flickerTime*2);this.redBorderTimeout[n]=setTimeout(function(){e.each(t,function(){i(e(this))})},o*r.flickerTime*2),this.blockFlickerFlag[n]=!0,setTimeout(function(){r.blockFlickerFlag[n]=!1},3*r.flickerTime)},flickerReset:function(){var t=this;e.each(this.redBorderTimeout,function(e,n){null!=n&&clearTimeout(t.redBorderTimeout[e])}),e.each(this.flickerTimeOut,function(e,n){null!=n&&clearTimeout(t.flickerTimeOut[e])}),e.each(this.errorFieldSelector,function(t,n){n&&e(n).each(function(){var t=e(this);t.data("original-borders")&&(t.stop(),this.style.borderTopColor="",this.style.borderRightColor="",this.style.borderBottomColor="",this.style.borderLeftColor="")})})},deleteActionCallback:function(e,t,n,i){this.hideComment(i,"Комментарий удален"),this.postMode!==this.POST_MODE_NEW&&this.setFormToThread(!1,null)},hideComment:function(t,n){var i=this.getCommentContainer(t),o=this.control.config;if(o.showDeletedComments){var r=i.find("blockquote:first"),a=r.find(".notifications");a.length&&a.remove(),e('<ul class="notifications"><li>'+n+"</li></ul>").prependTo(r),i.find(".complex-actions").remove()}else i.stop().slideUp(300,function(){e(this).remove()})},deleteActionFail:function(e){alert(e)},setApi:function(e){return this.api=e,this},setControl:function(e){return this.control=e,this},getCommentText:function(){return this.FormContainer.find("textarea").val()},setCommentText:function(e){this.FormContainer.find("textarea").val(e).trigger("autosize.resize")}};return x}),define("catalog/commentForm",["jquery","core","commentForm","catalog/commentText","events","config","catalog/branch"],function(e,t,n,i,o,r,a){var s=n,l={init:n.init,collectFormData:n.collectFormData,clearForm:n.clearForm,uiInitializer:n.uiInitializer,setCommentTextToTemplate:n.setCommentTextToTemplate},c=["resizeTextareaWidth"],u=function(){};s.authSelector=".cmt-auth-list a",r.isMobile()?s.progressElement=".comment-body":(s.errorSelector.comment=[".cmt-form-text textarea.cmt-input:visible:eq(0), .cmt-types-list-item.active",".cmt-form-text textarea.cmt-input:visible:eq(0)"],s.progressElement=".cmt-form-bottom");for(var d in c)c.hasOwnProperty(d)&&(s[c[d]]=u);return delete n.inputs.comment,s.init=function(){var e=this;i.init(),a.init(),l.init.call(s),this.FormContainer.find(".cmt-form-text textarea").on("keydown",function(t){t.ctrlKey&&13==t.keyCode&&(e.postMode===e.POST_MODE_EDIT?e.FormContainer.find(e.updateCommentBtnSelector).click():e.addCommentHandler(t))})},s.setCommentText=function(e){i.setValue(e)},s.collectFormData=function(e,t,n){l.collectFormData.call(this,e,t,n),e.comment=s.getCommentText(),t[a.selectors.inputName]=a.getValue(),e[a.selectors.inputName]=t[a.selectors.inputName]},s.getCommentText=function(){return r.isMobile()?e(".commentsvlru textarea#comment").val():i.getValue()},s.isPlaceholderValue=function(){var t=this.FormContainer.find("textarea"),n=!0;return t.each(function(){n=n&&(e(this).attr("placeholder")||e(this).prop("placeholder"))===e(this).val()}),n},s.flickerStart=function(t){e(t).addClass("cmt-error")},s.flickerResetSingleField=function(t){var n=this.errorFieldSelector[t];n&&(this.blockFlickerFlag[t]=!1,e(n).removeClass("cmt-error"))},s.flickerReset=function(){e.each(this.errorFieldSelector,function(t,n){n&&e(n).removeClass("cmt-error")})},s.clearForm=function(){l.clearForm.call(this),r.isMobile()||(i.clear(),a.clear())},s.setCommentTextToTemplate=function(){r.isMobile()&&l.setCommentTextToTemplate.call(this)},s.isTemplate=function(){var n=t.getModule("commentType");if(!n)return!1;var i=n.getValue(),o=["Дата посещения:\n\nПредлагаю:\n","Достоинства:\n\nНедостатки:\n\nКомментарий:\n","Дата посещения:\n\nНе понравилось:\n"],r=(s.getCommentText()||"").replace(/\r/g,""),a=!1;return(-1!==o.indexOf(r)||""===e.trim(r))&&("proposal"===i||"review"===i||"complaint"===i||"question"===i)&&(a=!0),a},s.imagesExists=function(){return!!e("#CommentForm .upload-form .item[image-id]").size()},s.uiInitializer=function(){l.uiInitializer.call(this),this.postMode===this.POST_MODE_REPLY?i.mode.single("Введите текст комментария",!0):i.mode.multi("")},s.isForceUpdate=function(){return this.postMode===this.POST_MODE_EDIT&&a.isChanged()},s}),define("catalog/commentType",["jquery","events"],function(e,t){function n(){e(l+" "+c).off("click",r).on("click",r);var t=e(l),n=t.find(c);if(n.length){var i=t.find("input[name=commentType]").val();n.removeClass("active"),n.filter('[data-key="'+i+'"]').addClass("active")}}function i(){return e(l+" "+u).val()}function o(i){e(l+" "+u).val(i),t.fire("ChangeCommentType",i);var o=e(".commentsvlru input[name=name]");""!==e.trim(o.val())&&e(".commentsvlru textarea[name=comment]:visible:eq(0)").focus(),n()}function r(){var t=e(this);if(!t.hasClass("active")){var n=t.attr("data-key");o(n)}}function a(e){e.hasOwnProperty("parentCommentId")&&"0"!==Number(e.parentCommentId||0).toFixed(0)&&e.hasOwnProperty("customFields")&&e.customFields.hasOwnProperty("commentType")&&delete e.customFields.commentType}function s(){t.on("UiInitialize",n),t.on("BeforePostComment",a)}var l="#CommentForm .cmt-form-types",c="[data-key]",u="input[name=commentType]";return{init:s,getValue:i,setValue:o}}),define("catalog-mobile/commentType",["jquery","events"],function(e,t){function n(){var t=e(l);if(!t.data("init-done")){var n=t.find(".list");t.find("label").hide(),e("body").on("click",function(t){var i=e(t.target);i.closest(".formFieldContainer").is('[field="commentType"]')||n.removeClass("active")}),t.find(".cmt-type-item").on("click",function(){o(e(this).data("key"))}),t.on("click",function(t){var i=e(t.target);return(i.hasClass("formFieldContainer")||i.closest(".formFieldContainer").is('[field="commentType"]'))&&n.hasClass("active")?void n.removeClass("active"):void(i.closest("div.list").length?n.removeClass("active"):n.addClass("active"))}),t.data("init-done",!0)}}function i(){return e(l).find('input[name="commentType"]').val()}function o(n){var i=e(l);i.find('input[name="commentType"]').val(n);var o=i.find(".list");o.removeClass("active"),o.find(".current").removeClass("current");var r=o.find("[data-key="+n+"]");r.addClass("current"),i.find(".cmt-title").text(r.text()),t.fire("ChangeCommentType",n)}function r(e){e.customFields.commentType=i(),e.hasOwnProperty("parentCommentId")&&"0"!==Number(e.parentCommentId||0).toFixed(0)&&e.hasOwnProperty("customFields")&&e.customFields.hasOwnProperty("commentType")&&delete e.customFields.commentType}function a(n){var o=function(){var t=i(),o=e("#comment");if(!t||0==o.length)return null;var r=o.attr("placeholder")||o.prop("placeholder"),a=["Дата посещения:\n\nПредлагаю:\n","Достоинства:\n\nНедостатки:\n\nКомментарий:\n","Дата посещения:\n\nНе понравилось:\n"],s=o.val().replace(/\r/g,"");return-1!==a.indexOf(s)||""===e.trim(s)||s===r?("proposal"===t?n.tpl=a[0]:"review"===t?n.tpl=a[1]:"complaint"===t?n.tpl=a[2]:"question"===t&&(n.tpl=""),n.tpl):null};t.on("ChangeCommentType",function(){n.tpl=o(),null!==n.tpl&&(e("#comment").val(n.tpl),commentsvlru.fire("commentResize"))}),o()}function s(){t.on("UiInitialize",n),t.on("BeforePostComment",r),t.on("onApplyCommentTemplate",a)}var l='.commentsvlru .formFieldContainer[field="commentType"]';return{init:s,getValue:i,setValue:o}}),define("catalog/commentText",["jquery","events","config","catalog/branch","core"],function(e,t,n,i,o){function r(){var t,n=o.getModule("commentType"),r=n?n.getValue():null,a=0;e(b).find(y).each(function(){var n=e(this),i=e.trim(n.find(C).text());t=t||n.is(w),e.inArray(i,_[r])>=0||e.trim(n.find(x).val()).length?(n.show(),a++):n.hide()}),t&&1===a&&i.isHidden()?d("Что интересует?",!1):h("")}function a(){var t=e(this);t.toggleClass("active",e.trim(t.val()).length>0)}function s(){var t={},n=0,i=[];if(e(b).find(y).each(function(){var i=e(this),o=e.trim(i.find(C).text()),r=e.trim(i.find(x).val());r.length&&("undefined"==typeof t[o]&&(t[o]=[]),t[o].push(r),n++)}),n){1!==n&&"undefined"!=typeof t[T]&&(t[S]="undefined"==typeof t[S]?t[T]:t[S].concat(t[T]),delete t[T]);for(var o in t)t.hasOwnProperty(o)&&i.push(o+"\n"+t[o].join("\n"))}return i.join("\n\n")}function l(t){var i,o,r,a,s={},l=t.split("\n"),u=[],m=S,f=0;c();for(i in _)if(_.hasOwnProperty(i))for(o in _[i])_[i].hasOwnProperty(o)&&_[i][o]!=T&&-1==e.inArray(_[i][o],u)&&u.push(_[i][o]);for(i in l)l.hasOwnProperty(i)&&(r=e.trim(l[i]),a=r.split(":",1)[0],a===r?a="":a+=":",-1!=e.inArray(a,u)&&(m=a,r=e.trim(r.substring(a.length))),r.length&&("undefined"==typeof s[m]&&(s[m]=[]),s[m].push(r),f++));f?(h(""),n.isMobile()?e("#CommentsList").find("textarea").val(t).trigger("autosize.resize"):e(b).find(y).each(function(){var t=e(this),n=e.trim(t.find(C).text());"undefined"!=typeof s[n]?(t.find(x).addClass("noTransition").val(s[n].join("\n")).trigger("change").trigger("autosize.resize").removeClass("noTransition"),t.show()):t.hide()})):d("Введите текст комментария",!1)}function c(){n.isMobile()?u(e('.commentsvlru [name="comment"]')):e(b+" textarea").each(function(){u(e(this))})}function u(e){e.val("").trigger("blur.placeholder").trigger("change").trigger("autosize.resize")}function d(t,n){if(!(I&&9>I)||n){e(b).find(y).hide();var i=e(b).find(y+w);i.find(k).attr("colspan",2),f(i.find(x),t),i.addClass("single").show(),e(v).addClass("cmt-one-field")}}function m(e){h(e),r()}function h(t){var n=e(b).find(y+w);n.find(k).removeAttr("colspan"),f(n.find(x),t),n.removeClass("single"),e(v).removeClass("cmt-one-field")}function f(e,t){if(!(I&&9>I)){var n=e.attr("placeholder")||e.prop("placeholder"),i=!1;e.val()===n?e.attr("placeholder","").prop("placeholder","").val("").trigger("blur.placeholder"):i=!0,(i||t)&&e.attr("placeholder",t).prop("placeholder",t).trigger("blur.placeholder")}}function p(){function t(){n=i.width(),setTimeout(function(){n<i.width()&&(i.trigger("autosize.resize"),t())},100)}var n,i=e(this);t()}function g(){var n=e(b+" textarea");n.hide().autosize({append:""}).show(),r(),n.on("change",a),n.on("paste",p),t.on("ChangeCommentType",r)}var v="#CommentForm",b=v+" .cmt-form-text",y=".cmt-field",C=".cmt-field-label",k=".cmt-field-data",x="textarea.cmt-input",w=".blank",_={review:["Достоинства:","Недостатки:","Комментарий:"],question:[""],complaint:["Дата посещения:","Не понравилось:"],proposal:["Дата посещения:","Предлагаю:"]},T="",S="Комментарий:",I=function(){for(var e,t=3,n=document.createElement("div"),i=n.getElementsByTagName("i");n.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->",i[0];);return t>4?t:e}();return{init:g,getValue:s,setValue:l,clear:c,mode:{single:d,multi:m}}}),define("catalog/widget",["jquery","core","console","profile","widget"],function(e,t,n,i,o){function r(t){if(!t.hasOwnProperty("target"))return void n.log("Wrong config");if(!t.hasOwnProperty("url"))return void n.log("Wrong config");var r=e("#"+t.target);return o.init({target:r,url:t.url,onLoad:function(){r.find(".rating").each(function(t,n){var i=18*e(n).data("rating")*5;e(n).css("width",i+"px")}),r.on("click",".cmt-profile__link",i.profileLinkClick)}})}return{init:r}}),define("catalog/collapsedForm",["jquery","events","catalog/commentForm"],function(e,t,n){function i(t,n){if(C){if(C=!1,!c())return void o(n,function(){return r(n,!1)});e(g).removeClass("collapsed"),e("#temp-comment-body").remove(),r(n),t&&v.height&&e(".commentsvlru .commentBase").css("min-height",v.height),o(n),e("body").off("click.collapsed").on("click.collapsed",d)}}function o(e,t){e&&p.control.scrollTo.scroll(y,t)}function r(t){var n=e(".commentsvlru textarea[name=comment]"),i=e(".commentsvlru input[name=name]"),o=e(".commentsvlru textarea[name=comment]:visible:eq(0)");v.placeholder&&(f(v.placeholder,!0),v.placeholder=null);var r=!1;if(v.text&&""==e.trim(n.val())&&(p.features.commentForm.setCommentText(v.text),r=!0),t&&0!=i.val().length)if(e(".commentsvlru").hasClass("company"))o.focus();else if(r){var a=v.text.split("\n")[0].length;a&&h(n.get(0),a+1)}else n.focus()}function a(){i(!0,!0)}function s(){C=!0,p.control.scrollTo.scroll(y,a)}function l(){var i=e(".commentsvlru"),o=i.find("textarea[name=comment]"),r=i.find(".commentBase"),s=p.features.commentForm;s.postMode!=s.POST_MODE_NEW||!n.isTemplate()||n.imagesExists()||c()||s.getCommentText()&&s.isPlaceholderValue()||(e(g).addClass("collapsed"),
v.text=s.isPlaceholderValue()?"":s.getCommentText(),v.height=r.css("min-height"),v.placeholder=[],o.each(function(){v.placeholder.push(e(this).attr("placeholder")||e(this).prop("placeholder"))}),r.css("min-height","inherit"),i.hasClass("company")?(i.find(".cmt-form-login").append('<div class="comment-body" id="temp-comment-body"><textarea placeholder="'+b+'" rows="1"></textarea></div>'),i.find(".cmt-form-login textarea").placeholder(),e("#temp-comment-body textarea").on("focus",a)):(f(b,!1),o.val("").trigger("autosize.resize").height("auto"),o.on("focus",a)),C=!0,e("body").off("click",d),t.fire("UiInitialize"))}function c(){return e("#CommentForm").hasClass("collapsed")}function u(n){p=n,t.on("BeforeSetFormToComment",function(){var t=e(".commentsvlru .commentBase");t.css("min-height",t.height()),v.text="",i(!1,!1)}),t.on("SetFormToComment",function(){r(!0)}),t.on("SetFormToThread",l),t.on("ThreadLoad",l),t.on("ClickNoMoreComments",s),l(),e("body").on("click",d)}function d(t){e(t.target).closest("#CommentForm").size()||l()}function m(e,t,n){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,n);else if(e.createTextRange){var i=e.createTextRange();i.collapse(!0),i.moveEnd("character",n),i.moveStart("character",t),i.select()}}function h(e,t){m(e,t,t)}function f(t,n){var i=e(".commentsvlru textarea[name=comment]");n&&(i.attr("placeholder","").prop("placeholder","").val(""),i.trigger("blur.placeholder")),i.each(function(n){t&&"undefined"!=typeof t[n]&&"string"!=typeof t?(e(this).attr("placeholder",t[n]).prop("placeholder",t[n]),e(this).trigger("blur.placeholder")):t&&"string"==typeof t&&(e(this).attr("placeholder",t).prop("placeholder",t),e(this).trigger("blur.placeholder"))})}var p,g=".commentsvlru #CommentForm, .commentsvlru .notification-rules",v={text:null,height:null,placeholder:null},b="Оставить отзыв",y="commentForm",C=!1;return{init:u,show:i,hide:l,isCollapsed:c,setCursor:r}}),define("catalog/mobileCollapsedForm",["jquery","events","handlebars","catalog/commentForm","catalog/collapsedForm"],function(e,t,n,i,o){var r="#MobileCollapsedForm",a="60px",s=null,l=function(){var t=e(".commentsvlru .commentBase");t.addClass("cmt-collapsed"),t.css("min-height",a),e(window).off("scroll.collapsedForm").on("scroll.collapsedForm",u).off("resize.collapsedForm").on("resize.collapsedForm",c)},c=function(){var t=e(".commentsvlru .commentBase");d(t)},u=function(){var t=e(".commentsvlru .commentBase"),n=t.offset().top,i=e(this).scrollTop();i>n?(t.hasClass("cmt-collapsed-form-fix")||t.addClass("cmt-collapsed-form-fix"),d(t)):t.removeClass("cmt-collapsed-form-fix")},d=function(e){e.find(".cmt-mobile-collapsed-form:first").width(e.width())},m=function(){var t=e(".commentsvlru .commentBase");t.removeClass("cmt-collapsed"),s.control.scrollTo.scroll("commentForm",function(){o.setCursor(!0)})},h=function(i){s=i;var o=e(".commentsvlru .commentBase");if(o.length){var a=e(r).html(),c=n.compile(a)();o.append(c),l(),t.on("BeforeSetFormToComment",function(){var t=e(".commentsvlru .commentBase");t.css("min-height",t.height())}),t.on("SetFormToComment",function(){var t=e('.commentsvlru [name="name"]');t.size()&&t.val().length&&e('.commentsvlru [name="comment"]').focus()}),t.on("SetFormToThread",l),o.find(".cmt-mobile-collapsed-form-button").on("click",m),t.on("ClickNoMoreComments",function(){m()})}};return{init:h}}),define("catalog/primkuponUser",["jquery","events","core","config","userName","logger"],function(e,t,n,i,o,r){function a(e){var t,o=null;try{t=n.getCookie(h)}catch(r){o=r}if(null!==f&&u({"function":"beforePostCommentHandler start",cmtPrimCookie:t,error:o}),"undefined"!=typeof t){for(var a=n.getCookie(h).split(","),s=0;s<a.length;s++)if("undefined"!=typeof a[s]){var l=a[s].split(":");l[0]==i.threadId&&(e.customFields[d]=l[1])}u({"function":"beforePostCommentHandler done",cmtPrimCookie:t,postCommentData:e})}}function s(e){var t,o=n.getCookie(h),r=[],a=!1;if(o){r=o.split(",");for(var s=0;s<r.length;s++)"undefined"!=typeof r[s]&&(t=r[s].split(":"),i.threadId==t[0]&&(r[s]=i.threadId+":"+e,a=!0))}a||r.push(i.threadId+":"+e);var l=r.join(",");return n.setCookie(h,l,1,"/"),l}function l(e){o.isEmptyDisplayName()&&o.setDisplayName(e)}function c(){var e=n.getQueryParam(d);if(e){var t=n.getCookie(h),i=s(e),o=n.getQueryParam(m);o&&l(o),f=Math.random()+"_"+JSON.stringify(new Date),u({"function":"onThreadLoad",cmtPrimFromQuery:e,cmtPrimOldCookie:t,cmtPrimNewCookie:i})}}function u(e){try{e.threadId=i.threadId,e.trackingId=f,e.cookie=document.cookie,e.cookieEnabled=document.cookieEnabled}catch(t){}r.log("primkupon","dbg-user",JSON.stringify(e))}var d="cmtPrim",m="cmtName",h="prim-keys",f=null;return{init:function(){t.on("ThreadLoad",c),t.on("BeforePostComment",a)}}}),define("catalog/autocomplete",["jquery"],function(e){function t(t,i,o){i=e.extend(w,i||{}),t.typeahead(i,o),n(t)}function n(e){e.on("focus",u),e.on("blur",d),e.on("typeahead:select",d),r(e),i(e)}function i(e){e.on("keyup paste blur typeahead:select",function(){o(e)}),o(e)}function o(e){c(e).off("click"),e.val()?c(e).on("click",p(e)).attr("data-action","cmt-autocomplete-clear"):c(e).on("click",g(e)).removeAttr("data-action")}function r(e){l(e).on("mousedown",g(e))}function a(e){var t=e.data("dropDownTimer");t&&window.clearTimeout(t),t=window.setTimeout(function(){r(e)},50),e.data("dropDownTimer",t)}function s(e){var t=e.data("dropDownTimer");t&&window.clearTimeout(t),l(e).off("mousedown")}function l(e){return e.closest(x.wrapper).find(x.dropDown)}function c(e){return e.closest(x.wrapper).find(x.searchClear)}function u(){var t=e(this);t.closest(x.wrapper).addClass("focus"),s(t)}function d(){var t=e(this);t.closest(x.wrapper).removeClass("focus"),a(t)}function m(e,t){e.on("blur",h(t))}function h(t){return function(){-1===t.indexOf(e(this).val())&&f(e(this))}}function f(e){v(e,"")}function p(e){return function(){f(e)}}function g(e){return function(){return e.focus(),!1}}function v(e,t){var n=k(e);n!==t&&(e.val(t),e.typeahead("val",t),o(e))}function b(e){return C(e)?"":e.val()}function y(e){C(e)||v(e,e.val())}function C(e){var t=k(e),n=e.val();return n==t}function k(e){return e.attr("placeholder")||e.data("placeholder")}var x={wrapper:".cmt-autocomplete-wrapper",input:".cmt-autocomplete",dropDown:".cmt-autocomplete-dropdown",searchClear:".cmt-autocomplete-search-clear"},w={classNames:{input:"cmt-tt-input",hint:"cmt-tt-hint",menu:"cmt-tt-menu",dataset:"cmt-tt-dataset",suggestion:"cmt-tt-suggestion",empty:"cmt-tt-empty",open:"cmt-tt-open",cursor:"cmt-tt-cursor",highlight:"cmt-tt-highlight",selectable:"cmt-tt-selectable"}};return{init:t,setAvailable:m,clear:f,setValue:v,getValue:b,refresh:y}}),define("catalog/branch",["jquery","events","config","catalog/autocomplete","core","console"],function(e,t,n,i,o,r){function a(t){if(e.isArray(C))return void t(C);var i=w.getItem(n.threadId);return e.isArray(i)?(C=i,void t(i)):void o.jsonRequest({url:o.getRightUrl("/ajax/catalog/branch/"+n.threadId),method:"GET",debug:n.debug,successCallback:function(e){C=e,t(e),w.setItem(n.threadId,e)},failureCallback:function(e){r.log("Get branch error: "+e)}})}function s(){k&&e(x.wrapper).show()}function l(){e(x.wrapper).hide()}function c(t){var n=e(x.input),o=function(t){return function(n,i){var o=[],r=new RegExp(n,"i");e.each(t,function(e,t){r.test(t)&&o.push(t)}),i(o)}};i.init(n,{hint:!0,highlight:!0,minLength:0},{name:n.attr("name"),source:o(t)}),i.setAvailable(n,t),k=!0}function u(e){e.length>1?(c(e),s()):l()}function d(){a(u),t.on("SetFormToComment",m)}function m(t){t.postMode===t.POST_MODE_EDIT&&"0"===h().attr("level")?(i.setValue(e(x.input),f()),s()):(p(),l())}function h(){return e("#CommentForm").closest("[comment]")}function f(){var e=h().find("[data-cmt-company-branch]").data("cmt-company-branch");return e?e:""}function p(){i.clear(e(x.input))}function g(){return f()!==e(x.input).val()}function v(){return"none"===e(x.wrapper).css("display")}function b(){return i.getValue(e(x.input))}function y(){i.refresh(e(x.input))}var C,k=!1,x={wrapper:".cmt-form-branch",input:"#cmt-branch",inputName:"companyBranch"},w={ttl:864e5,key:"cmt-company-branches-",support:function(){try{return"localStorage"in window&&null!==window.localStorage&&"object"==typeof JSON&&"function"==typeof JSON.stringify&&"function"==typeof JSON.parse}catch(e){return!1}},getKey:function(e){return w.key+e.toString()},getItem:function(e){if(!w.support())return!1;var t=window.localStorage.getItem(w.getKey(e));if(!t)return!1;var n=JSON.parse(t);return!n||"undefined"==typeof n.value||"undefined"==typeof n.expires||n.expires<(new Date).getTime()?!1:n.value},setItem:function(e,t){if(w.support()){var n={value:t,expires:(new Date).getTime()+w.ttl};window.localStorage.setItem(w.getKey(e),JSON.stringify(n))}}};return{init:d,clear:p,selectors:x,isChanged:g,isHidden:v,getValue:b,refresh:y}}),define("formTypeDetect",["jquery","events","config"],function(e,t,n){function i(){for(var e in l)if(l.hasOwnProperty(e)&&l[e].call())return e;return"unknown"}function o(e){e.customFields[s]=i()}function r(e){a=e,t.on("BeforePostComment",o)}var a,s="formType",l={mobile:function(){return n.isMobile()},answer:function(){return!!a&&!!a.FormContainer&&!!a.FormContainer.closest("[comment]").size()},standard:function(){return!!a&&!!a.FormContainer&&!!a.FormContainer.parent().hasClass("commentBase")}};return{init:r,detectFormType:i}}),define("bindAnonymousCommentsDialog",["events","config","core","pastafarian","modalForms","console"],function(e,t,n,i,o,r){var a={profileId:null,resizeHandler:null};return a.load=function(){n.jsonRequest({url:n.getRightUrl("/ajax/bind-anonymous-comments"),method:"GET",data:{profileId:a.profileId,pastafarian:i.getUserKey()},successCallback:$.proxy(a.show,a),failureCallback:function(e,t,n){r.log("dialog load error"),r.log([e,t,n])}})},a.show=function(e){o.showModalForm("",{clickedTarget:$(event.target),type:"dialog",hideTriangle:!0},e.content),this.setCommentsBlockHeight(),$(window).on("resize",this.setCommentsBlockHeight),o.modalForm.find(".cmt-bac__cancel").off("click",a.cancel).on("click",a.cancel),o.modalForm.find(".cmt-bac__ok").off("click",a.bind).on("click",a.bind)},a.setCommentsBlockHeight=function(){$(".cmt-bac").each(function(){var e=$(this);e.find(".cmt-bac__content").css("max-height",.5*$(window).height());var t=e.find(".cmt-bac__wrap").outerHeight(!0)+1;o.modalForm.css("height",t),o.centerModalForm()})},a.cancel=function(e){e.preventDefault(),e.stopPropagation(),n.jsonRequest({url:n.getRightUrl("/ajax/bind-anonymous-comments/bind"),method:"POST",data:{profileId:a.profileId,pastafarian:i.getUserKey(),ids:[]},progressElement:e.target,successCallback:function(){o.hideModal()},failureCallback:function(){o.hideModal()}})},a.bind=function(e){e.preventDefault(),e.stopPropagation();var t=[],r=o.modalForm.find('.cmt-bac__item__sidebar input[type="checkbox"]:checked');r.each(function(){t.push($(this).attr("data-comment-id"))}),n.jsonRequest({url:n.getRightUrl("/ajax/bind-anonymous-comments/bind"),method:"POST",data:{profileId:a.profileId,pastafarian:i.getUserKey(),ids:t},progressElement:e.target,successCallback:function(){o.hideModal()},failureCallback:function(){o.modalForm.find(".cmt-bac__bind-error").show(),a.setCommentsBlockHeight()}})},a.onThreadLoad=function(e){t.isMobile()||e.hasOwnProperty("bindAnonymousCommentsDialog")&&e.bindAnonymousCommentsDialog&&(this.profileId=e.bindAnonymousCommentsDialog,this.load())},a.init=function(){t.embedded?e.on(["ThreadLoad"],$.proxy(a.onThreadLoad,a)):t.bindAnonymousCommentsDialog&&(a.profileId=t.bindAnonymousCommentsDialog,e.on(["ThreadInit"],$.proxy(a.load,a)))},{init:a.init}}),define("authMotivator",["core","events","modalForms","console"],function(e,t,n,i){"use strict";function o(){e.setCookie(m,"1",3650,"/"),$(h).remove()}function r(e){e.preventDefault(),e.stopPropagation(),n.showModalForm(f,{clickedTarget:$(e.target),message:"Выберите способ авторизации:"})}function a(e){e&&e.hasOwnProperty("initAuthMotivatorDialog")&&e.initAuthMotivatorDialog&&l()}function s(){n.hideModal()}function l(){var t=$(".commentsvlru").hasClass("catalog-mobile")?1:0,o="/widgets/auth-motivator-dialog?returnUrl="+encodeURIComponent(window.location.href)+"&isMobile="+t;e.jsonRequest({url:e.getRightStaticUrl(o),method:"GET",successCallback:function(e){n.showModalForm(null,{type:"dialog",hideTriangle:!0},e),c(n.modalForm),n.modalForm.find(".cmt-button-hide").on("click touchstart",s),n.modalForm.find(".cmt-icon-hide").on("click touchstart",s)},failureCallback:i.log,logFunc:i.log})}function c(e){e.find(".cmt-auth a.cmt-auth-icon").each(function(e,t){var n=$(t);-1===n.attr("href").indexOf("&action=")&&n.attr("href",n.attr("href")+"&action=authMotivator"),-1===n.attr("href").indexOf("&bindComments=")&&n.attr("href",n.attr("href")+"&bindComments=1")})}function u(e,t){var n=t.prop("clickedTarget");n&&n.size()&&n.hasClass("cmt-auth")&&n.closest(".cmt-auth-motivator").size()&&t.find(".open-auth-link").each(function(e,t){var n=$(t);-1===n.attr("href").indexOf("&action=")&&n.attr("href",n.attr("href")+"&action=authMotivator")})}function d(){e.getCookie(m)||$(h).each(function(){var e=$(this);e.find(".hide").off("click touchstart",o).on("click touchstart",o),e.find(".cmt-auth").off("click touchstart",r).on("click touchstart",r),e.show()})}var m="cmt-auth-motivator",h=".commentsvlru .cmt-auth-motivator",f="#AuthModalForm";return{init:function(){t.on(["UiInitialize"],d),t.on(["AfterCommentAdd"],a),n.addFormUIInitializer(f,u,this)}}}),define("primkupon/publishToSpravochnik",["jquery","events","config","core"],function(e,t,n,i){function o(n){n.stopPropagation(),n.preventDefault();var o=e(n.target);if(!o.hasClass("disabled")){o.addClass("disabled");var s=o.data("comment-id"),l=i.getRightUrl("/ajax/primkupon/publish-to-spravochnik");i.jsonRequest({url:l,method:"POST",data:{commentId:s},progressElement:n.target,successCallback:function(){a?t.fire("CommentPublishToSpravochnik"):r.utils.renderComment(s)}})}}var r,a=!1,s='[action="publish-to-spravochnik"]';return{init:function(t,n,i){a=n,r=i,e(".cmt-primkupon-action").show(),t.off("click",s,o).on("click",s,o)}}}),define("complaint",["jquery","core","modalForms","events","pastafarian"],function(e,t,n,i,o){function r(t){t.preventDefault(),t.stopPropagation();var n=e(t.target),i=n.closest(h);a(i,null,-23,0)}function a(t,i,o,r){if(t.hasClass("need-login"))return void n.showModalForm(p,{$parent:i,clickedTarget:t,message:"Жалобы доступны только авторизованным пользователям, пожалуйста, авторизуйтесь",leftOffset:o,topOffset:r});var a=t.data("comment-id");n.showModalForm("#ComplaintCreate",{type:"dialog",hideTriangle:!0}),e("#okModal").off("click",l(a)).on("click",l(a)),e("#cancelModal").off("click",d).on("click",d),e(document).off("keydown",d).on("keydown",d),e("#complainModal textarea").off("focus",s).on("focus",s)}function s(){e(this).closest("label").find("input[type=radio]").trigger("click")}function l(n){return function(i){i.preventDefault(),i.stopPropagation();var r=e("#complainModal"),a=r.find("input[type=radio]:checked");if(!a.size())return void r.find(".error").show().html("Необходимо выбрать причину жалобы");var s={id:n,type:a.val(),pastafarian:o.getUserKey()},l=a.parent().find("textarea");if(l.size()){if(0===e.trim(l.val()).length)return void r.find(".error").show().html("Введите, пожалуйста, причину жалобы");s.text=l.val()}var d=t.getRightUrl("/ajax/comment/add-complaint");t.jsonRequest({url:d,method:"POST",data:s,successCallback:c,failureCallback:u,param:s,progressElement:e("#okModal")})}}function c(t,i,o,r){e('[comment="'+r.id+'"]').slideUp(300,function(){e(this).hide()}),n.hideModal(),n.showModalForm("#ComplaintCreateOk",{type:"dialog",hideTriangle:!0}),e(document).off("keydown",d).on("keydown",d).off("click",d).on("click",d),f&&clearTimeout(f),f=setTimeout(d,3e3)}function u(e){n.modalForm.find(".error").text(e).show()}function d(t){if(t){if("keydown"==t.type&&27!=t.keyCode)return;t.preventDefault(),t.stopPropagation()}n.hideModal(),e(document).off("keydown",d).off("click",d),f&&clearTimeout(f)}function m(){var t=e(".commentsvlru"),n=t.find(h);n.off("click",r).on("click",r),n.show()}var h='[action="complaint-create"]',f=null,p="#AuthModalForm";return{init:function(){i.on("UiInitialize",m),m()},doLinkClick:a}}),define("subscribeEvents",["jquery","events","modalForms","config"],function(e,t,n,i){function o(){var e=require("catalog/tabs");!e||e.isActiveTab("complaint")||i.isMobile()?t.on("AfterCommentAdd",a):t.on("BeforeCommentAddRender",r)}function r(e){function n(){t.off("ThreadLoad",n),a(e)}e.hasOwnProperty("attributes")&&"object"==typeof e.attributes&&e.attributes.hasOwnProperty("requireApprovedEmail")&&e.attributes.requireApprovedEmail&&t.on("ThreadLoad",n)}function a(t){var i=e("[comment="+t.id+"]:eq(0)");if(1==i.attr("requireapprovedemail")){var o=i.find(".comment-body"),r=o.parent();r.hasClass("content")&&(o=r),n.alert("#CmtMailAlert",{clickedTarget:o,hideTriangle:!0},1e4),n.modalForm.css({"margin-top":-1*o.outerHeight(),width:o.outerWidth()})}}function s(){t.on("ThreadLoad",o)}return{init:s}}),define("handlebars-profile-container",[],function(){return'<div class="cmt-profile"><div class="cmt-profile__overlay"></div><div class="cmt-profile__content-wrap"><div class="cmt-profile__content-helper"><div class="cmt-profile__trobber">Загрузка данных профиля...</div><div class="cmt-profile__reload">Не удалось загрузить профиль пользователя. <span class="cmt-profile__reload-action">Повторить</span></div></div></div><div class="cmt-profile__close" title="Закрыть профиль"></div></div>'}),define("handlebars-embedded-profile",[],function(){return'<div class="cmt-profile__content"><div class="cmt-profile__form{{#if editable}} cmt-profile__form-editable{{/if}}"><div class="cmt-profile__avatar{{#if editable}} cmt-profile_editable{{/if}}">{{#if editable }}<div class="cmt-profile__avatar-image">{{#if avatar}}<img src="{{avatar}}" alt=""/>{{else}}<div class="cmt-profile__avatar-stub"></div>{{/if}}</div><div class="cmt-profile__avatar-form"><input name="avatar" type="file" accept="image/*"/><div class="cmt-profile__avatar-hint">изменить фото</div><div class="cmt-profile__avatar-delete" title="удалить фото"></div><div class="cmt-profile__avatar-shadow"></div></div>{{else}}{{#if avatar}}<img src="{{avatar}}" alt=""/>{{else}}<div class="cmt-profile__avatar-stub"></div>{{/if}}{{/if}}</div><div class="cmt-profile__fields"><div class="cmt-profile__display-name">{{#if provider }}<a class="cmt-profile__provider-url" href="{{ provider.url }}" target="_blank"><div class="cmt-profile__provider-icon {{ provider.name }}"></div></a>{{/if}}{{#if editable }}<div class="cmt-profile__label cmt-profile__editable" title="Щелкните для редактирования">{{ displayName }}</div><input type="text" name="displayName" value="{{ displayName }}" maxlength="50"/>{{else}}{{#if showFollowButton }}<div class="cmt-profile__right-block"><div class="cmt-profile__follow-action{{#unless canFollow}} cmt-profile__not-follow{{ else }} cmt-profile__follow{{/unless}}{{#if currentUserAnon}} need-login{{/if}}" action="{{#unless canFollow}}unfollow{{else}}follow{{/unless}}" data-profile-id="{{ profileId }}" data-project-id="{{ projectId }}"><div class="cmt-profile__button"><div class="cmt-profile__button-text cmt-profile__button-cancel" title="Отписаться от профиля">Отписаться</div><div class="cmt-profile__button-text cmt-profile__button-following">Подписан</div><div class="cmt-profile__button-text cmt-profile__button-follow" title="Подписаться на профиль">Подписаться</div></div></div></div>{{/if}}<div class="cmt-profile__label">{{ displayName }}</div>{{/if}}</div>{{#if activeSince}}<div class="cmt-profile__active-since">на сайте {{ activeSince }}</div>{{/if}}{{#if editable}}<div class="cmt-profile__birthday-sex-wrapper"><span class="cmt-profile__birthday">дата рождения:&nbsp;<input type="text" name="birthday" value="{{ birthday }}"/></span><span class="cmt-profile__sex-edit">пол:&nbsp;<select><option></option><option value="1"{{#if sexM}} selected="selected"{{/if}}>мужской</option><option value="2"{{#if sexF}} selected="selected"{{/if}}>женский</option></select></span></div>{{else}}{{#if age}}<span class="cmt-profile__age">возраст: {{ age }}</span>{{/if}}{{#if sexName}}<span class="cmt-profile__sex">пол: {{ sexName }}</span>{{/if}}<div class="cmt-clearfix"></div>{{/if}}</div><div class="cmt-profile__fields-stat"><div class="cmt-profile__stat"><span class="cmt-profile__rating" title="Рейтинг">{{ rating }}</span><span class="cmt-profile__likes cmt-profile__likes-for" title="Нравится"><span class="cmt-profile__likes-action"></span><span class="cmt-profile__likes-counter">{{ likes }}</span></span><span class="cmt-profile__likes cmt-profile__likes-against" title="Не нравится"><span class="cmt-profile__likes-action"></span><span class="cmt-profile__likes-counter">{{ dislikes }}</span></span></div></div></div><div class="cmt-profile__error-text"></div><div class="cmt-profile__menu"><div class="cmt-profile__menu-block"><div class="cmt-profile__menu-item cmt_active" data-target=".cmt-profile__comments-wrap"><span>Комментарии</span><span class="cmt-profile__menu-count">{{ commentsCount }}</span></div>{{#if achievements.visible }}<div class="cmt-profile__menu-item" data-target=".cmt-profile__achievements-wrap"><span>Награды</span><span class="cmt-profile__menu-count">{{ achievements.activeCount }}</span></div>{{/if}}{{#if enableFollowers }}<div class="cmt-profile__menu-item cmt-profile__menu-item-followig{{#unless followingsCount}} cmt-motivation{{/unless}}" data-target=".cmt-profile__following"><span>Подписки</span><span class="cmt-profile__menu-count">{{ followingsCount }}</span></div><div class="cmt-profile__menu-item cmt-profile__menu-item-follower{{#unless followersCount}} cmt-motivation{{/unless}}" data-target=".cmt-profile__followers"><span>Подписчики</span><span class="cmt-profile__menu-count">{{ followersCount }}</span></div>{{/if}}</div></div><div class="cmt-profile__comments-wrap"><div class="cmt-profile__comments commentsvlru marisa">{{#if jumbo}}            <div class="cmt-jumbotron cmt-profile-jumbo">                <div class="hide"></div>                <p>Мы группируем комментарии от анонимных пользователей для того, чтобы читатели могли лучше понимать автора.</p><p>Если вы предпочитаете не связывать с собой прошлую историю, то можете просто сменить имя в профиле или форме добавления комментария</p>            </div>{{/if}}</div></div>{{#if achievements.visible }}<div class="cmt-profile__achievements-wrap cmt-hidden"><div class="cmt-profile__achievements commentsvlru marisa">{{#if achievements.authMotivator }}<div class="cmt-jumbotron cmt-auth-motivator" data-profile-id="{{ profileId }}" data-project-id="{{ projectId }}"><div class="hide"></div><p>Награды видны только вам. <a class="cmt-auth" href="#">Авторизуйтесь</a>, чтобы их увидели остальные.</p></div>{{/if}}{{#each achievements.items}}<div class="cmt-profile__badge" title="{{this.hint}}"><div class="cmt-profile__badge__icon cmt-profile__{{#if this.active}}active-{{/if}}badge__{{this.imageId}}"></div><div class="cmt-profile__badge__title{{#unless this.active}} cmt-profile__inactive{{/unless}}">{{this.title}}</div></div>{{/each}}</div></div>{{/if}}{{#if enableFollowers }}<div class="cmt-profile__following cmt-hidden commentsvlru marisa"></div><div class="cmt-profile__followers cmt-hidden commentsvlru marisa"></div>{{/if}}</div>'}),define("handlebars-profile-name-dialog",[],function(){return'<div class="commentsvlru-modal-box dialog marisa cmt-profile__change-name-dialog">    <div>При изменении имени связь с вашими предыдущими комментариями будет утеряна.</div>    <a id="cancelModal" href="#" class="cmt-button marisa">Отмена</a>    <a id="okModal" href="#" class="cmt-button marisa">OK</a></div>'}),define("handlebars-profile-followers",[],function(){return'<div id="handlebarsProfileFollowers" class="commentsvlru-modal-box marisa"><p class="notice">Перед тем, как подписаться на профиль,<br/>пожалуйста, авторизуйтесь</p><div class="auth-block follow"><div class="cmt-auth-list">{{{ authView }}}</div></div></div>'}),define("handlebars-profile-anonymous-input-name",[],function(){return'{{#if company}}<div class="cmt-user-info-name-input"><input id="login" type="text" name="name" value="{{{name}}}" title="Введите имя" placeholder="Введите имя" class="cmt-input"></div>{{else}}{{#if mobile}}<div class="cmt-input-wrapper cmt-user-info-name-input"><input id="login" type="text" name="name" value="{{{name}}}" title="Введите имя" placeholder="Введите имя"></div>{{else}}<div class="cmt-form-user cmt-user-info-name-input"><span class="login"><input id="login" type="text" name="name" value="{{{name}}}" title="Введите имя" placeholder="Введите имя"/></span></div>{{/if}}{{/if}}'}),define("loader",["jquery","console","supercookie","events","core","outdatedLikes","follower","profile","pastafarian","config","user_bananas","imageUpload","showConversation","mediaCss","complaint","logger","tooltip","linkConverter","deletedComments","subscribeEvents","subscribeActions","mobileCommentMenu"],function(e,t,n,i,o,r,a,s,l,c,u,d,m,h,f,p,g,v,b,y,C,k){"use strict";var x={api:null,deprecatedHandlersDescription:[],initialLoadingHtml:null,initialLoadingSelector:".commentsvlru .threadLoadingStatus",xhr:null},w={initialLoadingSelector:x.initialLoadingSelector};return w.init=x.init=function(p){try{x.api.control.lastApiConfig&&i.clear(),p.debug&&t.enable(),e.ajaxSetup({xhrFields:{withCredentials:!0}})}catch(v){o.catchError(v)}e(function(){try{x.api.control.lastApiConfig={},e.extend(x.api.control.lastApiConfig,p||{}),i.on(["ThreadLoad","ThreadInit"],u.init,u),i.on(["ThreadLoad","ThreadInit"],n.init,n),i.on(["ThreadLoad","ThreadInit"],l.updateUserKey,l),i.on(["ThreadLoad","ThreadInit"],x.prevPageLoader.init,x.prevPageLoader),i.on(["AfterShowModalForm","UiInitialize"],g.init);var t=p||{};t.features=t.features||[],"string"==typeof t.features&&(t.features=t.features.split(",")),t.threadName?t.threadId=null:t.threadId&&(t.threadName=null);var v,b;for(v in t.features)b=e.trim(t.features[v]),("likes"==b||"commentForm"==b)&&t.features.indexOf("modalForms")<0&&t.features.push("modalForms");var w=e(".commentsvlru");t.theme&&("marisa"!=t.theme&&w.addClass("marisa"),w.addClass(t.theme),d.openOnInit=!0,c.theme=t.theme),t.embedded?(t.features.push("embeddedControl"),t.features.push("scrollTo")):(v=t.features.indexOf("embeddedControl"))>=0&&t.features.splice(v,1);var _=[];for(v in t.features)if(b=e.trim(t.features[v]),"subscribeActions"!=b){var T=x.applyFeature(b,t[b]);T&&_.push(T),delete t[b]}delete t.features,t.baseUrl||delete t.baseUrl,t.baseUrlStatic||delete t.baseUrlStatic,x.initDeprecatedHandlers(t),x.initHandlers(t.listeners),delete t.listeners,e.extend(c,t),c.baseUrlStatic||(c.baseUrlStatic=c.baseUrl);var S=function(){s.init(),a.init(),r.init(x.api),m.init(),h.init(w),f.init(),y.init(),C.init(),k.init(x.api,w)},I=function(){x.deprecatedLog()};c.embedded?x.api.utils.doAppendCssToHead(function(){S();var e=!1;c.disableEndingComment&&(e=c.disableEndingComment),x.doLoadCommentsThread(_,0,null,e),I()}):(S(),x.initFeatures(_),i.fire("ThreadInit"),e('.commentsvlru textarea, .commentsvlru input[type="text"]').placeholder(),c.sortMode&&x.doLoadNextCommentsPage(!0),I(),g.init())}catch(F){o.catchError(F),x.doLoadCommentsThreadFail()}})},w.initForPostingOnly=x.initForPostingOnly=function(i){i.debug&&t.enable();try{var r=i||{};delete r.features,x.initDeprecatedHandlers(r),x.initHandlers(r.listeners),delete r.listeners,r.threadName?r.threadId=null:r.threadId&&(r.threadName=null),e.extend(c,r),n.init(),l.updateUserKey()}catch(a){t.log(a),o.catchError(a)}},w.initForProfile=x.initForProfile=function(c){c.debug&&t.enable();try{e.ajaxSetup({xhrFields:{withCredentials:!0}});var u={embedded:!0,theme:"marisa"};e.extend(u,c||{}),delete u.features,x.initHandlers(u.listeners),delete u.listeners,u.threadName?u.threadId=null:u.threadId&&(u.threadName=null),e.extend(x.api.control.config,u),n.init(),i.on(["AfterShowModalForm","UiInitialize"],g.init),l.updateUserKey();var d=function(){s.init(),a.init(),r.init(x.api),i.fire("ProfileInit")};u.embedded?x.api.utils.doAppendCssToHead(d):d()}catch(m){t.log(m),o.catchError(m)}},w.doLoadCommentsThread=x.doLoadCommentsThread=function(n,i,r,a){var s,u="/ajax/thread/{threadId}/embedded",d="/ajax/thread/{type}/{name}/embedded";if(c.threadId)s=u.replace("{threadId}",c.threadId);else{if(!c.threadName)throw new Error("Thread identification not configured");s=d.replace("{type}",c.threadName.type).replace("{name}",c.threadName.name)}var m=null;if(c.embedded&&!a){var h,f=window.location.hash;(h=f.match(/#p(\d+)/))&&(m=h[1])}var p={reloadcount:i,p:m,pastafarian:l.getUserKey(),commentAttributes:c.commentAttributesFilter,location:location.href};c.withoutList&&(p.withoutList=1),c.relatedThreads&&(p.relatedThreads=1),c.mergeTypes&&(p.mergeTypes=c.mergeTypes),r===!1&&(p.moderatorMode=0),null===x.initialLoadingHtml&&(x.initialLoadingHtml=e(x.initialLoadingSelector).html()),x.abortXhr(),x.xhr=o.jsonRequest({url:o.getRightUrl(s),method:"GET",data:p,successCallback:x.doLoadCommentsThreadCallback,failureCallback:x.doLoadCommentsThreadFail,scope:x.api.utils,param:n,progressElement:e(x.initialLoadingSelector),logFunc:t.log})},x.abortXhr=function(){"undefined"!=typeof x.xhr&&null!==x.xhr&&(x.xhr.abort(),e(x.initialLoadingSelector).html(x.initialLoadingHtml))},x.doLoadCommentsThreadFail=function(){var t=e(x.initialLoadingSelector).hide().detach();t.html('<div class="fail">Не удалось загрузить комментарии. <a href="#">Перезагрузить</a></div>'),t.find("a").on("click",function(e){e.preventDefault(),x.api.reInit()}),t.show(),e(".commentsvlru").empty().append(t)},x.initHandlers=function(t){for(var n in t)if(t.hasOwnProperty(n)){var o=t[n];if(e.isArray(o))for(var r=0;r<o.length;o++)i.on(n,o[r]);else i.on(n,o)}},x.deprecatedLog=function(){if(x.deprecatedHandlersDescription.length){var e=x.deprecatedHandlersDescription.join(",");e+="\nLocation: "+window.location,p.log("events","using-deprecated-handlers",e)}},x.initDeprecatedHandlers=function(e){x.deprecatedHandlersDescription=[],e.onBeforePostComment&&(x.deprecatedHandlersDescription.push("onBeforePostComment"),i.on("BeforePostComment",e.onBeforePostComment)),e.onCommentAdd&&(this.deprecatedHandlersDescription.push("onCommentAdd"),i.on("CommentAdd",e.onCommentAdd)),e.onSaveDefaultPosterName&&(this.deprecatedHandlersDescription.push("onSaveDefaultPosterName"),i.on("SaveAnonPosterName",e.onSaveDefaultPosterName)),e.onThreadLoad&&(this.deprecatedHandlersDescription.push("onThreadLoad"),i.on("ThreadLoad",e.onThreadLoad)),e.onPageLoad&&(this.deprecatedHandlersDescription.push("onPageLoad"),i.on("PageLoad",e.onPageLoad)),delete e.onBeforePostComment,delete e.onCommentAdd,delete e.onListLoad,delete e.onListPageLoad,delete e.onSaveDefaultPosterName,delete e.onThreadLoad,delete e.onPageLoad},x.doLoadCommentsThreadCallback=function(t,n,o,r){x.xhr=null,t.content=v.convertContentUrls(e.trim(t.content)),i.fire("ThreadLoadRender",t);var a=e(e.parseHTML(t.content));c.embedded&&x.api.control.infiniteScroll&&(a.find(".loading").removeClass("cmt-more-comments").text(""),a.find(".loading").show());var s=e(x.initialLoadingSelector).hide().detach(),l=x.api.utils.getTargetContainer();l.empty().append(s).append(a),c.lastCommentId=t.lastCommentId,c.commentsCount=t.commentsCount,c.prevPageId=t.prevPageId,c.threadId=t.threadId,c.loadedFeatures=r,c.pageTitle=t.pageTitle,c.commentTemplate=t.commentTemplate,c.reloadCounter=t.reloadCounter,c.isThreadSubscribed=t.isThreadSubscribed,c.showDeletedComments=t.showDeletedComments,c.storeNameOnClient=t.storeNameOnClient,c.totalCommentsCount=n,c.logoUrl=t.logoUrl,c.commentFormAtBottom=t.commentFormAtBottom,c.sortMode=t.sortMode,c.bindAnonymousCommentsDialog=t.bindAnonymousCommentsDialog,c.profileId=t.profileId,c.socketServer=t.socketServer,c.enableSocketIO=t.enableSocketIO,c.enableSubscribe=t.enableSubscribe,c.subscribeEmail||(c.subscribeEmail=t.defaultPosterEmail),c.addShareUrl||(c.addShareUrl=t.addShareUrl),
t.endingCommentId&&(window.location.hash="#p"+t.endingCommentId),t.addModeratorCtrl&&r.indexOf("moderator")<0&&r.push(x.applyFeature("moderator")),t.enableImages&&!this.api.control.imageUpload&&r.push(x.applyFeature("imageUpload")),x.initFeatures(r),i.fire("ThreadLoad",t),c.sortMode&&x.doLoadNextCommentsPage(!0),c.commentsCount&&!c.lastCommentId&&x.noMoreComments(),c.isMobile()&&e('.commentsvlru textarea, .commentsvlru input[type="text"]').placeholder(),m.init(),require("config").enableSocketIO&&require("newCommentsListener").init()},x.prevPageLoader={button:null,clickHandler:null,init:function(){var t=x.api.utils.getTargetContainer();this.button=t.find(".cmt-prev-page-loader"),this.button.size()&&(c.prevPageId?(this.clickHandler&&this.button.off("click",this.clickHandler),this.clickHandler=e.proxy(this.onClick,this),this.button.on("click",this.clickHandler).show()):this.button.hide())},onClick:function(e){if(e.preventDefault(),e.stopPropagation(),!c.prevPageId)return void this.button.hide();if(!this.button.hasClass("ajax-progress")&&!this.button.hasClass("cmt-has-error")){x.abortXhr();var n={prevPageId:c.prevPageId,pastafarian:l.getUserKey()};b.isChecked()===!1&&(n.moderatorMode=0),c.commentAttributesFilter&&(n.commentAttributes=c.commentAttributesFilter),c.relatedThreads&&(n.relatedThreads=1),c.mergeTypes&&(n.mergeTypes=c.mergeTypes);var i=x.getRenderedCommentsUrl();x.xhr=o.jsonRequest({url:i,method:"GET",data:n,successCallback:this.onLoad,failureCallback:this.onError,scope:this,progressElement:this.button,logFunc:t.log})}},onError:function(){this.button.addClass("cmt-has-error"),this.button.find(".cmt-prev-page-loader__reload__action").click(e.proxy(this.reloadClick,this)),x.failureCommentsLoadCallback()},reloadClick:function(){c.prevPageId=null,this.button.hide().detach(),e(x.initialLoadingSelector).hide().detach(),x.doLoadCommentsThread(c.loadedFeatures,c.reloadCounter+1,null,!0)},onLoad:function(t){x.xhr=null,c.prevPageId=t.prevPageId,t.content=v.convertContentUrls(e.trim(t.content)),i.fire("PageLoadRender",t);var n=e(e.parseHTML(t.content)),o=e("#CommentsList"),r=e('<li style="height:0;"></li>').prependTo(o),a=e(r).offset();o.prepend(n),c.prevPageId||x.prevPageLoader.button.hide(),i.fire("UiInitialize"),i.fire("PageLoad",t);var s=r.offset();r.remove(),"object"==typeof a&&"object"==typeof s&&a.hasOwnProperty("top")&&s.hasOwnProperty("top")&&window.scrollBy(0,s.top-a.top)}},x.getRenderedCommentsUrl=function(){var e,t="/ajax/comments/{threadId}/rendered",n="/ajax/comments/{type}/{name}/rendered";if(c.threadId)e=t.replace("{threadId}",c.threadId);else{if(!c.threadName)throw new Error("Thread identification not configured");e=n.replace("{type}",c.threadName.type).replace("{name}",c.threadName.name)}return o.getRightUrl(e)},x.initFeatures=function(e){for(var n in e){var o=e[n];if(o.init)try{o.init()}catch(r){t.log(r)}}i.fire("UiInitialize")},w.doLoadNextCommentsPage=x.doLoadNextCommentsPage=function(n){if(!x.xhr&&c.lastCommentId){var i=x.getRenderedCommentsUrl(),r={lastId:c.lastCommentId,disableScroll:!!n},a={before:c.lastCommentId,pastafarian:l.getUserKey()};b.isChecked()===!1&&(a.moderatorMode=0),c.commentAttributesFilter&&(a.commentAttributes=c.commentAttributesFilter),c.relatedThreads&&(a.relatedThreads=1),c.mergeTypes&&(a.mergeTypes=c.mergeTypes),x.xhr=o.jsonRequest({url:i,method:"GET",data:a,successCallback:x.doLoadNextCommentsPageCallback,failureCallback:x.failureCommentsLoadCallback,scope:x.api.utils,param:r,progressElement:e(".commentsvlru .loading"),logFunc:t.log})}},x.failureCommentsLoadCallback=function(){x.xhr=null,i.fire("FailureCommentsLoad")},x.doLoadNextCommentsPageCallback=function(t,n,o,r){if(x.xhr=null,r.lastId==c.lastCommentId){c.lastCommentId=t.lastCommentId,t.content=v.convertContentUrls(e.trim(t.content)),i.fire("PageLoadRender",t);var a=e(e.parseHTML(t.content));e("#CommentsList").append(a),e(".commentsvlru #CommentsList li[comment="+t.firstCommentId+"]").addClass("newPage"),c.lastCommentId||x.noMoreComments(),i.fire("UiInitialize"),r.disableScroll||!c.embedded||x.api.control.infiniteScroll||x.api.control.scrollTo.scroll(t.firstCommentId),i.fire("PageLoad",t);var s=x.api.control.embeddedControl.lastCustomAction;!r.disableScroll||"login"!==s&&"logout"!==s||x.api.control.scrollTo.scroll("commentForm")}},w.noMoreComments=x.noMoreComments=function(){var t=".commentsvlru .noMoreComments";e(t).show(),e(t).find(".to-comment-form").off("click").on("click",function(t){return t.preventDefault(),t.stopPropagation(),"catalog-mobile"==c.theme||"company"==c.theme?i.fire("ClickNoMoreComments"):x.api.control.scrollTo.scroll("commentForm",function(){var t=e('.commentsvlru input[name="name"]');t.val()?e('.commentsvlru textarea[name="comment"]').focus():t.focus()}),!1})},x.applyFeature=function(t,n){var i,r=["commentForm"];return e.inArray(t,r)>=0?(i=o.getModule(t),i.setApi(x.api),i.setControl(x.api.control),x.api.features[t]=i):i=x.api.features[t],"undefined"!=typeof i?(e.extend(i,n||{}),x.api.control[t]=i,i.control=x.api.control,i.api=x.api,i):null},w.setApi=x.setApi=function(e){return x.api=e,this},w}),function(e,t,n){e.fn.cssNumber=function(e){var t=parseInt(this.css(e),10);return isNaN(t)?0:t},Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1});var i=require("console"),o={control:{config:null,lastApiConfig:{}},features:{infiniteScroll:{control:null,targetContainer:null,loadMoreComments:function(){this.control.config.lastCommentId?require("loader").setApi(this.api).doLoadNextCommentsPage():require("loader").setApi(this.api).noMoreComments()},onCommentsLoaded:function(){this.isMoreCommentsNeeded()&&this.loadMoreComments()},scrollHandler:function(){this.isMoreCommentsNeeded()&&this.loadMoreComments()},isMoreCommentsNeeded:function(){if(!this.control.config.lastCommentId)return!1;var e=this.targetContainer[0].getBoundingClientRect(),t=n.innerHeight||document.documentElement.clientHeight,i=350;return e.bottom<=t+i},setAutoLoadScrollHandler:function(){e(n).scroll(e.proxy(this.scrollHandler,this)),this.isMoreCommentsNeeded()&&this.loadMoreComments()},init:function(){var t=this.control.config;t.embedded?(this.targetContainer=e(".commentsvlru").filter(function(){return 0===e(this).closest(".cmt-profile").length}).first(),this.targetContainer.length||(this.targetContainer=e(".commentsvlru:eq(0)"))):this.targetContainer=e("body"),t.lastCommentId?this.setAutoLoadScrollHandler():t.commentsCount<=t.commentsLimit&&t.commentsCount>0&&require("loader").setApi(this.api).noMoreComments(),e(this.api.features.embeddedControl.loadMoreCommentsSelector).hide(),this.api.on("PageLoad",{fn:this.onCommentsLoaded,scope:this}),this.targetContainer.find(".loading").removeClass("cmt-more-comments").text("")}},modalForms:{addFormUIInitializer:function(e,t,i){require("logger").log("events","using-modal-form","addFormUIInitializer\nLocation: "+n.location),require("modalForms").addFormUIInitializer(e,t,i)}},commentForm:null,scrollTo:{queryParamName:"p",time:300,autoScrolled:!1,scroll:function(t,n){var i=e("a[name=p"+parseInt(t)+"]");if(i.size()||(i=e("a[name="+t+"]")),1==i.size()){var o={target:i};if(n&&(o.onAfter=n),"catalog-mobile"===this.control.config.theme){var r=e(".cmt-mobile-collapsed-form");r.size()&&(o.offset={top:-r.height(),left:0})}e.scrollTo(i,this.time,o)}},init:function(){this.api.on("UiInitialize",this.uiInitializer,this)},uiInitializer:function(){if(!this.autoScrolled){this.autoScrolled=!0;var t=this.control.config,i=require("core").getQueryParam(this.queryParamName),o=this,r=function(n,i){return function(){var r=o.api.features.commentForm.getCommentFeedContainer(n);r=!t.theme||t.isMobile()?r.find("blockquote:first"):r.children("div.comment:first");var a=e.proxy(o.api.utils.hilight,o.api.utils,r,!1);o.scroll(i,null,a)}};if(i)require("core").defer(r(i,i),400);else if(t.embedded){var a=n.location.hash;if("#comments"==a)require("core").defer(function(){o.scroll("comments")},400);else{var s=a.substr(0,2);i=a.substr(2),"#p"==s&&i&&i.match(/\d+/)&&require("core").defer(r(i,a.substr(1)),400)}}}}},moderator:{control:null,changeTypeSelector:"[action=change-type]",changeTypeHandlerObj:null,restoreCommentCallbackObj:null,hideCommentsOnUpdateObj:null,init:function(){this.changeTypeHandlerObj=e.proxy(this.changeTypeHandler,this),this.restoreCommentCallbackObj=e.proxy(this.restoreCommentCallback,this),this.hideCommentsOnUpdateObj=e.proxy(this.hideCommentsOnUpdate,this),this.api.on("UiInitialize",this.uiInitializer,this)},uiInitializer:function(){var t=e(".commentsvlru");require("restoreComment").init(t,this.restoreCommentCallbackObj),require("events").on("CommentRestore",this.restoreCommentCallbackObj),require("ban").init(t),require("annotation").init(t),require("events").on("CommentBan",this.hideCommentsOnUpdateObj),require("replaceComment").init(t),require("events").on("CommentReplace",this.hideCommentsOnUpdateObj),e(this.changeTypeSelector).show().off("change",this.changeTypeHandlerObj).on("change",this.changeTypeHandlerObj),require("primkupon/publishToSpravochnik")&&require("primkupon/publishToSpravochnik").init(t,!1,this.api)},restoreCommentCallback:function(e){var t=this.api.features.commentForm.getCommentContainer(e),n=t.find("blockquote:first p");n.text("Коммент восстановлен. Обновите страницу, чтобы увидеть изменения"),t.find(".complex-actions").remove()},hideCommentsOnUpdate:function(e){for(var t=0;t<e.length;t++)this.api.features.commentForm.hideComment(e[t],"Обновите страницу, чтобы увидеть изменения");this.api.features.commentForm.setFormToThread(!1,null)},changeTypeHandler:function(t){t.preventDefault(),t.stopPropagation();var n=e("option:selected",t.target);if(n.val()){var o=this.api.features.commentForm.readCommentId(t.target),r=this.api.utils.getRightUrl("/ajax/moderator/comments/change-type");require("core").jsonRequest({url:r,method:"POST",data:{commentId:o,commentType:n.val()},scope:this,progressElement:e(t.target),logFunc:i.log})}}},embeddedControl:{loadMoreCommentsContainerSelector:".commentsvlru .loadMoreComments",loadMoreCommentsSelector:".commentsvlru [action=loadMoreComments]",loginButtonsSelector:".login-link",loginActionHandlerObj:null,logoutButtonsSelector:"[action=logout]",logoutActionHandlerObj:null,lastCustomAction:null,init:function(){e(this.loadMoreCommentsSelector).click(e.proxy(this.loadNextCommentsPage,this)),this.loginActionHandlerObj=e.proxy(this.loginActionHandler,this),this.logoutActionHandlerObj=e.proxy(this.logoutActionHandler,this),this.api.on("UiInitialize",this.uiInitializer,this),require("modalForms").addFormUIInitializer("#AuthModalForm",this.modalFormUIInitializer,this),this.modalFormUIInitializer("",e(".commentsvlru"))},loadNextCommentsPage:function(e){e.preventDefault(),e.stopPropagation(),require("loader").setApi(this.api).doLoadNextCommentsPage()},hideNextPageControl:function(){e(this.loadMoreCommentsContainerSelector).hide()},showNextPageControl:function(){e(this.loadMoreCommentsContainerSelector).show()},uiInitializer:function(){this.control.infiniteScroll||(this.control.config.lastCommentId?this.showNextPageControl():this.hideNextPageControl())},modalFormUIInitializer:function(e,t){this.control.config.noLoginActionsOverride||(t.find(this.loginButtonsSelector).off("click",this.loginActionHandlerObj).on("click",this.loginActionHandlerObj),t.find(this.logoutButtonsSelector).off("click",this.logoutActionHandlerObj).on("click",this.logoutActionHandlerObj))},loginActionHandler:function(e){this.control.config.noLoginActionsOverride||this.doCustomAction(e,"login")},logoutActionHandler:function(e){this.control.config.noLoginActionsOverride||this.doCustomAction(e,"logout")},doCustomAction:function(t,i){var o="a"==t.target.tagName?e(t.target):e(t.target).closest("a");t.stopPropagation(),t.preventDefault(),require("modalForms").hideModal();var r=o.attr("href");r=r.replace(o[0].search,"?returnUrl="+encodeURIComponent("/embedclose?reason="+i));var a=n.open(r,"commentschild","toolbar=0,status=0,width=800,height=650"),s=this,l=n.setInterval(function(){a.closed&&(n.clearInterval(l),s.lastCustomAction=i,s.reloadThread(),"login"==i&&s.api.control.scrollTo.scroll("comments"))},300)},reloadThread:function(t){var n=require("loader").initialLoadingSelector,i=e(n).hide().detach();e(".commentsvlru").prepend(i.text("Обновление...").show());var o=this.control.config;"undefined"==typeof t&&(t=null),require("loader").setApi(this.api).doLoadCommentsThread(o.loadedFeatures,o.reloadCounter+1,t)}},miscCtrls:{init:function(){}},imageUpload:{init:function(){require("imageUpload").init()}}},utils:{targetContainer:null,getTargetContainer:function(){return this.targetContainer||(this.targetContainer=e(".commentsvlru").filter(function(){return 0===e(this).closest(".cmt-profile").length}).first(),this.targetContainer.length||(this.targetContainer=e(".commentsvlru:eq(0)"))),this.targetContainer||e(".commentsvlru")},addCommentCallback:function(t,n,i,o){var r=e(e.parseHTML(require("linkConverter").convertContentUrls(e.trim(t.comment))));t.userMessage&&r.prepend(e('<p style="color: red">'+t.userMessage.replace("\n","<br/>")+"</p>")),this.api.fire("BeforeRenderNewComment",r);var a=this.createNewCommentContainer(o.parentId);a.prepend?a.cont.prepend(r):a.cont.append(r),this.api.fire("UiInitialize"),this.api.utils.hilightReset(e(".commentsvlru blockquote"));var s=this.api.control.config;if(!s.theme||s.isMobile()){var l=r.find("blockquote");this.api.utils.hilight(l,l.hasClass("moderation"))}if(t.parentId){var c=this,u=function(){require("events").off("UiInitialize",u),setTimeout(function(){c.api.control.scrollTo.scroll(t.id)})};require("events").on("UiInitialize",u)}},addCommentFailure:function(){},createNewCommentContainer:function(t){var n,i={},o=!1;if(0!=t){var r=e(".commentsvlru li[comment="+t+"][level=0]");if(0!=r.length){var a=r.find("ul.comment-replies");if(0==a.length){i.openReply=1,i.lastCloseTag=1;var s=e("<ul>",{"class":"comment-replies"}),l=r.find(".cmt-new-comments-message");l.size()?l.before(s):r.append(s),n=s}else n=a}else n=e(".commentsvlru li[comment="+t+"]").closest("ul.comment-replies")}else n=e(".commentsvlru ul#CommentsList"),o=!require("config").sortMode;return{cont:n,comm:i,prepend:o}},hilight:function(t,n){var i=require("config"),o=i.theme,r=this,a=function(){};if(require("config").hilightEnabled){if(o){if(o&&!i.isMobile()){var s="#FFFACD",l="#FFFFFF",c=1250;a=function(){t.stop(),n?t.css("background-color",s):e.when(t.css("background-color",l)).then(t.animate({backgroundColor:s},c)).then(t.animate({backgroundColor:l},c)).then(t.animate({backgroundColor:s},c)).then(t.animate({backgroundColor:l},c)).done(function(){t.css("background-color","inherit")})}}}else a=function(){if(t.stop(),n)t.css("background-color","#FFFF30");else{t.css("background-color","#FFFF30");var e=r.api.control.config;t.animate({backgroundColor:"#FFFFE0"},2e3,function(){e.isMobile()&&t.css("background-color","inherit")})}};a()}},hilightReset:function(e){e.stop(),e.css("background-color","transparent")},getUserKey:function(){return require("pastafarian").getUserKey()},updateUserKey:function(){return require("pastafarian").updateUserKey()},getJquery:function(){return e},getAnonPosterName:function(){var e=this.api.control.config;return null!==e.defaultPosterName?e.defaultPosterName:e.anonPosterNameCookie?require("core").getCookie(e.anonPosterNameCookie):""},doAppendCssToHead:function(e){require("core").loadCss(require("config").cssFiles,e,!1)},renderComment:function(t){var n=this,i=require("core"),o={},r=n.api.features.commentForm;n.api.control.config.relatedThreads&&(o.relatedThreads=1),n.api.control.config.mergeTypes&&(o.mergeTypes=n.api.control.config.mergeTypes),i.jsonRequest({url:i.getRightUrl(r.commentUrl.replace("{commentId}",t)),method:"GET",data:o,debug:n.api.control.config.debug,successCallback:function(i){var o={comment:i};o.comment=require("linkConverter").convertContentUrls(e.trim(o.comment)),require("events").fire("CommentEditRender",o);var a=e(e.parseHTML(o.comment)),s=r.getCommentContainer(t),l=r.getCommentContainerBody(s),c=r.getCommentContainerBody(a);l.replaceWith(c),n.api.control.imageUpload&&require("imageUpload").clearForm(),r.setFormToThread(!1,null),require("events").fire("UiInitialize"),n.hilightReset(e(".commentsvlru blockquote"));var u=a.find(".commentsvlru blockquote");n.hilight(u,u.hasClass("moderation"))},failureCallback:function(e){alert(e)},scope:this})}},init:function(e){require("loader").setApi(this).init(e)},initForPostingOnly:function(e){require("loader").setApi(this).initForPostingOnly(e)},initForProfile:function(e){require("loader").setApi(this).initForProfile(e)}};o.reInit=function(e){var t=this.control.lastApiConfig;return t.disableEndingComment=e,this.control.lastApiConfig=null,this.control.imageUpload&&delete this.control.imageUpload,this.init(t),!1},o.reloadThread=function(){var e=this.control.config;e.embedded&&this.control.embeddedControl.reloadThread()},o.checkUploadProcess=function(){if(this.control.imageUpload&&require("imageUpload").isActive()){require("modalForms").showModalForm(require("imageUpload").anonymousAuthForm,{clickedTarget:e(".upload-form"),message:"Подождите, пока загрузятся приложенные фотографии",leftOffset:0});var t=require("modalForms").modalForm.find(".auth-block");return t.hasClass("anon-image-post")&&t.hide(),!0}return!1},o.postComment=function(t){if(require("config").sortMode&&require("config").lastCommentId&&!require("config").commentFormAtBottom&&t.force!==!0){e(t.progressElement).addClass("ajax-progress");var o=this;return require("events").on("FailureCommentsLoad",function(){t.force=!0,o.postComment(t)}),void require("events").on("PageLoad",function(){o.postComment(t)})}if(this.checkUploadProcess())return!1;var r=this.control.config;if(!r.threadId&&!r.threadName)return i.log("Neither threadId nor threadName was not initialized"),!1;t.param&&t.param.button&&t.param.button.attr("disabled","disabled");var a=r.threadId?"/ajax/comments/{threadId}".replace("{threadId}",r.threadId):"/ajax/comments/{type}/{name}".replace("{type}",r.threadName.type).replace("{name}",r.threadName.name);a=this.utils.getRightUrl(a.replace("{threadId}",r.threadId));var s={};return t.customFields&&(s=e.extend(s,t.customFields)),r.relatedThreads&&(s.relatedThreads=1),s=e.extend(s,{name:t.name||"",comment:t.text||"",parentId:Number(t.parentCommentId||0).toFixed(0),subscribeCheck:Boolean(t.subscribeCheck||!1),subscribeEmail:String(t.subscribeEmail||""),crossPostCheck:Boolean(t.crossPost||!1),imagesIds:t.imagesIds,pastafarian:require("pastafarian").getUserKey(),bananas:require("user_bananas").collectBananas(),pseudoCommentId:require("timings").getPseudoCommentId()}),require("core").jsonRequest({url:a,method:"POST",data:s,debug:this.control.config.debug,successCallback:function(o){var a=o.userMessage,l=o.comment,c={pastafarian:require("pastafarian").getUserKey()};r.relatedThreads&&(c.relatedThreads=1),r.mergeTypes&&(c.mergeTypes=r.mergeTypes),require("core").jsonRequest({url:this.utils.getRightUrl(String("/ajax/comment/{id}").replace("{id}",l.id)),method:"GET",data:c,debug:this.control.config.debug,successCallback:function(e,o,r){l.userMessage=a,l.comment=e;var c="CommentId: "+l.id+"\nComment:\n"+l.text;if(require("timings").log("add-comment-complete",c),this.fire("BeforeCommentAddRender",l),this.fire("CommentAddRender",l)!==!1){if(this.utils.addCommentCallback(l,o,r,s),t.successCallback)try{t.successCallback.call(t.scope||n,l,o,r,t.param)}catch(u){if(i.log(u),this.utils.addCommentFailure(u.toString(),s,l),t.failureCallback)try{t.failureCallback.call(t.scope||n,"Error executing post handler",t.param,e)}catch(u){i.log(u)}}this.control.scrollTo.scroll(l.id),this.fire("CommentAdd",l.id),this.fire("AfterCommentAdd",l)}},failureCallback:function(e,o,r){if(e="Сообщение добавлено, но произошла ошибка при попытке показать его. Администрация в курсе. Перезагрузите страницу для просмотра вашего сообщения.",this.utils.addCommentFailure(e,s,r),t.failureCallback)try{t.failureCallback.call(t.scope||n,e,t.param,r)}catch(a){i.log(a)}},scope:this,progressElement:e(t.progressElement)})},failureCallback:function(e,o,r){if(-1!=e.indexOf("-32099")&&(e="Ошибка отправки комментария. Попробуйте ещё раз."),this.utils.addCommentFailure(e,s,r),t.failureCallback)try{t.failureCallback.call(t.scope||n,e,t.param,r)}catch(a){i.log(a)}},scope:this,param:null,progressElement:e(t.progressElement),logFunc:i.log}),s.crossPostCheck&&this.addShareDialog({title:r.pageTitle,message:s.comment,image:r.logoUrl,messageUrl:r.addShareBackUrl?r.addShareBackUrl:n.location.href}),!0},o.addShareDialog=function(e){var t=this.control.config;if(e&&e.message&&t.addShareOnPost&&t.addShareUrl){var i=String(t.addShareUrl),o=encodeURIComponent(e.message),r=encodeURIComponent(e.messageUrl),a=encodeURIComponent(e.title),s=encodeURIComponent(e.image);i=i.replace("{message}",o).replace("{messageUrl}",r).replace("{title}",a).replace("{imageUrl}",s).replace(/\{\w+\}/,""),n.open(i,"","toolbar=0,status=0,width=626,height=436")}},o.getCurrentThreadTotalCommentsCount=function(){return this.control.config.totalCommentsCount},o.require=function(e){var t=["catalog/widget","catalog/tabs","likes","outdatedLikes","profile","follower","jquery","tooltip","linkConverter"];return-1!=t.indexOf(e)?require(e):null},define("jquery",[],function(){return e}),define("handlebars",[],function(){return t}),require("browserDetect").init(),o.on=require("events").on,o.off=require("events").off,o.fire=require("events").fire,o._define=define,o._require=require,o.control.config=require("config"),o.utils.getCookie=require("core").getCookie,o.utils.setCookie=require("core").setCookie,o.utils.jsonRequest=require("core").jsonRequest,o.utils.getRightUrl=require("core").getRightUrl,o.utils.api=o,n.commentsvlru=o,function(){for(var e=document.getElementsByTagName("script"),t=/^https?:\/\/(comments\.(vl\.ru|vl\.dev|loc)|(172\.16\.70\.\d+))/i,n=e.length-1;n>=0;n--)if(n in e){var i=t.exec(e[n].src);if(i){o.control.config.baseUrl=o.control.config.baseUrlStatic=i[0];break}}}(),e(function(){e.fn.selectRange=function(e,t){return this.each(function(){if(this.setSelectionRange){this.focus();try{this.setSelectionRange(e,t)}catch(n){i.log(n)}}else if(this.createTextRange){var o=this.createTextRange();o.collapse(!0),o.moveEnd("character",t),o.moveStart("character",e),o.select()}})}}),"undefined"==typeof ga&&!function(e,t,n,i,o,r,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,r=t.createElement(n),a=t.getElementsByTagName(n)[0],r.async=1,r.src=i,a.parentNode.insertBefore(r,a)}(n,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-16970504-11","auto",{name:"commentsvlru"}),ga("commentsvlru.send","pageview")}(window.jQuery,Handlebars,window)}(),function(e){var t=e({});e.publish=function(e,t){return e||t},e.each({on:"subscribe",trigger:"publish",off:"unsubscribe"},function(n,i){e[i]=function(){t[n].apply(t,arguments)}})}(jQuery);var makeCommentsSlider=function(){function e(){var e=parseInt($("#comments").offset().top);try{var t=parseInt(c.offset().top+c.height());c.offset().top<=u&&c.is(":visible")&&c.css({position:"relative",top:0}),d.scrollTop()>u&&c.is(":visible")&&c.css({position:"fixed",top:0}),t>=e&&c.is(":visible")?c.fadeOut():e>t&&c.is(":hidden")&&c.fadeIn()}catch(n){}}var t="undefined"!=typeof window.Handlebars?Handlebars:null,n=".commentsvlru li[comment]",i="blockquote p",o=".user-name";if(0!=t&&$("#sliding-comment-template")&&0!=$("#sliding-comment-template").length){var r=$(n);if(r.length){r=r.not(n+"ul li[comment]"),$(".sliding-comments").remove();var a=t.compile($("#sliding-comment-template").html()),s=t.compile($("#sliding-comments-template").html()),l=r.map(function(){var e=$(this),t=e.find(o).filter(":first").text(),n=e.find(i).filter(":first").html().replace(/<br>|<br\/>|<br \/>/g," "),r=a({user:t,text:n,commentId:e.attr("comment")});return r}).slice(0,3),c=$(s({comments:l.length?l:!1}));c.appendTo("td.col3");var u=c.offset().top,d=$(window);$(window).off("scroll",e).on("scroll",e),$(window).off("resize",e).on("resize",e),e(),$.subscribe("load.specPhotoReport",function(){var t=$(".specPhotoReport");t.length&&(u=t.offset().top+t.height()),e()})}}};"undefined"!=typeof currentCommentsCountUrl&&currentCommentsCountUrl&&$(function(){var e=$(".commentsLink");e.length&&jsonRequest2({url:currentCommentsCountUrl,method:"GET",successCallback:function(t){var n=Number(t);e.text(n>0?e.text()+" ("+String(t)+")":e.attr("addText"))},failureCallback:function(t,n,i){"notFound"==i.data.errorType&&e.text(e.attr("addText"))}})}),$(function(){function e(){var e=n.offset().left+n.width(),t=$(window).width();i=t-e>o.width()&&$(window).width()>1340}function t(){var e=$(".commentsvlru .comment:visible .vote-for .action[action=vote-for]:first");if(i&&e.size()){var t=$(document).scrollTop();if(e.offset().top-t<250)return o.css("left",n.offset().left+n.width()+15),void o.fadeIn()}o.fadeOut()}if($("#catalog-add-comments-vote-motivator").size()){var n=$(".commentsvlru");if(n.size()){var i,o=$('<div class="vote-motivator"><div class="arrow"></div><div class="inner"><h3>Помог отзыв?</h3>Проголосуй за него, нажав <span class="plus">+</span> или <span class="minus">-</span>!</div></div>');o.insertAfter(n),e(),$(window).scroll(function(){t()}),$(window).on("resize",function(){e(),t()})}}}),$(document).ready(function(){$(".cmt-type").on("click",function(){$(".active > .cmt-type").parent().removeClass("active"),$(this).parent().addClass("active")})});